<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><link rel="stylesheet" type="text/css" href="/lessons/styles.css"></head><body class="c19 doc-content"><p class="c1"><span class="c22 c23">Atributele &icirc;n .NET.</span></p><p class="c1 c5"><span class="c0"></span></p><p class="c1"><span class="c11">Atributele &icirc;n .NET reprezint&#259; instrumente speciale care permit &icirc;ncorporarea de metadate suplimentare &icirc;n asambl&#259;ri. Atributele pot fi aplicate &icirc;ntregului tip (clas&#259;, interfa&#539;&#259; etc.) sau anumitor p&#259;r&#539;i ale acestuia (metod&#259;, proprietate etc.). Baza atributelor o constituie clasa</span><span class="c8">&nbsp;System.Attribute</span><span class="c0">, din care deriv&#259; toate celelalte clase de atribute. &Icirc;n .NET exist&#259; multe clase de atribute integrate, dar putem crea &#537;i propriile noastre clase de atribute care s&#259; defineasc&#259; metadate pentru alte tipuri.</span></p><p class="c1 c5"><span class="c0"></span></p><p class="c1"><span class="c0">S&#259; presupunem c&#259; trebuie s&#259; verific&#259;m dac&#259; un utilizator &icirc;ndepline&#537;te anumite restric&#539;ii de v&acirc;rst&#259;. Vom crea un atribut care va stoca pragul de v&acirc;rst&#259; de la care sunt permise anumite ac&#539;iuni:</span></p><p class="c1 c5"><span class="c0"></span></p><a id="t.8e56118cdaeb225ac622ad019374d783ca84d4de"></a><a id="t.0"></a><table class="c20"><tr class="c15"><td class="c12" colspan="1" rowspan="1"><p class="c14"><span class="c2">class</span><span class="c6">&nbsp;</span><span class="c7">AgeValidationAttribute</span><span class="c6">&nbsp;: </span><span class="c7">Attribute</span><span class="c6"><br>{<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c6">&nbsp;</span><span class="c2">int</span><span class="c6">&nbsp;Age { </span><span class="c2">get</span><span class="c6">; }<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c6">&nbsp;</span><span class="c7">AgeValidationAttribute</span><span class="c6">() { }<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c6">&nbsp;</span><span class="c7">AgeValidationAttribute</span><span class="c6">(</span><span class="c2">int</span><span class="c6">&nbsp;age) =&gt; Age = age;<br>}</span></p></td></tr></table><p class="c1 c5"><span class="c0"></span></p><p class="c1"><span class="c0">&Icirc;n esen&#539;&#259;, aceasta este o clas&#259; obi&#537;nuit&#259;, mo&#537;tenit&#259; din System.Attribute. &Icirc;n ea sunt defini&#539;i doi constructori: unul cu parametri &#537;i unul f&#259;r&#259;. Constructorul cu parametri al atributului prime&#537;te un prag de v&acirc;rst&#259; &#537;i &icirc;l salveaz&#259; &icirc;n proprietate.</span></p><p class="c1 c5"><span class="c0"></span></p><p class="c1"><span class="c0">Acum vom aplica acest atribut unei clase:</span></p><p class="c1 c5"><span class="c0"></span></p><a id="t.5b8c6d6ccf5d1da97597c3fa32a56abab6f3b925"></a><a id="t.1"></a><table class="c20"><tr class="c15"><td class="c12" colspan="1" rowspan="1"><p class="c14"><span class="c6">[</span><span class="c4">AgeValidation(18)</span><span class="c6">]<br></span><span class="c2">public</span><span class="c6">&nbsp;</span><span class="c2">class</span><span class="c6">&nbsp;</span><span class="c7">Person</span><span class="c6"><br>{<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c6">&nbsp;</span><span class="c2">string</span><span class="c6">&nbsp;Name { </span><span class="c2">get</span><span class="c6">; }<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c6">&nbsp;</span><span class="c2">int</span><span class="c6">&nbsp;Age { </span><span class="c2">get</span><span class="c6">; </span><span class="c2">set</span><span class="c6">; }<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c6">&nbsp;</span><span class="c7">Person</span><span class="c6">(</span><span class="c2">string</span><span class="c6">&nbsp;name, </span><span class="c2">int</span><span class="c6">&nbsp;age)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;Name = name;<br> &nbsp; &nbsp; &nbsp; &nbsp;Age = age;<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c1 c5"><span class="c0"></span></p><p class="c1"><span class="c11">Aceast&#259; clas&#259; Person aplic&#259; atributul. Pentru aceasta, numele atributului este specificat &icirc;ntre paranteze drepte chiar &icirc;nainte de definirea clasei. Sufixul Attribute nu este obligatoriu de men&#539;ionat. Ambele scrieri</span><span class="c11 c16">&nbsp;[AgeValidation(18)]</span><span class="c11">&nbsp;&#537;i </span><span class="c11 c16">[AgeValidationAttribute(18)] </span><span class="c0">sunt echivalente.</span></p><p class="c1 c5"><span class="c0"></span></p><p class="c1"><span class="c11">Dac&#259; constructorul atributului prevede utilizarea unor parametri (public </span><span class="c11 c16">AgeValidationAttribute(int age))</span><span class="c0">, atunci dup&#259; numele atributului putem specifica valorile pentru parametrii constructorului. &Icirc;n acest caz, se transmite valoarea pentru parametrul age. Astfel, practic, spunem c&#259; &icirc;n AgeValidationAttribute proprietatea Age va avea valoarea 18.</span></p><p class="c1 c5"><span class="c0"></span></p><p class="c1"><span class="c11">Ca alternativ&#259;, putem folosi parametri nominaliza&#539;i pentru toate propriet&#259;&#539;ile atributului, dac&#259; clasa atributului are un constructor f&#259;r&#259; parametri: </span><span class="c11 c16 c22">[AgeValidation(Age = 18)].</span></p><p class="c1 c5"><span class="c0"></span></p><p class="c1"><span class="c0">Acum s&#259; ob&#539;inem atributul clasei Person &#537;i s&#259;-l folosim pentru a verifica obiectele acestei clase:</span></p><p class="c1 c5"><span class="c0"></span></p><a id="t.b28751524f492f4db3b4c2523c5ba86d549adb82"></a><a id="t.2"></a><table class="c20"><tr class="c15"><td class="c12" colspan="1" rowspan="1"><p class="c14"><span class="c6">Person tom = </span><span class="c2">new</span><span class="c6">&nbsp;Person(</span><span class="c18">&quot;Tom&quot;</span><span class="c6">, </span><span class="c17">35</span><span class="c6">);<br>Person bob = </span><span class="c2">new</span><span class="c6">&nbsp;Person(</span><span class="c18">&quot;Bob&quot;</span><span class="c6">, </span><span class="c17">16</span><span class="c6">);<br></span><span class="c2">bool</span><span class="c6">&nbsp;tomIsValid = ValidateUser(tom); &nbsp; &nbsp;</span><span class="c10">// true</span><span class="c6"><br></span><span class="c2">bool</span><span class="c6">&nbsp;bobIsValid = ValidateUser(bob); &nbsp; &nbsp;</span><span class="c10">// false</span><span class="c6"><br> <br>Console.WriteLine(</span><span class="c18">$&quot;Rezultatul valid&#259;rii pentru Tom: {tomIsValid}&quot;</span><span class="c6">);<br>Console.WriteLine(</span><span class="c18">$&quot;Rezultatul valid&#259;rii pentru Bob: {bobIsValid}&quot;</span><span class="c6">);<br> <br></span><span class="c2">bool</span><span class="c6">&nbsp;</span><span class="c7">ValidateUser</span><span class="c6">(Person person)<br>{<br> &nbsp; &nbsp;Type type = </span><span class="c2">typeof</span><span class="c6">(Person);<br> &nbsp; &nbsp;</span><span class="c10">// ob&#539;inem toate atributele clasei Person</span><span class="c6"><br> &nbsp; &nbsp;</span><span class="c2">object</span><span class="c6">[] attributes = type.GetCustomAttributes(</span><span class="c2">false</span><span class="c6">);<br> <br> &nbsp; &nbsp;</span><span class="c10">// parcurgem toate atributele</span><span class="c6"><br> &nbsp; &nbsp;</span><span class="c2">foreach</span><span class="c6">&nbsp;(Attribute attr </span><span class="c2">in</span><span class="c6">&nbsp;attributes)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c10">// dac&#259; atributul reprezint&#259; tipul AgeValidationAttribute</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c2">if</span><span class="c6">&nbsp;(attr </span><span class="c2">is</span><span class="c6">&nbsp;AgeValidationAttribute ageAttribute)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c10">// return&#259;m rezultatul verific&#259;rii v&acirc;rstei</span><span class="c6"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c2">return</span><span class="c6">&nbsp;person.Age &gt;= ageAttribute.Age;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span class="c2">return</span><span class="c6">&nbsp;</span><span class="c2">true</span><span class="c6">;<br>}<br> <br></span><span class="c2">class</span><span class="c6">&nbsp;</span><span class="c7">AgeValidationAttribute</span><span class="c6">&nbsp;: </span><span class="c7">Attribute</span><span class="c6"><br>{<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c6">&nbsp;</span><span class="c2">int</span><span class="c6">&nbsp;Age { </span><span class="c2">get</span><span class="c6">; }<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c6">&nbsp;</span><span class="c7">AgeValidationAttribute</span><span class="c6">() { }<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c6">&nbsp;</span><span class="c7">AgeValidationAttribute</span><span class="c6">(</span><span class="c2">int</span><span class="c6">&nbsp;age) =&gt; Age = age;<br>}<br> <br>[</span><span class="c4">AgeValidation(18)</span><span class="c6">]<br></span><span class="c2">public</span><span class="c6">&nbsp;</span><span class="c2">class</span><span class="c6">&nbsp;</span><span class="c7">Person</span><span class="c6"><br>{<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c6">&nbsp;</span><span class="c2">string</span><span class="c6">&nbsp;Name { </span><span class="c2">get</span><span class="c6">; }<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c6">&nbsp;</span><span class="c2">int</span><span class="c6">&nbsp;Age { </span><span class="c2">get</span><span class="c6">; </span><span class="c2">set</span><span class="c6">; }<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c6">&nbsp;</span><span class="c7">Person</span><span class="c6">(</span><span class="c2">string</span><span class="c6">&nbsp;name, </span><span class="c2">int</span><span class="c6">&nbsp;age)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;Name = name;<br> &nbsp; &nbsp; &nbsp; &nbsp;Age = age;<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c1 c5"><span class="c0"></span></p><p class="c1"><span class="c0">&Icirc;n acest caz, &icirc;n metoda ValidateUser primim un obiect Person &#537;i folosind metoda GetCustomAttributes extragem toate atributele din tipul Person. Apoi, dintre atribute, ob&#539;inem atributul AgeValidationAttribute, dac&#259; acesta exist&#259; (pentru c&#259; putem s&#259; nu-l aplic&#259;m clasei) &#537;i verific&#259;m dac&#259; v&acirc;rsta utilizatorului este permis&#259;. Dac&#259; utilizatorul trece verificarea de v&acirc;rst&#259;, return&#259;m true, altfel return&#259;m false. Dac&#259; atributul nu este aplicat, return&#259;m true.</span></p><p class="c1 c5"><span class="c0"></span></p><p class="c1"><span class="c21">Limitarea aplic&#259;rii atributului.</span></p><p class="c1 c5"><span class="c0"></span></p><p class="c1"><span class="c11">Cu ajutorul atributului </span><span class="c8">AttributeUsage </span><span class="c0">putem limita tipurile la care poate fi aplicat atributul. De exemplu, dorim ca atributul definit mai sus s&#259; poat&#259; fi aplicat doar claselor:</span></p><p class="c1 c5"><span class="c0"></span></p><a id="t.fcdbe3bb8bcdd89b0acca7ecda4cd1f236040313"></a><a id="t.3"></a><table class="c20"><tr class="c15"><td class="c12" colspan="1" rowspan="1"><p class="c14"><span class="c6">[</span><span class="c4">AttributeUsage(AttributeTargets.Class)</span><span class="c6">]<br></span><span class="c2">class</span><span class="c6">&nbsp;</span><span class="c7">AgeValidationAttribute</span><span class="c6">&nbsp;: </span><span class="c7">Attribute</span><span class="c6"><br>{<br></span><span class="c10">//....................................</span><span class="c6"><br>}</span></p></td></tr></table><p class="c1 c5"><span class="c0"></span></p><p class="c1"><span class="c11">Limitarea este definit&#259; prin enumerarea </span><span class="c8">AttributeTargets</span><span class="c0">, care poate accepta &#537;i alte valori:</span></p><p class="c1 c5"><span class="c0"></span></p><ul class="c9 lst-kix_cinn73dxw4o-0 start"><li class="c1 c13 li-bullet-0"><span class="c8">All</span><span class="c0">: utilizat de toate tipurile</span></li></ul><p class="c1 c3"><span class="c0"></span></p><ul class="c9 lst-kix_cinn73dxw4o-0"><li class="c1 c13 li-bullet-0"><span class="c8">Assembly</span><span class="c0">: atributul se aplic&#259; la asamblare</span></li></ul><p class="c1 c3"><span class="c0"></span></p><ul class="c9 lst-kix_cinn73dxw4o-0"><li class="c1 c13 li-bullet-0"><span class="c8">Constructor</span><span class="c0">: atributul se aplic&#259; la constructor</span></li></ul><p class="c1 c3"><span class="c0"></span></p><ul class="c9 lst-kix_cinn73dxw4o-0"><li class="c1 c13 li-bullet-0"><span class="c8">Delegate</span><span class="c0">: atributul se aplic&#259; la delegat</span></li></ul><p class="c1 c3"><span class="c0"></span></p><ul class="c9 lst-kix_cinn73dxw4o-0"><li class="c1 c13 li-bullet-0"><span class="c8">Enum</span><span class="c0">: se aplic&#259; la enumerare</span></li></ul><p class="c1 c3"><span class="c0"></span></p><ul class="c9 lst-kix_cinn73dxw4o-0"><li class="c1 c13 li-bullet-0"><span class="c8">Event</span><span class="c0">: atributul se aplic&#259; la eveniment</span></li></ul><p class="c1 c3"><span class="c0"></span></p><ul class="c9 lst-kix_cinn73dxw4o-0"><li class="c1 c13 li-bullet-0"><span class="c8">Field</span><span class="c0">: se aplic&#259; la c&acirc;mpul unui tip</span></li></ul><p class="c1 c5"><span class="c0"></span></p><ul class="c9 lst-kix_cinn73dxw4o-0"><li class="c1 c13 li-bullet-0"><span class="c8">Interface</span><span class="c0">: atributul se aplic&#259; la interfa&#539;&#259;</span></li></ul><p class="c1 c3"><span class="c0"></span></p><ul class="c9 lst-kix_cinn73dxw4o-0"><li class="c1 c13 li-bullet-0"><span class="c8">Method</span><span class="c0">: se aplic&#259; la metod&#259;</span></li></ul><p class="c1 c3"><span class="c0"></span></p><ul class="c9 lst-kix_cinn73dxw4o-0"><li class="c1 c13 li-bullet-0"><span class="c8">Property</span><span class="c0">: se aplic&#259; la proprietate</span></li></ul><p class="c1 c3"><span class="c0"></span></p><ul class="c9 lst-kix_cinn73dxw4o-0"><li class="c1 c13 li-bullet-0"><span class="c8">Struct</span><span class="c0">: se aplic&#259; la structur&#259;</span></li></ul><p class="c1 c5"><span class="c0"></span></p><p class="c1"><span class="c11">Prin utilizarea operatorului logic OR, putem combina aceste valori. De exemplu, dac&#259; atributul poate fi aplicat at&acirc;t claselor, c&acirc;t &#537;i structurilor: </span><span class="c11 c16">[AttributeUsage(AttributeTargets.Class | AttributeTargets.Struct)]</span><span class="c0">.</span></p><p class="c1 c5"><span class="c0"></span></p></body></html>