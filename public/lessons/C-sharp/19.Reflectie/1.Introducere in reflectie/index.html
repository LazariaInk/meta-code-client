<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><link rel="stylesheet" type="text/css" href="/lessons/styles.css"></head><body class="c15 doc-content"><p class="c6"><span class="c12">Introducere &icirc;n reflec&#539;ie. Clasa System.Type.</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c0">Reflec&#539;ia </span><span class="c2">reprezint&#259; procesul de identificare a tipurilor &icirc;n timpul rul&#259;rii aplica&#539;iei. Fiecare aplica&#539;ie con&#539;ine un set de clase utilizate, interfe&#539;e, precum &#537;i metodele, propriet&#259;&#539;ile &#537;i alte componente ale acestora. Reflec&#539;ia permite determinarea tuturor acestor elemente componente ale aplica&#539;iei. Principala sarcin&#259; a reflec&#539;iei este studierea tipurilor.</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">Func&#539;ionalitatea principal&#259; a reflec&#539;iei este concentrat&#259; &icirc;n spa&#539;iul de nume </span><span class="c0">System.Reflection</span><span class="c2">. Aici, putem eviden&#539;ia urm&#259;toarele clase principale:</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">Assembly</span><span class="c2">: clasa care reprezint&#259; o asamblare &#537;i permite manipularea acesteia</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">AssemblyName</span><span class="c2">: clasa care stocheaz&#259; informa&#539;ii despre asamblare</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">MemberInfo</span><span class="c2">: clasa abstract&#259; de baz&#259; care define&#537;te func&#539;ionalitatea comun&#259; pentru clasele EventInfo, FieldInfo, MethodInfo &#537;i PropertyInfo</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">EventInfo</span><span class="c2">: clasa care stocheaz&#259; informa&#539;ii despre un eveniment</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">FieldInfo</span><span class="c2">: stocheaz&#259; informa&#539;ii despre un anumit c&acirc;mp al unui tip</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">MethodInfo</span><span class="c2">: stocheaz&#259; informa&#539;ii despre o anumit&#259; metod&#259;</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">PropertyInfo</span><span class="c2">: stocheaz&#259; informa&#539;ii despre o proprietate</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">ConstructorInfo</span><span class="c2">: clasa care reprezint&#259; un constructor</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">Module</span><span class="c2">: clasa care permite accesul la un anumit modul dintr-o asamblare</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">ParameterInfo</span><span class="c2">: clasa care stocheaz&#259; informa&#539;ii despre un parametru al unei metode</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">Aceste clase reprezint&#259; blocurile componente ale unui tip &#537;i aplica&#539;iei: metode, propriet&#259;&#539;i etc. Pentru a ob&#539;ine informa&#539;ii despre membrii unui tip, trebuie s&#259; utiliz&#259;m clasa </span><span class="c0">System.Type</span><span class="c2">.</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">Clasa </span><span class="c0">Type </span><span class="c2">reprezint&#259; tipul studiat, &icirc;ncapsul&acirc;nd toate informa&#539;iile despre acesta. Cu ajutorul propriet&#259;&#539;ilor &#537;i metodelor sale, putem ob&#539;ine aceste informa&#539;ii. Unele dintre propriet&#259;&#539;ile &#537;i metodele sale sunt:</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">-</span><span class="c0">&nbsp;FindMembers() </span><span class="c2">returneaz&#259; un array de obiecte MemberInfo al tipului dat</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">GetConstructors() </span><span class="c2">returneaz&#259; to&#539;i constructorii tipului dat sub form&#259; de set de obiecte ConstructorInfo</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">-</span><span class="c0">&nbsp;GetEvents() </span><span class="c2">returneaz&#259; toate evenimentele tipului dat sub form&#259; de array de obiecte EventInfo</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">-</span><span class="c0">&nbsp;GetFields() </span><span class="c2">returneaz&#259; toate c&acirc;mpurile tipului dat sub form&#259; de array de obiecte FieldInfo</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">-</span><span class="c0">&nbsp;GetInterfaces() </span><span class="c2">ob&#539;ine toate interfe&#539;ele implementate de tipul dat sub form&#259; de array de obiecte Type</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">GetMembers()</span><span class="c2">&nbsp;returneaz&#259; to&#539;i membrii tipului sub form&#259; de array de obiecte MemberInfo</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">-</span><span class="c0">&nbsp;GetMethods()</span><span class="c2">&nbsp;ob&#539;ine toate metodele tipului sub form&#259; de array de obiecte MethodInfo</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">GetProperties() </span><span class="c2">ob&#539;ine toate propriet&#259;&#539;ile sub form&#259; de array de obiecte PropertyInfo</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">Name</span><span class="c2">&nbsp;returneaz&#259; numele tipului</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">Assembly </span><span class="c2">returneaz&#259; numele asambl&#259;rii &icirc;n care este definit tipul</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">Namespace </span><span class="c2">returneaz&#259; numele spa&#539;iului de nume &icirc;n care este definit tipul</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">IsArray </span><span class="c2">returneaz&#259; true dac&#259; tipul este un array</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">IsClass </span><span class="c2">returneaz&#259; true dac&#259; tipul reprezint&#259; o clas&#259;</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">IsEnum </span><span class="c2">returneaz&#259; true dac&#259; tipul este o enumera&#539;ie</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">- </span><span class="c0">IsInterface </span><span class="c2">returneaz&#259; true dac&#259; tipul reprezint&#259; o interfa&#539;&#259;</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c13">Ob&#539;inerea tipului.</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">Pentru a manipula tipul &#537;i a ob&#539;ine toate informa&#539;iile despre acesta, trebuie mai &icirc;nt&acirc;i s&#259; ob&#539;inem tipul respectiv. Acest lucru poate fi realizat &icirc;n trei moduri: cu ajutorul operatorului </span><span class="c0">typeof</span><span class="c5">, folosind metoda </span><span class="c0">GetType() </span><span class="c5">a clasei Object &#537;i aplic&acirc;nd metoda static&#259; </span><span class="c5 c17">Type.GetType()</span><span class="c2">.</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">Ob&#539;inerea tipului prin </span><span class="c0">typeof</span><span class="c2">:</span></p><p class="c3"><span class="c2"></span></p><a id="t.779ada16770adbaba366919609846bc17dccf2f8"></a><a id="t.0"></a><table class="c10"><tr class="c8"><td class="c11" colspan="1" rowspan="1"><p class="c14"><span class="c1">Type myType = </span><span class="c4">typeof</span><span class="c1">(Person);<br><br>Console.WriteLine(myType); &nbsp;</span><span class="c16">// Person</span><span class="c1"><br><br></span><span class="c4">public</span><span class="c1">&nbsp;</span><span class="c4">class</span><span class="c1">&nbsp;</span><span class="c9">Person</span><span class="c1"><br>{<br> &nbsp; &nbsp;</span><span class="c4">public</span><span class="c1">&nbsp;</span><span class="c4">string</span><span class="c1">&nbsp;Name { </span><span class="c4">get</span><span class="c1">; }<br> &nbsp; &nbsp;</span><span class="c4">public</span><span class="c1">&nbsp;</span><span class="c9">Person</span><span class="c1">(</span><span class="c4">string</span><span class="c1">&nbsp;name) =&gt; Name = name;<br>}</span></p></td></tr></table><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">Aici, este definit&#259; clasa Person cu o anumit&#259; func&#539;ionalitate. Pentru a ob&#539;ine tipul acesteia, se folose&#537;te expresia </span><span class="c5 c17">Type myType = typeof(Person)</span><span class="c2">;.</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">Ob&#539;inerea tipului folosind metoda </span><span class="c0">GetType</span><span class="c5">, mo&#537;tenit&#259; de la clasa </span><span class="c5 c17">Object</span><span class="c2">:</span></p><p class="c3"><span class="c2"></span></p><a id="t.1a07eafaaff3e2bf09200b0fa9a6498539f5f939"></a><a id="t.1"></a><table class="c10"><tr class="c8"><td class="c11" colspan="1" rowspan="1"><p class="c14"><span class="c1">Person tom = </span><span class="c4">new</span><span class="c1">&nbsp;Person(</span><span class="c7">&quot;Tom&quot;</span><span class="c1">);<br>Type myType = tom.GetType();</span></p></td></tr></table><p class="c3"><span class="c2"></span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c2">Spre deosebire de exemplul anterior, aici, pentru a ob&#539;ine tipul, trebuie s&#259; cre&#259;m un obiect al clasei.</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">Al treilea mod de ob&#539;inere a tipului - metoda static&#259;</span><span class="c0">&nbsp;Type.GetType()</span><span class="c2">:</span></p><p class="c3"><span class="c2"></span></p><a id="t.065a291b3e07cd95aa84ef962b91aee853157fe6"></a><a id="t.2"></a><table class="c10"><tr class="c8"><td class="c11" colspan="1" rowspan="1"><p class="c14"><span class="c1">Type? myType = Type.GetType(</span><span class="c7">&quot;Person&quot;</span><span class="c1">, </span><span class="c4">false</span><span class="c1">, </span><span class="c4">true</span><span class="c1">);</span></p></td></tr></table><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c2">Primul parametru indic&#259; numele complet al clasei cu spa&#539;iul de nume. Al doilea parametru indic&#259; dac&#259; va fi generat&#259; o excep&#539;ie &icirc;n cazul &icirc;n care clasa nu poate fi g&#259;sit&#259;. &Icirc;n acest caz, valoarea false &icirc;nseamn&#259; c&#259; excep&#539;ia nu va fi generat&#259;. Al treilea parametru indic&#259; dac&#259; trebuie s&#259; se &#539;in&#259; cont de sensibilitatea la majuscule &#537;i minuscule &icirc;n primul parametru. Valoarea true &icirc;nseamn&#259; c&#259; sensibilitatea la majuscule &#537;i minuscule este ignorat&#259;. Deoarece tipul specificat poate lipsi, metoda returneaz&#259; un obiect de tip nullable.</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c2">&Icirc;n acest caz, clasa principal&#259; a programului &#537;i clasa Person se afl&#259; &icirc;n spa&#539;iul de nume global. Totu&#537;i, dac&#259; tipul este situat &icirc;ntr-un alt spa&#539;iu de nume, acesta trebuie de asemenea specificat:</span></p><p class="c3"><span class="c2"></span></p><a id="t.9f1fab43650362bf3706c1fd1dedfcb7b751d119"></a><a id="t.3"></a><table class="c10"><tr class="c8"><td class="c11" colspan="1" rowspan="1"><p class="c14"><span class="c1">Type? myType = Type.GetType(</span><span class="c7">&quot;PeopleTypes.Person&quot;</span><span class="c1">, </span><span class="c4">false</span><span class="c1">, </span><span class="c4">true</span><span class="c1">);<br><br>Console.WriteLine(myType); &nbsp;</span><span class="c16">// PeopleTypes.Person</span><span class="c1"><br><br></span><span class="c4">namespace</span><span class="c1">&nbsp;</span><span class="c9">PeopleTypes</span><span class="c1"><br>{<br> &nbsp; &nbsp;</span><span class="c4">public</span><span class="c1">&nbsp;</span><span class="c4">class</span><span class="c1">&nbsp;</span><span class="c9">Person</span><span class="c1"><br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c4">public</span><span class="c1">&nbsp;</span><span class="c4">string</span><span class="c1">&nbsp;Name { </span><span class="c4">get</span><span class="c1">; }<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c4">public</span><span class="c1">&nbsp;</span><span class="c9">Person</span><span class="c1">(</span><span class="c4">string</span><span class="c1">&nbsp;name) =&gt; Name = name;<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c2">Ca alternativ&#259;, putem folosi operatorul typeof, transmi&#539;&acirc;ndu-i numele tipului cu specificarea spa&#539;iului de nume:</span></p><p class="c3"><span class="c2"></span></p><a id="t.57ba505111b377b8148130510d5b8d6da230e5d4"></a><a id="t.4"></a><table class="c10"><tr class="c8"><td class="c11" colspan="1" rowspan="1"><p class="c14"><span class="c1">Type myType = </span><span class="c4">typeof</span><span class="c1">(PeopleTypes.Person);</span></p></td></tr></table><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c2">Dac&#259; tipul necesar se afl&#259; &icirc;ntr-o alt&#259; asamblare dll, atunci dup&#259; numele complet al clasei, se specific&#259; numele asambl&#259;rii, separat prin virgul&#259;:</span></p><p class="c3"><span class="c2"></span></p><a id="t.27357c532888907ecddf4dfce666e7c7d833f965"></a><a id="t.5"></a><table class="c10"><tr class="c8"><td class="c11" colspan="1" rowspan="1"><p class="c14"><span class="c1">Type myType = Type.GetType(</span><span class="c7">&quot;PeopleTypes.Person, MyLibrary&quot;</span><span class="c1">, </span><span class="c4">false</span><span class="c1">, </span><span class="c4">true</span><span class="c1">);</span></p></td></tr></table><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c2">Acum vom explora tipul &#537;i vom ob&#539;ine c&acirc;teva informa&#539;ii despre el.</span></p><p class="c3"><span class="c2"></span></p><a id="t.f1c6f6644993a013c6adf817808ea49c94105077"></a><a id="t.6"></a><table class="c10"><tr class="c8"><td class="c11" colspan="1" rowspan="1"><p class="c14"><span class="c1">Type myType = </span><span class="c4">typeof</span><span class="c1">(PeopleTypes.Person);<br><br>Console.WriteLine(</span><span class="c7">$&quot;Name: {myType.Name}&quot;</span><span class="c1">); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c16">// ob&#539;inem numele scurt al tipului</span><span class="c1"><br>Console.WriteLine(</span><span class="c7">$&quot;Full Name: {myType.FullName}&quot;</span><span class="c1">); &nbsp; &nbsp; </span><span class="c16">// ob&#539;inem numele complet al tipului</span><span class="c1"><br>Console.WriteLine(</span><span class="c7">$&quot;Namespace: {myType.Namespace}&quot;</span><span class="c1">); &nbsp; &nbsp;</span><span class="c16">// ob&#539;inem spa&#539;iul de nume al tipului</span><span class="c1"><br>Console.WriteLine(</span><span class="c7">$&quot;Is struct: {myType.IsValueType}&quot;</span><span class="c1">); &nbsp;</span><span class="c16">// verific&#259;m dac&#259; tipul este structur&#259;</span><span class="c1"><br>Console.WriteLine(</span><span class="c7">$&quot;Is class: {myType.IsClass}&quot;</span><span class="c1">); &nbsp; &nbsp; &nbsp; </span><span class="c16">// verific&#259;m dac&#259; tipul este clas&#259;</span><span class="c1"><br><br></span><span class="c4">namespace</span><span class="c1">&nbsp;</span><span class="c9">PeopleTypes</span><span class="c1"><br>{<br> &nbsp; &nbsp;</span><span class="c4">class</span><span class="c1">&nbsp;</span><span class="c9">Person</span><span class="c1"><br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c4">public</span><span class="c1">&nbsp;</span><span class="c4">string</span><span class="c1">&nbsp;Name { </span><span class="c4">get</span><span class="c1">; }<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c4">public</span><span class="c1">&nbsp;</span><span class="c9">Person</span><span class="c1">(</span><span class="c4">string</span><span class="c1">&nbsp;name) =&gt; Name = name;<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c2">Output-ul consolei:</span></p><p class="c3"><span class="c2"></span></p><a id="t.0960ca835206e58e659e0dcf009b4e72662184eb"></a><a id="t.7"></a><table class="c10"><tr class="c8"><td class="c11" colspan="1" rowspan="1"><p class="c14"><span class="c1">Name: Person<br>Full Name: PeopleTypes.Person<br>Namespace: PeopleTypes<br>Is </span><span class="c4">struct</span><span class="c1">: False<br>Is </span><span class="c4">class</span><span class="c1">: </span><span class="c9">True</span></p></td></tr></table><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c13">C&#259;utarea interfe&#539;elor implementate.</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c5">Pentru a ob&#539;ine toate interfe&#539;ele implementate de tip, trebuie s&#259; utiliz&#259;m metoda </span><span class="c0">GetInterfaces()</span><span class="c2">, care returneaz&#259; un array de obiecte Type:</span></p><p class="c3"><span class="c2"></span></p><a id="t.0bd04161215e33814341627583c0f6dcf7966e0e"></a><a id="t.8"></a><table class="c10"><tr class="c8"><td class="c11" colspan="1" rowspan="1"><p class="c14"><span class="c1">Type myType = </span><span class="c4">typeof</span><span class="c1">(Person);<br><br>Console.WriteLine(</span><span class="c7">&quot;Interfe&#539;ele implementate:&quot;</span><span class="c1">);<br></span><span class="c4">foreach</span><span class="c1">&nbsp;(Type i </span><span class="c4">in</span><span class="c1">&nbsp;myType.GetInterfaces())<br>{<br> &nbsp; &nbsp;Console.WriteLine(i.Name);<br>}<br><br></span><span class="c4">public</span><span class="c1">&nbsp;</span><span class="c4">class</span><span class="c1">&nbsp;</span><span class="c9">Person</span><span class="c1">&nbsp;: </span><span class="c9">IEater</span><span class="c1">, </span><span class="c9">IMovable</span><span class="c1"><br>{<br> &nbsp; &nbsp;</span><span class="c4">public</span><span class="c1">&nbsp;</span><span class="c4">string</span><span class="c1">&nbsp;Name { </span><span class="c4">get</span><span class="c1">; }<br> &nbsp; &nbsp;</span><span class="c4">public</span><span class="c1">&nbsp;</span><span class="c9">Person</span><span class="c1">(</span><span class="c4">string</span><span class="c1">&nbsp;name) =&gt; Name = name;<br> &nbsp; &nbsp;</span><span class="c4">public</span><span class="c1">&nbsp;</span><span class="c4">void</span><span class="c1">&nbsp;</span><span class="c9">Eat</span><span class="c1">() =&gt; Console.WriteLine(</span><span class="c7">$&quot;{Name} m&#259;n&acirc;nc&#259;&quot;</span><span class="c1">);<br><br> &nbsp; &nbsp;</span><span class="c4">public</span><span class="c1">&nbsp;</span><span class="c4">void</span><span class="c1">&nbsp;</span><span class="c9">Move</span><span class="c1">() =&gt; Console.WriteLine(</span><span class="c7">$&quot;{Name} se mi&#537;c&#259;&quot;</span><span class="c1">);<br>}<br><br></span><span class="c4">interface</span><span class="c1">&nbsp;</span><span class="c9">IEater</span><span class="c1"><br>{<br> &nbsp; &nbsp;</span><span class="c4">void</span><span class="c1">&nbsp;</span><span class="c9">Eat</span><span class="c1">();<br>}<br><br></span><span class="c4">interface</span><span class="c1">&nbsp;</span><span class="c9">IMovable</span><span class="c1"><br>{<br> &nbsp; &nbsp;</span><span class="c4">void</span><span class="c1">&nbsp;</span><span class="c9">Move</span><span class="c1">();<br>}</span></p></td></tr></table><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c2">Deoarece fiecare interfa&#539;&#259; reprezint&#259; un obiect Type, pentru fiecare interfa&#539;&#259; ob&#539;inut&#259; putem aplica metodele discutate mai sus pentru a extrage informa&#539;ii despre propriet&#259;&#539;i &#537;i metode.</span></p><p class="c3"><span class="c2"></span></p><p class="c6"><span class="c2">&Icirc;ns&#259; p&acirc;n&#259; acum, toate exemplele de mai sus nu au folosit reflec&#539;ia. &Icirc;n urm&#259;toarele teme vom examina cum putem folosi reflec&#539;ia pentru a ob&#539;ine componentele unui tip &#537;i pentru a le accesa, de exemplu, pentru a modifica valorile c&acirc;mpurilor private ale unei clase.</span></p><p class="c3"><span class="c2"></span></p></body></html>