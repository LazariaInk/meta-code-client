<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><link rel="stylesheet" type="text/css" href="/lessons/styles.css"></head><body class="c13 doc-content"><p class="c1"><span class="c19">Fi&#537;iere binare. BinaryWriter &#537;i BinaryReader.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">Pentru lucrul cu fi&#537;ierele binare sunt destinate dou&#259; clase: </span><span class="c7">BinaryWriter </span><span class="c3">&#537;i </span><span class="c7">BinaryReader</span><span class="c0">. Aceste clase permit citirea &#537;i scrierea datelor &icirc;n format binar.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c16">BinaryWriter.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c0">Pentru a crea un obiect BinaryWriter se pot folosi mai mul&#539;i constructori. Unul dintre cei mai simpli este:</span></p><p class="c1 c4"><span class="c0"></span></p><a id="t.0fa6e36ad446f28b3117e9186089172f4772abc2"></a><a id="t.0"></a><table class="c12"><tr class="c14"><td class="c17" colspan="1" rowspan="1"><p class="c6"><span class="c5">BinaryWriter(Stream stream)</span></p></td></tr></table><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c0">&Icirc;n constructorul s&#259;u se transmite un obiect Stream (de obicei, acesta este un obiect FileStream).</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">Principalele metode ale clasei </span><span class="c7">BinaryWriter</span><span class="c0">:</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">-</span><span class="c7">&nbsp;Close()</span><span class="c0">: &icirc;nchide fluxul &#537;i elibereaz&#259; resursele.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">-</span><span class="c7">&nbsp;Flush()</span><span class="c0">: cur&#259;&#539;&#259; bufferul, scriind datele r&#259;mase din buffer &icirc;n fi&#537;ier.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">- </span><span class="c7">Seek()</span><span class="c0">: seteaz&#259; pozi&#539;ia &icirc;n flux.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">- </span><span class="c7">Write()</span><span class="c0">: scrie date &icirc;n flux. Ca parametru, aceast&#259; metod&#259; poate primi valori de tipuri primitive:</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">&nbsp; -</span><span class="c8 c3">&nbsp;Write(bool)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(byte)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(char)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(decimal)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(double)</span></p><p class="c1 c4"><span class="c3 c8"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(Half)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(short)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(int)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(long)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(sbyte)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(float)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(string)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(ushort)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(uint)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(ulong)</span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c0">&nbsp; Sau poate primi array-uri de tipuri byte &#537;i char:</span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(byte[])</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(char[])</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(ReadOnlySpan&lt;byte&gt;)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(ReadOnlySpan&lt;char&gt;)</span></p><p class="c1"><span class="c0">&nbsp; </span></p><p class="c1"><span class="c0">&nbsp; La scrierea unui array, se poate specifica de la ce element al array-ului trebuie s&#259; &icirc;nceap&#259; scrierea, precum &#537;i num&#259;rul de elemente care urmeaz&#259; s&#259; fie scrise:</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">&nbsp; </span><span class="c8 c3">- Write(byte[], int, int)</span></p><p class="c1 c4"><span class="c8 c3"></span></p><p class="c1"><span class="c8 c3">&nbsp; - Write(char[], int, int)</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c0">S&#259; vedem un exemplu simplu de scriere a unui fi&#537;ier binar:</span></p><p class="c1 c4"><span class="c0"></span></p><a id="t.494a680e27cb00f87769bea3d03a92d7c03bfb30"></a><a id="t.1"></a><table class="c12"><tr class="c14"><td class="c17" colspan="1" rowspan="1"><p class="c6"><span class="c2">string</span><span class="c5">&nbsp;path = </span><span class="c10">&quot;person.dat&quot;</span><span class="c5">;<br> <br></span><span class="c9">// cre&#259;m un obiect BinaryWriter</span><span class="c5"><br></span><span class="c2">using</span><span class="c5">&nbsp;(BinaryWriter writer = </span><span class="c2">new</span><span class="c5">&nbsp;BinaryWriter(File.Open(path, FileMode.OpenOrCreate)))<br>{<br> &nbsp; &nbsp;</span><span class="c9">// scriem &icirc;n fi&#537;ier un &#537;ir de caractere</span><span class="c5"><br> &nbsp; &nbsp;writer.Write(</span><span class="c10">&quot;Tom&quot;</span><span class="c5">);<br> &nbsp; &nbsp;</span><span class="c9">// scriem &icirc;n fi&#537;ier un num&#259;r de tip int</span><span class="c5"><br> &nbsp; &nbsp;writer.Write(</span><span class="c11">37</span><span class="c5">);<br> &nbsp; &nbsp;Console.WriteLine(</span><span class="c10">&quot;Fi&#537;ierul a fost scris&quot;</span><span class="c5">);<br>}</span></p></td></tr></table><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">&Icirc;n acest caz, &icirc;n fi&#537;ierul person.dat sunt scrise dou&#259; valori: un &#537;ir de caractere &quot;Tom&quot; &#537;i un num&#259;r 37. Pentru crearea obiectului se folose&#537;te apelul </span><span class="c3 c18">new BinaryWriter(File.Open(path, FileMode.OpenOrCreate))</span><span class="c0">.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c0">Similar, putem salva date mai complexe. De exemplu, s&#259; salv&#259;m &icirc;n fi&#537;ier un array de obiecte:</span></p><p class="c1 c4"><span class="c0"></span></p><a id="t.bb6850c0f621cb8bce52d995f30c910b91b819f7"></a><a id="t.2"></a><table class="c12"><tr class="c14"><td class="c17" colspan="1" rowspan="1"><p class="c6"><span class="c2">string</span><span class="c5">&nbsp;path = </span><span class="c10">&quot;people.dat&quot;</span><span class="c5">;<br> <br></span><span class="c9">// array pentru scriere</span><span class="c5"><br>Person[] people =<br>{<br> &nbsp; &nbsp;</span><span class="c2">new</span><span class="c5">&nbsp;Person(</span><span class="c10">&quot;Tom&quot;</span><span class="c5">, </span><span class="c11">37</span><span class="c5">),<br> &nbsp; &nbsp;</span><span class="c2">new</span><span class="c5">&nbsp;Person(</span><span class="c10">&quot;Bob&quot;</span><span class="c5">, </span><span class="c11">41</span><span class="c5">)<br>};<br> <br></span><span class="c2">using</span><span class="c5">&nbsp;(BinaryWriter writer = </span><span class="c2">new</span><span class="c5">&nbsp;BinaryWriter(File.Open(path, FileMode.OpenOrCreate)))<br>{<br> &nbsp; &nbsp;</span><span class="c9">// scriem &icirc;n fi&#537;ier valoarea fiec&#259;rei propriet&#259;&#539;i a obiectului</span><span class="c5"><br> &nbsp; &nbsp;</span><span class="c2">foreach</span><span class="c5">&nbsp;(Person person </span><span class="c2">in</span><span class="c5">&nbsp;people)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;writer.Write(person.Name);<br> &nbsp; &nbsp; &nbsp; &nbsp;writer.Write(person.Age);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;Console.WriteLine(</span><span class="c10">&quot;Fi&#537;ierul a fost scris&quot;</span><span class="c5">);<br>}<br> <br></span><span class="c2">class</span><span class="c5">&nbsp;</span><span class="c15">Person</span><span class="c5"><br>{<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c5">&nbsp;</span><span class="c2">string</span><span class="c5">&nbsp;Name { </span><span class="c2">get</span><span class="c5">; </span><span class="c2">set</span><span class="c5">; }<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c5">&nbsp;</span><span class="c2">int</span><span class="c5">&nbsp;Age { </span><span class="c2">get</span><span class="c5">; </span><span class="c2">set</span><span class="c5">; }<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c5">&nbsp;</span><span class="c15">Person</span><span class="c5">(</span><span class="c2">string</span><span class="c5">&nbsp;name, </span><span class="c2">int</span><span class="c5">&nbsp;age)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;Name = name;<br> &nbsp; &nbsp; &nbsp; &nbsp;Age = age;<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c0">&Icirc;n acest exemplu, salv&#259;m secven&#539;ial &icirc;n fi&#537;ierul people.dat datele obiectelor Person din array-ul people.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c16">BinaryReader.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c0">Pentru a crea un obiect BinaryReader se pot folosi mai mul&#539;i constructori. Una dintre cele mai simple versiuni este:</span></p><p class="c1 c4"><span class="c0"></span></p><a id="t.a563563bcbc613709a6b8b42752f07173bf0b246"></a><a id="t.3"></a><table class="c12"><tr class="c14"><td class="c17" colspan="1" rowspan="1"><p class="c6"><span class="c5">Reader(Stream stream)</span></p></td></tr></table><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c0">Constructorul s&#259;u prime&#537;te, de asemenea, un obiect Stream (de obicei, un obiect FileStream).</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">Principalele metode ale clasei </span><span class="c7">BinaryReader</span><span class="c0">:</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">- </span><span class="c7">Close()</span><span class="c0">: &icirc;nchide fluxul &#537;i elibereaz&#259; resursele.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">- </span><span class="c7">ReadBoolean()</span><span class="c0">: cite&#537;te o valoare de tip bool &#537;i mut&#259; pointerul cu un byte &icirc;nainte.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">- </span><span class="c7">ReadByte()</span><span class="c0">: cite&#537;te un byte &#537;i mut&#259; pointerul cu un byte &icirc;nainte.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">- </span><span class="c7">ReadChar()</span><span class="c0">: cite&#537;te o valoare de tip char, adic&#259; un caracter, &#537;i mut&#259; pointerul cu num&#259;rul de bytes ocupat de caracter &icirc;n codificarea curent&#259;.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">-</span><span class="c7">&nbsp;ReadDecimal()</span><span class="c0">: cite&#537;te o valoare de tip decimal &#537;i mut&#259; pointerul cu 16 bytes &icirc;nainte.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">- </span><span class="c7">ReadDouble()</span><span class="c0">: cite&#537;te o valoare de tip double &#537;i mut&#259; pointerul cu 8 bytes &icirc;nainte.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">-</span><span class="c7">&nbsp;ReadInt16()</span><span class="c0">: cite&#537;te o valoare de tip short &#537;i mut&#259; pointerul cu 2 bytes &icirc;nainte.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">- </span><span class="c7">ReadInt32()</span><span class="c0">: cite&#537;te o valoare de tip int &#537;i mut&#259; pointerul cu 4 bytes &icirc;nainte.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">-</span><span class="c7">&nbsp;ReadInt64()</span><span class="c0">: cite&#537;te o valoare de tip long &#537;i mut&#259; pointerul cu 8 bytes &icirc;nainte.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">- </span><span class="c7">ReadSingle()</span><span class="c0">: cite&#537;te o valoare de tip float &#537;i mut&#259; pointerul cu 4 bytes &icirc;nainte.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">- </span><span class="c7">ReadString()</span><span class="c0">: cite&#537;te un &#537;ir de caractere. Fiecare &#537;ir este precedat de valoarea lungimii sale, care reprezint&#259; un num&#259;r &icirc;ntreg de 7 bi&#539;i.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c0">Citirea datelor binare este simpl&#259;: metoda corespunz&#259;toare cite&#537;te datele unui anumit tip &#537;i mut&#259; pointerul cu dimensiunea acestui tip &icirc;n bytes. De exemplu, valoarea de tip int ocup&#259; 4 bytes, deci BinaryReader va citi 4 bytes &#537;i va muta pointerul cu ace&#537;ti 4 bytes.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c0">De exemplu, &icirc;n exemplul anterior cu BinaryWriter am scris &icirc;n fi&#537;ierul person.dat un &#537;ir de caractere &#537;i un num&#259;r. S&#259; le citim cu ajutorul BinaryReader:</span></p><p class="c1 c4"><span class="c0"></span></p><a id="t.25c283babb5f857380a23900bb7cf22a2324784b"></a><a id="t.4"></a><table class="c12"><tr class="c14"><td class="c17" colspan="1" rowspan="1"><p class="c6"><span class="c2">using</span><span class="c5">&nbsp;(BinaryReader reader = </span><span class="c2">new</span><span class="c5">&nbsp;BinaryReader(File.Open(</span><span class="c10">&quot;person.dat&quot;</span><span class="c5">, FileMode.Open)))<br>{<br> &nbsp; &nbsp;</span><span class="c9">// citim din fi&#537;ier un &#537;ir de caractere</span><span class="c5"><br> &nbsp; &nbsp;</span><span class="c2">string</span><span class="c5">&nbsp;name = reader.ReadString();<br> &nbsp; &nbsp;</span><span class="c9">// citim din fi&#537;ier un num&#259;r </span><span class="c5"><br> &nbsp; &nbsp;</span><span class="c2">int</span><span class="c5">&nbsp;age = reader.ReadInt32();<br> &nbsp; &nbsp;Console.WriteLine(</span><span class="c10">$&quot;Nume: {name} &nbsp;V&acirc;rst&#259;: {age}&quot;</span><span class="c5">);<br>}</span></p></td></tr></table><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">Constructorul clasei BinaryReader prime&#537;te, de asemenea, un obiect de flux, dar &icirc;n acest caz stabilim modul de deschidere ca FileMode.Open: </span><span class="c3 c18">new BinaryReader(File.Open(&quot;person.dat&quot;, FileMode.Open))</span><span class="c0">.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c0">&Icirc;n ordinea &icirc;n care datele au fost scrise &icirc;n fi&#537;ier, &icirc;n aceea&#537;i ordine le putem citi de acolo. Deci, dac&#259; mai &icirc;nt&acirc;i a fost scris un &#537;ir de caractere, apoi un num&#259;r, atunci &icirc;n aceast&#259; ordine le putem citi din fi&#537;ier.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c0">Sau, similar, putem citi datele din fi&#537;ierul people.dat, care a fost scris &icirc;n exemplul de mai sus &#537;i care con&#539;ine datele obiectelor Person:</span></p><p class="c1 c4"><span class="c0"></span></p><a id="t.82c2890e04cedccbd6e7f7c316e579f5e9f8ce8d"></a><a id="t.5"></a><table class="c12"><tr class="c14"><td class="c17" colspan="1" rowspan="1"><p class="c6"><span class="c9">// list&#259; pentru datele citite</span><span class="c5"><br>List&lt;Person&gt; people = </span><span class="c2">new</span><span class="c5">&nbsp;List&lt;Person&gt;();<br> <br></span><span class="c9">// cre&#259;m un obiect BinaryReader</span><span class="c5"><br></span><span class="c2">using</span><span class="c5">&nbsp;(BinaryReader reader = </span><span class="c2">new</span><span class="c5">&nbsp;BinaryReader(File.Open(</span><span class="c10">&quot;people.dat&quot;</span><span class="c5">, FileMode.Open)))<br>{<br> &nbsp; &nbsp;</span><span class="c9">// p&acirc;n&#259; c&acirc;nd nu este atins sf&acirc;r&#537;itul fi&#537;ierului</span><span class="c5"><br> &nbsp; &nbsp;</span><span class="c9">// citim fiecare valoare din fi&#537;ier</span><span class="c5"><br> &nbsp; &nbsp;</span><span class="c2">while</span><span class="c5">&nbsp;(reader.PeekChar() &gt; </span><span class="c11">-1</span><span class="c5">)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c2">string</span><span class="c5">&nbsp;name = reader.ReadString();<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c2">int</span><span class="c5">&nbsp;age = reader.ReadInt32();<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c9">// pe baza datelor citite cre&#259;m un obiect Person &#537;i &icirc;l ad&#259;ug&#259;m &icirc;n list&#259;</span><span class="c5"><br> &nbsp; &nbsp; &nbsp; &nbsp;people.Add(</span><span class="c2">new</span><span class="c5">&nbsp;Person(name, age));<br> &nbsp; &nbsp;}<br>}<br></span><span class="c9">// afi&#537;&#259;m con&#539;inutul listei people &icirc;n consol&#259;</span><span class="c5"><br></span><span class="c2">foreach</span><span class="c5">(Person person </span><span class="c2">in</span><span class="c5">&nbsp;people)<br>{<br> &nbsp; &nbsp;Console.WriteLine(</span><span class="c10">$&quot;Nume: {person.Name} &nbsp;V&acirc;rst&#259;: {person.Age}&quot;</span><span class="c5">);<br>}<br> <br></span><span class="c2">class</span><span class="c5">&nbsp;</span><span class="c15">Person</span><span class="c5"><br>{<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c5">&nbsp;</span><span class="c2">string</span><span class="c5">&nbsp;Name { </span><span class="c2">get</span><span class="c5">; </span><span class="c2">set</span><span class="c5">; }<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c5">&nbsp;</span><span class="c2">int</span><span class="c5">&nbsp;Age { </span><span class="c2">get</span><span class="c5">; </span><span class="c2">set</span><span class="c5">; }<br> &nbsp; &nbsp;</span><span class="c2">public</span><span class="c5">&nbsp;</span><span class="c15">Person</span><span class="c5">(</span><span class="c2">string</span><span class="c5">&nbsp;name, </span><span class="c2">int</span><span class="c5">&nbsp;age)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;Name = name;<br> &nbsp; &nbsp; &nbsp; &nbsp;Age = age;<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c3">Aici citim datele &icirc;ntr-un ciclu </span><span class="c3 c18">while</span><span class="c3">. Pentru a afla sf&acirc;r&#537;itul fluxului, apel&#259;m metoda </span><span class="c3 c18">PeekChar()</span><span class="c0">. Aceast&#259; metod&#259; cite&#537;te urm&#259;torul caracter &#537;i returneaz&#259; reprezentarea sa numeric&#259;. Dac&#259; caracterul nu exist&#259;, metoda returneaz&#259; -1, ceea ce va indica faptul c&#259; am ajuns la sf&acirc;r&#537;itul fi&#537;ierului.</span></p><p class="c1 c4"><span class="c0"></span></p><p class="c1"><span class="c0">&Icirc;n ciclu, citim secven&#539;ial valorile propriet&#259;&#539;ilor obiectelor Person &icirc;n aceea&#537;i ordine &icirc;n care au fost scrise.</span></p><p class="c1 c4"><span class="c0"></span></p></body></html>