<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <link rel="stylesheet" type="text/css" href="/lessons/styles.css">
</head>

<body class="c15 doc-content">
    <h1 class="c9 c17">Iteratoare È™i operatorul yield.</h1>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c12">Un </span><span class="c14">iterativ </span><span class="c12">reprezint&#259; un
            bloc de cod care utilizeaz&#259; operatorul </span><span class="c14">yield </span><span class="c4">pentru a
            parcurge un set de valori. Acest bloc de cod poate reprezenta corpul unei metode, al unui operator sau
            blocul get al unei propriet&#259;&#539;i.</span></p>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c4">Un iterativ utilizeaz&#259; dou&#259; instruc&#539;iuni speciale:</span></p>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c12">- </span><span class="c14">yield return</span><span class="c4">: define&#537;te
            elementul returnat</span></p>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c12">-</span><span class="c14">&nbsp;yield break</span><span class="c4">: indic&#259;
            faptul c&#259; secven&#539;a nu mai are elemente</span></p>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c4">S&#259; vedem un mic exemplu:</span></p>
    <p class="c3"><span class="c4"></span></p><a id="t.12b8c5b558d5acc349dca3330dcfa66c2f72bce2"></a><a id="t.0"></a>
    <table class="c6">
        <tr class="c10">
            <td class="c1" colspan="1" rowspan="1">
                <p class="c7"><span class="c2">Numbers numbers = </span><span class="c0">new</span><span
                        class="c2">&nbsp;Numbers();<br></span><span class="c0">foreach</span><span
                        class="c2">&nbsp;(</span><span class="c0">int</span><span class="c2">&nbsp;n </span><span
                        class="c0">in</span><span class="c2">&nbsp;numbers)<br>{<br> &nbsp;
                        &nbsp;Console.WriteLine(n);<br>}<br><br></span><span class="c0">class</span><span
                        class="c2">&nbsp;</span><span class="c5">Numbers</span><span class="c2"><br>{<br> &nbsp;
                        &nbsp;</span><span class="c0">public</span><span class="c2">&nbsp;IEnumerator&lt;</span><span
                        class="c0">int</span><span class="c2">&gt; </span><span class="c5">GetEnumerator</span><span
                        class="c2">()<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span
                        class="c0">for</span><span class="c2">&nbsp;(</span><span class="c0">int</span><span
                        class="c2">&nbsp;i = </span><span class="c11">0</span><span class="c2">; i &lt; </span><span
                        class="c11">6</span><span class="c2">; i++)<br> &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp;
                        &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c0">yield</span><span
                        class="c2">&nbsp;</span><span class="c0">return</span><span class="c2">&nbsp;i * i;<br> &nbsp;
                        &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;}<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c12">&Icirc;n clasa Numbers, metoda</span><span
            class="c14">&nbsp;GetEnumerator()</span><span class="c12">&nbsp;reprezint&#259; de fapt un iterativ. Cu
            ajutorul operatorului </span><span class="c14">yield return </span><span class="c4">se returneaz&#259; o
            valoare (&icirc;n acest caz, p&#259;tratul num&#259;rului).</span></p>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c4">&Icirc;n program, cu ajutorul ciclului foreach, putem parcurge obiectul Numbers ca o
            colec&#539;ie obi&#537;nuit&#259;. La ob&#539;inerea fiec&#259;rui element &icirc;n ciclul foreach, va fi
            declan&#537;at operatorul yield return, care va returna un element &#537;i va memora pozi&#539;ia
            curent&#259;.</span></p>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c4">Datorit&#259; iteratoarelor, putem merge mai departe &#537;i implementa cu
            u&#537;urin&#539;&#259; parcurgerea unui num&#259;r &icirc;n ciclul foreach:</span></p>
    <p class="c3"><span class="c4"></span></p><a id="t.421922c7b421d07575d9e27c2dbb3f0902800a6f"></a><a id="t.1"></a>
    <table class="c6">
        <tr class="c10">
            <td class="c1" colspan="1" rowspan="1">
                <p class="c7"><span class="c0">foreach</span><span class="c2">(</span><span class="c0">var</span><span
                        class="c2">&nbsp;n </span><span class="c0">in</span><span class="c2">&nbsp;</span><span
                        class="c11">5</span><span class="c2">) Console.WriteLine(n);<br></span><span
                        class="c0">foreach</span><span class="c2">&nbsp;(</span><span class="c0">var</span><span
                        class="c2">&nbsp;n </span><span class="c0">in</span><span class="c2">&nbsp;</span><span
                        class="c11">-5</span><span class="c2">) Console.WriteLine(n);<br><br></span><span
                        class="c0">static</span><span class="c2">&nbsp;</span><span class="c0">class</span><span
                        class="c2">&nbsp;</span><span class="c5">Int32Extension</span><span class="c2"><br>{<br> &nbsp;
                        &nbsp;</span><span class="c0">public</span><span class="c2">&nbsp;</span><span
                        class="c0">static</span><span class="c2">&nbsp;IEnumerator&lt;</span><span
                        class="c0">int</span><span class="c2">&gt; </span><span class="c5">GetEnumerator</span><span
                        class="c2">(</span><span class="c0">this</span><span class="c2">&nbsp;</span><span
                        class="c0">int</span><span class="c2">&nbsp;number)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp;
                        &nbsp;</span><span class="c0">int</span><span class="c2">&nbsp;k = (number &gt; </span><span
                        class="c11">0</span><span class="c2">) ? number : </span><span class="c11">0</span><span
                        class="c2">;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c0">for</span><span
                        class="c2">&nbsp;(</span><span class="c0">int</span><span class="c2">&nbsp;i = number - k; i
                        &lt;= k; i++) </span><span class="c0">yield</span><span class="c2">&nbsp;</span><span
                        class="c0">return</span><span class="c2">&nbsp;i;<br> &nbsp; &nbsp;}<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c4">&Icirc;n acest caz, iterativul este implementat ca o metod&#259; de extensie pentru
            tipul int sau System.Int32. &Icirc;n metoda iterativului, return&#259;m de fapt toate valorile &icirc;ntregi
            de la 0 la num&#259;rul curent. Rezultatul &icirc;n consol&#259;:</span></p>
    <p class="c3"><span class="c4"></span></p><a id="t.a44d22afbf112cd71cc158d0beaa414fec0c6503"></a><a id="t.2"></a>
    <table class="c6">
        <tr class="c10">
            <td class="c1" colspan="1" rowspan="1">
                <p class="c7"><span class="c11">0</span><span class="c2"><br></span><span class="c11">1</span><span
                        class="c2"><br></span><span class="c11">2</span><span class="c2"><br></span><span
                        class="c11">3</span><span class="c2"><br></span><span class="c11">4</span><span
                        class="c2"><br></span><span class="c11">5</span><span class="c2"><br></span><span
                        class="c11">-5</span><span class="c2"><br></span><span class="c11">-4</span><span
                        class="c2"><br></span><span class="c11">-3</span><span class="c2"><br></span><span
                        class="c11">-2</span><span class="c2"><br></span><span class="c11">-1</span><span
                        class="c2"><br></span><span class="c11">0</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c4">Un alt exemplu: s&#259; presupunem c&#259; avem o colec&#539;ie Company, care
            reprezint&#259; o companie &#537;i care stocheaz&#259; &icirc;ntr-un array personnel personalul companiei -
            obiecte de tip Person. Folosim operatorul yield pentru a parcurge aceast&#259; colec&#539;ie:</span></p>
    <p class="c3"><span class="c4"></span></p><a id="t.8adcef94cef8066ceb21e904260b4f45f2f484cf"></a><a id="t.3"></a>
    <table class="c6">
        <tr class="c10">
            <td class="c1" colspan="1" rowspan="1">
                <p class="c7"><span class="c0">class</span><span class="c2">&nbsp;</span><span
                        class="c5">Person</span><span class="c2"><br>{<br> &nbsp; &nbsp;</span><span
                        class="c0">public</span><span class="c2">&nbsp;</span><span class="c0">string</span><span
                        class="c2">&nbsp;Name { </span><span class="c0">get</span><span class="c2">; }<br> &nbsp;
                        &nbsp;</span><span class="c0">public</span><span class="c2">&nbsp;</span><span
                        class="c5">Person</span><span class="c2">(</span><span class="c0">string</span><span
                        class="c2">&nbsp;name) =&gt; Name = name;<br>}<br><br></span><span class="c0">class</span><span
                        class="c2">&nbsp;</span><span class="c5">Company</span><span class="c2"><br>{<br> &nbsp;
                        &nbsp;Person[] personnel;<br> &nbsp; &nbsp;</span><span class="c0">public</span><span
                        class="c2">&nbsp;</span><span class="c5">Company</span><span class="c2">(Person[] personnel)
                        =&gt; </span><span class="c0">this</span><span class="c2">.personnel = personnel;<br> &nbsp;
                        &nbsp;</span><span class="c0">public</span><span class="c2">&nbsp;</span><span
                        class="c0">int</span><span class="c2">&nbsp;Length =&gt; personnel.Length;<br> &nbsp;
                        &nbsp;</span><span class="c0">public</span><span class="c2">&nbsp;IEnumerator&lt;Person&gt;
                    </span><span class="c5">GetEnumerator</span><span class="c2">()<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp;
                        &nbsp; &nbsp;</span><span class="c0">for</span><span class="c2">&nbsp;(</span><span
                        class="c0">int</span><span class="c2">&nbsp;i = </span><span class="c11">0</span><span
                        class="c2">; i &lt; personnel.Length; i++)<br> &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp;
                        &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c0">yield</span><span
                        class="c2">&nbsp;</span><span class="c0">return</span><span class="c2">&nbsp;personnel[i];<br>
                        &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;}<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c12">Metoda </span><span class="c8">GetEnumerator() </span><span
            class="c12">reprezint&#259; un iterativ. &#536;i c&acirc;nd vom parcurge obiectul Company &icirc;n ciclul
            foreach, va fi apelat </span><span class="c8">yield return personnel[i]</span><span class="c12">. La apelul
            operatorului </span><span class="c8">yield return</span><span class="c4">, se va memora pozi&#539;ia
            curent&#259;. Iar c&acirc;nd ciclul foreach va trece la urm&#259;toarea itera&#539;ie pentru a ob&#539;ine
            un nou obiect, iterativul va &icirc;ncepe execu&#539;ia de la acea pozi&#539;ie.</span></p>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c4">&Icirc;n programul principal, &icirc;n ciclul foreach, parcurgerea are loc
            datorit&#259; implement&#259;rii iterativului:</span></p>
    <p class="c3"><span class="c4"></span></p><a id="t.6dae14d60f8d6e709e711f6d04e3152a8b4e905a"></a><a id="t.4"></a>
    <table class="c6">
        <tr class="c10">
            <td class="c1" colspan="1" rowspan="1">
                <p class="c7"><span class="c0">var</span><span class="c2">&nbsp;people = </span><span
                        class="c0">new</span><span class="c2">&nbsp;Person[]<br>{<br> &nbsp; &nbsp;</span><span
                        class="c0">new</span><span class="c2">&nbsp;Person(</span><span
                        class="c13">&quot;Tom&quot;</span><span class="c2">),<br> &nbsp; &nbsp;</span><span
                        class="c0">new</span><span class="c2">&nbsp;Person(</span><span
                        class="c13">&quot;Bob&quot;</span><span class="c2">),<br> &nbsp; &nbsp;</span><span
                        class="c0">new</span><span class="c2">&nbsp;Person(</span><span
                        class="c13">&quot;Sam&quot;</span><span class="c2">)<br>};<br></span><span
                        class="c0">var</span><span class="c2">&nbsp;microsoft = </span><span class="c0">new</span><span
                        class="c2">&nbsp;Company(people);<br><br></span><span class="c0">foreach</span><span
                        class="c2">&nbsp;(Person employee </span><span class="c0">in</span><span
                        class="c2">&nbsp;microsoft)<br>{<br> &nbsp; &nbsp;Console.WriteLine(employee.Name);<br>}</span>
                </p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c12">De&#537;i &icirc;n implementarea iterativului &icirc;n metoda </span><span
            class="c8">GetEnumerator()</span><span class="c12">&nbsp;am folosit parcurgerea array-ului &icirc;ntr-un
            ciclu for, nu este obligatoriu s&#259; facem asta. Putem pur &#537;i simplu s&#259; definim c&acirc;teva
            apeluri ale operatorului</span><span class="c8">&nbsp;yield return</span><span class="c4">:</span></p>
    <p class="c3"><span class="c4"></span></p><a id="t.6b34d1cf83f2951bce12924f5206a7c4b970ea38"></a><a id="t.5"></a>
    <table class="c6">
        <tr class="c10">
            <td class="c1" colspan="1" rowspan="1">
                <p class="c7"><span class="c0">public</span><span class="c2">&nbsp;IEnumerator&lt;Person&gt;
                    </span><span class="c5">GetEnumerator</span><span class="c2">()<br>{<br> &nbsp; &nbsp;</span><span
                        class="c0">yield</span><span class="c2">&nbsp;</span><span class="c0">return</span><span
                        class="c2">&nbsp;personnel[</span><span class="c11">0</span><span class="c2">];<br> &nbsp;
                        &nbsp;</span><span class="c0">yield</span><span class="c2">&nbsp;</span><span
                        class="c0">return</span><span class="c2">&nbsp;personnel[</span><span class="c11">1</span><span
                        class="c2">];<br> &nbsp; &nbsp;</span><span class="c0">yield</span><span
                        class="c2">&nbsp;</span><span class="c0">return</span><span
                        class="c2">&nbsp;personnel[</span><span class="c11">2</span><span class="c2">];<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c12">&Icirc;n acest caz, la fiecare apel al operatorului</span><span
            class="c8">&nbsp;yield return</span><span class="c4">, iterativul va memora &#537;i pozi&#539;ia
            curent&#259; &#537;i, la apelurile ulterioare, va &icirc;ncepe de la acea pozi&#539;ie.</span></p>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c16">Iterativ denumit.</span></p>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c12">Mai sus, pentru crearea iterativului am folosit metoda GetEnumerator. Dar operatorul
            yield poate fi folosit &icirc;n orice metod&#259;, doar c&#259; metoda respectiv&#259; trebuie s&#259;
            returneze un obiect al interfe&#539;ei IEnumerable. Astfel de metode mai sunt numite </span><span
            class="c14">iteratoare denumite</span><span class="c4">.</span></p>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c4">S&#259; cre&#259;m un astfel de iterativ denumit &icirc;n clasa Company &#537;i
            s&#259;-l folosim:</span></p>
    <p class="c3"><span class="c4"></span></p><a id="t.f5461bbe3c0f44b975e466820304696b6df1d806"></a><a id="t.6"></a>
    <table class="c6">
        <tr class="c10">
            <td class="c1" colspan="1" rowspan="1">
                <p class="c7"><span class="c0">class</span><span class="c2">&nbsp;</span><span
                        class="c5">Person</span><span class="c2"><br>{<br> &nbsp; &nbsp;</span><span
                        class="c0">public</span><span class="c2">&nbsp;</span><span class="c0">string</span><span
                        class="c2">&nbsp;Name { </span><span class="c0">get</span><span class="c2">; }<br> &nbsp;
                        &nbsp;</span><span class="c0">public</span><span class="c2">&nbsp;</span><span
                        class="c5">Person</span><span class="c2">(</span><span class="c0">string</span><span
                        class="c2">&nbsp;name) =&gt; Name = name;<br>}<br><br></span><span class="c0">class</span><span
                        class="c2">&nbsp;</span><span class="c5">Company</span><span class="c2"><br>{<br> &nbsp;
                        &nbsp;Person[] personnel;<br> &nbsp; &nbsp;</span><span class="c0">public</span><span
                        class="c2">&nbsp;</span><span class="c5">Company</span><span class="c2">(Person[] personnel)
                        =&gt; </span><span class="c0">this</span><span class="c2">.personnel = personnel;<br> &nbsp;
                        &nbsp;</span><span class="c0">public</span><span class="c2">&nbsp;</span><span
                        class="c0">int</span><span class="c2">&nbsp;Length =&gt; personnel.Length;<br> &nbsp;
                        &nbsp;</span><span class="c0">public</span><span class="c2">&nbsp;IEnumerable&lt;Person&gt;
                    </span><span class="c5">GetPersonnel</span><span class="c2">(</span><span class="c0">int</span><span
                        class="c2">&nbsp;max)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span
                        class="c0">for</span><span class="c2">&nbsp;(</span><span class="c0">int</span><span
                        class="c2">&nbsp;i = </span><span class="c11">0</span><span class="c2">; i &lt; max; i++)<br>
                        &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span
                        class="c0">if</span><span class="c2">&nbsp;(i == personnel.Length)<br> &nbsp; &nbsp; &nbsp;
                        &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span
                        class="c0">yield</span><span class="c2">&nbsp;</span><span class="c0">break</span><span
                        class="c2">;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;
                        &nbsp; &nbsp;</span><span class="c0">else</span><span class="c2"><br> &nbsp; &nbsp; &nbsp;
                        &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span
                        class="c0">yield</span><span class="c2">&nbsp;</span><span class="c0">return</span><span
                        class="c2">&nbsp;personnel[i];<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;
                        &nbsp; &nbsp;}<br> &nbsp; &nbsp;}<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c12">Iterativul definit aici - metoda IEnumerable GetPersonnel(int max) - accept&#259; ca
            parametru num&#259;rul maxim de obiecte returnate. &Icirc;n timpul execu&#539;iei programului, se poate
            &icirc;nt&acirc;mpla ca valoarea sa s&#259; fie mai mare dec&acirc;t lungimea array-ului personnel. Pentru a
            evita o eroare, se folose&#537;te operatorul</span><span class="c14">&nbsp;yield break</span><span
            class="c4">. Acest operator &icirc;ntrerupe execu&#539;ia iterativului.</span></p>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c4">Aplicarea iterativului:</span></p>
    <p class="c3"><span class="c4"></span></p><a id="t.f7983c38e2177e4d7f3275f40ef6954542b65519"></a><a id="t.7"></a>
    <table class="c6">
        <tr class="c10">
            <td class="c1" colspan="1" rowspan="1">
                <p class="c7"><span class="c0">var</span><span class="c2">&nbsp;people = </span><span
                        class="c0">new</span><span class="c2">&nbsp;Person[]<br>{<br> &nbsp; &nbsp;</span><span
                        class="c0">new</span><span class="c2">&nbsp;Person(</span><span
                        class="c13">&quot;Tom&quot;</span><span class="c2">),<br> &nbsp; &nbsp;</span><span
                        class="c0">new</span><span class="c2">&nbsp;Person(</span><span
                        class="c13">&quot;Bob&quot;</span><span class="c2">),<br> &nbsp; &nbsp;</span><span
                        class="c0">new</span><span class="c2">&nbsp;Person(</span><span
                        class="c13">&quot;Sam&quot;</span><span class="c2">)<br>};<br></span><span
                        class="c0">var</span><span class="c2">&nbsp;microsoft = </span><span class="c0">new</span><span
                        class="c2">&nbsp;Company(people);<br><br></span><span class="c0">foreach</span><span
                        class="c2">&nbsp;(Person employee </span><span class="c0">in</span><span
                        class="c2">&nbsp;microsoft.GetPersonnel(</span><span class="c11">5</span><span
                        class="c2">))<br>{<br> &nbsp; &nbsp;Console.WriteLine(employee.Name);<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c4"></span></p>
    <p class="c9"><span class="c12">Apelul </span><span class="c8">microsoft.GetPersonnel(5)</span><span
            class="c12">&nbsp;va returna un set de nu mai mult de 5 obiecte Person. Dar, deoarece avem doar trei astfel
            de obiecte, &icirc;n metoda </span><span class="c8">GetPersonnel</span><span class="c12">, dup&#259; trei
            opera&#539;ii, va fi apelat operatorul </span><span class="c8">yield break</span><span class="c4">.</span>
    </p>
    <p class="c3"><span class="c4"></span></p>
</body>

</html>