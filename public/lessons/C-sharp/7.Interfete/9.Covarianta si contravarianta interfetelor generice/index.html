<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <link rel="stylesheet" type="text/css" href="/lessons/styles.css">
</head>

<body class="c18 doc-content">
    <h1 class="c3 c17">Covarianța și contravarianța interfețelor generice.</h1>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">No&#539;iunile de </span><span class="c9 c13">covarian&#539;&#259; </span><span
            class="c9">&#537;i </span><span class="c9 c13">contravarian&#539;&#259; </span><span class="c5">sunt legate
            de posibilitatea utiliz&#259;rii unui tip diferit &icirc;n locul unui alt tip, care se afl&#259; mai sus sau
            mai jos &icirc;n ierarhia mo&#537;tenirii.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c5">Exist&#259; trei posibile moduri de comportament:</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">- </span><span class="c15">Covarian&#539;a</span><span class="c5">: permite
            utilizarea unui tip mai specific dec&acirc;t cel definit ini&#539;ial.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">- </span><span class="c15">Contravarian&#539;a</span><span class="c5">: permite
            utilizarea unui tip mai general dec&acirc;t cel definit ini&#539;ial.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">- </span><span class="c15">Invarian&#539;a</span><span class="c5">: permite
            utilizarea doar a tipului definit.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c5">C# permite crearea interfe&#539;elor generice covariante &#537;i contravariante.
            Aceast&#259; func&#539;ionalitate cre&#537;te flexibilitatea utiliz&#259;rii interfe&#539;elor generice
            &icirc;n program. Implicit, toate interfe&#539;ele generice sunt invariante.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c5">Pentru a ilustra interfe&#539;ele covariante &#537;i contravariante, s&#259;
            lu&#259;m urm&#259;toarele clase:</span></p>
    <p class="c2"><span class="c5"></span></p><a id="t.c2e78be1f0ce14ced08e0880dc2dd2661bb96d9d"></a><a id="t.0"></a>
    <table class="c8">
        <tr class="c16">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c6"><span class="c4">class</span><span class="c1">&nbsp;</span><span
                        class="c10">Message</span><span class="c1"><br>{<br> &nbsp; &nbsp;</span><span
                        class="c4">public</span><span class="c1">&nbsp;</span><span class="c4">string</span><span
                        class="c1">&nbsp;Text { </span><span class="c4">get</span><span class="c1">; </span><span
                        class="c4">set</span><span class="c1">; }<br> &nbsp; &nbsp;</span><span
                        class="c4">public</span><span class="c1">&nbsp;</span><span class="c10">Message</span><span
                        class="c1">(</span><span class="c4">string</span><span class="c1">&nbsp;text) =&gt; Text =
                        text;<br>}<br></span><span class="c4">class</span><span class="c1">&nbsp;</span><span
                        class="c10">EmailMessage</span><span class="c1">&nbsp;: </span><span
                        class="c10">Message</span><span class="c1"><br>{<br> &nbsp; &nbsp;</span><span
                        class="c4">public</span><span class="c1">&nbsp;</span><span class="c10">EmailMessage</span><span
                        class="c1">(</span><span class="c4">string</span><span class="c1">&nbsp;text): </span><span
                        class="c10">base</span><span class="c1">(text) { }<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c5">Aici este definit&#259; clasa Message, care prime&#537;te textul prin constructor
            &#537;i &icirc;l stocheaz&#259; &icirc;n proprietatea Text. Clasa EmailMessage reprezint&#259; un email
            &#537;i doar apeleaz&#259; constructorul clasei de baz&#259;, transmi&#539;&acirc;ndu-i textul
            mesajului.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c7">Interfe&#539;e covariante.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">Interfe&#539;ele generice pot fi covariante dac&#259; parametrul generic
            folose&#537;te cuv&acirc;ntul cheie </span><span class="c15">out</span><span class="c5">. Un astfel de
            parametru trebuie s&#259; reprezinte tipul obiectului returnat de o metod&#259;. De exemplu:</span></p>
    <p class="c2"><span class="c5"></span></p><a id="t.015f7dc8e9c6f42cf49e5d26f065e83e704cb091"></a><a id="t.1"></a>
    <table class="c8">
        <tr class="c16">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c6"><span class="c4">interface</span><span class="c1">&nbsp;</span><span
                        class="c10">IMessenger</span><span class="c1">&lt;</span><span class="c10">out</span><span
                        class="c1">&nbsp;</span><span class="c10">T</span><span class="c1">&gt;<br>{<br> &nbsp; &nbsp;T
                    </span><span class="c10">WriteMessage</span><span class="c1">(</span><span
                        class="c4">string</span><span class="c1">&nbsp;text);<br>}<br></span><span
                        class="c4">class</span><span class="c1">&nbsp;</span><span
                        class="c10">EmailMessenger</span><span class="c1">&nbsp;: </span><span
                        class="c10">IMessenger</span><span class="c1">&lt;</span><span
                        class="c10">EmailMessage</span><span class="c1">&gt;<br>{<br> &nbsp; &nbsp;</span><span
                        class="c4">public</span><span class="c1">&nbsp;EmailMessage </span><span
                        class="c10">WriteMessage</span><span class="c1">(</span><span class="c4">string</span><span
                        class="c1">&nbsp;text)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span
                        class="c4">return</span><span class="c1">&nbsp;</span><span class="c4">new</span><span
                        class="c1">&nbsp;EmailMessage(</span><span class="c0">$&quot;Email: {text}&quot;</span><span
                        class="c1">);<br> &nbsp; &nbsp;}<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">Aici, interfa&#539;a generic&#259; IMessenger reprezint&#259; o interfa&#539;&#259;
            de mesagerie &#537;i define&#537;te metoda </span><span class="c9 c13">WriteMessage() </span><span
            class="c9">pentru a crea un mesaj. &Icirc;n momentul definirii interfe&#539;ei, nu &#537;tim ce tip de
            obiect va fi returnat de aceast&#259; metod&#259;. Cuv&acirc;ntul cheie </span><span class="c15">out
        </span><span class="c5">&icirc;n defini&#539;ia interfe&#539;ei indic&#259; faptul c&#259; aceasta va fi
            covariant&#259;.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">Clasa EmailMessenger, care reprezint&#259; o aplica&#539;ie pentru trimiterea
            emailurilor, implementeaz&#259; aceast&#259; interfa&#539;&#259; &#537;i returneaz&#259; un obiect
            EmailMessage din metoda </span><span class="c9 c13">WriteMessage()</span><span class="c5">.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c5">Utilizare:</span></p>
    <p class="c2"><span class="c5"></span></p><a id="t.fda620dcae3fcfb8b1d35990c93ee367e60e88c0"></a><a id="t.2"></a>
    <table class="c8">
        <tr class="c16">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c6"><span class="c1">IMessenger&lt;Message&gt; outlook = </span><span
                        class="c4">new</span><span class="c1">&nbsp;EmailMessenger();<br>Message message =
                        outlook.WriteMessage(</span><span class="c0">&quot;Hello World&quot;</span><span
                        class="c1">);<br>Console.WriteLine(message.Text); &nbsp; &nbsp;</span><span class="c14">//
                        Email: Hello World</span><span class="c1"><br> <br>IMessenger&lt;EmailMessage&gt; emailClient =
                    </span><span class="c4">new</span><span
                        class="c1">&nbsp;EmailMessenger();<br>IMessenger&lt;Message&gt; messenger =
                        emailClient;<br>Message emailMessage = messenger.WriteMessage(</span><span
                        class="c0">&quot;Hi!&quot;</span><span class="c1">);<br>Console.WriteLine(emailMessage.Text);
                        &nbsp; &nbsp;</span><span class="c14">// Email: Hi!</span></p>
            </td>
        </tr>
    </table>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">Putem atribui unui tip mai general, I</span><span
            class="c9 c13">Messenger&lt;Message&gt;</span><span class="c9">, un obiect de tip mai specific, </span><span
            class="c9 c13">EmailMessenger </span><span class="c9">sau</span><span
            class="c9 c13">&nbsp;IMessenger&lt;EmailMessage&gt;</span><span class="c5">.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">Dac&#259; nu am folosi cuv&acirc;ntul cheie </span><span
            class="c9 c13">out</span><span class="c5">:</span></p>
    <p class="c2"><span class="c5"></span></p><a id="t.c32ca054b0bc1927a44c83f7836262ac858a6015"></a><a id="t.3"></a>
    <table class="c8">
        <tr class="c16">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c6"><span class="c4">interface</span><span class="c1">&nbsp;</span><span
                        class="c10">IMessenger</span><span class="c1">&lt;</span><span class="c10">T</span><span
                        class="c1">&gt; { }</span></p>
            </td>
        </tr>
    </table>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c5">Am &icirc;nt&acirc;mpina o eroare la linia</span></p><a
        id="t.0539a8d78e6c3da25e277d06a9eed551b6241ac7"></a><a id="t.4"></a>
    <table class="c8">
        <tr class="c16"></tr>
    </table>
    <p class="c6 c11"><span class="c5"></span></p><a id="t.0539a8d78e6c3da25e277d06a9eed551b6241ac7"></a><a
        id="t.5"></a>
    <table class="c8">
        <tr class="c16"></tr>
    </table>
    <p class="c6 c11"><span class="c5"></span></p><a id="t.c18c0750c0c62ce7c4fc8c9af45cda272735a089"></a><a
        id="t.6"></a>
    <table class="c8">
        <tr class="c16">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c6"><span class="c1">IMessenger&lt;Message&gt; outlook = </span><span
                        class="c4">new</span><span class="c1">&nbsp;EmailMessenger(); &nbsp;</span><span class="c14">//
                        ! Eroare</span><span class="c1"><br> <br>IMessenger&lt;EmailMessage&gt; emailClient =
                    </span><span class="c4">new</span><span
                        class="c1">&nbsp;EmailMessenger();<br>IMessenger&lt;Message&gt; messenger = emailClient;
                        &nbsp;</span><span class="c14">// ! Eroare</span></p>
            </td>
        </tr>
    </table>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">&Icirc;n acest caz, nu ar fi posibil&#259; convertirea obiectului </span><span
            class="c9 c13">IMessenger&lt;EmailMessage&gt;</span><span class="c9">&nbsp;la tipul</span><span
            class="c9 c13">&nbsp;IMessenger&lt;Message&gt;</span><span class="c5">.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c5">La crearea unei interfe&#539;e covariante, trebuie s&#259; lu&#259;m &icirc;n
            considerare c&#259; parametrul generic poate fi folosit doar ca tipul valorii returnate de metodele
            interfe&#539;ei. Nu poate fi folosit ca tip al argumentelor metodei sau &icirc;n restric&#539;iile metodelor
            interfe&#539;ei.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c7">Interfe&#539;e contravariante.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">Pentru a crea o interfa&#539;&#259; contravariant&#259;, se folose&#537;te
            cuv&acirc;ntul cheie </span><span class="c15">in</span><span class="c5">. De exemplu, s&#259; folosim
            acelea&#537;i clase Message &#537;i EmailMessage &#537;i s&#259; definim urm&#259;toarele tipuri:</span></p>
    <p class="c2"><span class="c5"></span></p><a id="t.13e3505fc813d8ca6a3c8dad51a465a3cea85626"></a><a id="t.7"></a>
    <table class="c8">
        <tr class="c16">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c6"><span class="c4">interface</span><span class="c1">&nbsp;</span><span
                        class="c10">IMessenger</span><span class="c1">&lt;</span><span class="c10">in</span><span
                        class="c1">&nbsp;</span><span class="c10">T</span><span class="c1">&gt;<br>{<br> &nbsp;
                        &nbsp;</span><span class="c4">void</span><span class="c1">&nbsp;</span><span
                        class="c10">SendMessage</span><span class="c1">(T message);<br>}<br></span><span
                        class="c4">class</span><span class="c1">&nbsp;</span><span
                        class="c10">SimpleMessenger</span><span class="c1">&nbsp;: </span><span
                        class="c10">IMessenger</span><span class="c1">&lt;</span><span class="c10">Message</span><span
                        class="c1">&gt;<br>{<br> &nbsp; &nbsp;</span><span class="c4">public</span><span
                        class="c1">&nbsp;</span><span class="c4">void</span><span class="c1">&nbsp;</span><span
                        class="c10">SendMessage</span><span class="c1">(Message message)<br> &nbsp; &nbsp;{<br> &nbsp;
                        &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c0">$&quot;Trimitere mesaj:
                        {message.Text}&quot;</span><span class="c1">);<br> &nbsp; &nbsp;}<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">Aici, interfa&#539;a IMessenger define&#537;te metoda</span><span
            class="c9 c13">&nbsp;SendMessage()</span><span class="c9">&nbsp;pentru a trimite un mesaj. Cuv&acirc;ntul
            cheie </span><span class="c15">in </span><span class="c9">&icirc;n defini&#539;ia interfe&#539;ei
            indic&#259; faptul c&#259; aceasta este </span><span class="c15">contravariant&#259;</span><span
            class="c5">.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">Clasa SimpleMessenger reprezint&#259; o aplica&#539;ie de trimitere a mesajelor
            &#537;i implementeaz&#259; aceast&#259; interfa&#539;&#259;, folosind tipul Message. Deci, SimpleMessenger
            reprezint&#259; tipul</span><span class="c9 c13">&nbsp;IMessenger&lt;Message&gt;</span><span
            class="c5">.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c5">Utilizare:</span></p>
    <p class="c2"><span class="c5"></span></p><a id="t.42f0d12974fe64037e3cbd83f139b7b64ce9e228"></a><a id="t.8"></a>
    <table class="c8">
        <tr class="c16">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c6"><span class="c1">IMessenger&lt;EmailMessage&gt; outlook = </span><span
                        class="c4">new</span><span
                        class="c1">&nbsp;SimpleMessenger();<br>outlook.SendMessage(</span><span
                        class="c4">new</span><span class="c1">&nbsp;EmailMessage(</span><span
                        class="c0">&quot;Hi!&quot;</span><span class="c1">));<br> <br>IMessenger&lt;Message&gt; telegram
                        = </span><span class="c4">new</span><span
                        class="c1">&nbsp;SimpleMessenger();<br>IMessenger&lt;EmailMessage&gt; emailClient =
                        telegram;<br>emailClient.SendMessage(</span><span class="c4">new</span><span
                        class="c1">&nbsp;EmailMessage(</span><span class="c0">&quot;Hello&quot;</span><span
                        class="c1">));</span></p>
            </td>
        </tr>
    </table>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">Deoarece interfa&#539;a IMessenger folose&#537;te parametrul generic cu
            cuv&acirc;ntul cheie </span><span class="c15">in</span><span class="c9">, aceasta este contravariant&#259;,
            astfel c&#259; putem atribui unei variabile de tip </span><span
            class="c9 c13">IMessenger&lt;EmailMessage&gt;</span><span class="c9">&nbsp;un obiect de tip</span><span
            class="c9 c13">&nbsp;IMessenger&lt;Message&gt;</span><span class="c9">&nbsp;sau </span><span
            class="c9 c13">SimpleMessenger</span><span class="c5">.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">Dac&#259; nu s-ar folosi cuv&acirc;ntul cheie </span><span class="c15">in</span><span
            class="c5">, nu am putea face acest lucru. Un obiect de interfa&#539;&#259; cu un tip mai general poate fi
            convertit la un obiect de interfa&#539;&#259; cu un tip mai specific.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c5">La crearea unei interfe&#539;e contravariante, trebuie s&#259; lu&#259;m &icirc;n
            considerare c&#259; parametrul generic poate fi folosit doar ca tipul argumentelor metodei, dar nu &#537;i
            ca tipul valorii returnate de metod&#259;.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c7">Combinarea covarian&#539;ei &#537;i contravarian&#539;ei.</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c5">Putem combina covarian&#539;a &#537;i contravarian&#539;a &icirc;ntr-o singur&#259;
            interfa&#539;&#259;. De exemplu:</span></p>
    <p class="c2"><span class="c5"></span></p><a id="t.feadd6b59967d401f0786bdf0f3f66fcff17c0d2"></a><a id="t.9"></a>
    <table class="c8">
        <tr class="c16">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c6"><span class="c4">interface</span><span class="c1">&nbsp;</span><span
                        class="c10">IMessenger</span><span class="c1">&lt;</span><span class="c10">in</span><span
                        class="c1">&nbsp;</span><span class="c10">T</span><span class="c1">, </span><span
                        class="c10">out</span><span class="c1">&nbsp;</span><span class="c10">K</span><span
                        class="c1">&gt;<br>{<br> &nbsp; &nbsp;</span><span class="c4">void</span><span
                        class="c1">&nbsp;</span><span class="c10">SendMessage</span><span class="c1">(T message);<br>
                        &nbsp; &nbsp;K </span><span class="c10">WriteMessage</span><span class="c1">(</span><span
                        class="c4">string</span><span class="c1">&nbsp;text);<br>}<br></span><span
                        class="c4">class</span><span class="c1">&nbsp;</span><span
                        class="c10">SimpleMessenger</span><span class="c1">&nbsp;: </span><span
                        class="c10">IMessenger</span><span class="c1">&lt;</span><span class="c10">Message</span><span
                        class="c1">, </span><span class="c10">EmailMessage</span><span class="c1">&gt;<br>{<br> &nbsp;
                        &nbsp;</span><span class="c4">public</span><span class="c1">&nbsp;</span><span
                        class="c4">void</span><span class="c1">&nbsp;</span><span class="c10">SendMessage</span><span
                        class="c1">(Message message)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp;
                        &nbsp;Console.WriteLine(</span><span class="c0">$&quot;Trimitere mesaj:
                        {message.Text}&quot;</span><span class="c1">);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span
                        class="c4">public</span><span class="c1">&nbsp;EmailMessage </span><span
                        class="c10">WriteMessage</span><span class="c1">(</span><span class="c4">string</span><span
                        class="c1">&nbsp;text)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span
                        class="c4">return</span><span class="c1">&nbsp;</span><span class="c4">new</span><span
                        class="c1">&nbsp;EmailMessage(</span><span class="c0">$&quot;Email: {text}&quot;</span><span
                        class="c1">);<br> &nbsp; &nbsp;}<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c2"><span class="c5"></span></p>
    <p class="c3"><span class="c9">Practic, aici sunt combinate dou&#259; exemple anterioare. Datorit&#259;
            covarian&#539;ei/contravarian&#539;ei, un obiect al clasei SimpleMessenger poate reprezenta
            tipurile</span><span class="c9 c13">&nbsp;IMessenger&lt;EmailMessage, Message&gt;, IMessenger&lt;Message,
            EmailMessage&gt;, IMessenger&lt;Message, Message&gt; &#537;i IMessenger&lt;EmailMessage,
            EmailMessage&gt;</span><span class="c5">. Utilizare:</span></p>
    <p class="c2"><span class="c5"></span></p>
    <p class="c2"><span class="c5"></span></p><a id="t.16d762e9356c96c86eab47e04e6f7aee8f7e37aa"></a><a id="t.10"></a>
    <table class="c8">
        <tr class="c16">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c6"><span class="c1">IMessenger&lt;EmailMessage, Message&gt; messenger = </span><span
                        class="c4">new</span><span class="c1">&nbsp;SimpleMessenger();<br>Message message =
                        messenger.WriteMessage(</span><span class="c0">&quot;Hello World&quot;</span><span
                        class="c1">);<br>Console.WriteLine(message.Text);<br>messenger.SendMessage(</span><span
                        class="c4">new</span><span class="c1">&nbsp;EmailMessage(</span><span
                        class="c0">&quot;Test&quot;</span><span class="c1">));<br> <br>IMessenger&lt;EmailMessage,
                        EmailMessage&gt; outlook = </span><span class="c4">new</span><span
                        class="c1">&nbsp;SimpleMessenger();<br>EmailMessage emailMessage =
                        outlook.WriteMessage(</span><span class="c0">&quot;Mesaj din Outlook&quot;</span><span
                        class="c1">);<br>outlook.SendMessage(emailMessage);<br> <br>IMessenger&lt;Message, Message&gt;
                        telegram = </span><span class="c4">new</span><span
                        class="c1">&nbsp;SimpleMessenger();<br>Message simpleMessage =
                        telegram.WriteMessage(</span><span class="c0">&quot;Mesaj din Telegram&quot;</span><span
                        class="c1">);<br>telegram.SendMessage(simpleMessage);</span></p>
            </td>
        </tr>
    </table>
    <p class="c2"><span class="c5"></span></p>
    <p class="c2"><span class="c5"></span></p>
</body>

</html>