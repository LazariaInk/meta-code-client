<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><link rel="stylesheet" type="text/css" href="/lessons/styles.css"></head><body class="c16 doc-content"><p class="c5"><span class="c15">Selec&#539;ia elementelor &icirc;n LINQ to XML. </span></p><p class="c1"><span class="c2"></span></p><p class="c5"><span class="c13">Un mare avantaj al LINQ to XML este c&#259; aceast&#259; tehnologie permite extragerea u&#537;oar&#259; a elementelor necesare dintr-un document XML. De exemplu, s&#259; lu&#259;m fi&#537;ierul XML </span><span class="c14">people.xml</span><span class="c2">, creat &icirc;n tema anterioar&#259;:</span></p><a id="t.020f06049dd92aa3b2c8ff07cf04376479e11c18"></a><a id="t.0"></a><table class="c10"><tr class="c3"><td class="c12" colspan="1" rowspan="1"><p class="c9"><span class="c0">&lt;?xml version=</span><span class="c7">&quot;1.0&quot;</span><span class="c0">&nbsp;encoding=</span><span class="c7">&quot;utf-8&quot;</span><span class="c0">?&gt;<br>&lt;people&gt;<br> &nbsp;&lt;person name=</span><span class="c7">&quot;Tom&quot;</span><span class="c0">&gt;<br> &nbsp; &nbsp;&lt;company&gt;Microsoft&lt;/company&gt;<br> &nbsp; &nbsp;&lt;age&gt;</span><span class="c8">37</span><span class="c0">&lt;/age&gt;<br> &nbsp;&lt;/person&gt;<br> &nbsp;&lt;person name=</span><span class="c7">&quot;Bob&quot;</span><span class="c0">&gt;<br> &nbsp; &nbsp;&lt;company&gt;Google&lt;/company&gt;<br> &nbsp; &nbsp;&lt;age&gt;</span><span class="c8">41</span><span class="c0">&lt;/age&gt;<br> &nbsp;&lt;/person&gt;<br>&lt;/people&gt;</span></p></td></tr></table><p class="c1"><span class="c2"></span></p><p class="c5"><span class="c2">Vom parcurge elementele acestuia &#537;i le vom afi&#537;a valorile &icirc;n consol&#259;:</span></p><p class="c1"><span class="c2"></span></p><a id="t.952b28baf537dd2666147ff828b7e324b1d93da0"></a><a id="t.1"></a><table class="c10"><tr class="c3"><td class="c12" colspan="1" rowspan="1"><p class="c9"><span class="c4">using</span><span class="c0">&nbsp;System.Xml.Linq;<br><br>XDocument xdoc = XDocument.Load(</span><span class="c7">&quot;people.xml&quot;</span><span class="c0">);<br></span><span class="c11">// ob&#539;inem nodul r&#259;d&#259;cin&#259;</span><span class="c0"><br>XElement? people = xdoc.Element(</span><span class="c7">&quot;people&quot;</span><span class="c0">);<br></span><span class="c4">if</span><span class="c0">&nbsp;(people </span><span class="c4">is</span><span class="c0">&nbsp;not </span><span class="c4">null</span><span class="c0">)<br>{<br> &nbsp; &nbsp;</span><span class="c11">// parcurgem toate elementele person</span><span class="c0"><br> &nbsp; &nbsp;</span><span class="c4">foreach</span><span class="c0">&nbsp;(XElement person </span><span class="c4">in</span><span class="c0">&nbsp;people.Elements(</span><span class="c7">&quot;person&quot;</span><span class="c0">))<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;XAttribute? name = person.Attribute(</span><span class="c7">&quot;name&quot;</span><span class="c0">);<br> &nbsp; &nbsp; &nbsp; &nbsp;XElement? company = person.Element(</span><span class="c7">&quot;company&quot;</span><span class="c0">);<br> &nbsp; &nbsp; &nbsp; &nbsp;XElement? age = person.Element(</span><span class="c7">&quot;age&quot;</span><span class="c0">);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c7">$&quot;Person: {name?.Value}&quot;</span><span class="c0">);<br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c7">$&quot;Company: {company?.Value}&quot;</span><span class="c0">);<br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c7">$&quot;Age: {age?.Value}&quot;</span><span class="c0">);<br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(); </span><span class="c11">// pentru separare &icirc;n consol&#259;</span><span class="c0"><br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c1"><span class="c2"></span></p><p class="c5"><span class="c2">Rezultatul afi&#537;at va fi:</span></p><p class="c1"><span class="c2"></span></p><a id="t.08d560362a36d419f47a63c05f22a109353ac9e3"></a><a id="t.2"></a><table class="c10"><tr class="c3"><td class="c12" colspan="1" rowspan="1"><p class="c9"><span class="c0">Person: Tom<br>Company: Microsoft<br>Age: </span><span class="c8">37</span><span class="c0"><br><br>Person: Bob<br>Company: Google<br>Age: </span><span class="c8">41</span></p></td></tr></table><p class="c1"><span class="c2"></span></p><p class="c5"><span class="c13">Pentru a &icirc;ncepe lucrul cu un fi&#537;ier XML existent, trebuie mai &icirc;nt&acirc;i s&#259;-l &icirc;nc&#259;rc&#259;m folosind metoda static&#259; </span><span class="c6">XDocument.Load()</span><span class="c2">, &icirc;n care se transmite calea c&#259;tre fi&#537;ier:</span></p><p class="c1"><span class="c2"></span></p><a id="t.7067c60e6831897404f20dcc4112182b44a71ba1"></a><a id="t.3"></a><table class="c10"><tr class="c3"><td class="c12" colspan="1" rowspan="1"><p class="c9"><span class="c0">XDocument xdoc = XDocument.Load(</span><span class="c7">&quot;people.xml&quot;</span><span class="c0">);</span></p></td></tr></table><p class="c1"><span class="c2"></span></p><p class="c5"><span class="c2">Deoarece XML-ul stocheaz&#259; elementele &icirc;ntr-o structur&#259; ierarhic&#259;, pentru a accesa elementele, trebuie s&#259; &icirc;ncepem de la cel mai &icirc;nalt nivel din aceast&#259; ierarhie &#537;i s&#259; cobor&acirc;m. Astfel, pentru a ob&#539;ine elementele person &#537;i a accesa valorile acestora, trebuie s&#259; ne adres&#259;m mai &icirc;nt&acirc;i elementului r&#259;d&#259;cin&#259; &#537;i, prin acesta, elementelor person:</span></p><p class="c1"><span class="c2"></span></p><a id="t.4125fb3a9fa9f19904f961ce83547dd3e052c0b1"></a><a id="t.4"></a><table class="c10"><tr class="c3"><td class="c12" colspan="1" rowspan="1"><p class="c9"><span class="c11">// ob&#539;inem nodul r&#259;d&#259;cin&#259;</span><span class="c0"><br>XElement? people = xdoc.Element(</span><span class="c7">&quot;people&quot;</span><span class="c0">);<br></span><span class="c4">if</span><span class="c0">&nbsp;(people </span><span class="c4">is</span><span class="c0">&nbsp;not </span><span class="c4">null</span><span class="c0">)<br>{<br> &nbsp; &nbsp;</span><span class="c11">// parcurgem toate elementele person</span><span class="c0"><br> &nbsp; &nbsp;</span><span class="c4">foreach</span><span class="c0">&nbsp;(XElement person </span><span class="c4">in</span><span class="c0">&nbsp;people.Elements(</span><span class="c7">&quot;person&quot;</span><span class="c0">))<br> &nbsp; &nbsp;{</span></p></td></tr></table><p class="c1"><span class="c2"></span></p><p class="c5"><span class="c13">Metoda</span><span class="c6">&nbsp;Element(&quot;nume_element&quot;)</span><span class="c13">&nbsp;returneaz&#259; primul element g&#259;sit cu acest nume. Metoda</span><span class="c6">&nbsp;Elements(&quot;nume_element&quot;)</span><span class="c2">&nbsp;returneaz&#259; o colec&#539;ie de elemente cu acela&#537;i nume. &Icirc;n acest caz, ob&#539;inem o colec&#539;ie de elemente person, pe care o putem parcurge &icirc;ntr-o bucl&#259;.</span></p><p class="c1"><span class="c2"></span></p><p class="c5"><span class="c2">Cobor&acirc;nd mai jos &icirc;n ierarhie, putem ob&#539;ine atributele sau elementele &icirc;ncorporate, de exemplu, ob&#539;inerea elementului &lt;company&gt;:</span></p><p class="c1"><span class="c2"></span></p><a id="t.b1c83feaa540f7933e070788b46e357df2e1366e"></a><a id="t.5"></a><table class="c10"><tr class="c3"><td class="c12" colspan="1" rowspan="1"><p class="c9"><span class="c0">XElement? company = person.Element(</span><span class="c7">&quot;company&quot;</span><span class="c0">);</span></p></td></tr></table><p class="c1"><span class="c2"></span></p><p class="c5"><span class="c13">Valoarea elementelor simple, care con&#539;in un singur text, poate fi ob&#539;inut&#259; folosind proprietatea </span><span class="c14">Value</span><span class="c2">:</span></p><p class="c1"><span class="c2"></span></p><a id="t.0edfc9c590a829502f3236ee9c76f06932bec3c0"></a><a id="t.6"></a><table class="c10"><tr class="c3"><td class="c12" colspan="1" rowspan="1"><p class="c9"><span class="c4">string</span><span class="c0">? companyValue = person.Element(</span><span class="c7">&quot;company&quot;</span><span class="c0">)?.Value;</span></p></td></tr></table><p class="c1"><span class="c2"></span></p><p class="c5"><span class="c2">Combin&acirc;nd operatorii LINQ &#537;i LINQ to XML, putem extrage &#537;i prelucra datele din document destul de u&#537;or. De exemplu:</span></p><p class="c1"><span class="c2"></span></p><a id="t.2a431491816d6fdd4c38cfc681be20f3fca5d18f"></a><a id="t.7"></a><table class="c10"><tr class="c3"><td class="c12" colspan="1" rowspan="1"><p class="c9"><span class="c4">using</span><span class="c0">&nbsp;System.Xml.Linq;<br><br>XDocument xdoc = XDocument.Load(</span><span class="c7">&quot;people.xml&quot;</span><span class="c0">);<br><br></span><span class="c4">var</span><span class="c0">&nbsp;microsoft = xdoc.Element(</span><span class="c7">&quot;people&quot;</span><span class="c0">)? &nbsp; </span><span class="c11">// ob&#539;inem nodul r&#259;d&#259;cin&#259; people</span><span class="c0"><br> &nbsp; &nbsp;.Elements(</span><span class="c7">&quot;person&quot;</span><span class="c0">) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">// ob&#539;inem toate elementele person</span><span class="c0"><br> &nbsp; &nbsp;</span><span class="c11">// ob&#539;inem toate persoanele care au company = Microsoft</span><span class="c0"><br> &nbsp; &nbsp;.Where(p =&gt; p.Element(</span><span class="c7">&quot;company&quot;</span><span class="c0">)?.Value == </span><span class="c7">&quot;Microsoft&quot;</span><span class="c0">) &nbsp; &nbsp;<br> &nbsp; &nbsp;.Select(p =&gt; </span><span class="c4">new</span><span class="c0">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">// pentru fiecare obiect cre&#259;m un obiect anonim</span><span class="c0"><br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp;name = p.Attribute(</span><span class="c7">&quot;name&quot;</span><span class="c0">)?.Value,<br> &nbsp; &nbsp; &nbsp;age = p.Element(</span><span class="c7">&quot;age&quot;</span><span class="c0">)?.Value,<br> &nbsp; &nbsp; &nbsp;company = p.Element(</span><span class="c7">&quot;company&quot;</span><span class="c0">)?.Value<br> &nbsp;});<br><br></span><span class="c4">if</span><span class="c0">&nbsp;(microsoft </span><span class="c4">is</span><span class="c0">&nbsp;not </span><span class="c4">null</span><span class="c0">)<br>{<br> &nbsp; &nbsp;</span><span class="c4">foreach</span><span class="c0">&nbsp;(</span><span class="c4">var</span><span class="c0">&nbsp;person </span><span class="c4">in</span><span class="c0">&nbsp;microsoft)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c7">$&quot;Name: {person.name} &nbsp;Age: {person.age}&quot;</span><span class="c0">);<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c1"><span class="c2"></span></p><p class="c5"><span class="c2">&Icirc;n acest caz, select&#259;m toate elementele person al c&#259;ror element &icirc;ncorporat company este egal cu &quot;Microsoft&quot;. Apoi, pe baza selec&#539;iei ob&#539;inute, cre&#259;m un set de obiecte anonime cu trei propriet&#259;&#539;i. Pentru afi&#537;are, s-ar putea crea o clas&#259; sau o structur&#259; special&#259; &#537;i utilizarea lor &icirc;n locul obiectului anonim.</span></p><p class="c1"><span class="c2"></span></p><p class="c5"><span class="c2">Un alt exemplu - select&#259;m elementul person &icirc;n care atributul name este egal cu &quot;Tom&quot;:</span></p><p class="c1"><span class="c2"></span></p><a id="t.e2f394971cd24216c49faf2a1ea9ed23b6b9d3a7"></a><a id="t.8"></a><table class="c10"><tr class="c3"><td class="c12" colspan="1" rowspan="1"><p class="c9"><span class="c4">using</span><span class="c0">&nbsp;System.Xml.Linq;<br><br>XDocument xdoc = XDocument.Load(</span><span class="c7">&quot;people.xml&quot;</span><span class="c0">);<br><br></span><span class="c4">var</span><span class="c0">&nbsp;tom = xdoc.Element(</span><span class="c7">&quot;people&quot;</span><span class="c0">)? &nbsp; </span><span class="c11">// ob&#539;inem nodul r&#259;d&#259;cin&#259; people</span><span class="c0"><br> &nbsp; &nbsp;.Elements(</span><span class="c7">&quot;person&quot;</span><span class="c0">) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c11">// ob&#539;inem toate elementele person</span><span class="c0"><br> &nbsp; &nbsp;.FirstOrDefault(p =&gt; p.Attribute(</span><span class="c7">&quot;name&quot;</span><span class="c0">)?.Value == </span><span class="c7">&quot;Tom&quot;</span><span class="c0">);<br><br></span><span class="c4">var</span><span class="c0">&nbsp;name = tom?.Attribute(</span><span class="c7">&quot;name&quot;</span><span class="c0">)?.Value;<br></span><span class="c4">var</span><span class="c0">&nbsp;age = tom?.Element(</span><span class="c7">&quot;age&quot;</span><span class="c0">)?.Value;<br></span><span class="c4">var</span><span class="c0">&nbsp;company = tom?.Element(</span><span class="c7">&quot;company&quot;</span><span class="c0">)?.Value;<br><br>Console.WriteLine(</span><span class="c7">$&quot;Name: {name} &nbsp;Age: {age} &nbsp;Company: {company}&quot;</span><span class="c0">);</span></p></td></tr></table><p class="c1"><span class="c2"></span></p><p class="c5"><span class="c2">Acest cod extrage &#537;i afi&#537;eaz&#259; detaliile primei persoane din documentul XML care are atributul name cu valoarea &quot;Tom&quot;.</span></p><p class="c1"><span class="c2"></span></p></body></html>