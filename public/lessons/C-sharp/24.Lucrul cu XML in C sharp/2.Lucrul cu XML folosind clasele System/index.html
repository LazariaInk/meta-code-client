<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><link rel="stylesheet" type="text/css" href="/lessons/styles.css"></head><body class="c20 doc-content"><p class="c10"><span class="c18 c19">Lucrul cu XML folosind clasele System.Xml. </span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">Pentru a lucra cu XML &icirc;n C# se pot utiliza mai multe abord&#259;ri. &Icirc;n primele versiuni ale framework-ului, func&#539;ionalitatea principal&#259; pentru lucrul cu XML era oferit&#259; de spa&#539;iul de nume </span><span class="c7">System.Xml</span><span class="c0">. &Icirc;n acesta sunt definite o serie de clase care permit manipularea documentului XML:</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- </span><span class="c7">XmlNode</span><span class="c0">: reprezint&#259; un nod XML. Ca nod poate fi folosit &icirc;ntregul document sau un element individual</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- </span><span class="c7">XmlDocument</span><span class="c0">: reprezint&#259; &icirc;ntregul document XML</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- </span><span class="c7">XmlElement</span><span class="c0">: reprezint&#259; un element individual. Mo&#537;tene&#537;te clasa XmlNode</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- </span><span class="c7">XmlAttribute</span><span class="c0">: reprezint&#259; un atribut al unui element</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- </span><span class="c7">XmlText</span><span class="c0">: reprezint&#259; valoarea unui element sub form&#259; de text, adic&#259; acel text care se afl&#259; &icirc;n element &icirc;ntre tagurile sale de deschidere &#537;i &icirc;nchidere</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- </span><span class="c7">XmlComment</span><span class="c0">: reprezint&#259; un comentariu &icirc;n XML</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- </span><span class="c7">XmlNodeList</span><span class="c0">: este folosit pentru a lucra cu o list&#259; de noduri</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">Clasa principal&#259; care permite manipularea con&#539;inutului XML este </span><span class="c7">XmlNode</span><span class="c0">, a&#537;a c&#259; vom examina c&acirc;teva dintre metodele &#537;i propriet&#259;&#539;ile sale principale:</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- Proprietatea </span><span class="c7">Attributes </span><span class="c4">returneaz&#259; un obiect </span><span class="c4 c14">XmlAttributeCollection</span><span class="c0">, care reprezint&#259; o colec&#539;ie de atribute</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- Proprietatea </span><span class="c7">ChildNodes </span><span class="c0">returneaz&#259; colec&#539;ia de noduri copii pentru acest nod</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- Proprietatea </span><span class="c7">HasChildNodes </span><span class="c0">returneaz&#259; true dac&#259; nodul curent are noduri copii</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- Proprietatea </span><span class="c7">FirstChild </span><span class="c0">returneaz&#259; primul nod copil</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- Proprietatea </span><span class="c7">LastChild </span><span class="c0">returneaz&#259; ultimul nod copil</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- Proprietatea </span><span class="c7">InnerText </span><span class="c0">returneaz&#259; valoarea textului din nod</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- Proprietatea </span><span class="c7">InnerXml </span><span class="c0">returneaz&#259; &icirc;ntreaga structur&#259; intern&#259; XML a nodului</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- Proprietatea </span><span class="c7">Name </span><span class="c0">returneaz&#259; numele nodului. De exemplu, &lt;user&gt; - valoarea propriet&#259;&#539;ii Name este &quot;user&quot;</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">- Proprietatea </span><span class="c7">ParentNode </span><span class="c0">returneaz&#259; nodul p&#259;rinte al nodului curent</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">Aplic&#259;m aceste clase &#537;i func&#539;ionalitatea lor. Mai &icirc;nt&acirc;i, pentru a lucra cu XML, vom crea un nou fi&#537;ier. &Icirc;l vom numi </span><span class="c7">people.xml </span><span class="c0">&#537;i vom defini urm&#259;torul con&#539;inut &icirc;n el:</span></p><p class="c3"><span class="c0"></span></p><a id="t.f0cbcc1faa7ceed326b660f08ddc7ed92ce6bc31"></a><a id="t.0"></a><table class="c16"><tr class="c12"><td class="c15" colspan="1" rowspan="1"><p class="c6"><span class="c17">&lt;?</span><span class="c2">xml version=</span><span class="c5">&quot;1.0&quot;</span><span class="c2">&nbsp;encoding=</span><span class="c5">&quot;utf-8&quot;</span><span class="c2">&nbsp;</span><span class="c17">?&gt;</span><span class="c2"><br></span><span class="c1">&lt;</span><span class="c9">people</span><span class="c1">&gt;</span><span class="c2"><br> &nbsp;</span><span class="c1">&lt;</span><span class="c9">person</span><span class="c1">&nbsp;name=</span><span class="c5">&quot;Tom&quot;</span><span class="c1">&gt;</span><span class="c2"><br> &nbsp; &nbsp;</span><span class="c1">&lt;</span><span class="c9">company</span><span class="c1">&gt;</span><span class="c2">Microsoft</span><span class="c1">&lt;/</span><span class="c9">company</span><span class="c1">&gt;</span><span class="c2"><br> &nbsp; &nbsp;</span><span class="c1">&lt;</span><span class="c9">age</span><span class="c1">&gt;</span><span class="c2">37</span><span class="c1">&lt;/</span><span class="c9">age</span><span class="c1">&gt;</span><span class="c2"><br> &nbsp;</span><span class="c1">&lt;/</span><span class="c9">person</span><span class="c1">&gt;</span><span class="c2"><br> &nbsp;</span><span class="c1">&lt;</span><span class="c9">person</span><span class="c1">&nbsp;name=</span><span class="c5">&quot;Bob&quot;</span><span class="c1">&gt;</span><span class="c2"><br> &nbsp; &nbsp;</span><span class="c1">&lt;</span><span class="c9">company</span><span class="c1">&gt;</span><span class="c2">Google</span><span class="c1">&lt;/</span><span class="c9">company</span><span class="c1">&gt;</span><span class="c2"><br> &nbsp; &nbsp;</span><span class="c1">&lt;</span><span class="c9">age</span><span class="c1">&gt;</span><span class="c2">41</span><span class="c1">&lt;/</span><span class="c9">age</span><span class="c1">&gt;</span><span class="c2"><br> &nbsp;</span><span class="c1">&lt;/</span><span class="c9">person</span><span class="c1">&gt;</span><span class="c2"><br></span><span class="c1">&lt;/</span><span class="c9">people</span><span class="c1">&gt;</span></p></td></tr></table><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c0">Acum, vom parcurge acest document &#537;i &icirc;i vom afi&#537;a datele &icirc;n consol&#259;:</span></p><p class="c3"><span class="c0"></span></p><a id="t.9a8fa5ec96adbde6ad294785fb7042db45e3b601"></a><a id="t.1"></a><table class="c16"><tr class="c12"><td class="c15" colspan="1" rowspan="1"><p class="c6"><span class="c8">using</span><span class="c2">&nbsp;System.Xml;<br><br>XmlDocument xDoc = </span><span class="c8">new</span><span class="c2">&nbsp;XmlDocument();<br>xDoc.Load(</span><span class="c5">&quot;people.xml&quot;</span><span class="c2">);<br></span><span class="c13">// ob&#539;inem elementul r&#259;d&#259;cin&#259;</span><span class="c2"><br>XmlElement? xRoot = xDoc.DocumentElement;<br></span><span class="c8">if</span><span class="c2">&nbsp;(xRoot != </span><span class="c8">null</span><span class="c2">)<br>{<br> &nbsp; &nbsp;</span><span class="c13">// parcurgem toate nodurile din elementul r&#259;d&#259;cin&#259;</span><span class="c2"><br> &nbsp; &nbsp;</span><span class="c8">foreach</span><span class="c2">&nbsp;(XmlElement xnode </span><span class="c8">in</span><span class="c2">&nbsp;xRoot)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c13">// ob&#539;inem atributul name</span><span class="c2"><br> &nbsp; &nbsp; &nbsp; &nbsp;XmlNode? attr = xnode.Attributes.GetNamedItem(</span><span class="c5">&quot;name&quot;</span><span class="c2">);<br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(attr?.Value);<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c13">// parcurgem toate nodurile copii ale elementului user</span><span class="c2"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">foreach</span><span class="c2">&nbsp;(XmlNode childnode </span><span class="c8">in</span><span class="c2">&nbsp;xnode.ChildNodes)<br> &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c13">// dac&#259; nodul este company</span><span class="c2"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">if</span><span class="c2">&nbsp;(childnode.Name == </span><span class="c5">&quot;company&quot;</span><span class="c2">)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c5">$&quot;Company: {childnode.InnerText}&quot;</span><span class="c2">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c13">// dac&#259; nodul este age</span><span class="c2"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">if</span><span class="c2">&nbsp;(childnode.Name == </span><span class="c5">&quot;age&quot;</span><span class="c2">)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c5">$&quot;Age: {childnode.InnerText}&quot;</span><span class="c2">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine();<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c0">Rezultatul afi&#537;at &icirc;n consol&#259; va fi:</span></p><p class="c3"><span class="c0"></span></p><a id="t.32679ebf4d3f009f8e6191f029d69b204090816b"></a><a id="t.2"></a><table class="c16"><tr class="c12"><td class="c15" colspan="1" rowspan="1"><p class="c6"><span class="c2">Tom<br>Company: Microsoft<br>Age: </span><span class="c11">37</span><span class="c2"><br><br>Bob<br>Company: Google<br>Age: </span><span class="c11">41</span></p></td></tr></table><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">Pentru a &icirc;ncepe lucrul cu documentul XML, trebuie s&#259; cre&#259;m un obiect XmlDocument &#537;i apoi s&#259; &icirc;nc&#259;rc&#259;m &icirc;n el fi&#537;ierul XML: </span><span class="c4 c14">xDoc.Load(&quot;people.xml&quot;)</span><span class="c0">;.</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">La analizarea XML-ului, mai &icirc;nt&acirc;i ob&#539;inem elementul r&#259;d&#259;cin&#259; al documentului cu ajutorul propriet&#259;&#539;ii </span><span class="c4 c14">xDoc.DocumentElement</span><span class="c0">. Apoi are loc analiza efectiv&#259; a nodurilor documentului.</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">&Icirc;n bucla</span><span class="c4 c14">&nbsp;foreach(XmlNode xnode in xRoot)</span><span class="c4">&nbsp;parcurgem toate nodurile copii ale elementului r&#259;d&#259;cin&#259;. Deoarece nodurile copii reprezint&#259; elemente &lt;person&gt;, putem ob&#539;ine atributele acestora: </span><span class="c4 c14 c18">XmlNode attr =</span></p><p class="c10"><span class="c4 c14">xnode.Attributes.GetNamedItem(&quot;name&quot;)</span><span class="c4">; &#537;i elementele &icirc;ncorporate: </span><span class="c4 c14">foreach(XmlNode childnode in xnode.ChildNodes)</span><span class="c0">.</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c4">Pentru a determina ce fel de nod avem &icirc;n fa&#539;&#259;, putem compara numele acestuia: </span><span class="c4 c18 c14">if(childnode.Name==&quot;company&quot;).</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c0">&Icirc;n mod similar, putem crea obiecte ale claselor &#537;i structurilor din datele XML:</span></p><p class="c3"><span class="c0"></span></p><a id="t.9dbdfb22f7bd6bfff5a841d894b2a31c74492ad3"></a><a id="t.3"></a><table class="c16"><tr class="c12"><td class="c15" colspan="1" rowspan="1"><p class="c6"><span class="c8">using</span><span class="c2">&nbsp;System.Xml;<br><br></span><span class="c8">var</span><span class="c2">&nbsp;people = </span><span class="c8">new</span><span class="c2">&nbsp;List&lt;Person&gt;();<br><br>XmlDocument xDoc = </span><span class="c8">new</span><span class="c2">&nbsp;XmlDocument();<br>xDoc.Load(</span><span class="c5">&quot;people.xml&quot;</span><span class="c2">);<br></span><span class="c13">// ob&#539;inem elementul r&#259;d&#259;cin&#259;</span><span class="c2"><br>XmlElement? xRoot = xDoc.DocumentElement;<br></span><span class="c8">if</span><span class="c2">&nbsp;(xRoot != </span><span class="c8">null</span><span class="c2">)<br>{<br> &nbsp; &nbsp;</span><span class="c8">foreach</span><span class="c2">&nbsp;(XmlElement xnode </span><span class="c8">in</span><span class="c2">&nbsp;xRoot)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;Person person = </span><span class="c8">new</span><span class="c2">&nbsp;Person();<br> &nbsp; &nbsp; &nbsp; &nbsp;XmlNode? attr = xnode.Attributes.GetNamedItem(</span><span class="c5">&quot;name&quot;</span><span class="c2">);<br> &nbsp; &nbsp; &nbsp; &nbsp;person.Name = attr?.Value;<br><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">foreach</span><span class="c2">&nbsp;(XmlNode childnode </span><span class="c8">in</span><span class="c2">&nbsp;xnode.ChildNodes)<br> &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">if</span><span class="c2">&nbsp;(childnode.Name == </span><span class="c5">&quot;company&quot;</span><span class="c2">)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;person.Company = childnode.InnerText;<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c8">if</span><span class="c2">&nbsp;(childnode.Name == </span><span class="c5">&quot;age&quot;</span><span class="c2">)<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;person.Age = </span><span class="c8">int</span><span class="c2">.Parse(childnode.InnerText);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;people.Add(person);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span class="c8">foreach</span><span class="c2">&nbsp;(</span><span class="c8">var</span><span class="c2">&nbsp;person </span><span class="c8">in</span><span class="c2">&nbsp;people)<br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c5">$&quot;{person.Name} ({person.Company}) - {person.Age}&quot;</span><span class="c2">);<br>}<br><br></span><span class="c8">class</span><span class="c2">&nbsp;</span><span class="c21">Person</span><span class="c2"><br>{<br> &nbsp; &nbsp;</span><span class="c8">public</span><span class="c2">&nbsp;</span><span class="c8">string</span><span class="c2">? Name { </span><span class="c8">get</span><span class="c2">; </span><span class="c8">set</span><span class="c2">; }<br> &nbsp; &nbsp;</span><span class="c8">public</span><span class="c2">&nbsp;</span><span class="c8">int</span><span class="c2">&nbsp;Age { </span><span class="c8">get</span><span class="c2">; </span><span class="c8">set</span><span class="c2">; }<br> &nbsp; &nbsp;</span><span class="c8">public</span><span class="c2">&nbsp;</span><span class="c8">string</span><span class="c2">? Company { </span><span class="c8">get</span><span class="c2">; </span><span class="c8">set</span><span class="c2">; }<br>}</span></p></td></tr></table><p class="c3"><span class="c0"></span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c0">&Icirc;n acest caz, este definit&#259; clasa Person cu trei propriet&#259;&#539;i. La parcurgerea nodurilor fi&#537;ierului XML, valorile elementelor &#537;i atributelor acestora sunt transmise obiectului clasei Person.</span></p><p class="c3"><span class="c0"></span></p><p class="c10"><span class="c0">Afi&#537;area &icirc;n consol&#259; a programului:</span></p><p class="c3"><span class="c0"></span></p><a id="t.d19abdb13e1029e7f091cee26949ab7054353b88"></a><a id="t.4"></a><table class="c16"><tr class="c12"><td class="c15" colspan="1" rowspan="1"><p class="c6"><span class="c2">Tom (Microsoft) - </span><span class="c11">37</span><span class="c2"><br>Bob (Google) - </span><span class="c11">41</span></p></td></tr></table><p class="c3"><span class="c0"></span></p><p class="c3"><span class="c0"></span></p></body></html>