<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><link rel="stylesheet" type="text/css" href="/lessons/styles.css"></head><body class="c22 doc-content"><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c17 c23">Metode asincrone, async &#537;i await.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c0">Nu de pu&#539;ine ori programul execut&#259; astfel de opera&#539;ii, care pot dura mult timp, de exemplu, accesarea resurselor de re&#539;ea, citirea-scrierea fi&#537;ierelor, accesarea bazei de date etc. Astfel de opera&#539;ii pot &icirc;nc&#259;rca serios aplica&#539;ia. Acest lucru este deosebit de relevant &icirc;n aplica&#539;iile grafice (desktop sau mobile), unde opera&#539;iile de lung&#259; durat&#259; pot bloca interfa&#539;a utilizatorului &#537;i influen&#539;a negativ dorin&#539;a utilizatorului de a lucra cu programul, sau &icirc;n aplica&#539;iile web, care trebuie s&#259; fie gata s&#259; deserveasc&#259; mii de cereri pe secund&#259;. &Icirc;ntr-o aplica&#539;ie sincron&#259;, &icirc;n timpul efectu&#259;rii opera&#539;iilor de lung&#259; durat&#259; &icirc;n firul principal, acest fir pur &#537;i simplu ar fi blocat pe durata execut&#259;rii opera&#539;iei. &#536;i pentru ca opera&#539;iile de lung&#259; durat&#259; s&#259; nu blocheze func&#539;ionarea general&#259; a aplica&#539;iei, &icirc;n C# se poate utiliza asincronitatea.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c2">Asincronitatea </span><span class="c0">permite mutarea unor sarcini separate din firul principal &icirc;n metode asincrone speciale &#537;i, &icirc;n acela&#537;i timp, utilizarea mai economic&#259; a firelor. Metodele asincrone se execut&#259; &icirc;n fire separate. Totu&#537;i, &icirc;n timpul execut&#259;rii unei opera&#539;ii de lung&#259; durat&#259;, firul metodei asincrone se &icirc;ntoarce &icirc;n pool-ul de fire &#537;i va fi utilizat pentru alte sarcini. Iar c&acirc;nd opera&#539;ia de lung&#259; durat&#259; &icirc;&#537;i &icirc;ncheie execu&#539;ia, pentru metoda asincron&#259; se aloc&#259; din nou un fir din pool-ul de fire, iar metoda asincron&#259; &icirc;&#537;i continu&#259; activitatea.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">Cheia pentru lucrul cu apelurile asincrone &icirc;n C# sunt doi operatori: </span><span class="c2">async </span><span class="c5">&#537;i </span><span class="c2">await</span><span class="c0">, al c&#259;ror scop este simplificarea scrierii codului asincron. Ei sunt folosi&#539;i &icirc;mpreun&#259; pentru a crea o metod&#259; asincron&#259;.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c2">O metod&#259; asincron&#259;</span><span class="c0">&nbsp;are urm&#259;toarele caracteristici:</span></p><p class="c6 c12"><span class="c0"></span></p><ul class="c7 lst-kix_hdxh4ua48v31-0 start"><li class="c6 c19 li-bullet-0"><span class="c5">&Icirc;n antetul metodei se utilizeaz&#259; modificatorul </span><span class="c17 c2">async</span></li></ul><p class="c6 c8"><span class="c17 c2"></span></p><ul class="c7 lst-kix_hdxh4ua48v31-0"><li class="c6 c19 li-bullet-0"><span class="c5">Metoda con&#539;ine una sau mai multe expresii </span><span class="c2 c17">await</span></li></ul><p class="c6 c8"><span class="c0"></span></p><ul class="c7 lst-kix_hdxh4ua48v31-0"><li class="c6 c19 li-bullet-0"><span class="c0">Ca tip de returnare se folose&#537;te unul dintre urm&#259;toarele:</span></li></ul><p class="c6 c12"><span class="c0"></span></p><ol class="c7 lst-kix_zdcqkctbfmdu-0 start" start="1"><li class="c6 c19 li-bullet-0"><span class="c20 c5 c15">void</span></li></ol><p class="c6 c8"><span class="c0"></span></p><ol class="c7 lst-kix_zdcqkctbfmdu-0" start="2"><li class="c6 c19 li-bullet-0"><span class="c20 c5 c15">Task</span></li></ol><p class="c6 c8"><span class="c0"></span></p><ol class="c7 lst-kix_zdcqkctbfmdu-0" start="3"><li class="c6 c19 li-bullet-0"><span class="c20 c5 c15">Task&lt;T&gt;</span></li></ol><p class="c6 c8"><span class="c0"></span></p><ol class="c7 lst-kix_zdcqkctbfmdu-0" start="4"><li class="c6 c19 li-bullet-0"><span class="c20 c5 c15">ValueTask&lt;T&gt;</span></li></ol><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">O metod&#259; asincron&#259;, la fel ca una obi&#537;nuit&#259;, poate folosi un num&#259;r oric&acirc;t de mare de parametri sau s&#259; nu foloseasc&#259; deloc. Totu&#537;i, o metod&#259; asincron&#259; nu poate defini parametri cu modificatorii </span><span class="c2">out</span><span class="c5">, </span><span class="c2">ref </span><span class="c5">&#537;i </span><span class="c2">in</span><span class="c0">.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">De asemenea, trebuie men&#539;ionat c&#259; cuv&acirc;ntul </span><span class="c2">async</span><span class="c5">, care se indic&#259; &icirc;n defini&#539;ia metodei, NU face automat metoda asincron&#259;. El doar indic&#259; faptul c&#259; aceast&#259; metod&#259; poate con&#539;ine una sau mai multe expresii </span><span class="c2">await</span><span class="c0">.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c0">S&#259; analiz&#259;m un exemplu simplu de definire &#537;i apelare a unei metode asincrone:</span></p><p class="c6 c12"><span class="c0"></span></p><a id="t.66907fc78573cbffa03fca2f1bbf716700d794ba"></a><a id="t.0"></a><table class="c16"><tr class="c18"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c13">await</span><span class="c4">&nbsp;PrintAsync(); &nbsp; </span><span class="c3">// apelul metodei asincrone</span><span class="c4"><br>Console.WriteLine(</span><span class="c11">&quot;Unele ac&#539;iuni &icirc;n metoda Main&quot;</span><span class="c4">);<br> <br></span><span class="c13">void</span><span class="c4">&nbsp;</span><span class="c14">Print</span><span class="c4">()<br>{<br> &nbsp; &nbsp;Thread.Sleep(</span><span class="c10">3000</span><span class="c4">); &nbsp; &nbsp; </span><span class="c3">// imita&#539;ia unei lucr&#259;ri de lung&#259; durat&#259;</span><span class="c4"><br> &nbsp; &nbsp;Console.WriteLine(</span><span class="c11">&quot;Hello FDC.COM&quot;</span><span class="c4">);<br>}<br> <br></span><span class="c3">// definirea metodei asincrone</span><span class="c4"><br></span><span class="c13">async</span><span class="c4">&nbsp;Task </span><span class="c14">PrintAsync</span><span class="c4">()<br>{<br> &nbsp; &nbsp;Console.WriteLine(</span><span class="c11">&quot;&Icirc;nceputul metodei PrintAsync&quot;</span><span class="c4">); </span><span class="c3">// se execut&#259; sincron</span><span class="c4"><br> &nbsp; &nbsp;</span><span class="c13">await</span><span class="c4">&nbsp;Task.Run(() =&gt; Print()); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">// se execut&#259; asincron</span><span class="c4"><br> &nbsp; &nbsp;Console.WriteLine(</span><span class="c11">&quot;Sf&acirc;r&#537;itul metodei PrintAsync&quot;</span><span class="c4">);<br>}</span></p></td></tr></table><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">Aici, &icirc;n primul r&acirc;nd, este definit&#259; o metod&#259; obi&#537;nuit&#259; Print, care doar afi&#537;eaz&#259; un anumit &#537;ir pe consol&#259;. Pentru imita&#539;ia unei lucr&#259;ri de lung&#259; durat&#259; se folose&#537;te o &icirc;nt&acirc;rziere de 3 secunde cu ajutorul metodei</span><span class="c5 c15">&nbsp;Thread.Sleep()</span><span class="c0">. Adic&#259;, &icirc;n mod condi&#539;ionat, Print este o anumit&#259; metod&#259; care execut&#259; o anumit&#259; opera&#539;ie de lung&#259; durat&#259;. &Icirc;ntr-o aplica&#539;ie real&#259;, aceasta ar putea fi accesarea bazei de date sau citirea-scrierea fi&#537;ierelor, dar pentru simplificarea &icirc;n&#539;elegerii, ea doar afi&#537;eaz&#259; un &#537;ir pe consol&#259;.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">De asemenea, aici este definit&#259; o metod&#259; asincron&#259; </span><span class="c5 c15">PrintAsync()</span><span class="c5">. Ea este asincron&#259; deoarece are &icirc;n defini&#539;ie, &icirc;naintea tipului de returnare, modificatorul </span><span class="c2">async</span><span class="c5">, tipul ei de returnare este Task, &#537;i &icirc;n corpul metodei este definit&#259; expresia </span><span class="c2">await</span><span class="c0">.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">Trebuie men&#539;ionat c&#259; metoda PrintAsync nu returneaz&#259; explicit niciun obiect Task, dar deoarece &icirc;n corpul metodei se aplic&#259; expresia </span><span class="c2">await</span><span class="c0">, ca tip de returnare se poate folosi tipul Task.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">Operatorul </span><span class="c2">await </span><span class="c0">precede executarea sarcinii care va fi executat&#259; asincron. &Icirc;n acest caz, aceast&#259; opera&#539;ie reprezint&#259; executarea metodei Print:</span></p><p class="c6 c12"><span class="c0"></span></p><a id="t.5675d8b5821f9460c8db99ff3a0ee6c7989d2331"></a><a id="t.1"></a><table class="c16"><tr class="c18"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c13">await</span><span class="c4">&nbsp;Task.Run(()=&gt;Print());</span></p></td></tr></table><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">Dup&#259; regulile nescrise, &icirc;n denumirea metodelor asincrone este obi&#537;nuit s&#259; se foloseasc&#259; sufixul </span><span class="c2">Async </span><span class="c5">- </span><span class="c5 c15">Print</span><span class="c2 c15">Async</span><span class="c2">()</span><span class="c0">, de&#537;i &icirc;n principiu nu este obligatoriu.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c0">&#536;i apoi &icirc;n program (&icirc;n acest caz &icirc;n metoda Main) este apelat&#259; aceast&#259; metod&#259; asincron&#259;.</span></p><p class="c6 c12"><span class="c0"></span></p><a id="t.06cbdd15ea9860aebf41e3e4c8f268896527b389"></a><a id="t.2"></a><table class="c16"><tr class="c18"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c13">await</span><span class="c4">&nbsp;PrintAsync(); &nbsp; </span><span class="c3">// apelul metodei asincrone</span></p></td></tr></table><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c0">S&#259; vedem ce va afi&#537;a programul pe consol&#259;:</span></p><p class="c6 c12"><span class="c0"></span></p><a id="t.edcbb5142c9593611f77a684a99764a41cdd3bb1"></a><a id="t.3"></a><table class="c16"><tr class="c18"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c4">&Icirc;nceputul metodei PrintAsync<br>Hello FDC.COM<br>Sf&acirc;r&#537;itul metodei PrintAsync<br>Unele ac&#539;iuni &icirc;n metoda Main</span></p></td></tr></table><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c0">S&#259; analiz&#259;m pe etape ce se &icirc;nt&acirc;mpl&#259; aici:</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c0">Se lanseaz&#259; programul, mai exact metoda Main, &icirc;n care este apelat&#259; metoda asincron&#259; PrintAsync.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c0">Metoda PrintAsync &icirc;ncepe s&#259; se execute sincron p&acirc;n&#259; la expresia await.</span></p><p class="c6 c12"><span class="c0"></span></p><a id="t.1f7366e4b9dbcb098d6f9bdfb8b9465a3c53344c"></a><a id="t.4"></a><table class="c16"><tr class="c18"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c4">Console.WriteLine(</span><span class="c11">&quot;&Icirc;nceputul metodei PrintAsync&quot;</span><span class="c4">); </span><span class="c3">// se execut&#259; sincron</span></p></td></tr></table><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">Expresia await lanseaz&#259; sarcina asincron&#259; </span><span class="c5 c15 c20">Task.Run(()=&gt;Print())</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">&Icirc;n timp ce sarcina asincron&#259;</span><span class="c5 c15">&nbsp;Task.Run(()=&gt;Print()) </span><span class="c0">se execut&#259; (&#537;i ea poate dura destul de mult timp), execu&#539;ia codului se &icirc;ntoarce &icirc;n metoda apelant&#259; - adic&#259; &icirc;n metoda Main.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">C&acirc;nd sarcina asincron&#259; &icirc;&#537;i &icirc;ncheie execu&#539;ia (&icirc;n cazul de mai sus - afi&#537;eaz&#259; &#537;irul dup&#259; trei secunde), metoda asincron&#259; </span><span class="c5 c15">PrintAsync</span><span class="c0">, care a lansat sarcina asincron&#259;, &icirc;&#537;i continu&#259; activitatea.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c0">Dup&#259; &icirc;ncheierea metodei PrintAsync, &icirc;&#537;i continu&#259; activitatea metoda Main.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c17 c21">Metoda asincron&#259; Main.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">Trebuie avut &icirc;n vedere c&#259; operatorul </span><span class="c2">await </span><span class="c5">se poate aplica doar &icirc;n metoda care are modificatorul </span><span class="c2">async</span><span class="c5">. &#536;i dac&#259; &icirc;n metoda Main se folose&#537;te operatorul </span><span class="c2">await</span><span class="c0">, atunci metoda Main trebuie de asemenea s&#259; fie definit&#259; ca asincron&#259;. Adic&#259; exemplul anterior va fi de fapt analog cu urm&#259;torul:</span></p><p class="c6 c12"><span class="c0"></span></p><a id="t.640fcefedf001a53f89e512bffea4b9d4743dee1"></a><a id="t.5"></a><table class="c16"><tr class="c18"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c13">class</span><span class="c4">&nbsp;</span><span class="c14">Program</span><span class="c4"><br>{<br> &nbsp; &nbsp;</span><span class="c13">async</span><span class="c4">&nbsp;</span><span class="c13">static</span><span class="c4">&nbsp;Task </span><span class="c14">Main</span><span class="c4">(</span><span class="c13">string</span><span class="c4">[] args)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c13">await</span><span class="c4">&nbsp;PrintAsync(); &nbsp; </span><span class="c3">// apelul metodei asincrone</span><span class="c4"><br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c11">&quot;Unele ac&#539;iuni &icirc;n metoda Main&quot;</span><span class="c4">);<br> <br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c13">void</span><span class="c4">&nbsp;</span><span class="c14">Print</span><span class="c4">()<br> &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thread.Sleep(</span><span class="c10">3000</span><span class="c4">); &nbsp; &nbsp; </span><span class="c3">// imita&#539;ia unei lucr&#259;ri de lung&#259; durat&#259;</span><span class="c4"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c11">&quot;Hello FDC.COM&quot;</span><span class="c4">);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> <br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">// definirea metodei asincrone</span><span class="c4"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c13">async</span><span class="c4">&nbsp;Task </span><span class="c14">PrintAsync</span><span class="c4">()<br> &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c11">&quot;&Icirc;nceputul metodei PrintAsync&quot;</span><span class="c4">); </span><span class="c3">// se execut&#259; sincron</span><span class="c4"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c13">await</span><span class="c4">&nbsp;Task.Run(() =&gt; Print()); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">// se execut&#259; asincron</span><span class="c4"><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c11">&quot;Sf&acirc;r&#537;itul metodei PrintAsync&quot;</span><span class="c4">);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c17 c21">&Icirc;nt&acirc;rzierea opera&#539;iei asincrone &#537;i Task.Delay.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">&Icirc;n metodele asincrone pentru oprirea metodei pentru o anumit&#259; perioad&#259; de timp se poate folosi metoda</span><span class="c2">&nbsp;Task.Delay()</span><span class="c0">. Ca parametru, aceasta prime&#537;te num&#259;rul de milisecunde sub form&#259; de valoare int sau obiectul TimeSpan, care stabile&#537;te timpul de &icirc;nt&acirc;rziere:</span></p><p class="c6 c12"><span class="c0"></span></p><a id="t.85b970a42ebee52a7efe9a2e1913dfb634e7f6b9"></a><a id="t.6"></a><table class="c16"><tr class="c18"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c13">await</span><span class="c4">&nbsp;PrintAsync(); &nbsp; </span><span class="c3">// apelul metodei asincrone</span><span class="c4"><br>Console.WriteLine(</span><span class="c11">&quot;Unele ac&#539;iuni &icirc;n metoda Main&quot;</span><span class="c4">);<br> <br></span><span class="c3">// definirea metodei asincrone</span><span class="c4"><br></span><span class="c13">async</span><span class="c4">&nbsp;Task </span><span class="c14">PrintAsync</span><span class="c4">()<br>{<br> &nbsp; &nbsp;</span><span class="c13">await</span><span class="c4">&nbsp;Task.Delay(</span><span class="c10">3000</span><span class="c4">); &nbsp; &nbsp; </span><span class="c3">// imita&#539;ia unei lucr&#259;ri de lung&#259; durat&#259;</span><span class="c4"><br> &nbsp; &nbsp;</span><span class="c3">// sau a&#537;a</span><span class="c4"><br> &nbsp; &nbsp;</span><span class="c3">//await Task.Delay(TimeSpan.FromMilliseconds(3000));</span><span class="c4"><br> &nbsp; &nbsp;Console.WriteLine(</span><span class="c11">&quot;Hello FDC.COM&quot;</span><span class="c4">);<br>}</span></p></td></tr></table><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">Metoda </span><span class="c5 c15">Task.Delay</span><span class="c0">&nbsp;reprezint&#259; o opera&#539;ie asincron&#259;, prin urmare operatorul await se aplic&#259; la aceasta.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c17 c21">Avantajele asincronit&#259;&#539;ii.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c0">Exemplele de mai sus sunt simplific&#259;ri &#537;i probabil nu pot fi considerate exemplare. S&#259; analiz&#259;m un alt exemplu:</span></p><p class="c6 c12"><span class="c0"></span></p><a id="t.e264d76e4a2c95a04af29fcebf9bb2a212268f9c"></a><a id="t.7"></a><table class="c16"><tr class="c18"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c4">PrintName(</span><span class="c11">&quot;Tom&quot;</span><span class="c4">);<br>PrintName(</span><span class="c11">&quot;Bob&quot;</span><span class="c4">);<br>PrintName(</span><span class="c11">&quot;Sam&quot;</span><span class="c4">);<br> <br></span><span class="c13">void</span><span class="c4">&nbsp;</span><span class="c14">PrintName</span><span class="c4">(</span><span class="c13">string</span><span class="c4">&nbsp;name)<br>{<br> &nbsp; &nbsp;Thread.Sleep(</span><span class="c10">300</span><span class="c4"><br><br></span><span class="c10">0</span><span class="c4">); &nbsp; &nbsp; </span><span class="c3">// imita&#539;ia unei lucr&#259;ri de lung&#259; durat&#259;</span><span class="c4"><br> &nbsp; &nbsp;Console.WriteLine(name);<br>}</span></p></td></tr></table><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c0">Acest cod este sincron &#537;i execut&#259; secven&#539;ial trei apeluri ale metodei PrintName. Deoarece pentru imita&#539;ia unei lucr&#259;ri de lung&#259; durat&#259; &icirc;n metod&#259; este stabilit&#259; o &icirc;nt&acirc;rziere de trei secunde, execu&#539;ia total&#259; a programului va dura cel pu&#539;in 9 secunde. Deoarece fiecare apel ulterior al metodei PrintName va a&#537;tepta finalizarea celui precedent.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c0">S&#259; modific&#259;m &icirc;n program metoda sincron&#259; PrintName &icirc;n una asincron&#259;:</span></p><p class="c6 c12"><span class="c0"></span></p><a id="t.f0e091bafffc850592a6529f320607e2f3b38eca"></a><a id="t.8"></a><table class="c16"><tr class="c18"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c13">await</span><span class="c4">&nbsp;PrintNameAsync(</span><span class="c11">&quot;Tom&quot;</span><span class="c4">);<br></span><span class="c13">await</span><span class="c4">&nbsp;PrintNameAsync(</span><span class="c11">&quot;Bob&quot;</span><span class="c4">);<br></span><span class="c13">await</span><span class="c4">&nbsp;PrintNameAsync(</span><span class="c11">&quot;Sam&quot;</span><span class="c4">);<br> <br></span><span class="c3">// definirea metodei asincrone</span><span class="c4"><br></span><span class="c13">async</span><span class="c4">&nbsp;Task </span><span class="c14">PrintNameAsync</span><span class="c4">(</span><span class="c13">string</span><span class="c4">&nbsp;name)<br>{<br> &nbsp; &nbsp;</span><span class="c13">await</span><span class="c4">&nbsp;Task.Delay(</span><span class="c10">3000</span><span class="c4">); &nbsp; &nbsp; </span><span class="c3">// imita&#539;ia unei lucr&#259;ri de lung&#259; durat&#259;</span><span class="c4"><br> &nbsp; &nbsp;Console.WriteLine(name);<br>}</span></p></td></tr></table><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c5">&Icirc;n locul metodei PrintName, acum se apeleaz&#259; de trei ori PrintNameAsync. Pentru imita&#539;ia unei lucr&#259;ri de lung&#259; durat&#259; &icirc;n metod&#259; este stabilit&#259; o &icirc;nt&acirc;rziere de 3 secunde cu ajutorul apelului </span><span class="c5 c15">Task.Delay(3000)</span><span class="c0">. &#536;i deoarece la apelul fiec&#259;rei metode se folose&#537;te operatorul await, care opre&#537;te execu&#539;ia p&acirc;n&#259; la finalizarea metodei asincrone, execu&#539;ia total&#259; a programului va dura din nou cel pu&#539;in 9 secunde. Totu&#537;i, acum execu&#539;ia opera&#539;iilor asincrone nu blocheaz&#259; firul principal.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c0">Acum s&#259; optimiz&#259;m programul:</span></p><p class="c6 c12"><span class="c0"></span></p><a id="t.fc40d2b9bea61a0f4a3d91254294a80935c713fa"></a><a id="t.9"></a><table class="c16"><tr class="c18"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c13">var</span><span class="c4">&nbsp;tomTask = PrintNameAsync(</span><span class="c11">&quot;Tom&quot;</span><span class="c4">);<br></span><span class="c13">var</span><span class="c4">&nbsp;bobTask = PrintNameAsync(</span><span class="c11">&quot;Bob&quot;</span><span class="c4">);<br></span><span class="c13">var</span><span class="c4">&nbsp;samTask = PrintNameAsync(</span><span class="c11">&quot;Sam&quot;</span><span class="c4">);<br> <br></span><span class="c13">await</span><span class="c4">&nbsp;tomTask;<br></span><span class="c13">await</span><span class="c4">&nbsp;bobTask;<br></span><span class="c13">await</span><span class="c4">&nbsp;samTask;<br><br></span><span class="c3">// definirea metodei asincrone</span><span class="c4"><br></span><span class="c13">async</span><span class="c4">&nbsp;Task </span><span class="c14">PrintNameAsync</span><span class="c4">(</span><span class="c13">string</span><span class="c4">&nbsp;name)<br>{<br> &nbsp; &nbsp;</span><span class="c13">await</span><span class="c4">&nbsp;Task.Delay(</span><span class="c10">3000</span><span class="c4">); &nbsp; &nbsp; </span><span class="c3">// imita&#539;ia unei lucr&#259;ri de lung&#259; durat&#259;</span><span class="c4"><br> &nbsp; &nbsp;Console.WriteLine(name);<br>}</span></p></td></tr></table><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c0">&Icirc;n acest caz, sarcinile sunt de fapt lansate la definire. Iar operatorul await se aplic&#259; doar atunci c&acirc;nd trebuie s&#259; a&#537;tept&#259;m finalizarea opera&#539;iilor asincrone - adic&#259; la sf&acirc;r&#537;itul programului. &#536;i &icirc;n acest caz, execu&#539;ia total&#259; a programului va dura cel pu&#539;in 3 secunde, dar mult mai pu&#539;in de 9 secunde.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c17 c21">Definirea unei expresii lambda asincrone.</span></p><p class="c6 c12"><span class="c0"></span></p><p class="c6"><span class="c0">O opera&#539;ie asincron&#259; poate fi definit&#259; nu doar cu ajutorul unei metode separate, ci &#537;i cu ajutorul unei expresii lambda:</span></p><p class="c6 c12"><span class="c0"></span></p><a id="t.7e73ea45252e3703e70103fa87d6dc5712f7efeb"></a><a id="t.10"></a><table class="c16"><tr class="c18"><td class="c9" colspan="1" rowspan="1"><p class="c1"><span class="c3">// expresia lambda asincron&#259;</span><span class="c4"><br>Func&lt;</span><span class="c13">string</span><span class="c4">, Task&gt; printer = </span><span class="c13">async</span><span class="c4">&nbsp;(message) =&gt;<br>{<br> &nbsp; &nbsp;</span><span class="c13">await</span><span class="c4">&nbsp;Task.Delay(</span><span class="c10">1000</span><span class="c4">);<br> &nbsp; &nbsp;Console.WriteLine(message);<br>};<br> <br></span><span class="c13">await</span><span class="c4">&nbsp;printer(</span><span class="c11">&quot;Hello World&quot;</span><span class="c4">);<br></span><span class="c13">await</span><span class="c4">&nbsp;printer(</span><span class="c11">&quot;Hello FDC.COM&quot;</span><span class="c4">);</span></p></td></tr></table><p class="c6 c12"><span class="c0"></span></p><p class="c6 c12"><span class="c0"></span></p></body></html>