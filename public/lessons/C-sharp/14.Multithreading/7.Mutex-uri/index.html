<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><link rel="stylesheet" type="text/css" href="/lessons/styles.css"></head><body class="c16 doc-content"><p class="c4"><span class="c17">Mutex-uri.</span></p><p class="c1"><span class="c3"></span></p><p class="c4"><span class="c13">Un alt instrument de gestionare a sincroniz&#259;rii thread-urilor este clasa </span><span class="c12">Mutex</span><span class="c13">, care se afl&#259; &icirc;n namespace-ul</span><span class="c8">&nbsp;System.Threading</span><span class="c3">.</span></p><p class="c1"><span class="c3"></span></p><p class="c4"><span class="c3">S&#259; lu&#259;m exemplul cu operatorul lock din una dintre temele anterioare, &icirc;n care se utiliza sincronizarea thread-urilor:</span></p><p class="c1"><span class="c3"></span></p><a id="t.7b897154188d46b449bf96acc2ffd27b541408e8"></a><a id="t.0"></a><table class="c10"><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c7"><span class="c6">int</span><span class="c0">&nbsp;x = </span><span class="c2">0</span><span class="c0">;<br></span><span class="c6">object</span><span class="c0">&nbsp;locker = </span><span class="c6">new</span><span class="c0">(); &nbsp;</span><span class="c11">// obiect placeholder</span><span class="c0"><br><br></span><span class="c11">// pornim cinci thread-uri</span><span class="c0"><br></span><span class="c6">for</span><span class="c0">&nbsp;(</span><span class="c6">int</span><span class="c0">&nbsp;i = </span><span class="c2">1</span><span class="c0">; i &lt; </span><span class="c2">6</span><span class="c0">; i++)<br>{<br> &nbsp; &nbsp;Thread myThread = </span><span class="c6">new</span><span class="c0">(Print);<br> &nbsp; &nbsp;myThread.Name = </span><span class="c15">$&quot;Thread {i}&quot;</span><span class="c0">;<br> &nbsp; &nbsp;myThread.Start();<br>}<br><br></span><span class="c6">void</span><span class="c0">&nbsp;</span><span class="c5">Print</span><span class="c0">()<br>{<br> &nbsp; &nbsp;</span><span class="c6">lock</span><span class="c0">&nbsp;(locker)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;x = </span><span class="c2">1</span><span class="c0">;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c6">for</span><span class="c0">&nbsp;(</span><span class="c6">int</span><span class="c0">&nbsp;i = </span><span class="c2">1</span><span class="c0">; i &lt; </span><span class="c2">6</span><span class="c0">; i++)<br> &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c15">$&quot;{Thread.CurrentThread.Name}: {x}&quot;</span><span class="c0">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;x++;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thread.Sleep(</span><span class="c2">100</span><span class="c0">);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c1"><span class="c3"></span></p><p class="c4"><span class="c3">&#536;i rescriem acest exemplu folosind mutex-uri:</span></p><p class="c1"><span class="c3"></span></p><a id="t.dc169bc47e1fef3bbf2ec1932aa83441896b981b"></a><a id="t.1"></a><table class="c10"><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c7"><span class="c6">int</span><span class="c0">&nbsp;x = </span><span class="c2">0</span><span class="c0">;<br>Mutex mutexObj = </span><span class="c6">new</span><span class="c0">();<br><br></span><span class="c11">// pornim cinci thread-uri</span><span class="c0"><br></span><span class="c6">for</span><span class="c0">&nbsp;(</span><span class="c6">int</span><span class="c0">&nbsp;i = </span><span class="c2">1</span><span class="c0">; i &lt; </span><span class="c2">6</span><span class="c0">; i++)<br>{<br> &nbsp; &nbsp;Thread myThread = </span><span class="c6">new</span><span class="c0">(Print);<br> &nbsp; &nbsp;myThread.Name = </span><span class="c15">$&quot;Thread {i}&quot;</span><span class="c0">;<br> &nbsp; &nbsp;myThread.Start();<br>}<br><br></span><span class="c6">void</span><span class="c0">&nbsp;</span><span class="c5">Print</span><span class="c0">()<br>{<br> &nbsp; &nbsp;mutexObj.WaitOne(); &nbsp;</span><span class="c11">// suspend&#259;m thread-ul p&acirc;n&#259; la ob&#539;inerea mutex-ului</span><span class="c0"><br> &nbsp; &nbsp;x = </span><span class="c2">1</span><span class="c0">;<br> &nbsp; &nbsp;</span><span class="c6">for</span><span class="c0">&nbsp;(</span><span class="c6">int</span><span class="c0">&nbsp;i = </span><span class="c2">1</span><span class="c0">; i &lt; </span><span class="c2">6</span><span class="c0">; i++)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c15">$&quot;{Thread.CurrentThread.Name}: {x}&quot;</span><span class="c0">);<br> &nbsp; &nbsp; &nbsp; &nbsp;x++;<br> &nbsp; &nbsp; &nbsp; &nbsp;Thread.Sleep(</span><span class="c2">100</span><span class="c0">);<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;mutexObj.ReleaseMutex(); &nbsp;</span><span class="c11">// eliber&#259;m mutex-ul</span><span class="c0"><br>}</span></p></td></tr></table><p class="c1"><span class="c3"></span></p><p class="c4"><span class="c3">Mai &icirc;nt&acirc;i, cre&#259;m un obiect mutex:</span></p><p class="c1"><span class="c3"></span></p><a id="t.965c6b2a7e8c86ea775160af0679eadfe0f6e510"></a><a id="t.2"></a><table class="c10"><tr class="c14"><td class="c9" colspan="1" rowspan="1"><p class="c7"><span class="c0">Mutex mutexObj = </span><span class="c6">new</span><span class="c0">&nbsp;Mutex();</span></p></td></tr></table><p class="c1"><span class="c3"></span></p><p class="c4"><span class="c13">Principalele metode pentru sincronizare sunt </span><span class="c12">WaitOne() </span><span class="c13">&#537;i </span><span class="c12">ReleaseMutex()</span><span class="c13">. Metoda </span><span class="c8">mutexObj.WaitOne() </span><span class="c3">suspend&#259; execu&#539;ia thread-ului p&acirc;n&#259; c&acirc;nd mutex-ul mutexObj este ob&#539;inut.</span></p><p class="c1"><span class="c3"></span></p><p class="c4"><span class="c3">Ini&#539;ial, mutex-ul este liber, a&#537;a c&#259; este ob&#539;inut de unul dintre thread-uri.</span></p><p class="c1"><span class="c3"></span></p><p class="c4"><span class="c13">Dup&#259; ce toate ac&#539;iunile sunt finalizate &#537;i mutex-ul nu mai este necesar, thread-ul &icirc;l elibereaz&#259; folosind metoda </span><span class="c8">mutexObj.ReleaseMutex()</span><span class="c3">. Apoi, mutex-ul este ob&#539;inut de unul dintre thread-urile aflate &icirc;n a&#537;teptare.</span></p><p class="c1"><span class="c3"></span></p><p class="c4"><span class="c13">Astfel, c&acirc;nd execu&#539;ia ajunge la apelul </span><span class="c8">mutexObj.WaitOne()</span><span class="c3">, thread-ul va a&#537;tepta p&acirc;n&#259; c&acirc;nd mutex-ul va fi eliberat. Dup&#259; ce &icirc;l ob&#539;ine, va continua s&#259;-&#537;i execute activitatea.</span></p><p class="c1"><span class="c3"></span></p></body></html>