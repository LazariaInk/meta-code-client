<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><link rel="stylesheet" type="text/css" href="/lessons/styles.css"></head><body class="c16 doc-content"><p class="c4"><span class="c17">Semaforele.</span></p><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c7">Semaforele </span><span class="c14">sunt un alt instrument pe care platforma .NET &icirc;l ofer&#259; pentru gestionarea sincroniz&#259;rii. Semaforele permit limitarea num&#259;rului de thread-uri care au acces la anumite resurse. &Icirc;n .NET, semaforele sunt reprezentate de clasa </span><span class="c7">Semaphore</span><span class="c2">.</span></p><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c2">Pentru a crea un semafor, se folose&#537;te unul dintre constructorii clasei Semaphore:</span></p><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c14">-</span><span class="c7">&nbsp;Semaphore(int initialCount, int maximumCount)</span><span class="c14">: parametrul </span><span class="c5">initialCount </span><span class="c14">seteaz&#259; num&#259;rul ini&#539;ial de thread-uri, iar </span><span class="c5">maximumCount </span><span class="c2">- num&#259;rul maxim de thread-uri care au acces la resursele comune.</span></p><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c14">-</span><span class="c7">&nbsp;Semaphore(int initialCount, int maximumCount, string? name)</span><span class="c2">: &icirc;n plus, seteaz&#259; numele semaforului.</span></p><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c14">- </span><span class="c7">Semaphore(int initialCount, int maximumCount, string? name, out bool createdNew)</span><span class="c14">: ultimul parametru - </span><span class="c5">createdNew </span><span class="c2">indic&#259; prin valoarea true c&#259; semaforul a fost creat cu succes. Dac&#259; acest parametru este false, semaforul cu numele specificat deja exist&#259;.</span></p><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c2">Pentru a lucra cu thread-uri, clasa Semaphore are dou&#259; metode principale:</span></p><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c14">-</span><span class="c7">&nbsp;WaitOne()</span><span class="c2">: a&#537;teapt&#259; ob&#539;inerea unui loc liber &icirc;n semafor.</span></p><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c14">-</span><span class="c7">&nbsp;Release()</span><span class="c2">: elibereaz&#259; un loc &icirc;n semafor.</span></p><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c2">De exemplu, avem urm&#259;toarea sarcin&#259;: exist&#259; un num&#259;r de cititori care vin la bibliotec&#259; de trei ori pe zi pentru a citi. S&#259; presupunem c&#259; avem o limit&#259; de trei cititori simultan &icirc;n bibliotec&#259;. Aceast&#259; sarcin&#259; poate fi rezolvat&#259; foarte u&#537;or cu ajutorul semafoarelor:</span></p><p class="c4 c9"><span class="c2"></span></p><a id="t.39a3bb514861324a86733bf58fd08a206c5817ee"></a><a id="t.0"></a><table class="c11"><tr class="c12"><td class="c8" colspan="1" rowspan="1"><p class="c10"><span class="c6">// pornim cinci thread-uri</span><span class="c1"><br></span><span class="c3">for</span><span class="c1">&nbsp;(</span><span class="c3">int</span><span class="c1">&nbsp;i = </span><span class="c0">1</span><span class="c1">; i &lt; </span><span class="c0">6</span><span class="c1">; i++)<br>{<br> &nbsp; &nbsp;Reader reader = </span><span class="c3">new</span><span class="c1">&nbsp;Reader(i);<br>}<br><br></span><span class="c3">class</span><span class="c1">&nbsp;</span><span class="c15">Reader</span><span class="c1"><br>{<br> &nbsp; &nbsp;</span><span class="c6">// cre&#259;m semaforul</span><span class="c1"><br> &nbsp; &nbsp;</span><span class="c3">static</span><span class="c1">&nbsp;Semaphore sem = </span><span class="c3">new</span><span class="c1">&nbsp;Semaphore(</span><span class="c0">3</span><span class="c1">, </span><span class="c0">3</span><span class="c1">);<br> &nbsp; &nbsp;Thread myThread;<br> &nbsp; &nbsp;</span><span class="c3">int</span><span class="c1">&nbsp;count = </span><span class="c0">3</span><span class="c1">; </span><span class="c6">// num&#259;rul de citiri</span><span class="c1"><br><br> &nbsp; &nbsp;</span><span class="c3">public</span><span class="c1">&nbsp;</span><span class="c15">Reader</span><span class="c1">(</span><span class="c3">int</span><span class="c1">&nbsp;i)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;myThread = </span><span class="c3">new</span><span class="c1">&nbsp;Thread(Read);<br> &nbsp; &nbsp; &nbsp; &nbsp;myThread.Name = </span><span class="c13">$&quot;Cititor {i}&quot;</span><span class="c1">;<br> &nbsp; &nbsp; &nbsp; &nbsp;myThread.Start();<br> &nbsp; &nbsp;}<br><br> &nbsp; &nbsp;</span><span class="c3">public</span><span class="c1">&nbsp;</span><span class="c3">void</span><span class="c1">&nbsp;</span><span class="c15">Read</span><span class="c1">()<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">while</span><span class="c1">&nbsp;(count &gt; </span><span class="c0">0</span><span class="c1">)<br> &nbsp; &nbsp; &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sem.WaitOne(); &nbsp;</span><span class="c6">// a&#537;tept&#259;m eliberarea unui loc</span><span class="c1"><br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c13">$&quot;{Thread.CurrentThread.Name} intr&#259; &icirc;n bibliotec&#259;&quot;</span><span class="c1">);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c13">$&quot;{Thread.CurrentThread.Name} cite&#537;te&quot;</span><span class="c1">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thread.Sleep(</span><span class="c0">1000</span><span class="c1">);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c13">$&quot;{Thread.CurrentThread.Name} p&#259;r&#259;se&#537;te biblioteca&quot;</span><span class="c1">);<br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sem.Release(); &nbsp;</span><span class="c6">// eliber&#259;m locul</span><span class="c1"><br><br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;count--;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;Thread.Sleep(</span><span class="c0">1000</span><span class="c1">);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c14">&Icirc;n acest program, cititorul este reprezentat de clasa Reader. Aceasta &icirc;ncapsuleaz&#259; toat&#259; func&#539;ionalitatea legat&#259; de thread-uri prin variabila</span><span class="c5">&nbsp;Thread myThread</span><span class="c2">.</span></p><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c2">Semaforul &icirc;n sine este definit ca o variabil&#259; static&#259; sem:</span></p><p class="c4 c9"><span class="c2"></span></p><a id="t.ec01b0861b62e32580a4a454fb4a015673cabcd4"></a><a id="t.1"></a><table class="c11"><tr class="c12"><td class="c8" colspan="1" rowspan="1"><p class="c10"><span class="c3">static</span><span class="c1">&nbsp;Semaphore sem = </span><span class="c3">new</span><span class="c1">&nbsp;Semaphore(</span><span class="c0">3</span><span class="c1">, </span><span class="c0">3</span><span class="c1">);</span></p></td></tr></table><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c2">Constructorul s&#259;u prime&#537;te doi parametri: primul specific&#259; num&#259;rul de obiecte care ini&#539;ial vor avea acces la semafor, iar al doilea specific&#259; num&#259;rul maxim de obiecte care vor folosi semaforul. &Icirc;n acest caz, doar trei cititori pot fi simultan &icirc;n bibliotec&#259;, deci num&#259;rul maxim este 3.</span></p><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c14">Func&#539;ionalitatea principal&#259; este concentrat&#259; &icirc;n metoda Read, care se execut&#259; &icirc;n thread. La &icirc;nceput, pentru a a&#537;tepta eliberarea unui loc &icirc;n semafor, se folose&#537;te metoda</span><span class="c5">&nbsp;sem.WaitOne()</span><span class="c2">:</span></p><p class="c4 c9"><span class="c2"></span></p><a id="t.82d165c089c371193e60691281006fe3a4a3d6d8"></a><a id="t.2"></a><table class="c11"><tr class="c12"><td class="c8" colspan="1" rowspan="1"><p class="c10"><span class="c1">sem.WaitOne(); &nbsp;</span><span class="c6">// a&#537;tept&#259;m eliberarea unui loc</span></p></td></tr></table><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c2">Dup&#259; ce un loc se elibereaz&#259; &icirc;n semafor, thread-ul respectiv ocup&#259; locul &#537;i &icirc;ncepe s&#259; execute toate ac&#539;iunile urm&#259;toare.</span></p><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c14">Dup&#259; terminarea citirii, eliber&#259;m semaforul folosind metoda </span><span class="c5">sem.Release()</span><span class="c2">:</span></p><p class="c4 c9"><span class="c2"></span></p><a id="t.d6d4b0b17d23889fd5b478d2f24f5d1369144e77"></a><a id="t.3"></a><table class="c11"><tr class="c12"><td class="c8" colspan="1" rowspan="1"><p class="c10"><span class="c1">sem.Release(); &nbsp;</span><span class="c6">// eliber&#259;m locul</span></p></td></tr></table><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c2">Astfel, un loc se elibereaz&#259; &icirc;n semafor &#537;i este ocupat de un alt thread aflat &icirc;n a&#537;teptare.</span></p><p class="c4 c9"><span class="c2"></span></p><p class="c4"><span class="c2">Exemplu de ie&#537;ire pe consol&#259;:</span></p><p class="c4 c9"><span class="c2"></span></p><a id="t.36167402d53bc32eef01e4bbf1d9673d9c1944c4"></a><a id="t.4"></a><table class="c11"><tr class="c12"><td class="c8" colspan="1" rowspan="1"><p class="c10"><span class="c1">Cititor </span><span class="c0">5</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">5</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">4</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">4</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">1</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">1</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">5</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca<br>Cititor </span><span class="c0">1</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca<br>Cititor </span><span class="c0">4</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca<br>Cititor </span><span class="c0">3</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">3</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">2</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">2</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">4</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">3</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca<br>Cititor </span><span class="c0">2</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca<br>Cititor </span><span class="c0">5</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">5</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">4</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">1</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">1</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">5</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca<br>Cititor </span><span class="c0">3</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">3</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">4</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca<br>Cititor </span><span class="c0">1</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca<br>Cititor </span><span class="c0">2</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">2</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">3</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca<br>Cititor </span><span class="c0">5</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">5</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">2</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca<br>Cititor </span><span class="c0">1</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">4</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">1</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">4</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">5</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca<br>Cititor </span><span class="c0">1</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca<br>Cititor </span><span class="c0">4</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca<br>Cititor </span><span class="c0">2</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">3</span><span class="c1">&nbsp;intr&#259; &icirc;n bibliotec&#259;<br>Cititor </span><span class="c0">2</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">3</span><span class="c1">&nbsp;cite&#537;te<br>Cititor </span><span class="c0">3</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca<br>Cititor </span><span class="c0">2</span><span class="c1">&nbsp;p&#259;r&#259;se&#537;te biblioteca</span></p></td></tr></table><p class="c4 c9"><span class="c2"></span></p><p class="c4 c9"><span class="c2"></span></p></body></html>