<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><link rel="stylesheet" type="text/css" href="/lessons/styles.css"></head><body class="c19 doc-content"><p class="c6"><span class="c1"></span></p><p class="c8"><span class="c20">Introducere &icirc;n multithreading. Clasa Thread.</span></p><p class="c6"><span class="c1"></span></p><p class="c8"><span class="c9">Unul dintre aspectele cheie &icirc;n programarea modern&#259; este</span><span class="c11">&nbsp;multithreading-ul</span><span class="c9">. Conceptul principal &icirc;n lucrul cu multithreading-ul este thread-ul. Un </span><span class="c11">thread </span><span class="c1">reprezint&#259; o parte din codul programului. La rularea programului, fiec&#259;rui thread i se aloc&#259; un anumit cuantum de timp. Prin intermediul multithreading-ului, putem aloca &icirc;n aplica&#539;ie mai multe thread-uri care vor executa diverse sarcini simultan. Dac&#259; avem, de exemplu, o aplica&#539;ie grafic&#259; ce trimite o cerere c&#259;tre un server sau cite&#537;te &#537;i proceseaz&#259; un fi&#537;ier mare, f&#259;r&#259; multithreading, interfa&#539;a grafic&#259; ar fi blocat&#259; pe durata execut&#259;rii sarcinii. Datorit&#259; thread-urilor, putem aloca trimiterea cererii sau orice alt&#259; sarcin&#259; care necesit&#259; timp &icirc;ndelungat unui thread separat. Astfel, de exemplu, aplica&#539;iile client-server (&#537;i nu doar ele) sunt de neconceput f&#259;r&#259; multithreading.</span></p><p class="c6"><span class="c1"></span></p><p class="c8"><span class="c9">Func&#539;ionalitatea principal&#259; pentru utilizarea thread-urilor &icirc;ntr-o aplica&#539;ie este concentrat&#259; &icirc;n namespace-ul </span><span class="c11">System.Threading</span><span class="c9">. &Icirc;n acesta este definit&#259; clasa ce reprezint&#259; un thread separat - clasa </span><span class="c11">Thread</span><span class="c1">.</span></p><p class="c6"><span class="c1"></span></p><p class="c8"><span class="c1">Clasa Thread define&#537;te o serie de metode &#537;i propriet&#259;&#539;i care permit gestionarea thread-ului &#537;i ob&#539;inerea informa&#539;iilor despre acesta. Propriet&#259;&#539;ile principale ale clasei sunt:</span></p><p class="c6"><span class="c1"></span></p><ul class="c2 lst-kix_bo4w8fo8l4s1-0 start"><li class="c7 li-bullet-0"><span class="c11">ExecutionContext</span><span class="c1">: permite ob&#539;inerea contextului &icirc;n care se execut&#259; thread-ul</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_bo4w8fo8l4s1-0"><li class="c7 li-bullet-0"><span class="c11">IsAlive</span><span class="c1">: indic&#259; dac&#259; thread-ul ruleaz&#259; &icirc;n prezent</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_bo4w8fo8l4s1-0"><li class="c7 li-bullet-0"><span class="c11">IsBackground</span><span class="c1">: indic&#259; dac&#259; thread-ul este de fundal</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_bo4w8fo8l4s1-0"><li class="c7 li-bullet-0"><span class="c11">Name</span><span class="c1">: con&#539;ine numele thread-ului</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_bo4w8fo8l4s1-0"><li class="c7 li-bullet-0"><span class="c11">ManagedThreadId</span><span class="c1">: returneaz&#259; identificatorul numeric al thread-ului curent</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_uyzwj6mhfvl1-0 start"><li class="c7 li-bullet-0"><span class="c11">Priority</span><span class="c9">: stocheaz&#259; prioritatea thread-ului - valoarea unei enumera&#539;ii </span><span class="c11">ThreadPriority</span><span class="c1">:</span></li></ul><p class="c6"><span class="c1"></span></p><ul class="c2 lst-kix_f1ti275qjjoj-0 start"><li class="c7 li-bullet-0"><span class="c4">Lowest</span></li></ul><p class="c3"><span class="c4"></span></p><ul class="c2 lst-kix_f1ti275qjjoj-0"><li class="c7 li-bullet-0"><span class="c4">BelowNormal</span></li></ul><p class="c3"><span class="c4"></span></p><ul class="c2 lst-kix_f1ti275qjjoj-0"><li class="c7 li-bullet-0"><span class="c4">Normal </span></li></ul><p class="c3"><span class="c4"></span></p><ul class="c2 lst-kix_f1ti275qjjoj-0"><li class="c7 li-bullet-0"><span class="c4">AboveNormal</span></li></ul><p class="c3"><span class="c4"></span></p><ul class="c2 lst-kix_f1ti275qjjoj-0"><li class="c7 li-bullet-0"><span class="c4">Highest </span></li></ul><p class="c6"><span class="c1"></span></p><p class="c8"><span class="c1">Implicit, unui thread i se atribuie valoarea Normal. Totu&#537;i, putem modifica prioritatea &icirc;n timpul rul&#259;rii programului. De exemplu, putem cre&#537;te importan&#539;a thread-ului set&acirc;nd prioritatea Highest. Mediul CLR va citi &#537;i analiza valorile priorit&#259;&#539;ii &#537;i, pe baza acestora, va aloca thread-ului respectiv o anumit&#259; cantitate de timp.</span></p><p class="c6"><span class="c1"></span></p><ul class="c2 lst-kix_it4bonqsofb7-0 start"><li class="c7 li-bullet-0"><span class="c11">ThreadState </span><span class="c9">returneaz&#259; starea thread-ului - una dintre valorile enumera&#539;iei </span><span class="c11">ThreadState</span><span class="c1">:</span></li></ul><p class="c6"><span class="c1"></span></p><ul class="c2 lst-kix_rsxq98xf4o9a-0 start"><li class="c7 li-bullet-0"><span class="c11">Aborted</span><span class="c1">: thread-ul este oprit, dar &icirc;nc&#259; nu a fost finalizat</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_rsxq98xf4o9a-0"><li class="c7 li-bullet-0"><span class="c11">AbortRequested</span><span class="c1">: pentru thread a fost apelat&#259; metoda Abort, dar oprirea &icirc;nc&#259; nu a avut loc</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_rsxq98xf4o9a-0"><li class="c7 li-bullet-0"><span class="c11">Background</span><span class="c1">: thread-ul ruleaz&#259; &icirc;n mod de fundal</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_rsxq98xf4o9a-0"><li class="c7 li-bullet-0"><span class="c11">Running</span><span class="c1">: thread-ul este pornit &#537;i ruleaz&#259; (nu este suspendat)</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_rsxq98xf4o9a-0"><li class="c7 li-bullet-0"><span class="c11">Stopped</span><span class="c1">: thread-ul este finalizat</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_rsxq98xf4o9a-0"><li class="c7 li-bullet-0"><span class="c11">StopRequested</span><span class="c1">: thread-ul a primit o cerere de oprire</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_rsxq98xf4o9a-0"><li class="c7 li-bullet-0"><span class="c11">Suspended</span><span class="c1">: thread-ul este suspendat</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_rsxq98xf4o9a-0"><li class="c7 li-bullet-0"><span class="c11">SuspendRequested</span><span class="c1">: thread-ul a primit o cerere de suspendare</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_rsxq98xf4o9a-0"><li class="c7 li-bullet-0"><span class="c11">Unstarted</span><span class="c1">: thread-ul nu a fost &icirc;nc&#259; pornit</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_rsxq98xf4o9a-0"><li class="c7 li-bullet-0"><span class="c11">WaitSleepJoin</span><span class="c1">: thread-ul este blocat &icirc;n urma apel&#259;rii metodelor Sleep sau Join</span></li></ul><p class="c6"><span class="c1"></span></p><p class="c8"><span class="c9">&Icirc;n timpul rul&#259;rii thread-ului, starea acestuia poate fi modificat&#259; de mai multe ori prin intermediul metodelor. De exemplu, la &icirc;nceput, &icirc;nainte de aplicarea metodei Start, starea este Unstarted. Dup&#259; pornirea thread-ului, starea se schimb&#259; &icirc;n Running. Apel&acirc;nd metoda Sleep, starea se va schimba &icirc;n </span><span class="c9 c18">WaitSleepJoin</span><span class="c1">.</span></p><p class="c6"><span class="c1"></span></p><p class="c8"><span class="c9">&Icirc;n plus, proprietatea static&#259; </span><span class="c11">CurrentThread </span><span class="c1">a clasei Thread permite ob&#539;inerea thread-ului curent.</span></p><p class="c6"><span class="c1"></span></p><p class="c8"><span class="c1">&Icirc;ntr-un program C#, exist&#259; cel pu&#539;in un thread - thread-ul principal, &icirc;n care se execut&#259; metoda Main.</span></p><p class="c6"><span class="c1"></span></p><p class="c8"><span class="c1">De exemplu, utiliz&#259;m propriet&#259;&#539;ile descrise mai sus pentru a ob&#539;ine informa&#539;ii despre thread:</span></p><p class="c6"><span class="c1"></span></p><a id="t.1537a1ef361613d43d871d7b96ea055a142769d9"></a><a id="t.0"></a><table class="c17"><tr class="c12"><td class="c16" colspan="1" rowspan="1"><p class="c14"><span class="c10">using</span><span class="c0">&nbsp;System.Threading;<br><br></span><span class="c13">// ob&#539;inem thread-ul curent</span><span class="c0"><br>Thread currentThread = Thread.CurrentThread;<br><br></span><span class="c13">// ob&#539;inem numele thread-ului</span><span class="c0"><br>Console.WriteLine(</span><span class="c15">$&quot;Numele thread-ului: {currentThread.Name}&quot;</span><span class="c0">);<br>currentThread.Name = </span><span class="c15">&quot;Metoda Main&quot;</span><span class="c0">;<br>Console.WriteLine(</span><span class="c15">$&quot;Numele thread-ului: {currentThread.Name}&quot;</span><span class="c0">);<br><br>Console.WriteLine(</span><span class="c15">$&quot;Thread-ul este pornit: {currentThread.IsAlive}&quot;</span><span class="c0">);<br>Console.WriteLine(</span><span class="c15">$&quot;Id-ul thread-ului: {currentThread.ManagedThreadId}&quot;</span><span class="c0">);<br>Console.WriteLine(</span><span class="c15">$&quot;Prioritatea thread-ului: {currentThread.Priority}&quot;</span><span class="c0">);<br>Console.WriteLine(</span><span class="c15">$&quot;Starea thread-ului: {currentThread.ThreadState}&quot;</span><span class="c0">);<br></span></p></td></tr></table><p class="c6"><span class="c1"></span></p><p class="c6"><span class="c1"></span></p><p class="c8"><span class="c1">&Icirc;n acest caz, vom ob&#539;ine aproximativ urm&#259;torul output:</span></p><p class="c6"><span class="c1"></span></p><a id="t.233e16343e335cacf6e9eebdb58e53030a62a7b4"></a><a id="t.1"></a><table class="c17"><tr class="c12"><td class="c16" colspan="1" rowspan="1"><p class="c14"><span class="c0">Numele thread-ului:<br>Numele thread-ului: Metoda Main<br>Thread-ul este pornit: True<br>Id-ul thread-ului: </span><span class="c5">1</span><span class="c0"><br>Prioritatea thread-ului: Normal<br>Starea thread-ului: Running</span></p></td></tr></table><p class="c6"><span class="c1"></span></p><p class="c8"><span class="c1">Deoarece implicit, proprietatea Name a obiectelor Thread nu este setat&#259;, &icirc;n primul caz vom ob&#539;ine o valoare de &#537;ir gol pentru aceast&#259; proprietate.</span></p><p class="c6"><span class="c1"></span></p><p class="c8"><span class="c1">De asemenea, clasa Thread define&#537;te o serie de metode pentru gestionarea thread-urilor. Principalele dintre acestea sunt:</span></p><p class="c6"><span class="c1"></span></p><ul class="c2 lst-kix_6s6fvtx8tsf7-0 start"><li class="c7 li-bullet-0"><span class="c9">Metoda static&#259; </span><span class="c11">GetDomain </span><span class="c1">returneaz&#259; o referin&#539;&#259; la domeniul aplica&#539;iei</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_6s6fvtx8tsf7-0"><li class="c7 li-bullet-0"><span class="c9">Metoda static&#259; </span><span class="c11">GetDomainID </span><span class="c1">returneaz&#259; id-ul domeniului aplica&#539;iei &icirc;n care se execut&#259; thread-ul curent</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_6s6fvtx8tsf7-0"><li class="c7 li-bullet-0"><span class="c9">Metoda static&#259; </span><span class="c11">Sleep </span><span class="c1">opre&#537;te thread-ul pentru un anumit num&#259;r de milisecunde</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_6s6fvtx8tsf7-0"><li class="c7 li-bullet-0"><span class="c9">Metoda </span><span class="c11">Interrupt </span><span class="c1">&icirc;ntrerupe thread-ul aflat &icirc;n starea WaitSleepJoin</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_6s6fvtx8tsf7-0"><li class="c7 li-bullet-0"><span class="c9">Metoda </span><span class="c11">Join </span><span class="c1">blocheaz&#259; execu&#539;ia thread-ului care a apelat aceast&#259; metod&#259; p&acirc;n&#259; c&acirc;nd se finalizeaz&#259; thread-ul pentru care a fost apelat&#259; metoda</span></li></ul><p class="c3"><span class="c1"></span></p><ul class="c2 lst-kix_6s6fvtx8tsf7-0"><li class="c7 li-bullet-0"><span class="c9">Metoda </span><span class="c11">Start </span><span class="c1">porne&#537;te thread-ul</span></li></ul><p class="c6"><span class="c1"></span></p><p class="c8"><span class="c1">De exemplu, utiliz&#259;m metoda Sleep pentru a seta o &icirc;nt&acirc;rziere &icirc;n execu&#539;ia aplica&#539;iei:</span></p><p class="c6"><span class="c1"></span></p><a id="t.b5791c3ea7959eb2995bb14a78fd459d0887ea8d"></a><a id="t.2"></a><table class="c17"><tr class="c12"><td class="c16" colspan="1" rowspan="1"><p class="c14"><span class="c10">using</span><span class="c0">&nbsp;System.Threading;<br><br></span><span class="c10">for</span><span class="c0">(</span><span class="c10">int</span><span class="c0">&nbsp;i = </span><span class="c5">0</span><span class="c0">; i &lt; </span><span class="c5">10</span><span class="c0">; i++)<br>{<br> &nbsp; &nbsp;Thread.Sleep(</span><span class="c5">500</span><span class="c0">); &nbsp; &nbsp; &nbsp;</span><span class="c13">// &icirc;nt&acirc;rziere &icirc;n execu&#539;ie de 500 de milisecunde</span><span class="c0"><br> &nbsp; &nbsp;Console.WriteLine(i);<br>}</span></p></td></tr></table><p class="c6"><span class="c1"></span></p><p class="c6"><span class="c1"></span></p></body></html>