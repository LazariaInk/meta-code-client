<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><link rel="stylesheet" type="text/css" href="/lessons/styles.css"></head><body class="c17 doc-content"><p class="c7"><span class="c9">Thread-uri cu parametri &#537;i ParameterizedThreadStart.</span></p><p class="c3"><span class="c4"></span></p><p class="c7"><span class="c4">&Icirc;n articolul precedent am discutat despre cum s&#259; rul&#259;m metode f&#259;r&#259; parametri &icirc;n thread-uri separate. Dar ce facem dac&#259; trebuie s&#259; transmitem anumi&#539;i parametri &icirc;n thread?</span></p><p class="c3"><span class="c4"></span></p><p class="c7"><span class="c16">Pentru acest scop se utilizeaz&#259; delegatul</span><span class="c15">&nbsp;ParameterizedThreadStart</span><span class="c4">, care este transmis &icirc;n constructorul clasei Thread:</span></p><p class="c3"><span class="c4"></span></p><a id="t.762b5fad74a948a7f05b6cd2879dc23b4c84ee13"></a><a id="t.0"></a><table class="c8"><tr class="c11"><td class="c2" colspan="1" rowspan="1"><p class="c12"><span class="c5">public</span><span class="c0">&nbsp;</span><span class="c5">delegate</span><span class="c0">&nbsp;</span><span class="c5">void</span><span class="c0">&nbsp;</span><span class="c13">ParameterizedThreadStart</span><span class="c0">(</span><span class="c5">object</span><span class="c0">? obj);</span></p></td></tr></table><p class="c3"><span class="c4"></span></p><p class="c7"><span class="c4">Utilizarea delegatului ParameterizedThreadStart este foarte similar&#259; cu lucrul cu ThreadStart. S&#259; vedem un exemplu:</span></p><p class="c3"><span class="c4"></span></p><a id="t.2c3947f79bbeb660f0e5dd6595fdd047a7077bc6"></a><a id="t.1"></a><table class="c8"><tr class="c11"><td class="c2" colspan="1" rowspan="1"><p class="c12"><span class="c5">using</span><span class="c0">&nbsp;System.Threading;<br><br></span><span class="c10">// cre&#259;m noi thread-uri</span><span class="c0"><br>Thread myThread1 = </span><span class="c5">new</span><span class="c0">&nbsp;Thread(</span><span class="c5">new</span><span class="c0">&nbsp;ParameterizedThreadStart(Print));<br>Thread myThread2 = </span><span class="c5">new</span><span class="c0">&nbsp;Thread(Print);<br>Thread myThread3 = </span><span class="c5">new</span><span class="c0">&nbsp;Thread(message =&gt; Console.WriteLine(message));<br><br></span><span class="c10">// pornim thread-urile</span><span class="c0"><br>myThread1.Start(</span><span class="c1">&quot;Hello&quot;</span><span class="c0">);<br>myThread2.Start(</span><span class="c1">&quot;Aloha&quot;</span><span class="c0">);<br>myThread3.Start(</span><span class="c1">&quot;Salut&quot;</span><span class="c0">);<br><br></span><span class="c5">void</span><span class="c0">&nbsp;</span><span class="c13">Print</span><span class="c0">(</span><span class="c5">object</span><span class="c0">? message) =&gt; Console.WriteLine(message);</span></p></td></tr></table><p class="c3"><span class="c4"></span></p><p class="c7"><span class="c16">La crearea thread-ului, &icirc;n constructorul clasei Thread este transmis un obiect delegat ParameterizedThreadStart</span><span class="c6">&nbsp;new Thread(new ParameterizedThreadStart(Print))</span><span class="c16">, sau direct metoda care corespunde acestui delegat (</span><span class="c6">new Thread(Print)</span><span class="c16">), inclusiv sub form&#259; de expresie lambda (</span><span class="c6">new Thread(message =&gt; Console.WriteLine(message))</span><span class="c4">).</span></p><p class="c3"><span class="c4"></span></p><p class="c7"><span class="c16">Apoi, la pornirea thread-ului, &icirc;n metoda</span><span class="c6">&nbsp;Start()</span><span class="c4">&nbsp;se transmite valoarea care este transmis&#259; ca parametru metodei Print. &Icirc;n acest caz, vom ob&#539;ine urm&#259;torul output pe consol&#259;:</span></p><p class="c3"><span class="c4"></span></p><a id="t.41a1da88253d6660f2787c2ca7c95ad4beed8edc"></a><a id="t.2"></a><table class="c8"><tr class="c11"><td class="c2" colspan="1" rowspan="1"><p class="c12"><span class="c0">Salut<br>Hello<br>Aloha</span></p></td></tr></table><p class="c3"><span class="c4"></span></p><p class="c7"><span class="c4">Utiliz&acirc;nd ParameterizedThreadStart, ne confrunt&#259;m cu o limitare: putem rula &icirc;n al doilea thread doar o metod&#259; care prime&#537;te ca unic parametru un obiect de tip object?. Prin urmare, dac&#259; dorim s&#259; folosim date de alte tipuri, &icirc;n metod&#259; trebuie s&#259; realiz&#259;m conversia tipurilor. De exemplu:</span></p><p class="c3"><span class="c4"></span></p><a id="t.176e91121fff99ee94d93e91864cd702339b0c28"></a><a id="t.3"></a><table class="c8"><tr class="c11"><td class="c2" colspan="1" rowspan="1"><p class="c12"><span class="c5">using</span><span class="c0">&nbsp;System.Threading;<br><br></span><span class="c5">int</span><span class="c0">&nbsp;number = </span><span class="c14">4</span><span class="c0">;<br></span><span class="c10">// cre&#259;m un nou thread</span><span class="c0"><br>Thread myThread = </span><span class="c5">new</span><span class="c0">&nbsp;Thread(Print);<br>myThread.Start(number); &nbsp; &nbsp;</span><span class="c10">// n * n = 16</span><span class="c0"><br><br></span><span class="c10">// ac&#539;iuni executate &icirc;n al doilea thread</span><span class="c0"><br></span><span class="c5">void</span><span class="c0">&nbsp;</span><span class="c13">Print</span><span class="c0">(</span><span class="c5">object</span><span class="c0">? obj)<br>{<br> &nbsp; &nbsp;</span><span class="c10">// aici ne a&#537;tept&#259;m s&#259; primim un num&#259;r</span><span class="c0"><br> &nbsp; &nbsp;</span><span class="c5">if</span><span class="c0">&nbsp;(obj </span><span class="c5">is</span><span class="c0">&nbsp;</span><span class="c5">int</span><span class="c0">&nbsp;n)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c1">$&quot;n * n = {n * n}&quot;</span><span class="c0">);<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c3"><span class="c4"></span></p><p class="c7"><span class="c4">&Icirc;n acest caz, trebuie s&#259; convertim suplimentar valoarea transmis&#259; la tipul int pentru a o folosi &icirc;n calcule.</span></p><p class="c3"><span class="c4"></span></p><p class="c7"><span class="c4">Dar ce facem dac&#259; trebuie s&#259; transmitem mai mul&#539;i parametri de tipuri diferite? &Icirc;n acest caz, putem defini propriile noastre tipuri:</span></p><p class="c3"><span class="c4"></span></p><a id="t.3761000c70b9fd17a319c094eda59767190c16c4"></a><a id="t.4"></a><table class="c8"><tr class="c11"><td class="c2" colspan="1" rowspan="1"><p class="c12"><span class="c5">using</span><span class="c0">&nbsp;System.Threading;<br><br>Person tom = </span><span class="c5">new</span><span class="c0">&nbsp;Person(</span><span class="c1">&quot;Tom&quot;</span><span class="c0">, </span><span class="c14">37</span><span class="c0">);<br></span><span class="c10">// cre&#259;m un nou thread</span><span class="c0"><br>Thread myThread = </span><span class="c5">new</span><span class="c0">&nbsp;Thread(Print);<br>myThread.Start(tom);<br><br></span><span class="c5">void</span><span class="c0">&nbsp;</span><span class="c13">Print</span><span class="c0">(</span><span class="c5">object</span><span class="c0">? obj)<br>{<br> &nbsp; &nbsp;</span><span class="c10">// aici ne a&#537;tept&#259;m s&#259; primim un obiect Person</span><span class="c0"><br> &nbsp; &nbsp;</span><span class="c5">if</span><span class="c0">&nbsp;(obj </span><span class="c5">is</span><span class="c0">&nbsp;Person person)<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c1">$&quot;Name = {person.Name}&quot;</span><span class="c0">);<br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c1">$&quot;Age = {person.Age}&quot;</span><span class="c0">);<br> &nbsp; &nbsp;}<br>}<br><br>record class </span><span class="c13">Person</span><span class="c0">(</span><span class="c5">string</span><span class="c0">&nbsp;Name, </span><span class="c5">int</span><span class="c0">&nbsp;Age);</span></p></td></tr></table><p class="c3"><span class="c4"></span></p><p class="c7"><span class="c4">Mai &icirc;nt&acirc;i definim o clas&#259; special&#259; Person, al c&#259;rei obiect va fi transmis &icirc;n al doilea thread, iar &icirc;n metoda Main &icirc;l transmitem &icirc;n al doilea thread.</span></p><p class="c3"><span class="c4"></span></p><p class="c7"><span class="c16">Totu&#537;i, exist&#259; o limitare: metoda</span><span class="c6">&nbsp;Thread.Start</span><span class="c4">&nbsp;nu este tip-sigur&#259;, adic&#259; putem transmite orice tip &#537;i va trebui s&#259; convertim obiectul transmis la tipul dorit. Pentru a rezolva aceast&#259; problem&#259;, este recomandat s&#259; declar&#259;m toate metodele &#537;i variabilele utilizate &icirc;ntr-o clas&#259; special&#259;, iar &icirc;n programul principal s&#259; rul&#259;m thread-ul prin ThreadStart. De exemplu:</span></p><p class="c3"><span class="c4"></span></p><a id="t.2883c87e2ef27e71636ef6682e114a5790519951"></a><a id="t.5"></a><table class="c8"><tr class="c11"><td class="c2" colspan="1" rowspan="1"><p class="c12"><span class="c5">using</span><span class="c0">&nbsp;System.Threading;<br><br>Person tom = </span><span class="c5">new</span><span class="c0">&nbsp;Person(</span><span class="c1">&quot;Tom&quot;</span><span class="c0">, </span><span class="c14">37</span><span class="c0">);<br></span><span class="c10">// cre&#259;m un nou thread</span><span class="c0"><br>Thread myThread = </span><span class="c5">new</span><span class="c0">&nbsp;Thread(tom.Print);<br>myThread.Start();<br><br>record class </span><span class="c13">Person</span><span class="c0">(</span><span class="c5">string</span><span class="c0">&nbsp;Name, </span><span class="c5">int</span><span class="c0">&nbsp;Age)<br>{<br> &nbsp; &nbsp;</span><span class="c5">public</span><span class="c0">&nbsp;</span><span class="c5">void</span><span class="c0">&nbsp;</span><span class="c13">Print</span><span class="c0">()<br> &nbsp; &nbsp;{<br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c1">$&quot;Name = {Name}&quot;</span><span class="c0">);<br> &nbsp; &nbsp; &nbsp; &nbsp;Console.WriteLine(</span><span class="c1">$&quot;Age = {Age}&quot;</span><span class="c0">);<br> &nbsp; &nbsp;}<br>}</span></p></td></tr></table><p class="c3"><span class="c4"></span></p><p class="c3"><span class="c4"></span></p></body></html>