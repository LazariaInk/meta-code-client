<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><link rel="stylesheet" type="text/css" href="/lessons/styles.css"></head><body class="c14 doc-content"><p class="c8"><span class="c19">Am&acirc;narea &#537;i execu&#539;ia imediat&#259; a LINQ.</span></p><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c7">Exist&#259; dou&#259; moduri de executare a interog&#259;rii LINQ: </span><span class="c20">am&acirc;nat&#259; </span><span class="c7">(deferred) &#537;i </span><span class="c20">imediat&#259; </span><span class="c1">(immediate).</span></p><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c7">&Icirc;n cazul execu&#539;iei am&acirc;nate, expresia LINQ nu este executat&#259; p&acirc;n&#259; c&acirc;nd nu este efectuat&#259; o itera&#539;ie sau o parcurgere a selec&#539;iei, de exemplu, &icirc;ntr-un ciclu foreach. De obicei, astfel de opera&#539;ii returneaz&#259; un obiect </span><span class="c7 c17">IEnumerable&lt;T&gt;</span><span class="c7">&nbsp;sau </span><span class="c7 c17">IOrderedEnumerable&lt;T&gt;</span><span class="c1">. Lista complet&#259; a opera&#539;iunilor LINQ am&acirc;nate:</span></p><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0 start"><li class="c3 li-bullet-0"><span class="c11">AsEnumerable</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">Cast</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">Concat</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">DefaultIfEmpty</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">Distinct</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">Except</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">GroupBy</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">GroupJoin</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">Intersect</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">Join</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">OfType</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">OrderBy</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">OrderByDescending</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">Range</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">Repeat</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">Reverse</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">Select</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">SelectMany</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">Skip</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">SkipWhile</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">Take</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">TakeWhile</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">ThenBy</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">ThenByDescending</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">Union</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_g3og25ymjox-0"><li class="c3 li-bullet-0"><span class="c11">Where</span></li></ul><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c1">S&#259; examin&#259;m execu&#539;ia am&acirc;nat&#259;:</span></p><p class="c4"><span class="c1"></span></p><a id="t.aabac83b4988c244642fde4649112232b0fa069e"></a><a id="t.0"></a><table class="c18"><tr class="c12"><td class="c16" colspan="1" rowspan="1"><p class="c2"><span class="c13">string</span><span class="c0">[] people = { </span><span class="c10">&quot;Tom&quot;</span><span class="c0">, </span><span class="c10">&quot;Sam&quot;</span><span class="c0">, </span><span class="c10">&quot;Bob&quot;</span><span class="c0">&nbsp;};<br> <br></span><span class="c13">var</span><span class="c0">&nbsp;selectedPeople = people.Where(s=&gt;s.Length == </span><span class="c9">3</span><span class="c0">).OrderBy(s=&gt;s);<br> <br></span><span class="c15">// execu&#539;ia interog&#259;rii LINQ</span><span class="c0"><br></span><span class="c13">foreach</span><span class="c0">&nbsp;(</span><span class="c13">string</span><span class="c0">&nbsp;s </span><span class="c13">in</span><span class="c0">&nbsp;selectedPeople)<br> &nbsp; &nbsp;Console.WriteLine(s);</span></p></td></tr></table><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c7">Deci, execu&#539;ia efectiv&#259; a interog&#259;rii nu are loc &icirc;n linia de definire:</span><span class="c7 c17">&nbsp;var selectedPeople = people.Where...,</span><span class="c1">&nbsp;ci &icirc;n timpul parcurgerii &icirc;n ciclul foreach.</span></p><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c1">De fapt, interogarea LINQ se &icirc;mparte &icirc;n trei etape:</span></p><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c1">1. Ob&#539;inerea sursei de date:</span></p><p class="c4"><span class="c1"></span></p><a id="t.d3bdc3d0b75128abc07d97331cea12f4a07e19a7"></a><a id="t.1"></a><table class="c18"><tr class="c12"><td class="c16" colspan="1" rowspan="1"><p class="c2"><span class="c13">string</span><span class="c0">[] people = { </span><span class="c10">&quot;Tom&quot;</span><span class="c0">, </span><span class="c10">&quot;Sam&quot;</span><span class="c0">, </span><span class="c10">&quot;Bob&quot;</span><span class="c0">&nbsp;};</span></p></td></tr></table><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c1">2. Crearea interog&#259;rii - definirea variabilei selectedPeople:</span></p><p class="c4"><span class="c1"></span></p><a id="t.d429db3774470e7ef5f5bd1862b7feca61ef3c50"></a><a id="t.2"></a><table class="c18"><tr class="c12"><td class="c16" colspan="1" rowspan="1"><p class="c2"><span class="c13">var</span><span class="c0">&nbsp;selectedPeople = people.Where(s=&gt;s.Length == </span><span class="c9">3</span><span class="c0">).OrderBy(s=&gt;s);</span></p></td></tr></table><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c1">3. Execu&#539;ia interog&#259;rii &#537;i ob&#539;inerea rezultatelor:</span></p><p class="c4"><span class="c1"></span></p><a id="t.c9ed5e15d9ed06dd75eb2fd4dd26763d793c4cc3"></a><a id="t.3"></a><table class="c18"><tr class="c12"><td class="c16" colspan="1" rowspan="1"><p class="c2"><span class="c13">foreach</span><span class="c0">&nbsp;(</span><span class="c13">string</span><span class="c0">&nbsp;s </span><span class="c13">in</span><span class="c0">&nbsp;selectedPeople)<br> &nbsp; &nbsp;Console.WriteLine(s);</span></p></td></tr></table><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c1">Dup&#259; definirea interog&#259;rii, aceasta poate fi executat&#259; de mai multe ori. &#536;i p&acirc;n&#259; la execu&#539;ia interog&#259;rii, sursa de date poate fi modificat&#259;. Pentru a vedea mai clar acest lucru, putem modifica un element &icirc;nainte de parcurgerea selec&#539;iei:</span></p><p class="c4"><span class="c1"></span></p><a id="t.fdd2d2d456eebed1fe6f9bccb971fa34899eb484"></a><a id="t.4"></a><table class="c18"><tr class="c12"><td class="c16" colspan="1" rowspan="1"><p class="c2"><span class="c13">string</span><span class="c0">[] people = { </span><span class="c10">&quot;Tom&quot;</span><span class="c0">, </span><span class="c10">&quot;Sam&quot;</span><span class="c0">, </span><span class="c10">&quot;Bob&quot;</span><span class="c0">&nbsp;};<br> <br></span><span class="c13">var</span><span class="c0">&nbsp;selectedPeople = people.Where(s=&gt;s.Length == </span><span class="c9">3</span><span class="c0">).OrderBy(s=&gt;s);<br> <br>people[</span><span class="c9">2</span><span class="c0">] = </span><span class="c10">&quot;Mike&quot;</span><span class="c0">;<br></span><span class="c15">// execu&#539;ia interog&#259;rii LINQ</span><span class="c0"><br></span><span class="c13">foreach</span><span class="c0">&nbsp;(</span><span class="c13">string</span><span class="c0">&nbsp;s </span><span class="c13">in</span><span class="c0">&nbsp;selectedPeople)<br> &nbsp; &nbsp;Console.WriteLine(s);</span></p></td></tr></table><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c1">Acum, selec&#539;ia va con&#539;ine dou&#259; elemente, nu trei, deoarece ultimul element dup&#259; modificare nu va corespunde condi&#539;iei.</span></p><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c1">Este important de &icirc;n&#539;eles c&#259; variabila interog&#259;rii nu execut&#259; niciun fel de ac&#539;iuni &#537;i nu returneaz&#259; niciun fel de date. Ea doar stocheaz&#259; un set de comenzi necesare pentru ob&#539;inerea rezultatelor. Deci, execu&#539;ia interog&#259;rii dup&#259; crearea sa este am&acirc;nat&#259;. Ob&#539;inerea rezultatelor are loc la parcurgerea &icirc;n ciclul foreach.</span></p><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c5">Execu&#539;ia imediat&#259; a interog&#259;rii.</span></p><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c1">Cu ajutorul unor metode, putem aplica execu&#539;ia imediat&#259; a interog&#259;rii. Acestea sunt metode care returneaz&#259; o valoare atomic&#259; sau un singur element sau date de tipurile Array, List &#537;i Dictionary. Lista complet&#259; a acestor opera&#539;ii &icirc;n LINQ:</span></p><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0 start"><li class="c3 li-bullet-0"><span class="c11">Aggregate</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">All</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">Any</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">Average</span></li></ul><p class="c4"><span class="c11"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">Contains</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">Count</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">ElementAt</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">ElementAtOrDefault</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">Empty</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">First</span></li></ul><p class="c4"><span class="c11"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">FirstOrDefault</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">Last</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">LastOrDefault</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">LongCount</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">Max</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">Min</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">SequenceEqual</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">Single</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">SingleOrDefault</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">Sum</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">ToArray</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">ToDictionary</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">ToList</span></li></ul><p class="c4"><span class="c1"></span></p><ul class="c6 lst-kix_c5bi8t79e2z0-0"><li class="c3 li-bullet-0"><span class="c11">ToLookup</span></li></ul><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c7">S&#259; examin&#259;m un exemplu cu metoda </span><span class="c7 c17">Count()</span><span class="c1">, care returneaz&#259; num&#259;rul de elemente din secven&#539;&#259;:</span></p><p class="c4"><span class="c1"></span></p><a id="t.2e3770b6dabded2f8ce5d5917fe997e666b58ccb"></a><a id="t.5"></a><table class="c18"><tr class="c12"><td class="c16" colspan="1" rowspan="1"><p class="c2"><span class="c13">string</span><span class="c0">[] people = { </span><span class="c10">&quot;Tom&quot;</span><span class="c0">, </span><span class="c10">&quot;Sam&quot;</span><span class="c0">, </span><span class="c10">&quot;Bob&quot;</span><span class="c0">&nbsp;};<br></span><span class="c15">// definirea &#537;i execu&#539;ia interog&#259;rii LINQ</span><span class="c0"><br></span><span class="c13">var</span><span class="c0">&nbsp;count = people.Where(s=&gt;s.Length == </span><span class="c9">3</span><span class="c0">).OrderBy(s=&gt;s).Count();<br> <br>Console.WriteLine(count); &nbsp; </span><span class="c15">// 3 - &icirc;nainte de modificarea colec&#539;iei</span><span class="c0"><br> <br>people[</span><span class="c9">2</span><span class="c0">] = </span><span class="c10">&quot;Mike&quot;</span><span class="c0">;<br>Console.WriteLine(count); &nbsp; </span><span class="c15">// 3 - dup&#259; modificarea colec&#539;iei</span></p></td></tr></table><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c1">Rezultatul metodei Count va fi un obiect int, deci se va executa imediat.</span></p><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c7">Mai &icirc;nt&acirc;i se creeaz&#259; interogarea:</span><span class="c7 c17">&nbsp;people.Where(s=&gt;s.Length == 3).OrderBy(s=&gt;s)</span><span class="c7">. Apoi i se aplic&#259; metoda </span><span class="c7 c17">Count()</span><span class="c1">, care execut&#259; interogarea, parcurge implicit secven&#539;a de elemente generat&#259; de aceast&#259; interogare &#537;i returneaz&#259; num&#259;rul de elemente din aceast&#259; secven&#539;&#259;.</span></p><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c7">De asemenea, putem modifica codul astfel &icirc;nc&acirc;t metoda </span><span class="c7 c17">Count()</span><span class="c1">&nbsp;s&#259; &#539;in&#259; cont de modific&#259;ri &#537;i s&#259; fie executat&#259; separat de definirea interog&#259;rii:</span></p><p class="c4"><span class="c1"></span></p><a id="t.0a520c66907125ebc4481d11116d696c91a68ca3"></a><a id="t.6"></a><table class="c18"><tr class="c12"><td class="c16" colspan="1" rowspan="1"><p class="c2"><span class="c13">string</span><span class="c0">[] people = { </span><span class="c10">&quot;Tom&quot;</span><span class="c0">, </span><span class="c10">&quot;Sam&quot;</span><span class="c0">, </span><span class="c10">&quot;Bob&quot;</span><span class="c0">&nbsp;};<br></span><span class="c15">// definirea interog&#259;rii LINQ</span><span class="c0"><br></span><span class="c13">var</span><span class="c0">&nbsp;selectedPeople = people.Where(s=&gt;s.Length == </span><span class="c9">3</span><span class="c0">).OrderBy(s=&gt;s);<br></span><span class="c15">// execu&#539;ia interog&#259;rii</span><span class="c0"><br>Console.WriteLine(selectedPeople.Count()); &nbsp; </span><span class="c15">// 3 - &icirc;nainte de modificarea colec&#539;iei</span><span class="c0"><br> <br>people[</span><span class="c9">2</span><span class="c0">] = </span><span class="c10">&quot;Mike&quot;</span><span class="c0">;<br></span><span class="c15">// execu&#539;ia interog&#259;rii</span><span class="c0"><br>Console.WriteLine(selectedPeople.Count()); &nbsp; </span><span class="c15">// 2 - dup&#259; modificarea colec&#539;iei</span></p></td></tr></table><p class="c4"><span class="c1"></span></p><p class="c8"><span class="c7">De asemenea, pentru execu&#539;ia imediat&#259; a interog&#259;rii LINQ &#537;i stocarea rezultatelor sale putem aplica metodele de conversie</span><span class="c7 c17">&nbsp;ToArray&lt;T&gt;(), ToList&lt;T&gt;(), ToDictionary() </span><span class="c1">etc. Aceste metode ob&#539;in rezultatul interog&#259;rii sub form&#259; de obiecte Array, List &#537;i Dictionary respectiv. De exemplu:</span></p><p class="c4"><span class="c1"></span></p><a id="t.213402e7c92fd8c70e73b66ff09e6d0556016902"></a><a id="t.7"></a><table class="c18"><tr class="c12"><td class="c16" colspan="1" rowspan="1"><p class="c2"><span class="c13">string</span><span class="c0">[] people = { </span><span class="c10">&quot;Tom&quot;</span><span class="c0">, </span><span class="c10">&quot;Sam&quot;</span><span class="c0">, </span><span class="c10">&quot;Bob&quot;</span><span class="c0">&nbsp;};<br> <br></span><span class="c15">// definirea &#537;i execu&#539;ia interog&#259;rii LINQ</span><span class="c0"><br></span><span class="c13">var</span><span class="c0">&nbsp;selectedPeople = people.Where(s=&gt;s.Length == </span><span class="c9">3</span><span class="c0">).OrderBy(s=&gt;s).ToList();<br> <br></span><span class="c15">// modificarea array-ului nu va afecta lista selectedPeople</span><span class="c0"><br>people[</span><span class="c9">2</span><span class="c0">] = </span><span class="c10">&quot;Mike&quot;</span><span class="c0">;<br> <br></span><span class="c15">// execu&#539;ia interog&#259;rii</span><span class="c0"><br></span><span class="c13">foreach</span><span class="c0">&nbsp;(</span><span class="c13">string</span><span class="c0">&nbsp;s </span><span class="c13">in</span><span class="c0">&nbsp;selectedPeople)<br> &nbsp; &nbsp;Console.WriteLine(s);</span></p></td></tr></table><p class="c4"><span class="c1"></span></p><p class="c4"><span class="c1"></span></p></body></html>