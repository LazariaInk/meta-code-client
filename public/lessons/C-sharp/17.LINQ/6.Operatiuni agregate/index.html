<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><link rel="stylesheet" type="text/css" href="/lessons/styles.css"></head><body class="c15 doc-content"><p class="c9"><span class="c6 c18">Opera&#539;iuni agregate.</span></p><p class="c3"><span class="c5 c6"></span></p><p class="c9"><span class="c6 c5">Opera&#539;iunile agregate includ diverse opera&#539;iuni asupra selec&#539;iilor, cum ar fi ob&#539;inerea num&#259;rului de elemente, ob&#539;inerea valorii minime, maxime &#537;i medii &icirc;n selec&#539;ie, precum &#537;i sumarea valorilor.</span></p><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c6 c11">Metoda Aggregate.</span></p><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c5">Metoda </span><span class="c13">Aggregate </span><span class="c6 c5">efectueaz&#259; o agregare general&#259; a elementelor colec&#539;iei &icirc;n func&#539;ie de expresia specificat&#259;. De exemplu:</span></p><p class="c3"><span class="c6 c5"></span></p><a id="t.9e9d162a3d8b3806ae72af302ab9f62f8881a946"></a><a id="t.0"></a><table class="c8"><tr class="c7"><td class="c0" colspan="1" rowspan="1"><p class="c12"><span class="c2">int</span><span class="c1">[] numbers = { </span><span class="c4">1</span><span class="c1">, </span><span class="c4">2</span><span class="c1">, </span><span class="c4">3</span><span class="c1">, </span><span class="c4">4</span><span class="c1">, </span><span class="c4">5</span><span class="c1">&nbsp;};<br><br></span><span class="c2">int</span><span class="c1">&nbsp;query = numbers.Aggregate((x, y) =&gt; x - y);<br>Console.WriteLine(query); &nbsp; </span><span class="c14">// -13</span></p></td></tr></table><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c5">Variabila query va reprezenta rezultatul agreg&#259;rii array-ului. Ca &#537;i condi&#539;ie de agregare se folose&#537;te expresia</span><span class="c5 c17">&nbsp;(x, y) =&gt; x - y</span><span class="c6 c5">, adic&#259; ini&#539;ial se scade al doilea element din primul, apoi al treilea din rezultat &#537;i a&#537;a mai departe. Astfel, va fi echivalent cu expresia:</span></p><p class="c3"><span class="c6 c5"></span></p><a id="t.ee8c01e09e952843796ee5cf3f5ee1a628e47e5b"></a><a id="t.1"></a><table class="c8"><tr class="c7"><td class="c0" colspan="1" rowspan="1"><p class="c12"><span class="c2">int</span><span class="c1">&nbsp;query = </span><span class="c4">1</span><span class="c1">&nbsp;- </span><span class="c4">2</span><span class="c1">&nbsp;- </span><span class="c4">3</span><span class="c1">&nbsp;- </span><span class="c4">4</span><span class="c1">&nbsp;- </span><span class="c4">5</span><span class="c1">;</span></p></td></tr></table><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c6 c5">Rezultatul va fi -13. Putem folosi orice alte opera&#539;iuni, de exemplu, adunarea:</span></p><p class="c3"><span class="c6 c5"></span></p><a id="t.6c79f31093b44a19db82feeea7c0fbd1f8dfdef4"></a><a id="t.2"></a><table class="c8"><tr class="c7"><td class="c0" colspan="1" rowspan="1"><p class="c12"><span class="c2">int</span><span class="c1">&nbsp;query = numbers.Aggregate((x, y) =&gt; x + y); </span><span class="c14">// echivalent cu 1 + 2 + 3 + 4 + 5</span></p></td></tr></table><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c6 c5">O alt&#259; versiune a metodei permite specificarea unei valori ini&#539;iale de la care &icirc;ncepe lan&#539;ul opera&#539;iunilor de agregare:</span></p><p class="c3"><span class="c6 c5"></span></p><a id="t.b0ab1382a0cc1e87167431fe97ed1eba16b81616"></a><a id="t.3"></a><table class="c8"><tr class="c7"><td class="c0" colspan="1" rowspan="1"><p class="c12"><span class="c2">string</span><span class="c1">[] words = { </span><span class="c10">&quot;Gaudeamus&quot;</span><span class="c1">, </span><span class="c10">&quot;igitur&quot;</span><span class="c1">, </span><span class="c10">&quot;Juvenes&quot;</span><span class="c1">, </span><span class="c10">&quot;dum&quot;</span><span class="c1">, </span><span class="c10">&quot;sumus&quot;</span><span class="c1">&nbsp;};<br></span><span class="c2">var</span><span class="c1">&nbsp;sentence = words.Aggregate(</span><span class="c10">&quot;Text:&quot;</span><span class="c1">, (first, next) =&gt; </span><span class="c10">$&quot;{first} {next}&quot;</span><span class="c1">);<br><br>Console.WriteLine(sentence); &nbsp;</span><span class="c14">// Text: Gaudeamus igitur Juvenes dum sumus</span></p></td></tr></table><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c6 c5">&Icirc;n acest caz, toate elementele array-ului words sunt combinate, dar primul element al opera&#539;iunii de agregare va fi &#537;irul &quot;Text:&quot;.</span></p><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c6 c11">Ob&#539;inerea dimensiunii selec&#539;iei. Metoda Count.</span></p><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c5">Pentru a ob&#539;ine num&#259;rul de elemente dintr-o selec&#539;ie se folose&#537;te metoda</span><span class="c13">&nbsp;Count()</span><span class="c6 c5">:</span></p><p class="c3"><span class="c6 c5"></span></p><a id="t.e727674043d608ac9a734c7c0356b26c9514a363"></a><a id="t.4"></a><table class="c8"><tr class="c7"><td class="c0" colspan="1" rowspan="1"><p class="c12"><span class="c2">int</span><span class="c1">[] numbers = { </span><span class="c4">1</span><span class="c1">, </span><span class="c4">2</span><span class="c1">, </span><span class="c4">3</span><span class="c1">, </span><span class="c4">4</span><span class="c1">, </span><span class="c4">10</span><span class="c1">, </span><span class="c4">34</span><span class="c1">, </span><span class="c4">55</span><span class="c1">, </span><span class="c4">66</span><span class="c1">, </span><span class="c4">77</span><span class="c1">, </span><span class="c4">88</span><span class="c1">&nbsp;};<br></span><span class="c2">int</span><span class="c1">&nbsp;size = numbers.Count(); &nbsp;</span><span class="c14">// 10</span><span class="c1"><br>Console.WriteLine(size);</span></p></td></tr></table><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c5">Metoda </span><span class="c5 c17">Count()</span><span class="c5">&nbsp;&icirc;ntr-una din versiunile sale poate primi &#537;i o expresie lambda care stabile&#537;te condi&#539;ia de selec&#539;ie. Astfel, putem &icirc;n acest caz s&#259; nu folosim expresia </span><span class="c5 c17">Where</span><span class="c6 c5">:</span></p><p class="c3"><span class="c6 c5"></span></p><a id="t.f95929401659c1c97a23f236c0fc0969d8db64a4"></a><a id="t.5"></a><table class="c8"><tr class="c7"><td class="c0" colspan="1" rowspan="1"><p class="c12"><span class="c2">int</span><span class="c1">[] numbers = { </span><span class="c4">1</span><span class="c1">, </span><span class="c4">2</span><span class="c1">, </span><span class="c4">3</span><span class="c1">, </span><span class="c4">4</span><span class="c1">, </span><span class="c4">10</span><span class="c1">, </span><span class="c4">34</span><span class="c1">, </span><span class="c4">55</span><span class="c1">, </span><span class="c4">66</span><span class="c1">, </span><span class="c4">77</span><span class="c1">, </span><span class="c4">88</span><span class="c1">&nbsp;};<br></span><span class="c14">// num&#259;rul de numere pare care sunt mai mari de 10</span><span class="c1"><br></span><span class="c2">int</span><span class="c1">&nbsp;size = numbers.Count(i =&gt; i % </span><span class="c4">2</span><span class="c1">&nbsp;== </span><span class="c4">0</span><span class="c1">&nbsp;&amp;&amp; i &gt; </span><span class="c4">10</span><span class="c1">);<br>Console.WriteLine(size); &nbsp; &nbsp;</span><span class="c14">// 3</span></p></td></tr></table><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c6 c11">Ob&#539;inerea sumei.</span></p><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c5">Pentru a ob&#539;ine suma valorilor se folose&#537;te metoda </span><span class="c13">Sum</span><span class="c6 c5">:</span></p><p class="c3"><span class="c6 c5"></span></p><a id="t.967a1688ecf6bab7ed64a76643426a3b88ab8fda"></a><a id="t.6"></a><table class="c8"><tr class="c7"><td class="c0" colspan="1" rowspan="1"><p class="c12"><span class="c2">int</span><span class="c1">[] numbers = { </span><span class="c4">1</span><span class="c1">, </span><span class="c4">2</span><span class="c1">, </span><span class="c4">3</span><span class="c1">, </span><span class="c4">4</span><span class="c1">, </span><span class="c4">10</span><span class="c1">, </span><span class="c4">34</span><span class="c1">, </span><span class="c4">55</span><span class="c1">, </span><span class="c4">66</span><span class="c1">, </span><span class="c4">77</span><span class="c1">, </span><span class="c4">88</span><span class="c1">&nbsp;};<br><br></span><span class="c2">int</span><span class="c1">&nbsp;sum = numbers.Sum();<br>Console.WriteLine(sum); &nbsp; &nbsp; </span><span class="c14">// 340</span></p></td></tr></table><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c5">Metoda</span><span class="c5 c17">&nbsp;Sum()</span><span class="c6 c5">&nbsp;are mai multe suprascrieri. &Icirc;n special, dac&#259; avem un set de obiecte complexe, cum este exemplul de mai sus, putem specifica proprietatea ale c&#259;rei valori vor fi &icirc;nsumate:</span></p><p class="c3"><span class="c6 c5"></span></p><a id="t.5ea16f01dff6770018da15b93aebf5d7af1cdb5a"></a><a id="t.7"></a><table class="c8"><tr class="c7"><td class="c0" colspan="1" rowspan="1"><p class="c12"><span class="c1">Person[] people = { </span><span class="c2">new</span><span class="c1">&nbsp;Person(</span><span class="c10">&quot;Tom&quot;</span><span class="c1">, </span><span class="c4">37</span><span class="c1">), </span><span class="c2">new</span><span class="c1">&nbsp;Person(</span><span class="c10">&quot;Sam&quot;</span><span class="c1">, </span><span class="c4">28</span><span class="c1">), </span><span class="c2">new</span><span class="c1">&nbsp;Person(</span><span class="c10">&quot;Bob&quot;</span><span class="c1">, </span><span class="c4">41</span><span class="c1">) };<br><br></span><span class="c2">int</span><span class="c1">&nbsp;ageSum = people.Sum(p =&gt; p.Age);<br>Console.WriteLine(ageSum); &nbsp; &nbsp; </span><span class="c14">// 106</span><span class="c1"><br><br>record class </span><span class="c16">Person</span><span class="c1">(</span><span class="c2">string</span><span class="c1">&nbsp;Name, </span><span class="c2">int</span><span class="c1">&nbsp;Age);</span></p></td></tr></table><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c6 c5">&Icirc;n acest caz, se calculeaz&#259; suma valorilor propriet&#259;&#539;ii Age a obiectelor Person din array-ul people.</span></p><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c6 c11">Valoarea maxim&#259;, minim&#259; &#537;i medie.</span></p><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c5">Pentru a g&#259;si valoarea minim&#259; se folose&#537;te metoda</span><span class="c13">&nbsp;Min()</span><span class="c5">, pentru a ob&#539;ine valoarea maxim&#259; - metoda </span><span class="c13">Max()</span><span class="c5">, iar pentru a g&#259;si valoarea medie - metoda </span><span class="c13">Average()</span><span class="c6 c5">. Ac&#539;iunea lor este similar&#259; cu metodele Sum &#537;i Count:</span></p><p class="c3"><span class="c6 c5"></span></p><a id="t.59c09688ef2c86582ed756f8ee9225e0c508f94e"></a><a id="t.8"></a><table class="c8"><tr class="c7"><td class="c0" colspan="1" rowspan="1"><p class="c12"><span class="c2">int</span><span class="c1">[] numbers = { </span><span class="c4">1</span><span class="c1">, </span><span class="c4">2</span><span class="c1">, </span><span class="c4">3</span><span class="c1">, </span><span class="c4">4</span><span class="c1">, </span><span class="c4">10</span><span class="c1">, </span><span class="c4">34</span><span class="c1">, </span><span class="c4">55</span><span class="c1">, </span><span class="c4">66</span><span class="c1">, </span><span class="c4">77</span><span class="c1">, </span><span class="c4">88</span><span class="c1">&nbsp;};<br><br></span><span class="c2">int</span><span class="c1">&nbsp;min = numbers.Min();<br></span><span class="c2">int</span><span class="c1">&nbsp;max = numbers.Max();<br></span><span class="c2">double</span><span class="c1">&nbsp;average = numbers.Average();<br><br>Console.WriteLine(</span><span class="c10">$&quot;Min: {min}&quot;</span><span class="c1">); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c14">// Min: 1</span><span class="c1"><br>Console.WriteLine(</span><span class="c10">$&quot;Max: {max}&quot;</span><span class="c1">); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c14">// Max: 88</span><span class="c1"><br>Console.WriteLine(</span><span class="c10">$&quot;Average: {average}&quot;</span><span class="c1">); &nbsp; </span><span class="c14">// Average: 34</span></p></td></tr></table><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c6 c5">Dac&#259; lucr&#259;m cu obiecte complexe, &icirc;n aceste metode se transmite un delegat care specific&#259; proprietatea aplicat&#259; &icirc;n calcule:</span></p><p class="c3"><span class="c6 c5"></span></p><a id="t.e08355059aab62112930ade6fd2ea8b5f1cbe778"></a><a id="t.9"></a><table class="c8"><tr class="c7"><td class="c0" colspan="1" rowspan="1"><p class="c12"><span class="c1">Person[] people = { </span><span class="c2">new</span><span class="c1">&nbsp;Person(</span><span class="c10">&quot;Tom&quot;</span><span class="c1">, </span><span class="c4">37</span><span class="c1">), </span><span class="c2">new</span><span class="c1">&nbsp;Person(</span><span class="c10">&quot;Sam&quot;</span><span class="c1">, </span><span class="c4">28</span><span class="c1">), </span><span class="c2">new</span><span class="c1">&nbsp;Person(</span><span class="c10">&quot;Bob&quot;</span><span class="c1">, </span><span class="c4">41</span><span class="c1">) };<br><br></span><span class="c2">int</span><span class="c1">&nbsp;minAge = people.Min(p =&gt; p.Age); </span><span class="c14">// v&acirc;rsta minim&#259;</span><span class="c1"><br></span><span class="c2">int</span><span class="c1">&nbsp;maxAge = people.Max(p =&gt; p.Age); </span><span class="c14">// v&acirc;rsta maxim&#259;</span><span class="c1"><br></span><span class="c2">double</span><span class="c1">&nbsp;averageAge = people.Average(p =&gt; p.Age); </span><span class="c14">// v&acirc;rsta medie</span><span class="c1"><br><br>Console.WriteLine(</span><span class="c10">$&quot;Min Age: {minAge}&quot;</span><span class="c1">); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c14">// Min Age: 28</span><span class="c1"><br>Console.WriteLine(</span><span class="c10">$&quot;Max Age: {maxAge}&quot;</span><span class="c1">); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c14">// Max Age: 41</span><span class="c1"><br>Console.WriteLine(</span><span class="c10">$&quot;Average Age: {averageAge}&quot;</span><span class="c1">); &nbsp; </span><span class="c14">// Average Age: 35,33</span><span class="c1"><br><br>record class </span><span class="c16">Person</span><span class="c1">(</span><span class="c2">string</span><span class="c1">&nbsp;Name, </span><span class="c2">int</span><span class="c1">&nbsp;Age);</span></p></td></tr></table><p class="c3"><span class="c6 c5"></span></p><p class="c9"><span class="c6 c5">&Icirc;n acest caz, pentru calcule se folose&#537;te proprietatea Age, adic&#259; se calculeaz&#259; v&acirc;rsta minim&#259;, maxim&#259; &#537;i medie.</span></p><p class="c3"><span class="c6 c5"></span></p></body></html>