<html><head><meta content="text/html; charset=UTF-8" http-equiv="content-type"><link rel="stylesheet" type="text/css" href="/lessons/styles.css"></head><body class="c12 doc-content"><p class="c6"><span class="c17">Clasa StringBuilder.</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">De&#537;i clasa System.String ne ofer&#259; o func&#539;ionalitate extins&#259; pentru lucrul cu &#537;iruri de caractere, are totu&#537;i c&acirc;teva dezavantaje. &Icirc;n primul r&acirc;nd, obiectul String reprezint&#259; un &#537;ir imutabil. C&acirc;nd execut&#259;m o metod&#259; a clasei String, sistemul creeaz&#259; un nou obiect &icirc;n memorie, aloc&acirc;ndu-i suficient spa&#539;iu. &#536;tergerea primului caracter nu este cea mai costisitoare opera&#539;ie. Cu toate acestea, c&acirc;nd astfel de opera&#539;ii sunt numeroase &#537;i volumul textului pentru care trebuie efectuate aceste opera&#539;ii este semnificativ, pierderile de performan&#539;&#259; devin mai importante.</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c7">Pentru a rezolva aceast&#259; problem&#259;, &icirc;n cadrul .NET a fost ad&#259;ugat&#259; o nou&#259; clas&#259;, </span><span class="c9">StringBuilder</span><span class="c7">, care se afl&#259; &icirc;n spa&#539;iul de nume </span><span class="c7 c14">System.Text</span><span class="c2">. Aceast&#259; clas&#259; reprezint&#259; un &#537;ir dinamic.</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c8">Crearea unui StringBuilder.</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">Pentru a crea un obiect StringBuilder, putem folosi mai mul&#539;i constructori. &Icirc;n primul r&acirc;nd, putem crea un StringBuilder gol:</span></p><p class="c0"><span class="c2"></span></p><a id="t.20fd1ba9e3b9af1df3340042f70a3fbb089cc67a"></a><a id="t.0"></a><table class="c11"><tr class="c13"><td class="c15" colspan="1" rowspan="1"><p class="c4"><span class="c1">using</span><span class="c3">&nbsp;System.Text;<br><br>StringBuilder sb = </span><span class="c1">new</span><span class="c3">&nbsp;StringBuilder();</span></p></td></tr></table><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">Putem ini&#539;ializa direct obiectul cu un &#537;ir definit:</span></p><p class="c0"><span class="c2"></span></p><a id="t.0adade99c1bda13ea446eb9b3f11c6a7013a47ea"></a><a id="t.1"></a><table class="c11"><tr class="c13"><td class="c15" colspan="1" rowspan="1"><p class="c4"><span class="c3">StringBuilder sb = </span><span class="c1">new</span><span class="c3">&nbsp;StringBuilder(</span><span class="c10">&quot;Salut lume&quot;</span><span class="c3">);</span></p></td></tr></table><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c7">Cu ajutorul metodei </span><span class="c7 c14">ToString()</span><span class="c2">&nbsp;putem ob&#539;ine &#537;irul stocat &icirc;n StringBuilder:</span></p><p class="c0"><span class="c2"></span></p><a id="t.180efba262ad95a754e856bae5b36f13fd8d74b9"></a><a id="t.2"></a><table class="c11"><tr class="c13"><td class="c15" colspan="1" rowspan="1"><p class="c4"><span class="c1">var</span><span class="c3">&nbsp;sb = </span><span class="c1">new</span><span class="c3">&nbsp;StringBuilder(</span><span class="c10">&quot;Hello World&quot;</span><span class="c3">);<br>Console.WriteLine(sb.ToString()); </span><span class="c5">// Hello World</span></p></td></tr></table><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">Sau putem pur &#537;i simplu s&#259; transmitem obiectul StringBuilder:</span></p><p class="c0"><span class="c2"></span></p><a id="t.aa3caebae21d3e8fae294403ea22ec2d829cff8c"></a><a id="t.3"></a><table class="c11"><tr class="c13"><td class="c15" colspan="1" rowspan="1"><p class="c4"><span class="c1">var</span><span class="c3">&nbsp;sb = </span><span class="c1">new</span><span class="c3">&nbsp;StringBuilder(</span><span class="c10">&quot;Hello World&quot;</span><span class="c3">);<br>Console.WriteLine(sb); </span><span class="c5">// Hello World</span></p></td></tr></table><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c8">Lungimea &#537;i capacitatea StringBuilder.</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c7">Pentru a stoca lungimea &#537;irului &icirc;n clasa StringBuilder, este definit&#259; proprietatea </span><span class="c9">Length</span><span class="c7">. Cu toate acestea, exist&#259; &#537;i o a doua valoare - capacitatea memoriei alocate. Aceast&#259; valoare este stocat&#259; &icirc;n proprietatea </span><span class="c7 c14">Capacity</span><span class="c2">. Capacitatea este memoria alocat&#259; pentru obiect. Setarea capacit&#259;&#539;ii permite reducerea aloc&#259;rilor de memorie &#537;i, astfel, &icirc;mbun&#259;t&#259;&#539;irea performan&#539;ei.</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">Dac&#259; &#537;irul transmis constructorului StringBuilder are o lungime de 16 caractere sau mai pu&#539;in, capacitatea ini&#539;ial&#259; &icirc;n StringBuilder este de 16. Dac&#259; &#537;irul ini&#539;ial este mai mare de 16 caractere, capacitatea ini&#539;ial&#259; a StringBuilder va fi egal&#259; cu lungimea &#537;irului.</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">De exemplu, s&#259; vedem ce con&#539;in aceste propriet&#259;&#539;i:</span></p><p class="c0"><span class="c2"></span></p><a id="t.1975afed1cf6d42c6669164c470683280030d8a1"></a><a id="t.4"></a><table class="c11"><tr class="c13"><td class="c15" colspan="1" rowspan="1"><p class="c4"><span class="c1">using</span><span class="c3">&nbsp;System.Text;<br><br>StringBuilder sb = </span><span class="c1">new</span><span class="c3">&nbsp;StringBuilder(</span><span class="c10">&quot;Salut lume&quot;</span><span class="c3">);<br>Console.WriteLine(</span><span class="c10">$&quot;Lungime: {sb.Length}&quot;</span><span class="c3">); </span><span class="c5">// Lungime: 10</span><span class="c3"><br>Console.WriteLine(</span><span class="c10">$&quot;Capacitate: {sb.Capacity}&quot;</span><span class="c3">); </span><span class="c5">// Capacitate: 16</span></p></td></tr></table><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">De&#537;i &icirc;n acest caz lungimea este de 10 caractere, capacitatea real&#259; va fi implicit de 16 caractere. Adic&#259; vedem c&#259; la crearea &#537;irului StringBuilder se aloc&#259; mai mult&#259; memorie dec&acirc;t este necesar acestui &#537;ir. C&acirc;nd &#537;irul din StringBuilder se m&#259;re&#537;te &#537;i num&#259;rul de caractere dep&#259;&#537;e&#537;te capacitatea ini&#539;ial&#259;, capacitatea se dubleaz&#259; sau mai mult.</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">Dac&#259; &#537;tim dinainte dimensiunea maxim&#259; a obiectului, putem seta direct capacitatea folosind unul dintre constructori &#537;i astfel evit&#259;m aloc&#259;rile suplimentare de memorie ulterioare.</span></p><p class="c0"><span class="c2"></span></p><a id="t.862d4a3bff12f030e87c6d4fb80aa26fbdfb0927"></a><a id="t.5"></a><table class="c11"><tr class="c13"><td class="c15" colspan="1" rowspan="1"><p class="c4"><span class="c1">var</span><span class="c3">&nbsp;sb = </span><span class="c1">new</span><span class="c3">&nbsp;StringBuilder(</span><span class="c16">32</span><span class="c3">);</span></p></td></tr></table><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">StringBuilder permite de asemenea s&#259; set&#259;m direct &#537;irul &#537;i capacitatea:</span></p><p class="c0"><span class="c2"></span></p><a id="t.452caf54bf73c9b4a60658177d65326dae8eb1cb"></a><a id="t.6"></a><table class="c11"><tr class="c13"><td class="c15" colspan="1" rowspan="1"><p class="c4"><span class="c1">var</span><span class="c3">&nbsp;sb = </span><span class="c1">new</span><span class="c3">&nbsp;StringBuilder(</span><span class="c10">&quot;Salut lume&quot;</span><span class="c3">, </span><span class="c16">32</span><span class="c3">);</span></p></td></tr></table><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c8">Opera&#539;ii cu &#537;iruri &icirc;n StringBuilder.</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">Pentru opera&#539;iile asupra &#537;irurilor, clasa StringBuilder define&#537;te mai multe metode:</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c7">- </span><span class="c9">Append</span><span class="c2">: adaug&#259; un sub&#537;ir la obiectul StringBuilder</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c7">- </span><span class="c9">Insert</span><span class="c2">: insereaz&#259; un sub&#537;ir &icirc;n obiectul StringBuilder, &icirc;ncep&acirc;nd de la un anumit index</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c7">- </span><span class="c9">Remove</span><span class="c2">: elimin&#259; un num&#259;r specific de caractere, &icirc;ncep&acirc;nd de la un anumit index</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c7">- </span><span class="c9">Replace</span><span class="c2">: &icirc;nlocuie&#537;te toate apari&#539;iile unui caracter sau sub&#537;ir cu alt caracter sau sub&#537;ir</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c7">- </span><span class="c9">AppendFormat</span><span class="c2">: adaug&#259; un sub&#537;ir la sf&acirc;r&#537;itul obiectului StringBuilder</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c7">Acum s&#259; vedem un exemplu de utilizare a metodei </span><span class="c9">Append() </span><span class="c2">&#537;i avantajele clasei StringBuilder:</span></p><p class="c0"><span class="c2"></span></p><a id="t.8e513e6a8a511485acc52c1cbc58407c31b5415d"></a><a id="t.7"></a><table class="c11"><tr class="c13"><td class="c15" colspan="1" rowspan="1"><p class="c4"><span class="c1">using</span><span class="c3">&nbsp;System.Text;<br><br></span><span class="c1">var</span><span class="c3">&nbsp;sb = </span><span class="c1">new</span><span class="c3">&nbsp;StringBuilder(</span><span class="c10">&quot;Titlu: &quot;</span><span class="c3">);<br>Console.WriteLine(sb); </span><span class="c5">// Titlu:</span><span class="c3"><br>Console.WriteLine(</span><span class="c10">$&quot;Lungime: {sb.Length}&quot;</span><span class="c3">); </span><span class="c5">// 7</span><span class="c3"><br>Console.WriteLine(</span><span class="c10">$&quot;Capacitate: {sb.Capacity}&quot;</span><span class="c3">); </span><span class="c5">// 16</span><span class="c3"><br><br>sb.Append(</span><span class="c10">&quot; Ghid&quot;</span><span class="c3">);<br>Console.WriteLine(sb); </span><span class="c5">// Titlu: Ghid</span><span class="c3"><br>Console.WriteLine(</span><span class="c10">$&quot;Lungime: {sb.Length}&quot;</span><span class="c3">); </span><span class="c5">// 12</span><span class="c3"><br>Console.WriteLine(</span><span class="c10">$&quot;Capacitate: {sb.Capacity}&quot;</span><span class="c3">); </span><span class="c5">// 16</span><span class="c3"><br><br>sb.Append(</span><span class="c10">&quot; de C#&quot;</span><span class="c3">);<br>Console.WriteLine(sb); </span><span class="c5">// Titlu: Ghid de C#</span><span class="c3"><br>Console.WriteLine(</span><span class="c10">$&quot;Lungime: {sb.Length}&quot;</span><span class="c3">); </span><span class="c5">// 18</span><span class="c3"><br>Console.WriteLine(</span><span class="c10">$&quot;Capacitate: {sb.Capacity}&quot;</span><span class="c3">); </span><span class="c5">// 32</span></p></td></tr></table><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">La crearea obiectului StringBuilder, memoria este alocat&#259; implicit pentru 16 caractere, deoarece lungimea &#537;irului ini&#539;ial este mai mic&#259; de 16.</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">Apoi, este utilizat&#259; metoda Append - aceast&#259; metod&#259; adaug&#259; un sub&#537;ir la &#537;ir. Deoarece la unirea &#537;irurilor lungimea total&#259; - 12 caractere - dep&#259;&#537;e&#537;te capacitatea ini&#539;ial&#259; de 16 caractere, capacitatea ini&#539;ial&#259; se dubleaz&#259; la 32 de caractere.</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">Dac&#259; lungimea final&#259; a &#537;irului ar fi fost mai mare de 32 de caractere, capacitatea ar fi fost extins&#259; pentru a se potrivi lungimii &#537;irului.</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">Apoi, din nou se aplic&#259; metoda Append, &icirc;ns&#259; lungimea final&#259; va fi de 18 caractere, ceea ce este mai mic de 32 de caractere &#537;i nu se va aloca memorie suplimentar&#259;.</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">S&#259; utiliz&#259;m &#537;i celelalte metode ale StringBuilder:</span></p><p class="c0"><span class="c2"></span></p><a id="t.c2c6d883f5e37799a305be16a9632715ec70f731"></a><a id="t.8"></a><table class="c11"><tr class="c13"><td class="c15" colspan="1" rowspan="1"><p class="c4"><span class="c1">var</span><span class="c3">&nbsp;sb = </span><span class="c1">new</span><span class="c3">&nbsp;StringBuilder(</span><span class="c10">&quot;Salut lume&quot;</span><span class="c3">);<br>sb.Append(</span><span class="c10">&quot;!&quot;</span><span class="c3">);<br>sb.Insert(</span><span class="c16">6</span><span class="c3">, </span><span class="c10">&quot;programare &quot;</span><span class="c3">);<br>Console.WriteLine(sb); </span><span class="c5">// Salut programare lume!</span><span class="c3"><br><br></span><span class="c5">// &icirc;nlocuim un cuv&acirc;nt</span><span class="c3"><br>sb.Replace(</span><span class="c10">&quot;lume&quot;</span><span class="c3">, </span><span class="c10">&quot;world&quot;</span><span class="c3">);<br>Console.WriteLine(sb); </span><span class="c5">// Salut programare world!</span><span class="c3"><br><br></span><span class="c5">// elimin&#259;m 11 caractere, &icirc;ncep&acirc;nd de la al 6-lea</span><span class="c3"><br>sb.Remove(</span><span class="c16">6</span><span class="c3">, </span><span class="c16">11</span><span class="c3">);<br>Console.WriteLine(sb); </span><span class="c5">// Salut world!</span><span class="c3"><br><br></span><span class="c5">// ob&#539;inem &#537;irul din obiectul StringBuilder</span><span class="c3"><br></span><span class="c1">string</span><span class="c3">&nbsp;text = sb.ToString();<br>Console.WriteLine(text); </span><span class="c5">// Salut world!</span></p></td></tr></table><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">C&acirc;nd s&#259; utiliz&#259;m clasa String &#537;i c&acirc;nd StringBuilder?</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">Microsoft recomand&#259; utilizarea clasei String &icirc;n urm&#259;toarele cazuri:</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">- Pentru un num&#259;r mic de opera&#539;ii &#537;i modific&#259;ri asupra &#537;irurilor</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">- La efectuarea unui num&#259;r fix de opera&#539;ii de unire. &Icirc;n acest caz, compilatorul poate uni toate opera&#539;iile de unire &icirc;ntr-una singur&#259;</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">- C&acirc;nd trebuie s&#259; efectu&#259;m opera&#539;ii de c&#259;utare extinse la construirea unui &#537;ir, de exemplu, IndexOf sau StartsWith. Clasa StringBuilder nu are astfel de metode.</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">Clasa StringBuilder este recomandat&#259; &icirc;n urm&#259;toarele cazuri:</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">- C&acirc;nd num&#259;rul de opera&#539;ii &#537;i modific&#259;ri asupra &#537;irurilor este necunoscut &icirc;n timpul rul&#259;rii programului</span></p><p class="c0"><span class="c2"></span></p><p class="c6"><span class="c2">- C&acirc;nd se preconizeaz&#259; c&#259; aplica&#539;ia va trebui s&#259; fac&#259; numeroase astfel de opera&#539;ii</span></p><p class="c0"><span class="c2"></span></p></body></html>