<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <link rel="stylesheet" type="text/css" href="/lessons/styles.css">
</head>

<body class="c16 doc-content">
    <h1 class="c14 c17">Sarcini de continuare.</h1>
    <p class="c11"><span class="c4"></span></p>
    <p class="c14"><span class="c5">Sarcinile de continuare sau</span><span class="c15">&nbsp;continuation
            tasks</span><span class="c4">&nbsp;permit definirea sarcinilor care se execut&#259; dup&#259; finalizarea
            altor sarcini. Astfel, putem lansa mai multe sarcini dup&#259; finalizarea uneia, putem stabili
            condi&#539;iile pentru lansarea acestora &#537;i putem transmite date din sarcina anterioar&#259; &icirc;n
            urm&#259;toarea.</span></p>
    <p class="c11"><span class="c4"></span></p>
    <p class="c14"><span class="c4">Sarcinile de continuare sunt similare cu metodele de callback, dar sunt de fapt
            sarcini obi&#537;nuite Task. S&#259; vedem un exemplu:</span></p>
    <p class="c11"><span class="c4"></span></p><a id="t.3f13fc5a741e0f53524aadf28569a5b867589b93"></a><a id="t.0"></a>
    <table class="c10">
        <tr class="c9">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c7"><span class="c0">Task task1 = </span><span class="c8">new</span><span
                        class="c0">&nbsp;Task(() =&gt;<br>{<br> &nbsp; &nbsp;Console.WriteLine(</span><span
                        class="c3">$&quot;Id-ul sarcinii: {Task.CurrentId}&quot;</span><span class="c0">);<br>});<br>
                        <br></span><span class="c2">// sarcin&#259; de continuare - task2 se execut&#259; dup&#259;
                        task1</span><span class="c0"><br>Task task2 = task1.ContinueWith(PrintTask);<br>
                        <br>task1.Start();<br> <br></span><span class="c2">// a&#537;tept&#259;m finalizarea celei de-a
                        doua sarcini</span><span class="c0"><br>task2.Wait();<br>Console.WriteLine(</span><span
                        class="c3">&quot;Sf&acirc;r&#537;itul metodei Main&quot;</span><span class="c0">);<br>
                        <br></span><span class="c8">void</span><span class="c0">&nbsp;</span><span
                        class="c13">PrintTask</span><span class="c0">(Task t)<br>{<br> &nbsp;
                        &nbsp;Console.WriteLine(</span><span class="c3">$&quot;Id-ul sarcinii:
                        {Task.CurrentId}&quot;</span><span class="c0">);<br> &nbsp; &nbsp;Console.WriteLine(</span><span
                        class="c3">$&quot;Id-ul sarcinii anterioare: {t.Id}&quot;</span><span class="c0">);<br> &nbsp;
                        &nbsp;Thread.Sleep(</span><span class="c1">3000</span><span class="c0">);<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c11"><span class="c4"></span></p>
    <p class="c14"><span class="c5">Prima sarcin&#259; este definit&#259; folosind o expresie lambda care
            afi&#537;eaz&#259; doar id-ul acestei sarcini. A doua sarcin&#259; - sarcina de continuare - este
            definit&#259; folosind metoda </span><span class="c15">ContinueWith</span><span class="c5">, care
            prime&#537;te ca parametru un delegat</span><span class="c5 c6">&nbsp;Action&lt;Task&gt;</span><span
            class="c4">. Astfel, metoda PrintTask, care este transmis&#259; &icirc;n apelul ContinueWith, trebuie
            s&#259; accepte un parametru de tip Task.</span></p>
    <p class="c11"><span class="c4"></span></p>
    <p class="c14"><span class="c4">Prin transmiterea &icirc;n metod&#259; a parametrului Task, putem accesa diverse
            propriet&#259;&#539;i ale sarcinii anterioare, cum ar fi id-ul acesteia.</span></p>
    <p class="c11"><span class="c4"></span></p>
    <p class="c14"><span class="c4">Dup&#259; finalizarea sarcinii task1, sarcina task2 va fi lansat&#259; imediat.
            Ie&#537;ire pe consol&#259; a programului:</span></p>
    <p class="c11"><span class="c4"></span></p><a id="t.983dec031f078196eeb0fc468238a44e7804e6c3"></a><a id="t.1"></a>
    <table class="c10">
        <tr class="c9">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c7"><span class="c0">Id-ul sarcinii: </span><span class="c1">1</span><span
                        class="c0"><br>Id-ul sarcinii: </span><span class="c1">2</span><span class="c0"><br>Id-ul
                        sarcinii anterioare: </span><span class="c1">1</span><span class="c0"><br>Sf&acirc;r&#537;itul
                        metodei Main</span></p>
            </td>
        </tr>
    </table>
    <p class="c11"><span class="c4"></span></p>
    <p class="c14"><span class="c4">De asemenea, putem transmite rezultatul specific al sarcinii anterioare:</span></p>
    <p class="c11"><span class="c4"></span></p><a id="t.51948646e22e198f976db75e11a6cef4175b6526"></a><a id="t.2"></a>
    <table class="c10">
        <tr class="c9">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c7"><span class="c0">Task&lt;</span><span class="c8">int</span><span class="c0">&gt; sumTask =
                    </span><span class="c8">new</span><span class="c0">&nbsp;Task&lt;</span><span
                        class="c8">int</span><span class="c0">&gt;(() =&gt; Sum(</span><span class="c1">4</span><span
                        class="c0">, </span><span class="c1">5</span><span class="c0">));<br> <br></span><span
                        class="c2">// sarcin&#259; de continuare</span><span class="c0"><br>Task printTask =
                        sumTask.ContinueWith(task =&gt; PrintResult(task.Result));<br> <br>sumTask.Start();<br>
                        <br></span><span class="c2">// a&#537;tept&#259;m finalizarea celei de-a doua
                        sarcini</span><span class="c0"><br>printTask.Wait();<br>Console.WriteLine(</span><span
                        class="c3">&quot;Sf&acirc;r&#537;itul metodei Main&quot;</span><span class="c0">);<br>
                        <br></span><span class="c8">int</span><span class="c0">&nbsp;</span><span
                        class="c13">Sum</span><span class="c0">(</span><span class="c8">int</span><span
                        class="c0">&nbsp;a, </span><span class="c8">int</span><span class="c0">&nbsp;b) =&gt; a +
                        b;<br></span><span class="c8">void</span><span class="c0">&nbsp;</span><span
                        class="c13">PrintResult</span><span class="c0">(</span><span class="c8">int</span><span
                        class="c0">&nbsp;sum) =&gt; Console.WriteLine(</span><span class="c3">$&quot;Suma:
                        {sum}&quot;</span><span class="c0">);</span></p>
            </td>
        </tr>
    </table>
    <p class="c11"><span class="c4"></span></p>
    <p class="c14"><span class="c5">&Icirc;n acest caz, sarcina sumTask execut&#259; metoda </span><span
            class="c5 c6">Sum </span><span class="c4">&#537;i returneaz&#259; rezultatul acesteia. Sarcina printTask
            este sarcina de continuare, care se execut&#259; imediat dup&#259; sumTask &#537;i prime&#537;te rezultatul
            acesteia. Astfel, &icirc;n apelul:</span></p>
    <p class="c11"><span class="c4"></span></p><a id="t.f5a0ff1165b93acad0216dcb6067560e3b0a80a0"></a><a id="t.3"></a>
    <table class="c10">
        <tr class="c9">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c7"><span class="c0">Task printTask = sumTask.ContinueWith(task =&gt;
                        PrintResult(task.Result));</span></p>
            </td>
        </tr>
    </table>
    <p class="c11"><span class="c4"></span></p>
    <p class="c14"><span class="c4">Parametrul task din expresia lambda reprezint&#259; efectiv sarcina sumTask, din
            care extragem rezultatul.</span></p>
    <p class="c11"><span class="c4"></span></p>
    <p class="c14"><span class="c4">&Icirc;n mod similar, putem construi un lan&#539; de sarcini care se execut&#259;
            secven&#539;ial:</span></p>
    <p class="c11"><span class="c4"></span></p><a id="t.129a349e3e4a0f0bb37b3170b0912d345b94b94d"></a><a id="t.4"></a>
    <table class="c10">
        <tr class="c9">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c7"><span class="c0">Task task1 = </span><span class="c8">new</span><span
                        class="c0">&nbsp;Task(() =&gt; Console.WriteLine(</span><span class="c3">$&quot;Sarcina
                        curent&#259;: {Task.CurrentId}&quot;</span><span class="c0">));<br> <br></span><span
                        class="c2">// sarcin&#259; de continuare</span><span class="c0"><br>Task task2 =
                        task1.ContinueWith(t =&gt;<br> &nbsp; &nbsp;Console.WriteLine(</span><span
                        class="c3">$&quot;Sarcina curent&#259;: {Task.CurrentId} &nbsp;Sarcina anterioar&#259;:
                        {t.Id}&quot;</span><span class="c0">));<br> <br>Task task3 = task2.ContinueWith(t =&gt;<br>
                        &nbsp; &nbsp;Console.WriteLine(</span><span class="c3">$&quot;Sarcina curent&#259;:
                        {Task.CurrentId} &nbsp;Sarcina anterioar&#259;: {t.Id}&quot;</span><span class="c0">));<br>
                        <br>Task task4 = task3.ContinueWith(t =&gt;<br> &nbsp; &nbsp;Console.WriteLine(</span><span
                        class="c3">$&quot;Sarcina curent&#259;: {Task.CurrentId} &nbsp;Sarcina anterioar&#259;:
                        {t.Id}&quot;</span><span class="c0">));<br> <br>task1.Start();<br> <br>task4.Wait(); &nbsp;
                    </span><span class="c2">// a&#537;tept&#259;m finalizarea ultimei sarcini</span><span
                        class="c0"><br>Console.WriteLine(</span><span class="c3">&quot;Sf&acirc;r&#537;itul metodei
                        Main&quot;</span><span class="c0">);</span></p>
            </td>
        </tr>
    </table>
    <p class="c11"><span class="c4"></span></p>
    <p class="c14"><span class="c4">Aici, sarcinile task1, task2, task3 &#537;i task4 se execut&#259; una dup&#259;
            alta. Ie&#537;ire pe consol&#259; a programului:</span></p>
    <p class="c11"><span class="c4"></span></p><a id="t.6716d2a3e1011b7847d6334667be0976d2ae0819"></a><a id="t.5"></a>
    <table class="c10">
        <tr class="c9">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c7"><span class="c0">Sarcina curent&#259;: </span><span class="c1">1</span><span
                        class="c0"><br>Sarcina curent&#259;: </span><span class="c1">2</span><span class="c0">&nbsp;
                        Sarcina anterioar&#259;: </span><span class="c1">1</span><span class="c0"><br>Sarcina
                        curent&#259;: </span><span class="c1">3</span><span class="c0">&nbsp; Sarcina anterioar&#259;:
                    </span><span class="c1">2</span><span class="c0"><br>Sarcina curent&#259;: </span><span
                        class="c1">4</span><span class="c0">&nbsp; Sarcina anterioar&#259;: </span><span
                        class="c1">3</span><span class="c0"><br>Sf&acirc;r&#537;itul metodei Main</span></p>
            </td>
        </tr>
    </table>
    <p class="c11"><span class="c4"></span></p>
    <p class="c11"><span class="c4"></span></p>
</body>

</html>