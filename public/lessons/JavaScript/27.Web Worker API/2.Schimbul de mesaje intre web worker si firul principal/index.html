<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <link rel="stylesheet" type="text/css" href="/lessons/styles.css">
</head>

<body class="c19 doc-content">
    <h1 class="c0 c10">Schimbul de mesaje între web worker și firul principal. </h1>
    <p class="c0 c9"><span class="c5"></span></p>
    <p class="c0"><span class="c6">Firul principal &#537;i web workerii lansa&#539;i &icirc;n acesta pot
            interac&#539;iona prin intermediul mesajelor. Pentru a trimite un mesaj web workerului, se apeleaz&#259;
            metoda</span><span class="c8">&nbsp;postMessage()</span><span class="c6">&nbsp;a obiectului </span><span
            class="c8">Worker</span><span class="c4">:</span></p>
    <p class="c0 c9"><span class="c4"></span></p><a id="t.a4a603e29ec97597d9c7b58a272efac245d6809e"></a><a id="t.0"></a>
    <table class="c12">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c7"><span class="c1">postMessage(message)<br>postMessage(message,
                        options)<br>postMessage(message, transfer)</span></p>
            </td>
        </tr>
    </table>
    <p class="c0 c9"><span class="c4"></span></p>
    <p class="c0"><span class="c6">Ca prim &#537;i obligatoriu parametru </span><span class="c6 c17">message
        </span><span class="c6">se transmite mesajul care urmeaz&#259; s&#259; fie trimis. Ca mesaj poate servi orice
            valoare, de exemplu, un &#537;ir de caractere sau un obiect. La transmitere, web workerul prime&#537;te o
        </span><span class="c8">copie </span><span class="c4">a acestor date.</span></p>
    <p class="c0 c9"><span class="c4"></span></p>
    <p class="c0"><span class="c6">Parametrul suplimentar, op&#539;ional, </span><span class="c6 c17">options
        </span><span class="c6">reprezint&#259; un obiect de configurare care, prin proprietatea </span><span
            class="c6 c17">transfer</span><span class="c6">, stabile&#537;te datele suplimentar transmise. Acelea&#537;i
            date sunt transmise &icirc;n a treia versiune a func&#539;iei prin parametrul </span><span
            class="c6 c17">transfer</span><span class="c4">. La transmitere, posesiunea acestor date trece la web
            worker, iar codul principal nu mai poate utiliza aceste date.</span></p>
    <p class="c0 c9"><span class="c4"></span></p>
    <p class="c0"><span class="c6">Pentru a primi mesajul pe partea de web worker, este necesar s&#259; se
            &icirc;nregistreze o func&#539;ie-handler pentru evenimentul de primire a mesajului - evenimentul
        </span><span class="c8">message</span><span class="c6">. De exemplu, acest lucru se poate face prin proprietatea
        </span><span class="c8">onmessage </span><span class="c4">a web workerului.</span></p>
    <p class="c0 c9"><span class="c4"></span></p><a id="t.999604240604ea26d5b931678a3cc8f584e38a21"></a><a id="t.1"></a>
    <table class="c12">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c7"><span class="c6 c15">// stabilirea handlerului de eveniment prin
                        addEventListener</span><span class="c1"><br>worker.addEventListener(</span><span
                        class="c6 c13">&quot;message&quot;</span><span class="c1">, (event) =&gt; { </span><span
                        class="c6 c14">console</span><span class="c1">.log(event.data);});<br><br></span><span
                        class="c6 c15">// stabilirea handlerului de eveniment prin proprietatea onmessage</span><span
                        class="c1"><br>worker.onmessage = (event) =&gt; {</span><span class="c6 c14">console</span><span
                        class="c1">.log(event.data);};</span></p>
            </td>
        </tr>
    </table>
    <p class="c0 c9"><span class="c4"></span></p>
    <p class="c0"><span class="c6">&Icirc;n handlerul evenimentului este transmis un obiect MouseEvent, de la care prin
            proprietatea </span><span class="c8">data </span><span class="c4">se pot ob&#539;ine datele
            transmise.</span></p>
    <p class="c0 c9"><span class="c4"></span></p>
    <p class="c0"><span class="c6">Similar, pentru a trimite din web worker un mesaj &icirc;n firul principal, se
            apeleaz&#259; metoda </span><span class="c8">postMessage()</span><span class="c6">&nbsp;a web workerului.
            &Icirc;n interiorul firului principal, se poate accesa mesajul &icirc;n handlerul evenimentului </span><span
            class="c5">message:</span></p>
    <p class="c0 c9"><span class="c4"></span></p>
    <p class="c0"><span class="c6">S&#259; definim urm&#259;torul script</span><span
            class="c8">&nbsp;worker.js</span><span class="c4">:</span></p>
    <p class="c0 c9"><span class="c4"></span></p><a id="t.e027a62a6079495f324aecea3ef8ae3664b70c78"></a><a id="t.2"></a>
    <table class="c12">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c7"><span class="c6 c15">// ascult&#259;m evenimentul message</span><span
                        class="c1"><br>self.addEventListener(</span><span class="c6 c13">&quot;message&quot;</span><span
                        class="c1">, (event) =&gt; { <br> &nbsp; &nbsp;</span><span class="c6 c15">// afi&#537;&#259;m
                        datele primite din firul principal</span><span class="c1"><br> &nbsp; &nbsp;</span><span
                        class="c6 c14">console</span><span class="c1">.log(</span><span class="c6 c13">`[Worker] Message
                        received: ${event.data}`</span><span class="c1">);<br> &nbsp; &nbsp;</span><span
                        class="c6 c15">// trimitem &icirc;napoi firului principal un anumit mesaj</span><span
                        class="c1"><br> &nbsp; &nbsp;self.postMessage(</span><span class="c6 c13">&quot;Hello main
                        thread&quot;</span><span class="c1">);<br>});</span></p>
            </td>
        </tr>
    </table>
    <p class="c0 c9"><span class="c4"></span></p>
    <p class="c0"><span class="c6">Cu ajutorul cuv&acirc;ntului </span><span class="c8">self </span><span
            class="c6">ob&#539;inem acces la obiectul web workerului &#537;i stabilim pentru el un handler pentru
            evenimentul &quot;message&quot;. &Icirc;n acest handler primim datele transmise din firul principal &#537;i
            cu ajutorul apelului</span><span class="c6 c17">&nbsp;self.postMessage</span><span class="c4">&nbsp;trimitem
            firului principal un anumit r&#259;spuns.</span></p>
    <p class="c0 c9"><span class="c4"></span></p>
    <p class="c0"><span class="c6">&Icirc;n procesul de lucru al web workerului poate s&#259; apar&#259; o eroare,
            &icirc;n acest caz putem s&#259; proces&#259;m evenimentul </span><span class="c8">error </span><span
            class="c4">al obiectului Worker.</span></p>
    <p class="c0 c9"><span class="c4"></span></p>
    <p class="c0"><span class="c4">&#536;i s&#259; definim urm&#259;toarea pagin&#259; web:</span></p>
    <p class="c0 c9"><span class="c4"></span></p><a id="t.28563487c90bf21a19dcfb160bc82e2492184ce9"></a><a id="t.3"></a>
    <table class="c12">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c7"><span class="c1">&lt;!DOCTYPE html&gt;<br></span><span class="c6 c11">&lt;</span><span
                        class="c3">html</span><span class="c6 c11">&gt;</span><span class="c1"><br></span><span
                        class="c6 c11">&lt;</span><span class="c3">head</span><span class="c6 c11">&gt;</span><span
                        class="c1"><br> &nbsp; &nbsp;</span><span class="c6 c11">&lt;</span><span
                        class="c3">meta</span><span class="c6 c11">&nbsp;charset=</span><span
                        class="c6 c13">&quot;utf-8&quot;</span><span class="c6 c11">&nbsp;/&gt;</span><span
                        class="c1"><br> &nbsp; &nbsp;</span><span class="c6 c11">&lt;</span><span
                        class="c3">title</span><span class="c6 c11">&gt;</span><span class="c1">FDC.COM</span><span
                        class="c6 c11">&lt;/</span><span class="c3">title</span><span class="c6 c11">&gt;</span><span
                        class="c1"><br></span><span class="c6 c11">&lt;/</span><span class="c3">head</span><span
                        class="c6 c11">&gt;</span><span class="c1"><br></span><span class="c6 c11">&lt;</span><span
                        class="c3">body</span><span class="c6 c11">&gt;</span><span class="c1"><br></span><span
                        class="c6 c11">&lt;</span><span class="c3">script</span><span class="c6 c11">&gt;</span><span
                        class="c1"><br></span><span class="c6 c16">const</span><span class="c1">&nbsp;worker =
                    </span><span class="c6 c16">new</span><span class="c1">&nbsp;Worker(</span><span
                        class="c6 c13">&quot;worker.js&quot;</span><span class="c1">);<br> <br></span><span
                        class="c6 c16">const</span><span class="c1">&nbsp;message = </span><span
                        class="c6 c13">&quot;Hello web worker&quot;</span><span class="c1">;<br></span><span
                        class="c6 c14">console</span><span class="c1">.log(</span><span class="c6 c13">`[Main thread]
                        Send message: ${message}`</span><span class="c1">);<br></span><span class="c6 c15">// trimitem
                        web workerului un mesaj</span><span class="c1"><br>worker.postMessage(message); <br></span><span
                        class="c6 c15">// primim mesaje de la web worker</span><span
                        class="c1"><br>worker.addEventListener(</span><span
                        class="c6 c13">&quot;message&quot;</span><span class="c1">, (e) =&gt; </span><span
                        class="c6 c14">console</span><span class="c1">.log(</span><span class="c6 c13">`[Main thread]
                        Response from worker: ${e.data}`</span><span class="c1">));<br></span><span class="c6 c15">//
                        &icirc;n cazul unei erori</span><span class="c1"><br>worker.addEventListener(</span><span
                        class="c6 c13">&quot;error&quot;</span><span class="c1">, (e) =&gt; </span><span
                        class="c6 c14">console</span><span class="c1">.log(</span><span class="c6 c13">&quot;Error
                        occurred&quot;</span><span class="c1">));<br></span><span class="c6 c11">&lt;/</span><span
                        class="c3">script</span><span class="c6 c11">&gt;</span><span class="c1"><br></span><span
                        class="c6 c11">&lt;/</span><span class="c3">body</span><span class="c6 c11">&gt;</span><span
                        class="c1"><br></span><span class="c6 c11">&lt;/</span><span class="c3">html</span><span
                        class="c6 c11">&gt;</span></p>
            </td>
        </tr>
    </table>
    <p class="c0 c9"><span class="c4"></span></p>
    <p class="c0"><span class="c6">Aici, &icirc;n mod similar, cu ajutorul apelului</span><span
            class="c6 c17">&nbsp;worker.postMessage()</span><span class="c4">&nbsp;trimitem web workerului un mesaj
            &#537;i, de asemenea, cu ajutorul handlerului evenimentului &quot;message&quot; primim
            r&#259;spunsul.</span></p>
    <p class="c0 c9"><span class="c4"></span></p>
    <p class="c0"><span class="c4">Rezultatul lucr&#259;rii:</span></p>
    <p class="c0 c9"><span class="c4"></span></p>
    <p class="c0"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 618.00px; height: 629.00px;"><img
                alt="" src="images/image1.png"
                style="width: 618.00px; height: 629.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
                title=""></span></p>
</body>

</html>