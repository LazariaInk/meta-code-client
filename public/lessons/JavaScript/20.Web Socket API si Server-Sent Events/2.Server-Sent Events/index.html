<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <style type="text/css">
        @import url(https://themes.googleusercontent.com/fonts/css?kit=iMc4-4exjgqA-toZgqqJBf35jAjY-31lSKWZb9Fa77M);

        ol {
            margin: 0;
            padding: 0
        }

        table td,
        table th {
            padding: 0
        }

        .c2 {
            border-right-style: solid;
            padding: 5pt 5pt 5pt 5pt;
            border-bottom-color: #000000;
            border-top-width: 0pt;
            border-right-width: 0pt;
            border-left-color: #000000;
            vertical-align: top;
            border-right-color: #000000;
            border-left-width: 0pt;
            border-top-style: solid;
            background-color: #333333;
            border-left-style: solid;
            border-bottom-width: 0pt;
            width: 468pt;
            border-top-color: #000000;
            border-bottom-style: solid
        }

        .c7 {
            padding-top: 0pt;
            padding-bottom: 0pt;
            line-height: 1.5;
            orphans: 2;
            widows: 2;
            text-align: left;
            height: 11pt
        }

        .c1 {
            color: #000000;
            font-weight: 400;
            text-decoration: none;
            vertical-align: baseline;
            font-size: 12pt;
            font-family: "Open Sans";
            font-style: normal
        }

        .c0 {
            color: #000000;
            font-weight: 700;
            text-decoration: none;
            vertical-align: baseline;
            font-size: 15pt;
            font-family: "Open Sans";
            font-style: normal
        }

        .c8 {
            padding-top: 0pt;
            padding-bottom: 0pt;
            line-height: 1.5;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        .c6 {
            background-color: #333333;
            font-size: 12pt;
            font-family: "Open Sans";
            color: #62c8f3;
            font-weight: 400
        }

        .c3 {
            background-color: #333333;
            font-size: 12pt;
            font-family: "Open Sans";
            color: #fcc28c;
            font-weight: 400
        }

        .c4 {
            background-color: #333333;
            font-size: 12pt;
            font-family: "Open Sans";
            color: #a2fca2;
            font-weight: 400
        }

        .c13 {
            background-color: #333333;
            font-size: 12pt;
            font-family: "Open Sans";
            color: #ffffaa;
            font-weight: 400
        }

        .c5 {
            background-color: #333333;
            font-size: 12pt;
            font-family: "Open Sans";
            color: #ffffff;
            font-weight: 400
        }

        .c9 {
            font-size: 12pt;
            font-family: "Open Sans";
            font-style: italic;
            font-weight: 400
        }

        .c11 {
            padding-top: 0pt;
            padding-bottom: 0pt;
            line-height: 1.5;
            text-align: left
        }

        .c10 {
            border-spacing: 0;
            border-collapse: collapse;
            margin-right: auto
        }

        .c19 {
            color: #000000;
            text-decoration: none;
            vertical-align: baseline;
            font-style: normal
        }

        .c20 {
            color: #000000;
            text-decoration: none;
            vertical-align: baseline
        }

        .c12 {
            font-size: 12pt;
            font-family: "Open Sans";
            font-weight: 700
        }

        .c21 {
            font-weight: 700;
            font-size: 27pt;
            font-family: "Open Sans"
        }

        .c14 {
            font-size: 12pt;
            font-family: "Open Sans";
            font-weight: 400
        }

        .c22 {
            background-color: #ffffff;
            max-width: 468pt;
            padding: 72pt 72pt 72pt 72pt
        }

        .c17 {
            background-color: #333333;
            color: #d36363
        }

        .c15 {
            background-color: #333333;
            color: #62c8f3
        }

        .c16 {
            background-color: #333333;
            color: #888888
        }

        .c18 {
            height: 0pt
        }

        .title {
            padding-top: 0pt;
            color: #000000;
            font-size: 26pt;
            padding-bottom: 3pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        .subtitle {
            padding-top: 0pt;
            color: #666666;
            font-size: 15pt;
            padding-bottom: 16pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        li {
            color: #000000;
            font-size: 11pt;
            font-family: "Arial"
        }

        p {
            margin: 0;
            color: #000000;
            font-size: 11pt;
            font-family: "Arial"
        }

        h1 {
            padding-top: 20pt;
            color: #000000;
            font-size: 20pt;
            padding-bottom: 6pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        h2 {
            padding-top: 18pt;
            color: #000000;
            font-size: 16pt;
            padding-bottom: 6pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        h3 {
            padding-top: 16pt;
            color: #434343;
            font-size: 14pt;
            padding-bottom: 4pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        h4 {
            padding-top: 14pt;
            color: #666666;
            font-size: 12pt;
            padding-bottom: 4pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        h5 {
            padding-top: 12pt;
            color: #666666;
            font-size: 11pt;
            padding-bottom: 4pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        h6 {
            padding-top: 12pt;
            color: #666666;
            font-size: 11pt;
            padding-bottom: 4pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            font-style: italic;
            orphans: 2;
            widows: 2;
            text-align: left
        }
    </style>
</head>

<body class="c22 doc-content">
    <h1 class="c8 c19 c21">Server-Sent Events. </h1>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c12">Server-Sent Events</span><span class="c14">&nbsp;sau pe scurt </span><span
            class="c12">SSE </span><span class="c14">reprezint&#259; o alt&#259; tehnologie de interac&#539;iune
            &icirc;ntre client &#537;i server, care permite serverului s&#259; trimit&#259; mesaje clientului. Este de
            remarcat faptul c&#259;, spre deosebire de WebSockets, comunica&#539;ia prin </span><span
            class="c9">Server-Sent Events</span><span class="c14">&nbsp;este unidirec&#539;ional&#259;: mesajele sunt
            livrate &icirc;ntr-o singur&#259; direc&#539;ie - de la server la client (de exemplu, c&#259;tre browserul
            web al utilizatorului). Acest lucru le face o op&#539;iune excelent&#259; c&acirc;nd nu este necesar s&#259;
            se trimit&#259; date de la client la server. De exemplu, </span><span class="c9">Server-Sent
            Events</span><span class="c1">&nbsp;pot fi utilizate pentru gestionarea unor lucruri precum actualizarea
            statusului &icirc;n re&#539;elele sociale, fluxurile de &#537;tiri sau trimiterea de date pentru stocare pe
            partea de client.</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">Pe o pagin&#259; web, &icirc;n codul JavaScript pentru interac&#539;iunea cu
            serverul se utilizeaz&#259; interfa&#539;a </span><span class="c12">EventSource</span><span class="c14">.
            Obiectul </span><span class="c12">EventSource </span><span class="c1">reprezint&#259;, &icirc;n
            esen&#539;&#259;, un server care genereaz&#259; evenimente sau trimite mesaje. Pentru crearea unui obiect
            EventSource se folose&#537;te constructorul:</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.2862583e8aef3df0ff833e1e31f7d4e4e2e17699"></a><a id="t.0"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c3">new</span><span class="c5">&nbsp;EventSource(url, options)</span></p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">Ca prim parametru obligatoriu &icirc;n constructorul </span><span
            class="c9">EventSource </span><span class="c1">se transmite adresa URL a resursei pe server:</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.a81f79c5e2cf8fc6b4602443b7f79746cddd4e0f"></a><a id="t.1"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c3">const</span><span class="c5">&nbsp;evtSource = </span><span
                        class="c3">new</span><span class="c5">&nbsp;EventSource(</span><span
                        class="c4">&quot;/events&quot;</span><span class="c5">);</span></p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">Op&#539;ional, se poate transmite un parametru neobligatoriu care configureaz&#259;
            obiectul EventSource. Acest parametru reprezint&#259; un obiect cu o singur&#259; proprietate </span><span
            class="c12">withCredentials</span><span class="c14">. Aceast&#259; proprietate indic&#259; dac&#259; trebuie
            incluse antetele CORS pentru interac&#539;iunea cross-domain. Implicit, este </span><span
            class="c9">false</span><span class="c1">.</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c0">Evenimente EventSource.</span></p>
    <p class="c7"><span class="c19 c12"></span></p>
    <p class="c8"><span class="c14">Pentru gestionarea st&#259;rii conexiunii &icirc;n </span><span
            class="c12">EventSource </span><span class="c1">sunt definite o serie de evenimente:</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">- </span><span class="c12">open</span><span class="c14">: generat la stabilirea
            conexiunii. Pentru setarea handler-ului de evenimente se poate folosi proprietatea </span><span
            class="c12">onopen</span><span class="c1">.</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">- </span><span class="c12">error</span><span class="c14">: generat la apari&#539;ia
            unei erori &icirc;n timpul stabilirii conexiunii. Pentru setarea handler-ului de evenimente se poate folosi
            proprietatea </span><span class="c12">onerror</span><span class="c1">.</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">- </span><span class="c12">message</span><span class="c14">: generat la primirea
            datelor de la server. Pentru setarea handler-ului de evenimente se poate folosi proprietatea </span><span
            class="c12">onmessage</span><span class="c1">.</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">Handler-ii acestor evenimente primesc ca parametru un obiect standard </span><span
            class="c9">Event</span><span class="c1">. Exemplu de setare a handler-ilor de evenimente:</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.43129174d0b26871b6584c3baef7362c97cc02d4"></a><a id="t.2"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c3">const</span><span class="c5">&nbsp;evtSource = </span><span
                        class="c3">new</span><span class="c5">&nbsp;EventSource(</span><span
                        class="c4">&quot;/events&quot;</span><span class="c5">);<br><br></span><span class="c14 c16">//
                        folosind addEventListener</span><span class="c5"><br>evtSource.addEventListener(</span><span
                        class="c4">&quot;open&quot;</span><span class="c5">, () =&gt; {<br> &nbsp;</span><span
                        class="c13">console</span><span class="c5">.log(</span><span class="c4">&quot;conexiune
                        deschis&#259;&quot;</span><span class="c5">);<br>});<br>evtSource.addEventListener(</span><span
                        class="c4">&quot;error&quot;</span><span class="c5">, () =&gt; {<br> &nbsp;</span><span
                        class="c13">console</span><span class="c5">.log(</span><span
                        class="c4">&quot;Eroare&quot;</span><span class="c5">);<br>});<br><br></span><span
                        class="c14 c16">// folosind propriet&#259;&#539;i</span><span class="c5"><br>evtSource.onopen =
                        () =&gt; {<br> &nbsp;</span><span class="c13">console</span><span class="c5">.log(</span><span
                        class="c4">&quot;conexiune deschis&#259;&quot;</span><span
                        class="c5">);<br>};<br>evtSource.onerror = () =&gt; {<br> &nbsp;</span><span
                        class="c13">console</span><span class="c5">.log(</span><span
                        class="c4">&quot;Eroare&quot;</span><span class="c5">);<br>};</span></p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c0">Recep&#539;ia datelor.</span></p>
    <p class="c7"><span class="c12 c19"></span></p>
    <p class="c8"><span class="c14">C&acirc;nd vin date de la server, la obiectul WebSocket se declan&#537;eaz&#259;
            evenimentul </span><span class="c12">message</span><span class="c14">, pentru setarea handler-ului
            c&#259;ruia se poate folosi proprietatea </span><span class="c12">onmessage </span><span class="c14">sau
            metoda </span><span class="c9 c20">addEventListener().</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">&Icirc;n handler-ul evenimentului </span><span class="c12">message </span><span
            class="c14">se transmite un obiect de tip </span><span class="c12">MessageEvent</span><span class="c1">.
            Acest obiect ofer&#259; o serie de propriet&#259;&#539;i care permit extragerea datelor r&#259;spunsului
            serverului:</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">- </span><span class="c12">data</span><span class="c1">: returneaz&#259; datele
            primite</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">- </span><span class="c12">origin</span><span class="c1">: stocheaz&#259; adresa
            expeditorului</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">- </span><span class="c12">lastEventId</span><span class="c1">: stocheaz&#259;
            identificatorul unic al ultimului eveniment sub form&#259; de string.</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">- </span><span class="c12">source</span><span class="c14">: returneaz&#259; un
            obiect </span><span class="c9">MessageEventSource</span><span class="c1">, care poate fi un obiect
            WindowProxy, MessagePort sau ServiceWorker &#537;i care reprezint&#259; expeditorul datelor primite.</span>
    </p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">- </span><span class="c12">ports</span><span class="c14">: returneaz&#259; un array
            de obiecte </span><span class="c9">MessagePort</span><span class="c1">, care stocheaz&#259; porturile
            folosite pentru trimitere</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c1">Exemplu de recep&#539;ie a datelor:</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.437e3677a123931e766ca013da828c0ed445df4d"></a><a id="t.3"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c3">const</span><span class="c5">&nbsp;evtSource = </span><span
                        class="c3">new</span><span class="c5">&nbsp;EventSource(</span><span
                        class="c4">&quot;/events&quot;</span><span class="c5">);<br>evtSource.onmessage = (event) =&gt;
                        { <br> &nbsp; &nbsp;</span><span class="c13">console</span><span class="c5">.log(event.data);
                        &nbsp; &nbsp;</span><span class="c14 c16">// afi&#537;&#259;m datele trimise pe
                        consol&#259;</span><span class="c5"><br>};</span></p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c0">&Icirc;nchiderea conexiunii.</span></p>
    <p class="c7"><span class="c19 c12"></span></p>
    <p class="c8"><span class="c14">Pentru &icirc;nchiderea conexiunii se folose&#537;te metoda</span><span
            class="c12">&nbsp;close()</span><span class="c1">:</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.bd089513259ab2f0e56764e109dc79a816141be2"></a><a id="t.4"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c5">evtSource.close();</span></p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c0">Exemplu de interac&#539;iune &icirc;ntre client &#537;i server cu Server-Sent
            Events.</span></p>
    <p class="c7"><span class="c19 c12"></span></p>
    <p class="c8"><span class="c1">S&#259; examin&#259;m un exemplu mic de interac&#539;iune &icirc;ntre client &#537;i
            server folosind Server-Sent Events. Ca client va ac&#539;iona codul JavaScript pe o pagin&#259; web. Iar ca
            server vom folosi Node.js.</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">Mai &icirc;nt&acirc;i, definim codul pe server. Pentru aceasta, cre&#259;m
            fi&#537;ierul</span><span class="c12">&nbsp;server.js</span><span class="c1">&nbsp;cu urm&#259;torul
            cod:</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.be4a8ac71d7008edda137a831438205fea0fb40c"></a><a id="t.5"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c3">const</span><span class="c5">&nbsp;http = </span><span
                        class="c13">require</span><span class="c5">(</span><span class="c4">&quot;http&quot;</span><span
                        class="c5">);<br></span><span class="c3">const</span><span class="c5">&nbsp;fs = </span><span
                        class="c13">require</span><span class="c5">(</span><span class="c4">&quot;fs&quot;</span><span
                        class="c5">);<br><br></span><span class="c14 c16">// date pentru trimitere la client</span><span
                        class="c5"><br></span><span class="c3">const</span><span class="c5">&nbsp;messages =
                        [</span><span class="c4">&quot;Salut&quot;</span><span class="c5">, </span><span
                        class="c4">&quot;Ce faci?&quot;</span><span class="c5">, </span><span class="c4">&quot;Ce
                        faci?&quot;</span><span class="c5">, </span><span class="c4">&quot;Dormi?&quot;</span><span
                        class="c5">, </span><span class="c4">&quot;Pa&quot;</span><span
                        class="c5">];<br>http.createServer(</span><span class="c3">function</span><span
                        class="c5">(request, response){<br> &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp;</span><span
                        class="c3">if</span><span class="c5">(request.url == </span><span
                        class="c4">&quot;/events&quot;</span><span class="c5">){ &nbsp; </span><span class="c14 c16">//
                        dac&#259; este o cerere SSE</span><span class="c5"><br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span
                        class="c3">if</span><span class="c5">&nbsp;(request.headers.accept &amp;&amp;
                        request.headers.accept === </span><span class="c4">&quot;text/event-stream&quot;</span><span
                        class="c5">) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sendEvent(response);<br> &nbsp;
                        &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c3">else</span><span
                        class="c5">{<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;response.writeHead(</span><span
                        class="c14 c17">400</span><span class="c5">);<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        &nbsp;response.end(</span><span class="c4">&quot;Cerere gre&#537;it&#259;&quot;</span><span
                        class="c5">);<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span
                        class="c3">else</span><span class="c5">{ &nbsp; </span><span class="c14 c16">// &icirc;n alte
                        cazuri trimitem pagina index.html</span><span class="c5"><br> &nbsp; &nbsp; &nbsp;
                        &nbsp;fs.readFile(</span><span class="c4">&quot;index.html&quot;</span><span class="c5">, (_,
                        data) =&gt; response.end(data));<br> &nbsp; &nbsp;}<br>}).listen(</span><span
                        class="c14 c17">3000</span><span class="c5">, ()=&gt;</span><span
                        class="c13">console</span><span class="c5">.log(</span><span class="c4">&quot;Serverul a fost
                        lansat pe adresa http://localhost:3000&quot;</span><span class="c5">));<br><br></span><span
                        class="c14 c16">// trimitem mesaj clientului</span><span class="c5"><br></span><span
                        class="c3">function</span><span class="c5">&nbsp;</span><span class="c13">sendEvent</span><span
                        class="c5">(response) { <br> &nbsp; &nbsp;</span><span class="c14 c16">// form&#259;m
                        antetele</span><span class="c5"><br> &nbsp; &nbsp;response.writeHead(</span><span
                        class="c14 c17">200</span><span class="c5">, { &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp;
                        &nbsp;</span><span class="c4">&quot;Content-Type&quot;</span><span class="c5">: </span><span
                        class="c4">&quot;text/event-stream&quot;</span><span class="c5">, &nbsp; &nbsp;<br> &nbsp;
                        &nbsp; &nbsp; &nbsp;</span><span class="c4">&quot;Cache-Control&quot;</span><span class="c5">:
                    </span><span class="c4">&quot;no-cache&quot;</span><span class="c5">, &nbsp; &nbsp;<br> &nbsp;
                        &nbsp; &nbsp; &nbsp;</span><span class="c4">&quot;Connection&quot;</span><span class="c5">:
                    </span><span class="c4">&quot;keep-alive&quot;</span><span class="c5">&nbsp;<br> &nbsp;
                        &nbsp;});<br> &nbsp; &nbsp;</span><span class="c3">const</span><span class="c5">&nbsp;id =
                        (</span><span class="c3">new</span><span class="c5">&nbsp;</span><span
                        class="c13">Date</span><span class="c5">()).toLocaleTimeString(); &nbsp;</span><span
                        class="c14 c16">// definim identificatorul ultimului eveniment</span><span class="c5"><br>
                        &nbsp; &nbsp;</span><span class="c14 c16">// la fiecare 5 secunde trimitem un mesaj</span><span
                        class="c5"><br> &nbsp; &nbsp;setInterval(() =&gt; { createServerSendEvent(response, id); },
                    </span><span class="c14 c17">5000</span><span class="c5">);<br>}<br></span><span class="c14 c16">//
                        trimitem date clientului</span><span class="c5"><br></span><span class="c3">function</span><span
                        class="c5">&nbsp;</span><span class="c13">createServerSendEvent</span><span
                        class="c5">(response, id) {<br> &nbsp; &nbsp;</span><span class="c14 c16">// gener&#259;m un
                        num&#259;r aleatoriu - index pentru array-ul messages</span><span class="c5"><br> &nbsp;
                        &nbsp;</span><span class="c3">const</span><span class="c5">&nbsp;index = </span><span
                        class="c13">Math</span><span class="c5">.floor(</span><span class="c13">Math</span><span
                        class="c5">.random() * messages.length);<br> &nbsp; &nbsp;</span><span
                        class="c3">const</span><span class="c5">&nbsp;message = messages[index];<br> &nbsp;
                        &nbsp;response.write(</span><span class="c4">&quot;id: &quot;</span><span class="c5">&nbsp;+ id
                        + </span><span class="c4">&quot;\n&quot;</span><span class="c5">); &nbsp;<br> &nbsp;
                        &nbsp;response.write(</span><span class="c4">&quot;data: &quot;</span><span class="c5">&nbsp;+
                        message + </span><span class="c4">&quot;\n\n&quot;</span><span class="c5">);<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c1">S&#259; trecem pe scurt prin cod. &Icirc;n primul r&acirc;nd, se conecteaz&#259;
            pachetele cu func&#539;ionalitatea pe care inten&#539;ion&#259;m s&#259; o utiliz&#259;m:</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.a197e9eda088251a940ba1466b96a1fd85a9e359"></a><a id="t.6"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c3">const</span><span class="c5">&nbsp;http = </span><span
                        class="c13">require</span><span class="c5">(</span><span class="c4">&quot;http&quot;</span><span
                        class="c5">); &nbsp; </span><span class="c14 c16">// pentru procesarea cererilor
                        primite</span><span class="c5"><br></span><span class="c3">const</span><span class="c5">&nbsp;fs
                        = </span><span class="c13">require</span><span class="c5">(</span><span
                        class="c4">&quot;fs&quot;</span><span class="c5">); &nbsp; &nbsp; &nbsp; </span><span
                        class="c14 c16">// pentru citirea fi&#537;ierului index.html de pe disc</span></p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c1">Apoi, definim setul de date care vor fi trimise clientului - un set de &#537;iruri cu
            mesaje importante pentru client:</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.3bc88848cc352937bf087127121fcda30f05749a"></a><a id="t.7"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c3">const</span><span class="c5">&nbsp;messages = [</span><span
                        class="c4">&quot;Salut&quot;</span><span class="c5">, </span><span class="c4">&quot;Ce
                        faci?&quot;</span><span class="c5">, </span><span class="c4">&quot;Ce faci?&quot;</span><span
                        class="c5">, </span><span class="c4">&quot;Dormi?&quot;</span><span class="c5">, </span><span
                        class="c4">&quot;Pa&quot;</span><span class="c5">];</span></p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">Pentru crearea serverului se utilizeaz&#259; func&#539;ia </span><span
            class="c12">http.createServer()</span><span class="c14">. Acestei func&#539;ii i se transmite un handler,
            care este apelat de fiecare dat&#259; c&acirc;nd serverul prime&#537;te o cerere. Acest handler are doi
            parametri: </span><span class="c9">request </span><span class="c14">(con&#539;ine datele cererii) &#537;i
        </span><span class="c9">response </span><span class="c1">(gestioneaz&#259; trimiterea r&#259;spunsului).</span>
    </p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">&Icirc;n handler, folosind proprietatea</span><span
            class="c9">&nbsp;request.url</span><span class="c1">, putem determina la ce resurs&#259; de pe server s-a
            f&#259;cut cererea. Astfel, &icirc;n acest caz, dac&#259; cererea a venit pe calea &quot;/events&quot;,
            atunci vom interac&#539;iona cu clientul folosind Server-Sent Events:</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.20a7ca90ccc4a0fb6f51201cf68bba4e3804f60f"></a><a id="t.8"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c3">if</span><span class="c5">(request.url == </span><span
                        class="c4">&quot;/events&quot;</span><span class="c5">){ &nbsp; </span><span class="c14 c16">//
                        dac&#259; cererea este SSE</span><span class="c5"><br> &nbsp; &nbsp;</span><span
                        class="c3">if</span><span class="c5">&nbsp;(request.headers.accept &amp;&amp;
                        request.headers.accept === </span><span class="c4">&quot;text/event-stream&quot;</span><span
                        class="c5">) {<br> &nbsp; &nbsp; &nbsp; &nbsp;sendEvent(response);<br> &nbsp; &nbsp;}<br> &nbsp;
                        &nbsp;</span><span class="c3">else</span><span class="c5">{<br> &nbsp; &nbsp; &nbsp;
                        &nbsp;response.writeHead(</span><span class="c14 c17">400</span><span class="c5">);<br> &nbsp;
                        &nbsp; &nbsp; &nbsp;response.end(</span><span class="c4">&quot;Cerere
                        gre&#537;it&#259;&quot;</span><span class="c5">);<br> &nbsp; &nbsp;}<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">Este important ca &icirc;n cerere s&#259; fie setat antetul &quot;Accept&quot;:
            acesta trebuie s&#259; aib&#259; valoarea &quot;text/event-stream&quot;. Dac&#259; este a&#537;a, atunci
            pentru trimiterea datelor clientului execut&#259;m func&#539;ia </span><span
            class="c9">sendEvent()</span><span class="c1">, &icirc;n care transmitem obiectul r&#259;spuns response.
            Dac&#259; anteturile nu sunt setate, atunci trimitem un r&#259;spuns cu eroarea 400.</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c1">&Icirc;n func&#539;ia sendEvent form&#259;m anteturile r&#259;spunsului, ob&#539;inem
            ora curent&#259;, care va servi ca identificator al evenimentului, &#537;i pornim un timer pentru trimiterea
            datelor clientului la fiecare 5 secunde.</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.821a65616b3b2d491dfd1624a0fe07a032d03c61"></a><a id="t.9"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c3">function</span><span class="c5">&nbsp;</span><span
                        class="c13">sendEvent</span><span class="c5">(response) { <br> &nbsp; &nbsp;</span><span
                        class="c14 c16">// form&#259;m anteturile</span><span class="c5"><br> &nbsp;
                        &nbsp;response.writeHead(</span><span class="c14 c17">200</span><span class="c5">, { &nbsp;
                        &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span
                        class="c4">&quot;Content-Type&quot;</span><span class="c5">: </span><span
                        class="c4">&quot;text/event-stream&quot;</span><span class="c5">, &nbsp; &nbsp;<br> &nbsp;
                        &nbsp; &nbsp; &nbsp;</span><span class="c4">&quot;Cache-Control&quot;</span><span class="c5">:
                    </span><span class="c4">&quot;no-cache&quot;</span><span class="c5">, &nbsp; &nbsp;<br> &nbsp;
                        &nbsp; &nbsp; &nbsp;</span><span class="c4">&quot;Connection&quot;</span><span class="c5">:
                    </span><span class="c4">&quot;keep-alive&quot;</span><span class="c5">&nbsp;<br> &nbsp;
                        &nbsp;});<br> &nbsp; &nbsp;</span><span class="c3">const</span><span class="c5">&nbsp;id =
                        (</span><span class="c3">new</span><span class="c5">&nbsp;</span><span
                        class="c13">Date</span><span class="c5">()).toLocaleTimeString(); &nbsp;</span><span
                        class="c14 c16">// definim identificatorul ultimului eveniment</span><span class="c5"><br>
                        &nbsp; &nbsp;</span><span class="c14 c16">// la fiecare 5 secunde trimitem un mesaj</span><span
                        class="c5"><br> &nbsp; &nbsp;setInterval(() =&gt; { createServerSendEvent(response, id); },
                    </span><span class="c14 c17">5000</span><span class="c5">);<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c1">Trimiterea datelor se face &icirc;n func&#539;ia createServerSendEvent:</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.99fe0acb3b06e5c5f2598986719ea4113cdb0230"></a><a id="t.10"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c3">function</span><span class="c5">&nbsp;</span><span
                        class="c13">createServerSendEvent</span><span class="c5">(response, id) {<br> &nbsp;
                        &nbsp;</span><span class="c14 c16">// gener&#259;m un num&#259;r aleatoriu - index pentru
                        array-ul messages</span><span class="c5"><br> &nbsp; &nbsp;</span><span
                        class="c3">const</span><span class="c5">&nbsp;index = </span><span class="c13">Math</span><span
                        class="c5">.floor(</span><span class="c13">Math</span><span class="c5">.random() *
                        messages.length);<br> &nbsp; &nbsp;</span><span class="c3">const</span><span
                        class="c5">&nbsp;message = messages[index];<br> &nbsp; &nbsp;response.write(</span><span
                        class="c4">&quot;id: &quot;</span><span class="c5">&nbsp;+ id + </span><span
                        class="c4">&quot;\n&quot;</span><span class="c5">); &nbsp;<br> &nbsp;
                        &nbsp;response.write(</span><span class="c4">&quot;data: &quot;</span><span class="c5">&nbsp;+
                        message + </span><span class="c4">&quot;\n\n&quot;</span><span class="c5">);<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c1">Aici, ob&#539;inem un num&#259;r aleatoriu, care se afl&#259; &icirc;n intervalul de
            la 0 la messages.length &#537;i care va servi ca index, &#537;i pe baza acestui index select&#259;m un
            anumit mesaj. Apoi form&#259;m r&#259;spunsul. </span></p>
    <p class="c8"><span class="c1">Set&#259;m identificatorul evenimentului:</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.2da8a97d5337d672cfc55d8be1b8fce166909bc1"></a><a id="t.11"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c5">response.write(</span><span class="c4">&quot;id: &quot;</span><span
                        class="c5">&nbsp;+ id + </span><span class="c4">&quot;\n&quot;</span><span class="c5">);</span>
                </p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c1">&#536;i stabilim propriu-zis datele:</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.f83861a999fd1589825e62c0610e67e7de7dfbff"></a><a id="t.12"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c5">response.write(</span><span class="c4">&quot;data: &quot;</span><span
                        class="c5">&nbsp;+ message + </span><span class="c4">&quot;\n\n&quot;</span><span
                        class="c5">);</span></p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">Dac&#259; cererea a venit pe server pe o alt&#259; cale, atunci trimitem
            fi&#537;ierul </span><span class="c12">index.html</span><span class="c1">, pe care &icirc;l vom defini
            &icirc;n continuare.</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.ec126cff677f7f76be73ddf9ee4450cf75ff6bff"></a><a id="t.13"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c3">else</span><span class="c5">{<br> &nbsp; &nbsp;fs.readFile(</span><span
                        class="c4">&quot;index.html&quot;</span><span class="c5">, (_, data) =&gt;
                        response.end(data));<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">Pentru citirea fi&#537;ierelor se folose&#537;te func&#539;ia
            &icirc;ncorporat&#259;</span><span class="c12">&nbsp;fs.readFile()</span><span class="c14">. Primul
            parametru al func&#539;iei este adresa fi&#537;ierului (&icirc;n acest caz, se presupune c&#259;
            fi&#537;ierul index.html se afl&#259; &icirc;n acela&#537;i folder cu fi&#537;ierul serverului server.js).
            Al doilea parametru este func&#539;ia care este apelat&#259; dup&#259; citirea fi&#537;ierului &#537;i
            prime&#537;te con&#539;inutul s&#259;u prin al doilea parametru data. Apoi, con&#539;inutul citit poate fi
            trimis folosind func&#539;ia </span><span class="c9">response.end(data)</span><span class="c1">.</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">La final, cu ajutorul func&#539;iei </span><span class="c12">listen()</span><span
            class="c1">&nbsp;lans&#259;m serverul web pe portul 3000. Adic&#259;, serverul va fi accesibil la adresa
            http://localhost:3000/</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">Acum, &icirc;n folderul serverului, definim un fi&#537;ier</span><span
            class="c12">&nbsp;index.html</span><span class="c1">&nbsp;simplu cu urm&#259;torul cod:</span></p>
    <p class="c7"><span class="c1"></span></p><a id="t.f392a9a2424346fc492e92ece086621f1b8e6fbc"></a><a id="t.14"></a>
    <table class="c10">
        <tr class="c18">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c11"><span class="c5">&lt;!DOCTYPE html&gt;<br></span><span class="c6">&lt;</span><span
                        class="c12 c15">html</span><span class="c6">&gt;</span><span class="c5"><br></span><span
                        class="c6">&lt;</span><span class="c12 c15">head</span><span class="c6">&gt;</span><span
                        class="c5"><br> &nbsp; &nbsp;</span><span class="c6">&lt;</span><span
                        class="c12 c15">meta</span><span class="c6">&nbsp;charset=</span><span
                        class="c4">&quot;utf-8&quot;</span><span class="c6">&nbsp;/&gt;</span><span class="c5"><br>
                        &nbsp; &nbsp;</span><span class="c6">&lt;</span><span class="c12 c15">title</span><span
                        class="c6">&gt;</span><span class="c5">FDC.COM</span><span class="c6">&lt;/</span><span
                        class="c12 c15">title</span><span class="c6">&gt;</span><span class="c5"><br></span><span
                        class="c6">&lt;/</span><span class="c12 c15">head</span><span class="c6">&gt;</span><span
                        class="c5"><br></span><span class="c6">&lt;</span><span class="c12 c15">body</span><span
                        class="c6">&gt;</span><span class="c5"><br></span><span class="c6">&lt;</span><span
                        class="c12 c15">ul</span><span class="c6">&nbsp;id=</span><span
                        class="c4">&quot;list&quot;</span><span class="c6">&gt;&lt;/</span><span
                        class="c12 c15">ul</span><span class="c6">&gt;</span><span class="c5"><br></span><span
                        class="c6">&lt;</span><span class="c12 c15">script</span><span class="c6">&gt;</span><span
                        class="c5"><br></span><span class="c3">const</span><span class="c5">&nbsp;source = </span><span
                        class="c3">new</span><span class="c5">&nbsp;EventSource(</span><span
                        class="c4">&quot;/events&quot;</span><span class="c5">); &nbsp; &nbsp; &nbsp;<br></span><span
                        class="c3">const</span><span class="c5">&nbsp;list = </span><span
                        class="c13">document</span><span class="c5">.getElementById(</span><span
                        class="c4">&quot;list&quot;</span><span class="c5">) &nbsp; &nbsp;
                        &nbsp;<br>source.addEventListener(</span><span class="c4">&quot;message&quot;</span><span
                        class="c5">, (e) =&gt; {<br> &nbsp; &nbsp;</span><span class="c3">const</span><span
                        class="c5">&nbsp;listItem = </span><span class="c13">document</span><span
                        class="c5">.createElement(</span><span class="c4">&quot;li&quot;</span><span class="c5">);
                        &nbsp; &nbsp; &nbsp; <br> &nbsp; &nbsp;listItem.textContent += e.data;<br> &nbsp;
                        &nbsp;list.appendChild(listItem);<br>}); <br></span><span class="c6">&lt;/</span><span
                        class="c12 c15">script</span><span class="c6">&gt;</span><span class="c5"><br></span><span
                        class="c6">&lt;/</span><span class="c12 c15">body</span><span class="c6">&gt;</span><span
                        class="c5"><br></span><span class="c6">&lt;/</span><span class="c12 c15">html</span><span
                        class="c6">&gt;</span></p>
            </td>
        </tr>
    </table>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c1">Aici, la primirea datelor de la server, le ad&#259;ug&#259;m &icirc;n lista de pe
            pagina web.</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c14">Acum, &icirc;n consol&#259;, ne deplas&#259;m la folderul serverului folosind
            comanda </span><span class="c12">cd</span><span class="c14">&nbsp;&#537;i lans&#259;m serverul folosind
            comanda</span><span class="c12">&nbsp;node server.js</span><span class="c1">.</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 500.00px; height: 54.00px;"><img
                alt="" src="images/image2.png"
                style="width: 500.00px; height: 54.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
                title=""></span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span class="c1">Dup&#259; lansarea serverului, putem naviga &icirc;n browser la adresa
            http://localhost:3000, unde ni se va afi&#537;a pagina, iar &icirc;n codul JavaScript al acesteia se va
            realiza primirea datelor de la server &#537;i afi&#537;area lor pe pagina web.</span></p>
    <p class="c7"><span class="c1"></span></p>
    <p class="c8"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 467.50px; height: 333.50px;"><img
                alt="" src="images/image1.png"
                style="width: 467.50px; height: 333.50px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
                title=""></span></p>
</body>

</html>