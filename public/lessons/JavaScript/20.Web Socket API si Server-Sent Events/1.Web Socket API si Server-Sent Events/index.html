<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <style type="text/css">
        @import url(https://themes.googleusercontent.com/fonts/css?kit=iMc4-4exjgqA-toZgqqJBf35jAjY-31lSKWZb9Fa77M);

        .lst-kix_1nysho16ixk6-5>li:before {
            content: "\0025a0   "
        }

        ul.lst-kix_1nysho16ixk6-1 {
            list-style-type: none
        }

        ul.lst-kix_1nysho16ixk6-0 {
            list-style-type: none
        }

        ul.lst-kix_1nysho16ixk6-3 {
            list-style-type: none
        }

        .lst-kix_1nysho16ixk6-2>li:before {
            content: "\0025a0   "
        }

        ul.lst-kix_1nysho16ixk6-2 {
            list-style-type: none
        }

        .lst-kix_1nysho16ixk6-6>li:before {
            content: "\0025cf   "
        }

        .lst-kix_1nysho16ixk6-1>li:before {
            content: "\0025cb   "
        }

        .lst-kix_1nysho16ixk6-7>li:before {
            content: "\0025cb   "
        }

        li.li-bullet-0:before {
            margin-left: -18pt;
            white-space: nowrap;
            display: inline-block;
            min-width: 18pt
        }

        .lst-kix_1nysho16ixk6-8>li:before {
            content: "\0025a0   "
        }

        .lst-kix_1nysho16ixk6-0>li:before {
            content: "\0025cf   "
        }

        ul.lst-kix_1nysho16ixk6-5 {
            list-style-type: none
        }

        ul.lst-kix_1nysho16ixk6-4 {
            list-style-type: none
        }

        ul.lst-kix_1nysho16ixk6-7 {
            list-style-type: none
        }

        .lst-kix_1nysho16ixk6-3>li:before {
            content: "\0025cf   "
        }

        ul.lst-kix_1nysho16ixk6-6 {
            list-style-type: none
        }

        ul.lst-kix_1nysho16ixk6-8 {
            list-style-type: none
        }

        .lst-kix_1nysho16ixk6-4>li:before {
            content: "\0025cb   "
        }

        ol {
            margin: 0;
            padding: 0
        }

        table td,
        table th {
            padding: 0
        }

        .c12 {
            border-right-style: solid;
            padding: 5pt 5pt 5pt 5pt;
            border-bottom-color: #000000;
            border-top-width: 0pt;
            border-right-width: 0pt;
            border-left-color: #000000;
            vertical-align: top;
            border-right-color: #000000;
            border-left-width: 0pt;
            border-top-style: solid;
            background-color: #333333;
            border-left-style: solid;
            border-bottom-width: 0pt;
            width: 468pt;
            border-top-color: #000000;
            border-bottom-style: solid
        }

        .c2 {
            color: #000000;
            font-weight: 700;
            text-decoration: none;
            vertical-align: baseline;
            font-size: 12pt;
            font-family: "Open Sans";
            font-style: normal
        }

        .c4 {
            border-spacing: 0;
            border-collapse: collapse;
            margin-right: auto
        }

        .c1 {
            padding-top: 0pt;
            padding-bottom: 0pt;
            line-height: 1.5;
            text-align: left
        }

        .c3 {
            color: #000000;
            text-decoration: none;
            vertical-align: baseline;
            font-style: normal
        }

        .c18 {
            font-weight: 700;
            font-size: 15pt;
            font-family: "Open Sans"
        }

        .c0 {
            font-size: 12pt;
            font-family: "Open Sans";
            font-weight: 400
        }

        .c20 {
            font-weight: 400;
            font-size: 15pt;
            font-family: "Open Sans"
        }

        .c17 {
            font-weight: 700;
            font-size: 27pt;
            font-family: "Open Sans"
        }

        .c21 {
            background-color: #ffffff;
            max-width: 468pt;
            padding: 72pt 72pt 72pt 72pt
        }

        .c6 {
            font-size: 12pt;
            font-family: "Open Sans";
            font-weight: 700
        }

        .c9 {
            background-color: #333333;
            color: #62c8f3
        }

        .c8 {
            background-color: #333333;
            color: #a2fca2
        }

        .c23 {
            margin-left: 36pt;
            padding-left: 0pt
        }

        .c13 {
            background-color: #333333;
            color: #fcc28c
        }

        .c16 {
            background-color: #333333;
            color: #ffffaa
        }

        .c19 {
            background-color: #333333;
            color: #888888
        }

        .c7 {
            orphans: 2;
            widows: 2
        }

        .c14 {
            background-color: #333333;
            color: #d36363
        }

        .c5 {
            background-color: #333333;
            color: #ffffff
        }

        .c22 {
            padding: 0;
            margin: 0
        }

        .c10 {
            height: 11pt
        }

        .c15 {
            height: 0pt
        }

        .c11 {
            font-style: italic
        }

        .title {
            padding-top: 0pt;
            color: #000000;
            font-size: 26pt;
            padding-bottom: 3pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        .subtitle {
            padding-top: 0pt;
            color: #666666;
            font-size: 15pt;
            padding-bottom: 16pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        li {
            color: #000000;
            font-size: 11pt;
            font-family: "Arial"
        }

        p {
            margin: 0;
            color: #000000;
            font-size: 11pt;
            font-family: "Arial"
        }

        h1 {
            padding-top: 20pt;
            color: #000000;
            font-size: 20pt;
            padding-bottom: 6pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        h2 {
            padding-top: 18pt;
            color: #000000;
            font-size: 16pt;
            padding-bottom: 6pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        h3 {
            padding-top: 16pt;
            color: #434343;
            font-size: 14pt;
            padding-bottom: 4pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        h4 {
            padding-top: 14pt;
            color: #666666;
            font-size: 12pt;
            padding-bottom: 4pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        h5 {
            padding-top: 12pt;
            color: #666666;
            font-size: 11pt;
            padding-bottom: 4pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            orphans: 2;
            widows: 2;
            text-align: left
        }

        h6 {
            padding-top: 12pt;
            color: #666666;
            font-size: 11pt;
            padding-bottom: 4pt;
            font-family: "Arial";
            line-height: 1.15;
            page-break-after: avoid;
            font-style: italic;
            orphans: 2;
            widows: 2;
            text-align: left
        }
    </style>
</head>

<body class="c21 doc-content">
    <h1 class="c1 c7 c3 c17">Web Socket API È™i Server-Sent Events.</span></h1>
    <p class="c1 c7 c10"><span class="c2"></span></p>
    <p class="c1 c7"><span class="c3 c18">Web Socket API.</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c6">Web Socket API</span><span class="c3 c0">&nbsp;permite organizarea unei conexiuni
            &icirc;ntre client &#537;i server, prin care clientul &#537;i serverul pot trimite date unul altuia &icirc;n
            orice moment.</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c0">Pentru a crea o conexiune prin Web Socket API se utilizeaz&#259; constructorul
        </span><span class="c6">WebSocket()</span><span class="c3 c0">, &icirc;n care se transmite adresa de
            conexiune.</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.34c380bc1a1c08071214ce6d9ebcc0bbaacc61bd"></a><a
        id="t.0"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c13">const</span><span class="c0 c5">&nbsp;connection = </span><span
                        class="c0 c13">new</span><span class="c0 c5">&nbsp;WebSocket(</span><span
                        class="c0 c8">&quot;ws://example.com/test&quot;</span><span class="c0 c5">);</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c20"></span></p>
    <p class="c1 c7"><span class="c3 c18">Gestionarea ciclului de via&#539;&#259; al conexiunii.</span></p>
    <p class="c1 c7 c10"><span class="c2"></span></p>
    <p class="c1 c7"><span class="c3 c0">Pentru gestionarea conexiunii, pentru WebSocket sunt definite trei
            evenimente:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c0">- </span><span class="c6">open</span><span class="c0">: se apeleaz&#259; la
            deschiderea cu succes a conexiunii. Handler-ul poate fi setat prin proprietatea </span><span
            class="c6">onopen</span><span class="c3 c0">.</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c0">- </span><span class="c6">error</span><span class="c0">: se apeleaz&#259; atunci
            c&acirc;nd apare o eroare la conectare. Handler-ul se seteaz&#259; prin proprietatea </span><span
            class="c6">onerror</span><span class="c0">. </span><span class="c2">&Icirc;n func&#539;ia handler se
            transmite informa&#539;ia despre eroare.</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c0">- </span><span class="c6">close</span><span class="c0">: se apeleaz&#259; la
            &icirc;nchiderea conexiunii. Handler-ul se seteaz&#259; prin proprietatea </span><span
            class="c6">onclose</span><span class="c3 c0">.</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c3 c0">Exemplu de gestionare a evenimentelor:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.81cf593bc0e0f6146dbe3b6b6ce0c3c1897a0a07"></a><a
        id="t.1"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c13">const</span><span class="c0 c5">&nbsp;connection = </span><span
                        class="c0 c13">new</span><span class="c0 c5">&nbsp;WebSocket(</span><span
                        class="c0 c8">&quot;ws://example.com/test&quot;</span><span class="c0 c5">);<br></span><span
                        class="c0 c19">// dac&#259; conexiunea a fost stabilit&#259; cu succes</span><span
                        class="c0 c5"><br>connection.onopen = (event) =&gt; { &nbsp;<br> &nbsp; &nbsp;</span><span
                        class="c0 c16">console</span><span class="c0 c5">.log(</span><span
                        class="c0 c8">&quot;Connection opened&quot;</span><span class="c0 c5">);<br>};<br></span><span
                        class="c0 c19">// dac&#259; a ap&#259;rut o eroare</span><span
                        class="c0 c5"><br>connection.onerror = (error) =&gt; {<br> &nbsp; &nbsp;</span><span
                        class="c0 c16">console</span><span class="c0 c5">.log(</span><span class="c0 c8">`WebSocket
                        Error: ${error}`</span><span class="c0 c5">);<br>};<br></span><span class="c0 c19">// dac&#259;
                        conexiunea este &icirc;nchis&#259;</span><span class="c0 c5"><br>connection.onclose = (event)
                        =&gt; {<br> &nbsp; &nbsp;</span><span class="c0 c16">console</span><span
                        class="c0 c5">.log(</span><span class="c0 c8">&quot;Connection closed&quot;</span><span
                        class="c0 c5">);<br>};</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c3 c18">Trimiterea datelor c&#259;tre server.</span></p>
    <p class="c1 c7 c10"><span class="c2"></span></p>
    <p class="c1 c7"><span class="c0">Pentru trimiterea datelor c&#259;tre server se folose&#537;te metoda</span><span
            class="c6">&nbsp;send()</span><span class="c3 c0">&nbsp;a obiectului WebSocket. Ca parametru &icirc;n
            metod&#259; se poate transmite string-uri, date binare (BLOB), obiecte ArrayBuffer, mase tipizate. Desigur,
            trimiterea datelor este posibil&#259; numai dup&#259; stabilirea cu succes a conexiunii. De exemplu,
            trimiterea unui string:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.da5852b7fae6d5f11c411e63af9561f83130c198"></a><a
        id="t.2"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c19">// dac&#259; conexiunea este stabilit&#259;, trimitem un
                        string</span><span class="c0 c5"><br>connection.onopen = (event) =&gt; { &nbsp;<br> &nbsp;
                        &nbsp;connection.send(</span><span class="c0 c8">&quot;Hello FDC.COM&quot;</span><span
                        class="c0 c5">);<br>};</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c3 c0">Sau, de exemplu, dac&#259; dorim s&#259; trimitem un obiect &icirc;n format
            JSON, mai &icirc;nt&acirc;i trebuie s&#259;-l transform&#259;m &icirc;n acest format:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.841929ea341ce88bb6e49489b1f49f0d64d711b2"></a><a
        id="t.3"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c13">const</span><span class="c0 c5">&nbsp;data = { &nbsp;message:
                    </span><span class="c0 c8">&quot;Hello&quot;</span><span class="c0 c5">};<br></span><span
                        class="c0 c19">// trimitem obiectul &icirc;n format json</span><span
                        class="c0 c5"><br>connection.send(</span><span class="c0 c16">JSON</span><span
                        class="c0 c5">.stringify(data));</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c3 c18">Recep&#539;ia datelor.</span></p>
    <p class="c1 c7 c10"><span class="c2"></span></p>
    <p class="c1 c7"><span class="c0">C&acirc;nd vin date de la server, la obiectul WebSocket se declan&#537;eaz&#259;
            evenimentul </span><span class="c6">message</span><span class="c0">, pentru a seta handler-ul c&#259;ruia se
            poate folosi proprietatea </span><span class="c6">onmessage</span><span class="c3 c0">.</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c0">&Icirc;n handler-ul evenimentului </span><span class="c6">message </span><span
            class="c0">se transmite un obiect de tip </span><span class="c6">MessageEvent</span><span class="c3 c0">.
            Acest obiect ofer&#259; o serie de propriet&#259;&#539;i care permit extragerea datelor r&#259;spunsului
            serverului:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <ul class="c22 lst-kix_1nysho16ixk6-0 start">
        <li class="c1 c23 c7 li-bullet-0"><span class="c0">&nbsp;</span><span class="c6">data</span><span
                class="c3 c0">: returneaz&#259; datele primite</span></li>
    </ul>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <ul class="c22 lst-kix_1nysho16ixk6-0">
        <li class="c1 c23 c7 li-bullet-0"><span class="c0">&nbsp;</span><span class="c6">origin</span><span
                class="c3 c0">: stocheaz&#259; adresa expeditorului</span></li>
    </ul>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <ul class="c22 lst-kix_1nysho16ixk6-0">
        <li class="c1 c23 c7 li-bullet-0"><span class="c0">&nbsp;</span><span class="c6">lastEventId</span><span
                class="c3 c0">: stocheaz&#259; identificatorul unic al evenimentului sub form&#259; de string.</span>
        </li>
    </ul>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <ul class="c22 lst-kix_1nysho16ixk6-0">
        <li class="c1 c23 c7 li-bullet-0"><span class="c0">&nbsp;</span><span class="c6">source</span><span class="c0">:
                returneaz&#259; un obiect </span><span class="c0 c11">MessageEventSource</span><span class="c3 c0">,
                care poate fi un obiect WindowProxy, MessagePort sau ServiceWorker &#537;i care reprezint&#259;
                expeditorul datelor primite.</span></li>
    </ul>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <ul class="c22 lst-kix_1nysho16ixk6-0">
        <li class="c1 c7 c23 li-bullet-0"><span class="c0">&nbsp;</span><span class="c6">ports</span><span class="c0">:
                returneaz&#259; un array de obiecte </span><span class="c0 c11">MessagePort</span><span class="c3 c0">,
                care stocheaz&#259; porturile folosite pentru trimitere</span></li>
    </ul>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c0">Proprietatea cheie aici, desigur, este </span><span class="c6">data</span><span
            class="c0">, care reprezint&#259; datele primite. Aceasta poate reprezenta un string sau date binare.
            Dac&#259; sunt trimise date binare, atunci proprietatea </span><span class="c6">data </span><span
            class="c0">poate reprezenta tipul </span><span class="c0 c11">ArrayBuffer </span><span class="c0">sau
        </span><span class="c0 c11">Blob</span><span class="c3 c0">. Exemplu de recep&#539;ie a datelor:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.0fa2d460c67212aea645d06cdc2e8a2d2e0ca6d8"></a><a
        id="t.4"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c5">connection.onmessage = (event) =&gt;{ <br> &nbsp; &nbsp;</span><span
                        class="c0 c16">console</span><span class="c0 c5">.log(event.data);<br>};</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c0">Dac&#259; clientul prime&#537;te date binare, atunci cu ajutorul
            propriet&#259;&#539;ii </span><span class="c6">binaryType </span><span class="c3 c0">a obiectului WebSocket
            se poate specifica exact tipul de date pe care dorim s&#259;-l primim folosind valorile &quot;blob&quot;
            (pentru a primi date sub forma unui obiect Blob) &#537;i &quot;arraybuffer&quot; (pentru a primi date sub
            forma unui ArrayBuffer). De exemplu:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.30de627d899ad5dee11057ae9d109110626ff487"></a><a
        id="t.5"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c13">const</span><span class="c0 c5">&nbsp;connection = </span><span
                        class="c0 c13">new</span><span class="c0 c5">&nbsp;WebSocket(</span><span
                        class="c0 c8">&quot;ws://example.com/test&quot;</span><span
                        class="c0 c5">);<br>connection.binaryType = </span><span
                        class="c0 c8">&quot;arraybuffer&quot;</span><span class="c0 c5">;</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c3 c18">&Icirc;nchiderea conexiunii.</span></p>
    <p class="c1 c7 c10"><span class="c2"></span></p>
    <p class="c1 c7"><span class="c3 c0">Pentru a &icirc;nchide conexiunea, la obiectul WebSocket se apeleaz&#259;
            metoda close():</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.cdc5124d407c4dd45d01eb2f10f390e9f28ab53e"></a><a
        id="t.6"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c5">connection.close();</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c3 c18">Interac&#539;iunea cu serverul.</span></p>
    <p class="c1 c7 c10"><span class="c2"></span></p>
    <p class="c1 c7"><span class="c3 c0">S&#259; scriem un mic exemplu de interac&#539;iune &icirc;ntre client &#537;i
            server folosind WebSocket. &Icirc;n primul r&acirc;nd, vom crea codul serverului. Ca tehnologie server vom
            folosi Node.js, ca fiind varianta cea mai simpl&#259;, mai ales c&#259; utilizeaz&#259; acela&#537;i
            JavaScript. Deci, &icirc;n primul r&acirc;nd, trebuie s&#259; instal&#259;m Node.js. Totu&#537;i, se poate
            alege orice alt&#259; tehnologie server.</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c0">Am putea scrie &icirc;ntreg codul de lucru cu WebSocket de la zero, dar aceasta nu
            este cea mai simpl&#259; sarcin&#259;, &#537;i pentru demonstra&#539;ie vom folosi o bibliotec&#259;
            special&#259; - </span><span class="c6">ws</span><span class="c0">. Astfel, vom crea fi&#537;ierul
        </span><span class="c6">server.js</span><span class="c3 c0">&nbsp;&#537;i vom defini &icirc;n el urm&#259;torul
            cod:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.6c16df5aa3173443becda787fcf0ff7651ea3f1c"></a><a
        id="t.7"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c13">const</span><span class="c0 c5">&nbsp;WebSocket = </span><span
                        class="c0 c16">require</span><span class="c0 c5">(</span><span
                        class="c0 c8">&quot;ws&quot;</span><span class="c0 c5">);<br></span><span
                        class="c0 c13">const</span><span class="c0 c5">&nbsp;server = </span><span
                        class="c0 c13">new</span><span class="c0 c5">&nbsp;WebSocket.Server({port: </span><span
                        class="c0 c14">9000</span><span class="c0 c5">});<br><br>server.on(</span><span
                        class="c0 c8">&quot;connection&quot;</span><span class="c0 c5">, onConnect);<br><br></span><span
                        class="c0 c19">// handler pentru conectarea clientului</span><span
                        class="c0 c5"><br></span><span class="c0 c19">// parametrul - clientul conectat</span><span
                        class="c0 c5"><br></span><span class="c0 c13">function</span><span
                        class="c0 c5">&nbsp;</span><span class="c0 c16">onConnect</span><span class="c0 c5">(client)
                        {<br> &nbsp;</span><span class="c0 c16">console</span><span class="c0 c5">.log(</span><span
                        class="c0 c8">&quot;Connection opened&quot;</span><span class="c0 c5">);<br> &nbsp; <br> &nbsp;
                        &nbsp;</span><span class="c0 c19">// proces&#259;m mesajele venite de la client</span><span
                        class="c0 c5"><br> &nbsp; &nbsp;client.on(</span><span
                        class="c0 c8">&quot;message&quot;</span><span class="c0 c5">, </span><span
                        class="c0 c13">function</span><span class="c0 c5">(message) {<br> &nbsp; &nbsp; &nbsp;
                        &nbsp;</span><span class="c0 c16">console</span><span class="c0 c5">.log(</span><span
                        class="c0 c8">&quot;Client message:&quot;</span><span class="c0 c5">, message.toString());
                        &nbsp; &nbsp;</span><span class="c0 c19">// afi&#537;&#259;m pe consol&#259; mesajul clientului
                        pentru diagnostic</span><span class="c0 c5"><br> &nbsp; &nbsp; &nbsp; &nbsp; <br> &nbsp; &nbsp;
                        &nbsp; &nbsp;client.send(</span><span class="c0 c8">&quot;Hello Client&quot;</span><span
                        class="c0 c5">); &nbsp; &nbsp;</span><span class="c0 c19">// trimitem un mesaj
                        clientului</span><span class="c0 c5"><br> &nbsp; &nbsp;});<br> &nbsp; &nbsp;</span><span
                        class="c0 c19">// &icirc;nchiderea conexiunii</span><span class="c0 c5"><br> &nbsp;
                        &nbsp;client.on(</span><span class="c0 c8">&quot;close&quot;</span><span class="c0 c5">,
                    </span><span class="c0 c13">function</span><span class="c0 c5">() {<br> &nbsp; &nbsp; &nbsp;
                        &nbsp;</span><span class="c0 c16">console</span><span class="c0 c5">.log(</span><span
                        class="c0 c8">&quot;Connection closed&quot;</span><span class="c0 c5">);<br> &nbsp;
                        &nbsp;});<br>}<br><br></span><span class="c0 c16">console</span><span
                        class="c0 c5">.log(</span><span class="c0 c8">&quot;Serverul a fost lansat pe portul
                        9000&quot;</span><span class="c0 c5">);</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c3 c0">Pentru crearea unui server WebSocket apel&#259;m func&#539;ia Server din
            biblioteca ws:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.ccf214fd52b671751f6fb0f68e77896f3d3bcb50"></a><a
        id="t.8"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c13">const</span><span class="c0 c5">&nbsp;WebSocket = </span><span
                        class="c0 c16">require</span><span class="c0 c5">(</span><span
                        class="c0 c8">&quot;ws&quot;</span><span class="c0 c5">);<br></span><span
                        class="c0 c13">const</span><span class="c0 c5">&nbsp;server = </span><span
                        class="c0 c13">new</span><span class="c0 c5">&nbsp;WebSocket.Server({port: </span><span
                        class="c0 c14">9000</span><span class="c0 c5">});</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c0">Apoi, folosind metoda </span><span class="c0 c11">on()</span><span class="c3 c0">,
            ad&#259;ug&#259;m serverului un handler pentru evenimentul &quot;connection&quot;, care se
            declan&#537;eaz&#259; la conectarea unui nou client, func&#539;ia onConnect.</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.1a55bc9238321e7d05916c25e3d9e2ee6578cd70"></a><a
        id="t.9"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c5">server.on(</span><span
                        class="c0 c8">&quot;connection&quot;</span><span class="c0 c5">, onConnect);</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c3 c0">&Icirc;n handler-ul evenimentului, ca parametru se transmite un obiect, prin
            care se poate interac&#539;iona cu clientul:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.5e85852a7f68dc71b01f0fced59e447a51189f9b"></a><a
        id="t.10"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c13">function</span><span class="c0 c5">&nbsp;</span><span
                        class="c0 c16">onConnect</span><span class="c0 c5">(client) {</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c3 c0">&Icirc;n acest handler, set&#259;m pentru clientul conectat evenimentul
            &quot;message&quot;, care se declan&#537;eaz&#259; c&acirc;nd clientul trimite date pe server:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.cfc00281ca8685107bd94eda6195c5c346c566c2"></a><a
        id="t.11"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c5">client.on(</span><span class="c0 c8">&quot;message&quot;</span><span
                        class="c0 c5">, </span><span class="c0 c13">function</span><span class="c0 c5">(message) {<br>
                        &nbsp; &nbsp;</span><span class="c0 c16">console</span><span class="c0 c5">.log(</span><span
                        class="c0 c8">&quot;Client message:&quot;</span><span class="c0 c5">, message.toString());
                        &nbsp; &nbsp;</span><span class="c0 c19">// afi&#537;&#259;m mesajul clientului pe
                        consol&#259;</span><span class="c0 c5"><br> &nbsp; &nbsp;client.send(</span><span
                        class="c0 c8">&quot;Hello Client&quot;</span><span class="c0 c5">); &nbsp; &nbsp;</span><span
                        class="c0 c19">// trimitem un mesaj clientului</span><span class="c0 c5"><br>});</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c0">&Icirc;n func&#539;ia-handler a evenimentului &quot;message&quot; se transmit
            datele trimise de client (aici parametrul message). &Icirc;n interiorul func&#539;iei-handler,
            afi&#537;&#259;m aceste date pe consol&#259; &#537;i folosim metoda </span><span
            class="c0 c11">send()</span><span class="c3 c0">&nbsp;pentru a trimite clientului un anumit r&#259;spuns.
            Astfel, serverul va primi date de la client &#537;i &icirc;i va trimite &icirc;napoi un r&#259;spuns.</span>
    </p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c3 c0">De asemenea, se seteaz&#259; un handler pentru evenimentul &quot;close&quot;
            pentru a procesa &icirc;nchiderea conexiunii.</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c0">Problema cu biblioteca &quot;ws&quot; este c&#259; aceasta nu este o
            bibliotec&#259; &icirc;ncorporat&#259; &icirc;n Node.js, ci o bibliotec&#259; extern&#259;. Prin urmare,
            trebuie s&#259; o instal&#259;m. Pentru aceasta, ne vom deplasa &icirc;n consol&#259; la folderul unde se
            afl&#259; fi&#537;ierul </span><span class="c6">server.js</span><span class="c3 c0">, &#537;i apoi &icirc;n
            consol&#259; vom executa urm&#259;toarea comand&#259;:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.c2171bc9bc87ad6fdeb5a39fc04790417353f823"></a><a
        id="t.12"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c5">npm install ws</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c3 c0">Aceast&#259; comand&#259; va instala biblioteca ws.</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c0">Acum s&#259; definim codul clientului. S&#259; presupunem c&#259; este
            urm&#259;toarea pagin&#259; </span><span class="c6">index.html</span><span class="c3 c0">:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.7ce86453a51f405a6b46734b7490883fdca637f0"></a><a
        id="t.13"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c5">&lt;!DOCTYPE html&gt;<br></span><span class="c0 c9">&lt;</span><span
                        class="c6 c9">html</span><span class="c0 c9">&gt;</span><span class="c0 c5"><br></span><span
                        class="c0 c9">&lt;</span><span class="c6 c9">head</span><span class="c0 c9">&gt;</span><span
                        class="c0 c5"><br> &nbsp; &nbsp;</span><span class="c0 c9">&lt;</span><span
                        class="c6 c9">meta</span><span class="c0 c9">&nbsp;charset=</span><span
                        class="c0 c8">&quot;utf-8&quot;</span><span class="c0 c9">&nbsp;/&gt;</span><span
                        class="c0 c5"><br> &nbsp; &nbsp;</span><span class="c0 c9">&lt;</span><span
                        class="c6 c9">title</span><span class="c0 c9">&gt;</span><span class="c0 c5">FDC.COM</span><span
                        class="c0 c9">&lt;/</span><span class="c6 c9">title</span><span class="c0 c9">&gt;</span><span
                        class="c0 c5"><br></span><span class="c0 c9">&lt;/</span><span class="c6 c9">head</span><span
                        class="c0 c9">&gt;</span><span class="c0 c5"><br></span><span class="c0 c9">&lt;</span><span
                        class="c6 c9">body</span><span class="c0 c9">&gt;</span><span class="c0 c5"><br></span><span
                        class="c0 c9">&lt;</span><span class="c6 c9">script</span><span class="c0 c9">&gt;</span><span
                        class="c0 c5"><br></span><span class="c0 c13">const</span><span class="c0 c5">&nbsp;connection =
                    </span><span class="c0 c13">new</span><span class="c0 c5">&nbsp;WebSocket(</span><span
                        class="c0 c8">&quot;ws://localhost:9000&quot;</span><span class="c0 c5">);<br></span><span
                        class="c0 c19">// dac&#259; conexiunea a fost stabilit&#259; cu succes</span><span
                        class="c0 c5"><br>connection.onopen = (event) =&gt; { &nbsp;<br> &nbsp; &nbsp;</span><span
                        class="c0 c16">console</span><span class="c0 c5">.log(</span><span
                        class="c0 c8">&quot;Connection opened&quot;</span><span class="c0 c5">);<br> &nbsp;
                        &nbsp;connection.send(</span><span class="c0 c8">&quot;Hello Server&quot;</span><span
                        class="c0 c5">);<br>};<br></span><span class="c0 c19">// dac</span><span
                        class="c0 c5"><br><br>&#259; a ap&#259;rut o eroare<br>connection.onerror = (error) =&gt; {<br>
                        &nbsp; &nbsp;</span><span class="c0 c16">console</span><span class="c0 c5">.log(</span><span
                        class="c0 c8">`WebSocket Error: ${error}`</span><span class="c0 c5">);<br>};<br></span><span
                        class="c0 c19">// dac&#259; conexiunea este &icirc;nchis&#259;</span><span
                        class="c0 c5"><br>connection.onclose = (event) =&gt; {<br> &nbsp; &nbsp;</span><span
                        class="c0 c16">console</span><span class="c0 c5">.log(</span><span
                        class="c0 c8">&quot;Connection closed&quot;</span><span class="c0 c5">);<br>};<br></span><span
                        class="c0 c19">// primim r&#259;spunsul serverului</span><span
                        class="c0 c5"><br>connection.onmessage = (event) =&gt;{ <br> &nbsp; &nbsp;</span><span
                        class="c0 c16">console</span><span class="c0 c5">.log(</span><span class="c0 c8">&quot;Server
                        response:&quot;</span><span class="c0 c5">, event.data);<br>};<br></span><span
                        class="c0 c9">&lt;/</span><span class="c6 c9">script</span><span class="c0 c9">&gt;</span><span
                        class="c0 c5"><br></span><span class="c0 c9">&lt;/</span><span class="c6 c9">body</span><span
                        class="c0 c9">&gt;</span><span class="c0 c5"><br></span><span class="c0 c9">&lt;/</span><span
                        class="c6 c9">html</span><span class="c0 c9">&gt;</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c3 c0">&Icirc;n general, codul de lucru cu WebSocket a fost discutat anterior. Voi
            sublinia punctele principale. La deschiderea conexiunii, trimitem pe server string-ul &quot;Hello
            Server&quot;</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.1ebec8c979708675327b6866eac7b45e841a53e6"></a><a
        id="t.14"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c5">connection.send(</span><span class="c0 c8">&quot;Hello
                        Server&quot;</span><span class="c0 c5">);</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c3 c0">&#536;i la primirea r&#259;spunsului de la server, afi&#537;&#259;m datele
            primite pe consol&#259;:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.0fa2d460c67212aea645d06cdc2e8a2d2e0ca6d8"></a><a
        id="t.15"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c5">connection.onmessage = (event) =&gt;{ <br> &nbsp; &nbsp;</span><span
                        class="c0 c16">console</span><span class="c0 c5">.log(event.data);<br>};</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c0">Ne deplas&#259;m &icirc;n consol&#259; la folderul unde se afl&#259; fi&#537;ierul
            server - </span><span class="c6">server.js</span><span class="c3 c0">&nbsp;&#537;i execut&#259;m &icirc;n
            consol&#259; comanda:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.345208260810c584ceb64a3931bd385c5e67beff"></a><a
        id="t.16"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c5">node server.js</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c0 c3"></span></p>
    <p class="c1 c7"><span class="c0">Aceast&#259; comand&#259; va lansa serverul. &#536;i dup&#259; aceea vom deschide
            pagina noastr&#259; web </span><span class="c6">index.html</span><span class="c3 c0">&nbsp;&icirc;n browser
            &#537;i vom verifica output-ul s&#259;u de consol&#259;. &Icirc;n final, output-ul de consol&#259; al
            serverului va fi urm&#259;torul:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.011d01dac09f8e3b07dc7748a5608cf5f81517dc"></a><a
        id="t.17"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c5">C:\app&gt; node server.js<br>Serverul a fost lansat pe portul
                    </span><span class="c0 c14">9000</span><span class="c0 c5"><br>Connection opened<br>Client message:
                        Hello Server</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7"><span class="c0">&#536;i output-ul de consol&#259; al clientului - pagina web</span><span
            class="c6">&nbsp;index.html </span><span class="c3 c0">va fi urm&#259;torul:</span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p><a id="t.51cf4f95e58f18121201e71cc7fe5b237e911a6a"></a><a
        id="t.18"></a>
    <table class="c4">
        <tr class="c15">
            <td class="c12" colspan="1" rowspan="1">
                <p class="c1"><span class="c0 c5">Connection opened<br>Server response: Hello Client</span></p>
            </td>
        </tr>
    </table>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
    <p class="c1 c7 c10"><span class="c3 c0"></span></p>
</body>

</html>