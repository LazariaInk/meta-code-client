<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <link rel="stylesheet" type="text/css" href="/lessons/styles.css">
</head>

<body class="c3 doc-content">
    <h1 class="c9 c13 c16">Urmărirea procesului de Încărcarea a fișierului. </h1>
    <p class="c9 c12"><span class="c17"></span></p>
    <p class="c9 c13"><span class="c14">C&acirc;nd &icirc;nc&#259;rca&#539;i fi&#537;iere mari prin File API, poate fi
            util s&#259; informa&#539;i utilizatorii despre progresul opera&#539;iunii de citire. &Icirc;n acest scop,
            tipul </span><span class="c5">FileReader </span><span class="c14">permite tratarea evenimentului progress.
            La handler-ul acestui eveniment se transmite un obiect care are tipul </span><span class="c5">ProgressEvent
        </span><span class="c2">&#537;i care ofer&#259; urm&#259;toarele propriet&#259;&#539;i:</span></p>
    <p class="c9 c12"><span class="c2"></span></p>
    <p class="c9 c13"><span class="c14">- </span><span class="c5">lengthComputable</span><span class="c2">: o
            proprietate boolean&#259; care indic&#259; dac&#259; progresul (cantitatea de octe&#539;i citi&#539;i) poate
            fi calculat sau nu.</span></p>
    <p class="c9 c12"><span class="c2"></span></p>
    <p class="c9 c13"><span class="c14">- </span><span class="c5">loaded</span><span class="c2">: un num&#259;r
            &icirc;ntreg de 64 de bi&#539;i f&#259;r&#259; semn, care indic&#259; volumul de date deja
            &icirc;nc&#259;rcat.</span></p>
    <p class="c9 c12"><span class="c2"></span></p>
    <p class="c9 c13"><span class="c14">- </span><span class="c5">total</span><span class="c2">: un num&#259;r
            &icirc;ntreg de 64 de bi&#539;i f&#259;r&#259; semn, care stocheaz&#259; cantitatea total&#259; de date care
            urmeaz&#259; s&#259; fie &icirc;nc&#259;rcate.</span></p>
    <p class="c9 c12"><span class="c2"></span></p>
    <p class="c9 c13"><span class="c2">De exemplu, lua&#539;i &icirc;n considerare urm&#259;toarea pagin&#259;:</span>
    </p>
    <p class="c9 c12"><span class="c2"></span></p><a id="t.c26798976e3531ffae26acc636d07de61c0d7452"></a><a
        id="t.0"></a>
    <table class="c1">
        <tr class="c7">
            <td class="c10" colspan="1" rowspan="1">
                <p class="c9"><span class="c4">&lt;!DOCTYPE html&gt;<br>&lt;html&gt;<br>&lt;head&gt;<br> &nbsp;
                        &nbsp;&lt;meta charset=&quot;utf-8&quot; /&gt;<br> &nbsp;
                        &nbsp;&lt;title&gt;FDC.COM&lt;/title&gt;<br> &nbsp; &nbsp;&lt;style&gt;<br> &nbsp;
                        &nbsp;#progress {width:0; height:100%; background-color:#ccc;}<br> &nbsp; &nbsp;#progress-bar
                        {width:100px; height:20px; border:1px solid #888;}<br> &nbsp;
                        &nbsp;&lt;/style&gt;<br>&lt;/head&gt;<br>&lt;body&gt;<br>&lt;input type=&quot;file&quot;
                        id=&quot;files&quot; multiple /&gt;&lt;br&gt;&lt;br&gt;<br>&lt;div
                        id=&quot;progress-bar&quot;&gt;<br> &nbsp; &nbsp;&lt;div
                        id=&quot;progress&quot;&gt;&lt;/div&gt;<br>&lt;/div&gt;<br>&lt;script&gt;<br>const progressbar =
                        document.getElementById(&quot;progress-bar&quot;);<br>const progress =
                        document.getElementById(&quot;progress&quot;);<br>// urm&#259;rim progresul
                        &icirc;nc&#259;rc&#259;rii<br>function updateProgress(e) { &nbsp;<br> &nbsp; &nbsp;if
                        (e.lengthComputable) { &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;const percentLoaded =
                        Math.round((e.loaded / e.total) * 100); &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;if
                        (percentLoaded &lt; 100) { &nbsp; &nbsp; &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        &nbsp;progress.style.width = percentLoaded + &quot;%&quot;; &nbsp; &nbsp; &nbsp;<br> &nbsp;
                        &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;progress.textContent = percentLoaded + &quot;%&quot;;<br>
                        &nbsp; &nbsp; &nbsp; &nbsp;} <br> &nbsp; &nbsp;}<br>}<br>// gestion&#259;m selectarea
                        fi&#537;ierelor<br>function handleFileSelected(event) { <br> &nbsp; &nbsp;progress.style.width =
                        &quot;0%&quot;; &nbsp;<br> &nbsp; &nbsp;progress.textContent = &quot;0%&quot;; &nbsp;<br> <br>
                        &nbsp; &nbsp;const reader = new FileReader();<br> &nbsp; &nbsp;reader.onprogress =
                        updateProgress; &nbsp;<br> &nbsp; &nbsp;reader.onerror = (e) =&gt;
                        console.error(e.target.error); &nbsp;<br> &nbsp; &nbsp;reader.onload = () =&gt; { &nbsp;
                        &nbsp;<br> &nbsp; &nbsp; &nbsp; &nbsp;progress.style.width = &quot;100%&quot;; &nbsp; &nbsp;<br>
                        &nbsp; &nbsp; &nbsp; &nbsp;progress.textContent = &quot;100%&quot;;<br> &nbsp; &nbsp;};<br>
                        &nbsp; &nbsp;if(event.target.files.length&gt;0)
                        reader.readAsBinaryString(event.target.files[0]);<br>}<br>document.getElementById(&quot;files&quot;).addEventListener(&quot;change&quot;,
                        handleFileSelected);<br>&lt;/script&gt;<br>&lt;/body&gt;<br>&lt;/html&gt;</span></p>
            </td>
        </tr>
    </table>
    <p class="c9 c12"><span class="c2"></span></p>
    <p class="c9 c13"><span class="c14">Pe pagina este definit elementul input pentru alegerea fisierului. Pentru a
            indica incarcarea fisierului, pe pagina este definit elementul </span><span class="c11">div
            id=&quot;progress-bar&quot;</span><span class="c14">&nbsp;cu un element imbricat </span><span
            class="c11">div id=&quot;percent&quot;</span><span class="c2">.</span></p>
    <p class="c9 c12"><span class="c2"></span></p>
    <p class="c9 c13"><span class="c14">Ca handler pentru evenimentul </span><span class="c5">change </span><span
            class="c14">al acestui element input este utilizata functia </span><span
            class="c11">handleFileSelected</span><span class="c2">. In aceasta, setam valorile initiale pentru
            indicatorul de incarcare:</span></p>
    <p class="c9 c12"><span class="c2"></span></p><a id="t.b8a2e40cee62d231315b2c1034ec13480b2fff6d"></a><a
        id="t.1"></a>
    <table class="c1">
        <tr class="c7">
            <td class="c10" colspan="1" rowspan="1">
                <p class="c9"><span class="c4">progress.style.width = </span><span class="c0">&quot;0%&quot;</span><span
                        class="c4">;<br>progress.textContent = </span><span class="c0">&quot;0%&quot;</span><span
                        class="c4">;</span></p>
            </td>
        </tr>
    </table>
    <p class="c9 c12"><span class="c2"></span></p>
    <p class="c9 c13"><span class="c14">Apoi, cream un obiect FileReader si pentru evenimentul sau </span><span
            class="c5">progress </span><span class="c2">ca handler aplicam functia updateProgress. In aceasta functie,
            calculam starea curenta a incarcarii si actualizam corespunzator latimea si textul elementului
            progress.</span></p>
    <p class="c9 c12"><span class="c2"></span></p><a id="t.3ff1aa5b00740cf1ba7e305bbca5ed8efa4b7e51"></a><a
        id="t.2"></a>
    <table class="c1">
        <tr class="c7">
            <td class="c10" colspan="1" rowspan="1">
                <p class="c9"><span class="c8">function</span><span class="c4">&nbsp;</span><span
                        class="c6">updateProgress</span><span class="c4">(e) {<br> &nbsp; &nbsp;</span><span
                        class="c8">if</span><span class="c4">&nbsp;(e.lengthComputable) {<br> &nbsp; &nbsp; &nbsp;
                        &nbsp;</span><span class="c8">const</span><span class="c4">&nbsp;percentLoaded = </span><span
                        class="c6">Math</span><span class="c4">.round((e.loaded / e.total) * </span><span
                        class="c14 c15">100</span><span class="c4">);<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span
                        class="c8">if</span><span class="c4">&nbsp;(percentLoaded &lt; </span><span
                        class="c14 c15">100</span><span class="c4">) {<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
                        &nbsp;progress.style.width = percentLoaded + </span><span class="c0">&quot;%&quot;</span><span
                        class="c4">;<br> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;progress.textContent = percentLoaded +
                    </span><span class="c0">&quot;%&quot;</span><span class="c4">;<br> &nbsp; &nbsp; &nbsp; &nbsp;}<br>
                        &nbsp; &nbsp;}<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c9 c12"><span class="c2"></span></p>
    <p class="c9 c13"><span class="c2">Deoarece pentru elementul progress se utilizeaza o culoare de fundal gri,
            cresterea latimii va duce la marirea zonei colorate, ceea ce va fi un indicator al incarcarii. Mai mult,
            prin textul elementului vom putea vedea procentul de date al fisierului incarcat.</span></p>
    <p class="c9 c12"><span class="c2"></span></p>
    <p class="c9 c13"><span class="c14">Cand incarcarea este completa, la obiectul FileReader se declanseaza evenimentul
        </span><span class="c5">load</span><span class="c2">, unde setam valorile finale pentru elementul
            progress.</span></p>
    <p class="c9 c12"><span class="c2"></span></p><a id="t.9e8f5d4471664c841ea4c0e11d1ba319557aa127"></a><a
        id="t.3"></a>
    <table class="c1">
        <tr class="c7">
            <td class="c10" colspan="1" rowspan="1">
                <p class="c9"><span class="c4">reader.onload = () =&gt; {<br> &nbsp; &nbsp;progress.style.width =
                    </span><span class="c0">&quot;100%&quot;</span><span class="c4">;<br> &nbsp;
                        &nbsp;progress.textContent = </span><span class="c0">&quot;100%&quot;</span><span
                        class="c4">;<br>};</span></p>
            </td>
        </tr>
    </table>
    <p class="c9 c12"><span class="c2"></span></p>
    <p class="c9 c13"><span class="c2">La sfarsitul handler-ului de selectie a fisierului, incepem incarcarea acestuia
            ca un set de octeti:</span></p>
    <p class="c9 c12"><span class="c2"></span></p><a id="t.58af45dd880987a9b368226c1f83065526d7d782"></a><a
        id="t.4"></a>
    <table class="c1">
        <tr class="c7">
            <td class="c10" colspan="1" rowspan="1">
                <p class="c9"><span class="c8">if</span><span class="c4">(event.target.files.length&gt;</span><span
                        class="c14 c15">0</span><span class="c4">)
                        reader.readAsBinaryString(event.target.files[</span><span class="c14 c15">0</span><span
                        class="c4">]);</span></p>
            </td>
        </tr>
    </table>
    <p class="c9 c12"><span class="c2"></span></p>
    <p class="c9 c13"><span class="c2">Pentru a demonstra procesarea progresului incarcarii aici nu sunt utilizate
            datele incarcate, dar, desigur, putem obtine aceste date, asa cum a fost descris in articolul anterior, si
            le putem folosi in vreun fel.</span></p>
    <p class="c9 c12"><span class="c2"></span></p>
    <p class="c9 c13"><span class="c2">Astfel, la alegerea unui fisier, va incepe incarcarea, iar elementul progress va
            afisa indicatia de incarcare.</span></p>
    <p class="c9 c12"><span class="c2"></span></p>
    <p class="c9 c13"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 612.00px; height: 201.00px;"><img
                alt="" src="images/image1.png"
                style="width: 612.00px; height: 201.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
                title=""></span></p>
</body>

</html>