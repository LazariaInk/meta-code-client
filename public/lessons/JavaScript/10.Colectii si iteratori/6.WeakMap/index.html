<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <link rel="stylesheet" type="text/css" href="/lessons/styles.css">
</head>

<body class="c19 doc-content">
    <h1 class="c13 c15" id="h.gwveq2hz5rty"> WeakMap. </h1>
    <p class="c3"><span class="c9"></span></p>
    <p class="c4 c13"><span class="c9">WeakMap reprezint&#259; o extensie a colec&#539;iei Map. Caracteristica
            distinctiv&#259; a WeakMap este c&#259; toate elementele sale trebuie s&#259; reprezinte obiecte. &Icirc;n
            acela&#537;i timp, cheile trebuie s&#259; fie obiecte.</span></p>
    <p class="c3"><span class="c9"></span></p>
    <p class="c4 c13"><span class="c9">Crearea WeakMap:</span></p>
    <p class="c3"><span class="c9"></span></p><a id="t.d5b30db7f608c9a596f6cc12c66d8c9847534608"></a><a id="t.0"></a>
    <table class="c5">
        <tr class="c12">
            <td class="c0" colspan="1" rowspan="1">
                <p class="c4"><span class="c2">// WeakMap gol</span><span class="c1"><br></span><span
                        class="c10">const</span><span class="c1">&nbsp;weakMap1 = </span><span
                        class="c10">new</span><span class="c1">&nbsp;</span><span class="c11">WeakMap</span><span
                        class="c1">();<br><br></span><span class="c2">// WeakMap cu ini&#539;ializare de
                        date</span><span class="c1"><br></span><span class="c10">let</span><span class="c1">&nbsp;key1 =
                        { key: </span><span class="c6">1</span><span class="c1">&nbsp;};<br></span><span
                        class="c10">let</span><span class="c1">&nbsp;key2 = { key: </span><span class="c6">2</span><span
                        class="c1">&nbsp;};<br></span><span class="c10">let</span><span class="c1">&nbsp;value1 = {
                        name: </span><span class="c8">&quot;Tom&quot;</span><span class="c1">&nbsp;};<br></span><span
                        class="c10">let</span><span class="c1">&nbsp;value2 = { name: </span><span
                        class="c8">&quot;Sam&quot;</span><span class="c1">&nbsp;};<br><br></span><span
                        class="c10">const</span><span class="c1">&nbsp;weakMap2 = </span><span
                        class="c10">new</span><span class="c1">&nbsp;</span><span class="c11">WeakMap</span><span
                        class="c1">([[key1, value1], [key2, value2]]);<br></span><span class="c2">// sau</span><span
                        class="c1"><br></span><span class="c2">// const weakMap2 = new WeakMap([[{key:1}, {name:
                        &quot;Tom&quot;}], [{key:2}, {name: &quot;Sam&quot;}]]);</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c9"></span></p>
    <p class="c4 c13"><span class="c9">Trebuie men&#539;ionat c&#259; obiectul WeakMap nu suport&#259; iterarea.</span>
    </p>
    <p class="c3"><span class="c9"></span></p>
    <p class="c4 c13"><span class="c20">Pentru ad&#259;ugarea de noi obiecte sau modificarea celor existente, se
            folose&#537;te metoda </span><span class="c17">set()</span><span class="c9">:</span></p>
    <p class="c3"><span class="c9"></span></p><a id="t.80c661b7561ab424ebc95e93679c3a2765bdd302"></a><a id="t.1"></a>
    <table class="c5">
        <tr class="c12">
            <td class="c0" colspan="1" rowspan="1">
                <p class="c4"><span class="c10">let</span><span class="c1">&nbsp;key1 = {key:</span><span
                        class="c6">1</span><span class="c1">};<br></span><span class="c10">let</span><span
                        class="c1">&nbsp;key2 = {key:</span><span class="c6">2</span><span class="c1">};<br></span><span
                        class="c10">let</span><span class="c1">&nbsp;value1 = {name: </span><span
                        class="c8">&quot;Tom&quot;</span><span class="c1">};<br></span><span class="c10">let</span><span
                        class="c1">&nbsp;value2 = {name: </span><span class="c8">&quot;Sam&quot;</span><span
                        class="c1">};<br> <br></span><span class="c10">const</span><span class="c1">&nbsp;weakMap2 =
                    </span><span class="c10">new</span><span class="c1">&nbsp;</span><span
                        class="c11">WeakMap</span><span class="c1">([[key1, value1]]);<br>weakMap2.set(key2,
                        value2);<br>weakMap2.set(key1, {name: </span><span class="c8">&quot;Kate&quot;</span><span
                        class="c1">});<br></span><span class="c11">console</span><span
                        class="c1">.log(weakMap2.get(key1)); &nbsp; &nbsp;</span><span class="c2">//{name:
                        &quot;Kate&quot;}</span><span class="c1"><br></span><span class="c11">console</span><span
                        class="c1">.log(weakMap2.get(key2)); &nbsp; &nbsp;</span><span class="c2">//{name:
                        &quot;Sam&quot;}</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c9"></span></p>
    <p class="c4 c13"><span class="c20">Pentru a ob&#539;ine obiecte &icirc;n func&#539;ie de cheie dintr-un WeakMap, se
            utilizeaz&#259; metoda </span><span class="c17">get()</span><span class="c9">:</span></p>
    <p class="c3"><span class="c9"></span></p><a id="t.42b61629ec5e4f8209eedcbb3f323aff55714f72"></a><a id="t.2"></a>
    <table class="c5">
        <tr class="c12">
            <td class="c0" colspan="1" rowspan="1">
                <p class="c4"><span class="c10">let</span><span class="c1">&nbsp;key1 = {key:</span><span
                        class="c6">1</span><span class="c1">};<br></span><span class="c10">let</span><span
                        class="c1">&nbsp;key2 = {key:</span><span class="c6">2</span><span class="c1">};<br></span><span
                        class="c10">let</span><span class="c1">&nbsp;value1 = {name: </span><span
                        class="c8">&quot;Tom&quot;</span><span class="c1">};<br></span><span class="c10">let</span><span
                        class="c1">&nbsp;value2 = {name: </span><span class="c8">&quot;Sam&quot;</span><span
                        class="c1">};<br> <br></span><span class="c10">const</span><span class="c1">&nbsp;weakMap2 =
                    </span><span class="c10">new</span><span class="c1">&nbsp;</span><span
                        class="c11">WeakMap</span><span class="c1">([[key1, value1], [key2, value2]]);<br></span><span
                        class="c11">console</span><span class="c1">.log(weakMap2.get(key1)); &nbsp; &nbsp;</span><span
                        class="c2">// {name: &quot;Tom&quot;}</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c9"></span></p>
    <p class="c4 c13"><span class="c20">Pentru a verifica existen&#539;a unui element &icirc;n func&#539;ie de o
            anumit&#259; cheie, se utilizeaz&#259; metoda </span><span class="c17">has()</span><span class="c20">, care
            returneaz&#259; </span><span class="c16">true </span><span class="c9">&icirc;n cazul &icirc;n care elementul
            exist&#259;:</span></p>
    <p class="c3"><span class="c9"></span></p><a id="t.dadbb163d0ace6e6ff3d171a6c7bce588f81c31f"></a><a id="t.3"></a>
    <table class="c5">
        <tr class="c12">
            <td class="c0" colspan="1" rowspan="1">
                <p class="c4"><span class="c10">let</span><span class="c1">&nbsp;key1 = {key:</span><span
                        class="c6">1</span><span class="c1">},<br> &nbsp; &nbsp;key2 = {key:</span><span
                        class="c6">2</span><span class="c1">};<br></span><span class="c10">let</span><span
                        class="c1">&nbsp;value1 = {name: </span><span class="c8">&quot;Tom&quot;</span><span
                        class="c1">},<br> &nbsp; &nbsp;value2 = {name: </span><span
                        class="c8">&quot;Sam&quot;</span><span class="c1">};<br> <br></span><span
                        class="c10">const</span><span class="c1">&nbsp;weakMap2 = </span><span
                        class="c10">new</span><span class="c1">&nbsp;</span><span class="c11">WeakMap</span><span
                        class="c1">([[key1, value1]]);<br></span><span class="c11">console</span><span
                        class="c1">.log(weakMap2.has(key1)); &nbsp; &nbsp;</span><span class="c2">// true</span><span
                        class="c1"><br></span><span class="c11">console</span><span class="c1">.log(weakMap2.has(key2));
                        &nbsp; &nbsp;</span><span class="c2">// false</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c9"></span></p>
    <p class="c4 c13"><span class="c20">Pentru a &#537;terge un element &icirc;n func&#539;ie de o anumit&#259; cheie,
            se utilizeaz&#259; metoda</span><span class="c17">&nbsp;delete()</span><span class="c9">:</span></p>
    <p class="c3"><span class="c9"></span></p><a id="t.73e4fa65d8efac110dbd47c684c44387f8f11ecf"></a><a id="t.4"></a>
    <table class="c5">
        <tr class="c12">
            <td class="c0" colspan="1" rowspan="1">
                <p class="c4"><span class="c10">let</span><span class="c1">&nbsp;key1 = {key:</span><span
                        class="c6">1</span><span class="c1">},<br> &nbsp; &nbsp;key2 = {key:</span><span
                        class="c6">2</span><span class="c1">};<br></span><span class="c10">let</span><span
                        class="c1">&nbsp;value1 = {name: </span><span class="c8">&quot;Tom&quot;</span><span
                        class="c1">},<br> &nbsp; &nbsp;value2 = {name: </span><span
                        class="c8">&quot;Sam&quot;</span><span class="c1">};<br> <br></span><span
                        class="c10">const</span><span class="c1">&nbsp;weakMap2 = </span><span
                        class="c10">new</span><span class="c1">&nbsp;</span><span class="c11">WeakMap</span><span
                        class="c1">([[key1, value1], [key2, value2]]);<br></span><span class="c11">console</span><span
                        class="c1">.log(weakMap2.has(key1)); &nbsp; &nbsp;</span><span class="c2">// true</span><span
                        class="c1"><br>weakMap2.delete(key1);<br></span><span class="c11">console</span><span
                        class="c1">.log(weakMap2.has(key1)); &nbsp; &nbsp;</span><span class="c2">// false</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c9"></span></p>
    <p class="c4 c13"><span class="c14">Referin&#539;e slabe.</span></p>
    <p class="c3"><span class="c7"></span></p>
    <p class="c4 c13"><span class="c9">Obiectele sunt ad&#259;ugate &icirc;ntr-un WeakMap prin referin&#539;&#259;. O
            caracteristic&#259; distinctiv&#259; a WeakMap este c&#259; atunci c&acirc;nd un obiect &icirc;nceteaz&#259;
            s&#259; mai existe din diverse motive, el este eliminat din WeakMap. S&#259; lu&#259;m &icirc;n considerare
            urm&#259;torul exemplu:</span></p>
    <p class="c3"><span class="c9"></span></p><a id="t.cdd55c046e73ef90fd5aff31a1c2903f6f259348"></a><a id="t.5"></a>
    <table class="c5">
        <tr class="c12">
            <td class="c0" colspan="1" rowspan="1">
                <p class="c4"><span class="c10">let</span><span class="c1">&nbsp;jsCode = {code: </span><span
                        class="c8">&quot;js&quot;</span><span class="c1">},<br> &nbsp; &nbsp;tsCode = {code:
                    </span><span class="c8">&quot;ts&quot;</span><span class="c1">};<br></span><span
                        class="c10">let</span><span class="c1">&nbsp;js = {lang: </span><span
                        class="c8">&quot;JavaScript&quot;</span><span class="c1">},<br> &nbsp; &nbsp;ts = {lang:
                    </span><span class="c8">&quot;TypeScript&quot;</span><span class="c1">};<br></span><span
                        class="c10">const</span><span class="c1">&nbsp;weakMap = </span><span
                        class="c10">new</span><span class="c1">&nbsp;</span><span class="c11">WeakMap</span><span
                        class="c1">([[jsCode, js], [tsCode, ts]]);<br> <br>jsCode = </span><span
                        class="c10">null</span><span class="c1">;<br> <br></span><span class="c11">console</span><span
                        class="c1">.log(weakMap); &nbsp; </span><span class="c2">// WeakMap {{code: &quot;js&quot;}
                        =&gt; {lang: &quot;JavaScript&quot;}, {code: &quot;ts&quot;} =&gt; {lang:
                        &quot;TypeScript&quot;}}</span><span class="c1"><br></span><span class="c11">console</span><span
                        class="c1">.log(</span><span class="c8">&quot;Anumite opera&#539;ii&quot;</span><span
                        class="c1">);<br></span><span class="c10">const</span><span class="c1">&nbsp;timerId =
                        setTimeout(</span><span class="c10">function</span><span class="c1">(){<br> &nbsp;
                        &nbsp;</span><span class="c11">console</span><span class="c1">.log(weakMap); &nbsp; </span><span
                        class="c2">// WeakMap {{code: &quot;ts&quot;} =&gt; {lang: &quot;TypeScript&quot;}}</span><span
                        class="c1"><br> &nbsp; &nbsp;clearTimeout(timerId);<br>}, </span><span
                        class="c6">30000</span><span class="c1">);</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c9"></span></p>
    <p class="c4 c13"><span class="c9">&Icirc;n acest caz, mai &icirc;nt&acirc;i obiectul WeakMap stocheaz&#259;
            referin&#539;e c&#259;tre dou&#259; elemente cu cheile jsCode &#537;i tsCode. Apoi, valoarea variabilei
            jsCode este setat&#259; la null.</span></p>
    <p class="c3"><span class="c9"></span></p><a id="t.6e6b93c5bbf136c2547b521113bd54b3272a3c1b"></a><a id="t.6"></a>
    <table class="c5">
        <tr class="c12">
            <td class="c0" colspan="1" rowspan="1">
                <p class="c4"><span class="c1">jsCode = </span><span class="c10">null</span><span class="c1">;</span>
                </p>
            </td>
        </tr>
    </table>
    <p class="c4 c18"><span class="c9"></span></p>
    <p class="c4"><span class="c9">Acest lucru va duce la faptul c&#259;, dup&#259; un anumit timp, valoarea
            ini&#539;ial&#259; a acestei variabile va fi eliminat&#259; de c&#259;tre colectorul de gunoi
            JavaScript.</span></p>
    <p class="c4 c18"><span class="c9"></span></p>
    <p class="c4"><span class="c9">Dac&#259; imediat dup&#259; aceasta verific&#259;m con&#539;inutul weakMap, vom vedea
            c&#259; obiectul cu cheia jsCode &icirc;nc&#259; se afl&#259; &icirc;n el. Cu toate acestea, dup&#259; un
            timp, referin&#539;a va fi eliminat&#259; din weakMap. Pentru a simula trecerea timpului, aici se
            utilizeaz&#259; func&#539;ia setTimeout, care afi&#537;eaz&#259; con&#539;inutul weakMap la 10000 de
            milisecunde (perioada de timp specific&#259; dup&#259; care colectorul de gunoi va &#537;terge valoarea
            poate diferi).</span></p>
    <p class="c4 c18"><span class="c9"></span></p>
    <p class="c4"><span class="c20">Acum, s&#259; compar&#259;m cu ceea ce se &icirc;nt&acirc;mpl&#259; dac&#259;
            folosim </span><span class="c17">Map </span><span class="c9">&icirc;n loc de WeakMap:</span></p>
    <p class="c4 c18"><span class="c9"></span></p><a id="t.6e97122c04d7d53e4d400887b106d9dcbe62e44f"></a><a
        id="t.7"></a>
    <table class="c5">
        <tr class="c12">
            <td class="c0" colspan="1" rowspan="1">
                <p class="c4"><span class="c10">let</span><span class="c1">&nbsp;jsCode = {code: </span><span
                        class="c8">&quot;js&quot;</span><span class="c1">},<br> &nbsp; &nbsp;tsCode = {code:
                    </span><span class="c8">&quot;ts&quot;</span><span class="c1">};<br></span><span
                        class="c10">let</span><span class="c1">&nbsp;js = {lang: </span><span
                        class="c8">&quot;JavaScript&quot;</span><span class="c1">},<br> &nbsp; &nbsp;ts = {lang:
                    </span><span class="c8">&quot;TypeScript&quot;</span><span class="c1">};<br></span><span
                        class="c10">const</span><span class="c1">&nbsp;map = </span><span class="c10">new</span><span
                        class="c1">&nbsp;</span><span class="c11">Map</span><span class="c1">([[jsCode, js], [tsCode,
                        ts]]);<br> <br>jsCode = </span><span class="c10">null</span><span class="c1">;<br>
                        <br></span><span class="c11">console</span><span class="c1">.log(map); &nbsp; </span><span
                        class="c2">// Map(2) {{code: &quot;js&quot;} =&gt; {lang: &quot;JavaScript&quot;}, {code:
                        &quot;ts&quot;} =&gt; {lang: &quot;TypeScript&quot;}}</span><span class="c1"><br></span><span
                        class="c11">console</span><span class="c1">.log(</span><span class="c8">&quot;Anumite
                        opera&#539;ii&quot;</span><span class="c1">);<br></span><span class="c10">const</span><span
                        class="c1">&nbsp;timerId = setTimeout(</span><span class="c10">function</span><span
                        class="c1">(){<br> &nbsp; &nbsp;</span><span class="c11">console</span><span
                        class="c1">.log(map); &nbsp; </span><span class="c2">// Map(2) {{code: &quot;js&quot;} =&gt;
                        {lang: &quot;JavaScript&quot;}, {code: &quot;ts&quot;} =&gt; {lang:
                        &quot;TypeScript&quot;}}</span><span class="c1"><br> &nbsp; &nbsp;clearTimeout(timerId);<br>},
                    </span><span class="c6">30000</span><span class="c1">);</span></p>
            </td>
        </tr>
    </table>
    <p class="c4 c18"><span class="c9"></span></p>
    <p class="c4"><span class="c20">&Icirc;n cazul unui Map, chiar &#537;i dup&#259; un anumit timp, vom observa c&#259;
            obiectul pentru care a fost setat&#259; valoarea </span><span class="c16">null </span><span class="c9">este
            &icirc;nc&#259; prezent &icirc;n obiectul Map.</span></p>
</body>

</html>