<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <link rel="stylesheet" type="text/css" href="/lessons/styles.css">
</head>

<body class="c16 doc-content">
    <h1 class="c5 c28 c30">Gestionarea bazei de date Ã®n IndexedDB. </h1>
    <p class="c5 c6"><span class="c0"></span></p>
    <p class="c5"><span class="c8">Baza de date &icirc;n </span><span class="c10">IndexedDB API </span><span
            class="c8">este reprezentat&#259; de interfa&#539;a </span><span class="c10">IDBDatabase</span><span
            class="c0">, care asigur&#259; conexiunea cu baza de date, gestionarea magazinelor sale &#537;i crearea
            interog&#259;rilor c&#259;tre date. Parametrii bazei de date pot fi ob&#539;inu&#539;i utiliz&acirc;nd
            urm&#259;toarele propriet&#259;&#539;i IDBDatabase:</span></p>
    <p class="c5 c6"><span class="c0"></span></p>
    <ul class="c22 lst-kix_keg9ssasmuz2-0 start">
        <li class="c4 li-bullet-0"><span class="c10">name</span><span class="c0">: returneaz&#259; numele bazei de date
                conectate</span></li>
    </ul>
    <p class="c2"><span class="c0"></span></p>
    <ul class="c22 lst-kix_keg9ssasmuz2-0">
        <li class="c4 li-bullet-0"><span class="c10">version</span><span class="c0">: returneaz&#259; num&#259;rul
                versiunii bazei de date. La crearea bazei de date, acest atribut reprezint&#259; un &#537;ir gol.</span>
        </li>
    </ul>
    <p class="c2"><span class="c0"></span></p>
    <ul class="c22 lst-kix_keg9ssasmuz2-0">
        <li class="c4 li-bullet-0"><span class="c10">objectStoreNames</span><span class="c0">: returneaz&#259; lista de
                nume ale magazinelor (obiect DOMStringList), care exist&#259; &icirc;n prezent &icirc;n baza de date
                conectat&#259;</span></li>
    </ul>
    <p class="c5 c6"><span class="c0"></span></p>
    <p class="c5"><span class="c0">De exemplu, ob&#539;inem informa&#539;ii despre baza de date la conectare:</span></p>
    <p class="c5 c6"><span class="c0"></span></p><a id="t.ac00d1fc71ee06c5dedde38e68f95058a75811a5"></a><a id="t.0"></a>
    <table class="c12">
        <tr class="c15">
            <td class="c18" colspan="1" rowspan="1">
                <p class="c23"><span class="c7">const</span><span class="c1">&nbsp;request = indexedDB.open(</span><span
                        class="c8 c14">&quot;test&quot;</span><span class="c1">); </span><span class="c3">// ne
                        conect&#259;m la bd test</span><span class="c1"><br></span><span class="c3">// la deschiderea
                        reu&#537;it&#259; se activeaz&#259; evenimentul success</span><span class="c1"><br></span><span
                        class="c3">// proces&#259;m acest eveniment</span><span class="c1"><br>request.onsuccess =
                        (event) =&gt; { &nbsp;<br> &nbsp; &nbsp;</span><span class="c7">const</span><span
                        class="c1">&nbsp;database = event.target.result; &nbsp;</span><span class="c3">// acces&#259;m
                        baza de date &nbsp;</span><span class="c1"><br> &nbsp; &nbsp;</span><span
                        class="c8 c19">console</span><span class="c1">.log(database.name); &nbsp; &nbsp; &nbsp; &nbsp;
                        &nbsp; &nbsp;</span><span class="c3">// numele bazei de date - &quot;Test&quot;
                        &nbsp;</span><span class="c1"><br> &nbsp; &nbsp;</span><span class="c8 c19">console</span><span
                        class="c1">.log(database.version); &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="c3">//
                        versiunea bazei de date </span><span class="c1"><br> &nbsp; &nbsp;</span><span
                        class="c8 c19">console</span><span class="c1">.log(database.objectStoreNames); </span><span
                        class="c3">// lista magazinelor din baza de date</span><span class="c1"><br>};</span></p>
            </td>
        </tr>
    </table>
    <p class="c5 c6"><span class="c0"></span></p>
    <p class="c5"><span class="c0">Pe l&acirc;ng&#259; propriet&#259;&#539;i, obiectul IDBDatabase ofer&#259; o serie de
            metode pentru gestionarea conexiunii &#537;i a magazinelor:</span></p>
    <p class="c5 c6"><span class="c0"></span></p>
    <ul class="c22 lst-kix_uktb71bdwzr1-0 start">
        <li class="c4 li-bullet-0"><span class="c10">close()</span><span class="c0">: &icirc;nchide conexiunea cu baza
                de date</span></li>
    </ul>
    <p class="c2"><span class="c0"></span></p>
    <ul class="c22 lst-kix_uktb71bdwzr1-0">
        <li class="c4 li-bullet-0"><span class="c10">createObjectStore()</span><span class="c0">: creeaz&#259; un
                magazin</span></li>
    </ul>
    <p class="c2"><span class="c0"></span></p>
    <ul class="c22 lst-kix_uktb71bdwzr1-0">
        <li class="c4 li-bullet-0"><span class="c10">deleteObjectStore()</span><span class="c0">: &#537;terge un
                magazin</span></li>
    </ul>
    <p class="c5 c6"><span class="c0"></span></p>
    <ul class="c22 lst-kix_v68078cnluya-0 start">
        <li class="c4 li-bullet-0"><span class="c10">transaction()</span><span class="c8">: returneaz&#259; un obiect de
                tranzac&#539;ie - obiect </span><span class="c10">IDBTransaction</span><span class="c0">, care este
                utilizat pentru accesarea magazinului &#537;i efectuarea ulterioar&#259; a unei interog&#259;ri
                c&#259;tre date</span></li>
    </ul>
    <p class="c5 c6"><span class="c0"></span></p>
    <p class="c5"><span class="c0">Este de remarcat c&#259; crearea unui magazin este posibil&#259; doar la crearea
            bazei de date sau la modificarea versiunii acesteia. &#536;tergerea unui magazin este posibil&#259; doar la
            modificarea versiunii bazei de date.</span></p>
    <p class="c5 c6"><span class="c0"></span></p>
    <p class="c5"><span class="c27">Crearea unui magazin de obiecte.</span></p>
    <p class="c5 c6"><span class="c28 c10"></span></p>
    <p class="c5"><span class="c8">Astfel, pentru crearea unui magazin de obiecte se utilizeaz&#259; metoda </span><span
            class="c10">createObjectStore()</span><span class="c0">:</span></p>
    <p class="c5 c6"><span class="c0"></span></p><a id="t.1ee11a23bcfe9ffd2fe9e4e97fd661b707a2e129"></a><a id="t.1"></a>
    <table class="c12">
        <tr class="c15">
            <td class="c18" colspan="1" rowspan="1">
                <p class="c23"><span class="c1">createObjectStore(name)<br>createObjectStore(name, options)</span></p>
            </td>
        </tr>
    </table>
    <p class="c5 c6"><span class="c0"></span></p>
    <p class="c5"><span class="c0">&Icirc;n aceast&#259; metod&#259; se transmite numele magazinului. Ca al doilea
            parametru op&#539;ional, se poate transmite &#537;i un obiect de configurare a magazinului. Acest obiect
            poate include dou&#259; propriet&#259;&#539;i:</span></p>
    <p class="c5 c6"><span class="c0"></span></p>
    <ul class="c22 lst-kix_hohw3uj0d0td-0 start">
        <li class="c4 li-bullet-0"><span class="c8">&nbsp;</span><span class="c10">keyPath</span><span class="c0">:
                specific&#259; numele propriet&#259;&#539;ii-cheie a obiectului</span></li>
    </ul>
    <p class="c2"><span class="c0"></span></p>
    <ul class="c22 lst-kix_hohw3uj0d0td-0">
        <li class="c4 li-bullet-0"><span class="c8">&nbsp;</span><span class="c10">autoIncrement</span><span
                class="c8">: dac&#259; are valoarea </span><span class="c8 c9">true</span><span class="c8">, valorile
                cheilor sunt generate automat. Implicit, valoarea este </span><span class="c8 c9">false </span><span
                class="c0">(cheile nu sunt generate)</span></li>
    </ul>
    <p class="c5 c6"><span class="c0"></span></p>
    <p class="c5"><span class="c8">Combina&#539;iile acestor parametri sunt foarte importante. &Icirc;n IndexedDB,
            fiecare obiect este stocat sub o anumit&#259; cheie, care ulterior poate fi utilizat&#259; pentru accesul la
            obiect. Ce anume este utilizat ca cheie este determinat de diferite combina&#539;ii ale parametrilor de
            configurare </span><span class="c8 c9">keyPath </span><span class="c8">&#537;i </span><span
            class="c8 c9">autoIncrement</span><span class="c0">:</span></p>
    <p class="c5 c6"><span class="c0"></span></p>
    <p class="c5 c6"><span class="c0"></span></p><a id="t.f5e27d8f02662ef8c9a49d21ecb954521ab35097"></a><a id="t.2"></a>
    <table class="c12">
        <tr class="c32">
            <td class="c17 c29" colspan="1" rowspan="1">
                <p class="c13"><span class="c10">keyPath</span></p>
            </td>
            <td class="c24 c29" colspan="1" rowspan="1">
                <p class="c13"><span class="c10">autoIncrement</span></p>
            </td>
            <td class="c21" colspan="1" rowspan="1">
                <p class="c13"><span class="c10">Descriere</span></p>
            </td>
        </tr>
        <tr class="c31">
            <td class="c17" colspan="1" rowspan="1">
                <p class="c13"><span class="c0">Nu este specificat</span></p>
            </td>
            <td class="c24" colspan="1" rowspan="1">
                <p class="c13"><span class="c0">FALSE</span></p>
            </td>
            <td class="c20" colspan="1" rowspan="1">
                <p class="c23"><span class="c0">Magazinul de obiecte poate stoca valori de orice tip (inclusiv valori de
                        tipuri primitive, cum ar fi numere &#537;i &#537;iruri de caractere). Totu&#537;i, cheia trebuie
                        indicat&#259; explicit de fiecare dat&#259; c&acirc;nd se adaug&#259; un nou obiect &icirc;n
                        baza de date.</span></p>
            </td>
        </tr>
        <tr class="c11">
            <td class="c17" colspan="1" rowspan="1">
                <p class="c13"><span class="c0">Specificat</span></p>
            </td>
            <td class="c24" colspan="1" rowspan="1">
                <p class="c13"><span class="c0">FALSE</span></p>
            </td>
            <td class="c20" colspan="1" rowspan="1">
                <p class="c23"><span class="c0">Magazinul de obiecte poate stoca doar obiecte (adic&#259; niciun tip de
                        date primitive). Totu&#537;i, aceste obiecte trebuie s&#259; aib&#259; o proprietate cu
                        acela&#537;i nume care este specificat &icirc;n parametrul keyPath.</span></p>
            </td>
        </tr>
        <tr class="c11">
            <td class="c17" colspan="1" rowspan="1">
                <p class="c13"><span class="c0">Nu este specificat</span></p>
            </td>
            <td class="c24" colspan="1" rowspan="1">
                <p class="c13"><span class="c0">TRUE</span></p>
            </td>
            <td class="c20" colspan="1" rowspan="1">
                <p class="c23"><span class="c0">Magazinul de obiecte poate stoca valori de orice tip (inclusiv valori de
                        tipuri primitive). Cheile obiectelor sunt generate automat la ad&#259;ugarea obiectelor.
                        Totu&#537;i, se poate de asemenea indica explicit cheia pentru obiect.</span></p>
            </td>
        </tr>
        <tr class="c25">
            <td class="c17" colspan="1" rowspan="1">
                <p class="c13"><span class="c0">Specificat</span></p>
            </td>
            <td class="c24" colspan="1" rowspan="1">
                <p class="c13"><span class="c0">TRUE</span></p>
            </td>
            <td class="c20" colspan="1" rowspan="1">
                <p class="c23"><span class="c0">Magazinul de obiecte poate stoca doar obiecte (adic&#259; niciun tip de
                        date primitive). Cheile sunt denumite a&#537;a cum este specificat &icirc;n parametrul keyPath.
                        Dac&#259; la obiect lipse&#537;te aceast&#259; proprietate, atunci valoarea cheii este
                        generat&#259; automat &#537;i ad&#259;ugat&#259; la obiectul nou. Dac&#259; proprietatea
                        exist&#259; deja &icirc;n obiect, atunci cheia nu este generat&#259;, ci se utilizeaz&#259;
                        valoarea cheii deja salvat&#259;.</span></p>
            </td>
        </tr>
    </table>
    <p class="c5 c6"><span class="c0"></span></p>
    <p class="c5 c6"><span class="c0"></span></p>
    <p class="c5"><span class="c0">De exemplu, cre&#259;m &icirc;n baza de date test un magazin cu numele
            &quot;users&quot;:</span></p>
    <p class="c5 c6"><span class="c0"></span></p><a id="t.2297b793e211cd148ea6db97dd5d7f530db9e61e"></a><a id="t.3"></a>
    <table class="c12">
        <tr class="c15">
            <td class="c18" colspan="1" rowspan="1">
                <p class="c23"><span class="c7">const</span><span class="c1">&nbsp;request = indexedDB.open(</span><span
                        class="c8 c14">&quot;test&quot;</span><span class="c1">, </span><span
                        class="c8 c26">2</span><span class="c1">); </span><span class="c3">// ne conect&#259;m la bd
                        test</span><span class="c1"><br><br></span><span class="c3">// proces&#259;m crearea bazei de
                        date sau modificarea versiunii</span><span class="c1"><br>request.onupgradeneeded = (event)
                        =&gt; { <br> &nbsp; &nbsp;</span><span class="c7">const</span><span class="c1">&nbsp;db =
                        event.target.result; &nbsp;</span><span class="c3">// ob&#539;inem bd</span><span
                        class="c1"><br> &nbsp; &nbsp;</span><span class="c3">// cre&#259;m magazinul de obiecte
                        users</span><span class="c1"><br> &nbsp; &nbsp;</span><span class="c7">const</span><span
                        class="c1">&nbsp;objectStore = db.createObjectStore(</span><span
                        class="c8 c14">&quot;users&quot;</span><span class="c1">, { keyPath: </span><span
                        class="c8 c14">&quot;id&quot;</span><span class="c1">, autoIncrement: </span><span
                        class="c7">true</span><span class="c1">&nbsp;});<br> &nbsp; &nbsp;</span><span
                        class="c8 c19">console</span><span class="c1">.log(objectStore); </span><span class="c3">//
                        IDBObjectStore {name: &quot;users&quot;, keyPath: &quot;id&quot;, indexNames: DOMStringList,
                        transaction: IDBTransaction, autoIncrement: true}</span><span class="c1"><br> &nbsp;
                        &nbsp;</span><span class="c8 c19">console</span><span class="c1">.log(db.objectStoreNames);
                    </span><span class="c3">// lista magazinelor din baza de date</span><span class="c1"><br>};</span>
                </p>
            </td>
        </tr>
    </table>
    <p class="c5 c6"><span class="c0"></span></p>
    <p class="c5"><span class="c8">&Icirc;n acest caz, cheia obiectelor va fi proprietatea &quot;id&quot;, iar valoarea
            sa va fi generat&#259; automat. Rezultatul metodei</span><span
            class="c8 c9">&nbsp;db.createObjectStore()</span><span class="c0">&nbsp;este obiectul magazinului creat,
            care reprezint&#259; tipul IDBObjectStore.</span></p>
    <p class="c5 c6"><span class="c0"></span></p>
    <p class="c5"><span class="c0">Este important de re&#539;inut c&#259;, dac&#259; la deschiderea bazei de date se
            m&#259;re&#537;te num&#259;rul versiunii, magazinele din versiunile vechi se p&#259;streaz&#259;.
            &Icirc;ncercarea de a recrea un magazin de obiecte existent va rezulta &icirc;ntr-o eroare.</span></p>
    <p class="c5 c6"><span class="c0"></span></p>
    <p class="c5"><span class="c27">&#536;tergerea unui magazin.</span></p>
    <p class="c5 c6"><span class="c10 c28"></span></p>
    <p class="c5"><span class="c8">Pentru &#537;tergerea unui magazin se utilizeaz&#259; metoda</span><span
            class="c10">&nbsp;deleteObjectStore()</span><span class="c0">, &icirc;n care se transmite numele magazinului
            care urmeaz&#259; s&#259; fie &#537;ters:</span></p>
    <p class="c5 c6"><span class="c0"></span></p><a id="t.1259c133ef58c8cd2c34436cf792b2d3330d6b80"></a><a id="t.4"></a>
    <table class="c12">
        <tr class="c15">
            <td class="c18" colspan="1" rowspan="1">
                <p class="c23"><span class="c7">const</span><span class="c1">&nbsp;request = indexedDB.open(</span><span
                        class="c8 c14">&quot;test&quot;</span><span class="c1">, </span><span
                        class="c8 c26">3</span><span class="c1">); </span><span class="c3">// ne conect&#259;m la bd
                        test</span><span class="c1"><br><br></span><span class="c3">// proces&#259;m modificarea
                        versiunii bazei de date</span><span class="c1"><br>request.onupgradeneeded = (event) =&gt; {
                        <br> &nbsp; &nbsp;</span><span class="c7">const</span><span class="c1">&nbsp;db =
                        event.target.result; &nbsp;</span><span class="c3">// ob&#539;inem bd</span><span
                        class="c1"><br> &nbsp; &nbsp;</span><span class="c3">// recre&#259;m magazinul users - mai
                        &icirc;nt&acirc;i &icirc;l &#537;tergem</span><span class="c1"><br> &nbsp;
                        &nbsp;db.deleteObjectStore(</span><span class="c8 c14">&quot;users&quot;</span><span
                        class="c1">); &nbsp;<br> &nbsp; &nbsp;</span><span class="c3">// apoi &icirc;l cre&#259;m din
                        nou</span><span class="c1"><br> &nbsp; &nbsp;db.createObjectStore(</span><span
                        class="c8 c14">&quot;users&quot;</span><span class="c1">, { keyPath: </span><span
                        class="c8 c14">&quot;id&quot;</span><span class="c1">, autoIncrement: </span><span
                        class="c7">true</span><span class="c1">&nbsp;});<br> &nbsp; &nbsp;</span><span
                        class="c8 c19">console</span><span class="c1">.log(db.objectStoreNames); </span><span
                        class="c3">// lista magazinelor din baza de date</span><span class="c1"><br>};</span></p>
            </td>
        </tr>
    </table>
    <p class="c5 c6"><span class="c0"></span></p>
</body>

</html>