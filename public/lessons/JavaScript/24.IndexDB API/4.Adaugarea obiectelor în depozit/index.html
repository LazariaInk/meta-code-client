<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <link rel="stylesheet" type="text/css" href="/lessons/styles.css">
</head>

<body class="c24 doc-content">
    <h1 class="c7 c21 c27">Adăugarea obiectelor în depozit. </h1>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span class="c16">Pentru a ad&#259;uga obiecte &icirc;n depozitul bazei de date IndexDB, se
            folose&#537;te metoda </span><span class="c12">add() </span><span class="c16">a obiectului </span><span
            class="c13">IDBObjectStore</span><span class="c5">:</span></p>
    <p class="c3"><span class="c5"></span></p><a id="t.693fdde85cf9aed6fd7a3511d24e6029799c5d79"></a><a id="t.0"></a>
    <table class="c25">
        <tr class="c1">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c7"><span class="c0">add(value): valoarea care trebuie ad&#259;ugat&#259; este primul
                        parametru.<br><br>add(value, key): al doilea parametru, op&#539;ional, indic&#259; cheia
                        obiectului. Dac&#259; nu este specificat, cheia este considerat&#259; </span><span
                        class="c10">null</span><span class="c0">&nbsp;implicit.</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span class="c5">Alegerea de a specifica o cheie &#537;i tipul acesteia depinde de set&#259;rile
            de configurare ale depozitului stabilite la crearea acestuia:</span></p>
    <p class="c3"><span class="c5"></span></p>
    <ul class="c4 lst-kix_axjldmhksu44-0 start">
        <li class="c7 c21 c28 c14 li-bullet-0"><span class="c12">keyPath</span><span class="c5">: define&#537;te numele
                propriet&#259;&#539;ii care va servi ca cheie pentru obiecte.</span></li>
    </ul>
    <p class="c3 c14"><span class="c5"></span></p>
    <ul class="c4 lst-kix_axjldmhksu44-0">
        <li class="c7 c21 c14 c28 li-bullet-0"><span class="c12">autoIncrement</span><span class="c16">: atunci
                c&acirc;nd este setat pe </span><span class="c13">true</span><span class="c16">, cheile sunt generate
                automat. Implicit, acesta este setat pe </span><span class="c13">false</span><span class="c5">,
                indic&acirc;nd c&#259; cheile nu sunt generate automat.</span></li>
    </ul>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span class="c16">Modul &icirc;n care este utilizat&#259; cheia este determinat de
            combina&#539;iile specifice ale parametrilor </span><span class="c13">keyPath </span><span
            class="c16">&#537;i </span><span class="c13">autoIncrement</span><span class="c5">.</span></p>
    <p class="c3"><span class="c5"></span></p>
    <p class="c3"><span class="c5"></span></p><a id="t.f5e27d8f02662ef8c9a49d21ecb954521ab35097"></a><a id="t.1"></a>
    <table class="c25">
        <tr class="c32">
            <td class="c15 c29" colspan="1" rowspan="1">
                <p class="c11"><span class="c12">keyPath</span></p>
            </td>
            <td class="c19 c29" colspan="1" rowspan="1">
                <p class="c11"><span class="c12">autoIncrement</span></p>
            </td>
            <td class="c9" colspan="1" rowspan="1">
                <p class="c11"><span class="c12">Descriere</span></p>
            </td>
        </tr>
        <tr class="c17">
            <td class="c15" colspan="1" rowspan="1">
                <p class="c11"><span class="c5">Nu este specificat</span></p>
            </td>
            <td class="c19" colspan="1" rowspan="1">
                <p class="c11"><span class="c5">FALSE</span></p>
            </td>
            <td class="c22" colspan="1" rowspan="1">
                <p class="c7"><span class="c5">Depozitul de obiecte poate stoca valori de orice tip (inclusiv valori de
                        tipuri primitive, cum ar fi numere &#537;i &#537;iruri de caractere). Totu&#537;i, cheia trebuie
                        indicat&#259; explicit de fiecare dat&#259; c&acirc;nd se adaug&#259; un nou obiect &icirc;n
                        baza de date.</span></p>
            </td>
        </tr>
        <tr class="c23">
            <td class="c15" colspan="1" rowspan="1">
                <p class="c11"><span class="c5">Specificat</span></p>
            </td>
            <td class="c19" colspan="1" rowspan="1">
                <p class="c11"><span class="c5">FALSE</span></p>
            </td>
            <td class="c22" colspan="1" rowspan="1">
                <p class="c7"><span class="c5">Depozitul de obiecte poate stoca doar obiecte (adic&#259; niciun tip de
                        date primitive). Totu&#537;i, aceste obiecte trebuie s&#259; aib&#259; o proprietate cu
                        acela&#537;i nume care este specificat &icirc;n parametrul keyPath.</span></p>
            </td>
        </tr>
        <tr class="c23">
            <td class="c15" colspan="1" rowspan="1">
                <p class="c11"><span class="c5">Nu este specificat</span></p>
            </td>
            <td class="c19" colspan="1" rowspan="1">
                <p class="c11"><span class="c5">TRUE</span></p>
            </td>
            <td class="c22" colspan="1" rowspan="1">
                <p class="c7"><span class="c5">Depozitul de obiecte poate stoca valori de orice tip (inclusiv valori de
                        tipuri primitive). Cheile obiectelor sunt generate automat la ad&#259;ugarea obiectelor.
                        Totu&#537;i, se poate de asemenea indica explicit cheia pentru obiect.</span></p>
            </td>
        </tr>
        <tr class="c26">
            <td class="c15" colspan="1" rowspan="1">
                <p class="c11"><span class="c5">Specificat</span></p>
            </td>
            <td class="c19" colspan="1" rowspan="1">
                <p class="c11"><span class="c5">TRUE</span></p>
            </td>
            <td class="c22" colspan="1" rowspan="1">
                <p class="c7"><span class="c5">Depozitul de obiecte poate stoca doar obiecte (adic&#259; niciun tip de
                        date primitive). Cheile sunt denumite a&#537;a cum este specificat &icirc;n parametrul keyPath.
                        Dac&#259; la obiect lipse&#537;te aceast&#259; proprietate, atunci valoarea cheii este
                        generat&#259; automat &#537;i ad&#259;ugat&#259; la obiectul nou. Dac&#259; proprietatea
                        exist&#259; deja &icirc;n obiect, atunci cheia nu este generat&#259;, ci se utilizeaz&#259;
                        valoarea cheii deja salvat&#259;.</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span class="c16">Rezultatul metodei</span><span class="c13">&nbsp;add() </span><span
            class="c16">este un obiect </span><span class="c12">IDBRequest</span><span class="c16">. &Icirc;n cazul unei
            ad&#259;ug&#259;ri de succes, la acest obiect se declan&#537;eaz&#259; evenimentul </span><span
            class="c12">success</span><span class="c16">, iar proprietatea sa </span><span class="c12">result
        </span><span class="c16">con&#539;ine cheia obiectului ad&#259;ugat. &Icirc;n caz de eroare, se genereaz&#259;
            evenimentul </span><span class="c12">error </span><span class="c16">&icirc;mpreun&#259; cu o excep&#539;ie
            de tip </span><span class="c13">DOMException</span><span class="c16">. Pentru a gestiona aceste evenimente,
            se pot folosi propriet&#259;&#539;ile </span><span class="c12">onsuccess </span><span class="c16">&#537;i
        </span><span class="c12">onerror</span><span class="c5">, respectiv.</span></p>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span class="c5">De exemplu, s&#259; ad&#259;ug&#259;m un singur obiect:</span></p>
    <p class="c3"><span class="c5"></span></p><a id="t.02ecd1464044468728aa45f4e51c43f2e28c52fc"></a><a id="t.2"></a>
    <table class="c25">
        <tr class="c1">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c7"><span class="c10">const</span><span class="c0">&nbsp;request = indexedDB.open(</span><span
                        class="c8">&quot;test&quot;</span><span class="c0">, </span><span class="c6">5</span><span
                        class="c0">); </span><span class="c16 c18">// ne conect&#259;m la baza de date test</span><span
                        class="c0"><br><br></span><span class="c16 c18">// la crearea sau actualizarea versiunii bazei
                        de date, cre&#259;m &icirc;n ea un depozit users</span><span
                        class="c0"><br>request.onupgradeneeded = (event) =&gt; { <br> &nbsp; &nbsp;</span><span
                        class="c10">const</span><span class="c0">&nbsp;db = event.target.result; &nbsp;</span><span
                        class="c16 c18">// ob&#539;inem baza de date</span><span class="c0"><br> &nbsp;
                        &nbsp;</span><span class="c16 c18">// cheia este proprietatea id, &#537;i este
                        autoincrementat&#259;</span><span class="c0"><br> &nbsp; &nbsp;db.createObjectStore(</span><span
                        class="c8">&quot;users&quot;</span><span class="c0">, { keyPath: </span><span
                        class="c8">&quot;id&quot;</span><span class="c0">, autoIncrement: </span><span
                        class="c10">true</span><span class="c0">&nbsp;});<br>};<br></span><span class="c16 c18">// la
                        deschiderea bazei de date ad&#259;ug&#259;m &icirc;n depozitul users 1 obiect</span><span
                        class="c0"><br>request.onsuccess = (event) =&gt; { <br> &nbsp; &nbsp;</span><span
                        class="c10">const</span><span class="c0">&nbsp;db = event.target.result; &nbsp;</span><span
                        class="c16 c18">// ob&#539;inem baza de date</span><span class="c0"><br> &nbsp;
                        &nbsp;</span><span class="c10">const</span><span class="c0">&nbsp;transaction =
                        db.transaction([</span><span class="c8">&quot;users&quot;</span><span class="c0">], </span><span
                        class="c8">&quot;readwrite&quot;</span><span class="c0">); </span><span class="c16 c18">//
                        cre&#259;m o tranzac&#539;ie</span><span class="c0"><br> &nbsp; &nbsp;</span><span
                        class="c10">const</span><span class="c0">&nbsp;userStore = transaction.objectStore(</span><span
                        class="c8">&quot;users&quot;</span><span class="c0">); &nbsp; </span><span class="c16 c18">//
                        ob&#539;inem depozitul users</span><span class="c0"><br><br> &nbsp; &nbsp;</span><span
                        class="c10">const</span><span class="c0">&nbsp;tom = {name: </span><span
                        class="c8">&quot;Tom&quot;</span><span class="c0">, age: </span><span class="c6">39</span><span
                        class="c0">};<br> &nbsp; &nbsp;</span><span class="c10">const</span><span
                        class="c0">&nbsp;addRequest = userStore.add(tom); &nbsp; &nbsp; </span><span class="c16 c18">//
                        ad&#259;ug&#259;m obiectul tom &icirc;n depozitul userStore</span><span class="c0"><br> &nbsp;
                        &nbsp;addRequest.onsuccess = (event) =&gt; {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span
                        class="c16 c20">console</span><span class="c0">.log(</span><span class="c8">&quot;Datele au fost
                        ad&#259;ugate cu succes&quot;</span><span class="c0">);<br> &nbsp; &nbsp; &nbsp;
                        &nbsp;</span><span class="c16 c20">console</span><span class="c0">.log(</span><span
                        class="c8">&quot;id-ul &icirc;nregistr&#259;rii ad&#259;ugate:&quot;</span><span class="c0">,
                        addRequest.result); </span><span class="c16 c18">// id-ul &icirc;nregistr&#259;rii
                        ad&#259;ugate: 1</span><span class="c0"><br> &nbsp; &nbsp;};<br>};</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span class="c5">Aici, &icirc;n baza de date test este creat depozitul &quot;users&quot;, &icirc;n
            care ca cheie serve&#537;te proprietatea id, &#537;i aceast&#259; proprietate este autoincrementat&#259; la
            ad&#259;ugarea fiec&#259;rui obiect nou. Adic&#259;, obiectul ad&#259;ugat poate s&#259; nu
            con&#539;in&#259; o asemenea proprietate.</span></p>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span class="c12">P.S.</span><span class="c16">&nbsp;Pentru celor ce nu le-a fost clar unde
            trebuie rulat codul, cre&#259;m un fi&#537;ier de tip </span><span class="c12">html</span><span
            class="c16">, spre exemplu, </span><span class="c12">runserverjs.html</span><span class="c16">, &icirc;n
            folderul care l-a&#539;i folosit &icirc;n temele anteriare ( &icirc;n cazul meu </span><span class="c12">C:\
            app</span><span class="c16">). Acolo ad&#259;uga&#539;i codul ( s&#259; nu uita&#539;i de structura
        </span><span class="c13">html</span><span class="c16">, codul trebuie s&#259; fie ad&#259;ugat &icirc;ntre
        </span><span class="c13">&lt;script&gt;</span><span class="c16">&nbsp;&#537;i </span><span
            class="c13">&lt;/script&gt;</span><span class="c16">), iar dup&#259; asta face&#539;i click pe el. Dup&#259;
            ce aparea fereastra, ap&#259;sa&#539;i </span><span class="c12">F12</span><span class="c5">.</span></p>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span class="c5">&Icirc;n acest caz, ad&#259;ug&#259;m un singur obiect cu dou&#259;
            propriet&#259;&#539;i, name &#537;i age:</span></p>
    <p class="c3"><span class="c5"></span></p><a id="t.3c2d5f7b657a8012d7b1fbd05f48a194d093267e"></a><a id="t.3"></a>
    <table class="c25">
        <tr class="c1">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c7"><span class="c10">const</span><span class="c0">&nbsp;tom = {name: </span><span
                        class="c8">&quot;Tom&quot;</span><span class="c0">, age: </span><span class="c6">39</span><span
                        class="c0">};<br></span><span class="c10">const</span><span class="c0">&nbsp;addRequest =
                        userStore.add(tom);</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span class="c16">La ad&#259;ugarea cu succes,</span><span
            class="c13">&nbsp;addRequest.result</span><span class="c5">&nbsp;con&#539;ine cheia - valoarea
            propriet&#259;&#539;ii id a obiectului ad&#259;ugat</span></p>
    <p class="c3"><span class="c5"></span></p><a id="t.5a162b12ab805af0a81322a6fc5ce21cc936ff01"></a><a id="t.4"></a>
    <table class="c25">
        <tr class="c1">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c7"><span class="c0">addRequest.onsuccess = (event) =&gt; {<br> &nbsp; &nbsp;</span><span
                        class="c16 c20">console</span><span class="c0">.log(</span><span class="c8">&quot;Datele au fost
                        ad&#259;ugate cu succes&quot;</span><span class="c0">);<br> &nbsp; &nbsp;</span><span
                        class="c16 c20">console</span><span class="c0">.log(</span><span class="c8">&quot;id-ul
                        &icirc;nregistr&#259;rii ad&#259;ugate:&quot;</span><span class="c0">, addRequest.result);
                    </span><span class="c16 c18">// id-ul &icirc;nregistr&#259;rii ad&#259;ugate: 1</span><span
                        class="c0"><br>};</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span class="c16">Aceea&#537;i valoare poate fi ob&#539;inut&#259; prin parametrul handlerului
            &#537;i proprietatea sa </span><span class="c13 c31">event.target.result</span></p>
    <p class="c3"><span class="c5"></span></p><a id="t.2868f9044ab43c8ca60060abc65bc16008ceea52"></a><a id="t.5"></a>
    <table class="c25">
        <tr class="c1">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c7"><span class="c16 c20">console</span><span class="c0">.log(</span><span
                        class="c8">&quot;id-ul &icirc;nregistr&#259;rii ad&#259;ugate:&quot;</span><span class="c0">,
                        event.target.result);</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span class="c16">Este important de men&#539;ionat c&#259; ad&#259;ugarea datelor nu se
            &icirc;nt&acirc;mpl&#259; imediat dup&#259; apelul metodei </span><span class="c13">add()</span><span
            class="c16">, ci se finalizeaz&#259; dup&#259; un anumit timp. Prin urmare, pentru a urm&#259;ri
            opera&#539;iunea se utilizeaz&#259; handlerul </span><span class="c13">onsuccess</span><span
            class="c5">.</span></p>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span class="c5">S&#259; ad&#259;ug&#259;m &icirc;nc&#259; c&acirc;teva obiecte:</span></p>
    <p class="c3"><span class="c5"></span></p><a id="t.1d0e547d4a60c7e11ac8ca209af3ce1c2ef413f9"></a><a id="t.6"></a>
    <table class="c25">
        <tr class="c1">
            <td class="c2" colspan="1" rowspan="1">
                <p class="c7"><span class="c10">const</span><span class="c0">&nbsp;bob = {name: </span><span
                        class="c8">&quot;Bob&quot;</span><span class="c0">, age: </span><span class="c6">43</span><span
                        class="c0">};<br></span><span class="c10">const</span><span class="c0">&nbsp;sam = {name:
                    </span><span class="c8">&quot;Sam&quot;</span><span class="c0">, age: </span><span
                        class="c6">28</span><span class="c0">};<br>userStore.add(bob);<br>userStore.add(sam);</span></p>
            </td>
        </tr>
    </table>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span class="c30">Vizualizarea con&#539;inutului &icirc;n browser.</span></p>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span class="c16">Este de remarcat c&#259; browserele moderne ne permit s&#259; vizualiz&#259;m
            con&#539;inutul IndexDB prin instrumentele de dezvoltare. Astfel, &icirc;n Google Chrome, aceast&#259;
            func&#539;ionalitate este disponibil&#259; pe tabul </span><span class="c12">Application </span><span
            class="c16">la selectarea din meniul din st&acirc;nga a op&#539;iunii </span><span
            class="c12">Storage/IndexDB</span><span class="c5">.</span></p>
    <p class="c3"><span class="c5"></span></p>
    <p class="c7 c21"><span
            style="overflow: hidden; display: inline-block; margin: 0.00px 0.00px; border: 0.00px solid #000000; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px); width: 624.00px; height: 400.00px;"><img
                alt="" src="images/image1.png"
                style="width: 624.00px; height: 400.00px; margin-left: 0.00px; margin-top: 0.00px; transform: rotate(0.00rad) translateZ(0px); -webkit-transform: rotate(0.00rad) translateZ(0px);"
                title=""></span></p>
</body>

</html>