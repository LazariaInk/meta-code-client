<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <link rel="stylesheet" type="text/css" href="/lessons/styles.css">
</head>

<body class="c19 doc-content">
    <h1 class="c6 c24">Executarea interogărilor în baza de date. </h1>
    <p class="c0"><span class="c1"></span></p>
    <p class="c6"><span class="c3">Toate opera&#539;iunile cu baza de date </span><span class="c10">IndexDB </span><span
            class="c3">sunt &icirc;ncapsulate &icirc;n tranzac&#539;ii, care reprezint&#259; tipul </span><span
            class="c10">IDBTransaction</span><span class="c3">. Pentru a crea obiecte de acest tip, la obiectul bazei de
            date IDBDatabase se apeleaz&#259; metoda</span><span class="c10">&nbsp;transaction()</span><span
            class="c1">:</span></p>
    <p class="c0"><span class="c1"></span></p><a id="t.8b07d324bc2df99c668f248e5a1c969da5f2d93d"></a><a id="t.0"></a>
    <table class="c17">
        <tr class="c21">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c15"><span class="c3 c4">transaction(storeNames)<br>transaction(storeNames, mode)</span></p>
            </td>
        </tr>
    </table>
    <p class="c0"><span class="c1"></span></p>
    <p class="c6"><span class="c1">Aceast&#259; metod&#259; accept&#259; urm&#259;toarele parametri:</span></p>
    <p class="c0"><span class="c1"></span></p>
    <ul class="c9 lst-kix_6xpranca1t2z-0 start">
        <li class="c6 c11 c5 li-bullet-0"><span class="c3 c12">storeNames</span><span class="c1">: un array de nume ale
                magazinelor de obiecte, la care se acceseaz&#259; &icirc;n tranzac&#539;ie.</span></li>
    </ul>
    <p class="c0"><span class="c1"></span></p><a id="t.d66bdf1ab6e336bb7d47c821ae91bc20b59a0c57"></a><a id="t.1"></a>
    <table class="c17">
        <tr class="c21">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c15"><span class="c2">const</span><span class="c3 c4">&nbsp;request =
                        indexedDB.open(</span><span class="c3 c13">&quot;test&quot;</span><span class="c3 c4">,
                    </span><span class="c3 c16">3</span><span class="c3 c4">); </span><span class="c3 c7">// ne
                        conect&#259;m la bd test</span><span class="c3 c4"><br> <br>request.onsuccess = (event) =&gt; {
                        <br> &nbsp; &nbsp;</span><span class="c2">const</span><span class="c3 c4">&nbsp;db =
                        event.target.result; &nbsp;</span><span class="c3 c7">// ob&#539;inem bd</span><span
                        class="c3 c4"><br> &nbsp; &nbsp;</span><span class="c3 c7">// cre&#259;m
                        tranzac&#539;ie</span><span class="c3 c4"><br> &nbsp; &nbsp;</span><span
                        class="c2">const</span><span class="c3 c4">&nbsp;transaction = db.transaction(</span><span
                        class="c3 c13">&quot;users&quot;</span><span class="c3 c4">); &nbsp; &nbsp;</span><span
                        class="c3 c7">// acces&#259;m magazinul &quot;users&quot;</span><span class="c3 c4"><br> &nbsp;
                        &nbsp;</span><span class="c3 c8">console</span><span
                        class="c3 c4">.log(transaction);<br>};</span></p>
            </td>
        </tr>
    </table>
    <p class="c0"><span class="c1"></span></p>
    <p class="c6"><span class="c1">Dac&#259; trebuie s&#259; implic&#259;m mai multe magazine, atunci sunt definite
            &icirc;ntr-un array:</span></p>
    <p class="c0"><span class="c1"></span></p><a id="t.8edcdd02a3becfc071d0ba0b49d80fa3d4d3f8ad"></a><a id="t.2"></a>
    <table class="c17">
        <tr class="c21">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c15"><span class="c2">const</span><span class="c3 c4">&nbsp;transaction =
                        db.transaction([</span><span class="c3 c13">&quot;users&quot;</span><span class="c3 c4">,
                    </span><span class="c3 c13">&quot;companies&quot;</span><span class="c3 c4">]); </span><span
                        class="c3 c7">// acces&#259;m magazinele &quot;users&quot; &#537;i &quot;companies&quot;</span>
                </p>
            </td>
        </tr>
    </table>
    <p class="c0"><span class="c1"></span></p>
    <p class="c6"><span class="c3">Dac&#259; trebuie s&#259; specific&#259;m toate magazinele de obiecte ale bazei de
            date, atunci se poate folosi proprietatea</span><span
            class="c3 c12">&nbsp;IDBDatabase.objectStoreNames</span><span class="c1">:</span></p>
    <p class="c0"><span class="c1"></span></p><a id="t.156e02094765947f6abf47b3191c98fa4a9b4165"></a><a id="t.3"></a>
    <table class="c17">
        <tr class="c21">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c15"><span class="c2">const</span><span class="c3 c4">&nbsp;transaction =
                        db.transaction(db.objectStoreNames);</span></p>
            </td>
        </tr>
    </table>
    <p class="c0"><span class="c1"></span></p>
    <ul class="c9 lst-kix_psyymy7clz6v-0 start">
        <li class="c6 c11 c5 li-bullet-0"><span class="c3 c12">mode</span><span class="c1">: un parametru op&#539;ional,
                stabile&#537;te tipul de acces la baza de date. Poate lua urm&#259;toarele valori:</span></li>
    </ul>
    <p class="c0"><span class="c1"></span></p>
    <ol class="c9 lst-kix_9nck2pkxgx8g-0 start" start="1">
        <li class="c6 c11 c5 li-bullet-0"><span class="c3 c12">readonly</span><span class="c1">: datele sunt accesibile
                doar pentru citire. Aceast&#259; valoare este utilizat&#259; implicit, dac&#259; parametrul mode nu este
                specificat explicit.</span></li>
    </ol>
    <p class="c0 c5"><span class="c1"></span></p>
    <ol class="c9 lst-kix_9nck2pkxgx8g-0" start="2">
        <li class="c6 c11 c5 li-bullet-0"><span class="c3 c12">readwrite</span><span class="c1">: datele sunt accesibile
                at&acirc;t pentru citire, c&acirc;t &#537;i pentru scriere.</span></li>
    </ol>
    <p class="c0 c5"><span class="c1"></span></p>
    <ol class="c9 lst-kix_9nck2pkxgx8g-0" start="3">
        <li class="c6 c11 c5 li-bullet-0"><span class="c3 c12">versionchange</span><span class="c1">: sunt permise
                citirea &#537;i scrierea, precum &#537;i opera&#539;iunile de &#537;tergere sau creare a magazinelor
                &#537;i indexurilor de obiecte.</span></li>
    </ol>
    <p class="c0"><span class="c1"></span></p>
    <p class="c6"><span class="c1">Exemplu de utilizare:</span></p>
    <p class="c0"><span class="c1"></span></p><a id="t.9a81bfb1d4006d62319bc949c434cbf87817d378"></a><a id="t.4"></a>
    <table class="c17">
        <tr class="c21">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c15"><span class="c2">const</span><span class="c3 c4">&nbsp;transaction =
                        db.transaction(</span><span class="c3 c13">&quot;users&quot;</span><span class="c3 c4">,
                    </span><span class="c3 c13">&quot;readwrite&quot;</span><span class="c3 c4">);</span></p>
            </td>
        </tr>
    </table>
    <p class="c0"><span class="c1"></span></p>
    <p class="c6"><span class="c1">Cu ajutorul propriet&#259;&#539;ilor IDBTransaction se poate ob&#539;ine anumite
            informa&#539;ii despre tranzac&#539;ie:</span></p>
    <p class="c0"><span class="c1"></span></p>
    <ul class="c9 lst-kix_ca7txq94am-0 start">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">db</span><span class="c1">: obiectul bazei de date
                (IDBDatabase)</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_ca7txq94am-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">error</span><span class="c3">: informa&#539;ii despre eroare
                sub forma unui obiect </span><span class="c3 c18 c12">DOMException</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_ca7txq94am-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">mode</span><span class="c3">: modul de acces la baza de
                date, dac&#259; nu este setat, atunci implicit </span><span class="c3 c12 c18">readonly</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_ca7txq94am-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">objectStoreNames</span><span class="c3">: lista magazinelor
                implicate &icirc;n tranzac&#539;ie (obiect </span><span class="c3 c12">DOMStringList</span><span
                class="c3">), unde fiecare magazin reprezint&#259; un obiect </span><span
                class="c18 c10 c20">IDBObjectStore</span></li>
    </ul>
    <p class="c0"><span class="c1"></span></p>
    <p class="c6"><span class="c1">De exemplu, ob&#539;inerea datelor:</span></p>
    <p class="c0"><span class="c1"></span></p><a id="t.cdfcd7d44335aedb56b49000667a326f055b84bb"></a><a id="t.5"></a>
    <table class="c17">
        <tr class="c21">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c15"><span class="c2">const</span><span class="c3 c4">&nbsp;request =
                        indexedDB.open(</span><span class="c3 c13">&quot;test&quot;</span><span class="c3 c4">,
                    </span><span class="c3 c16">3</span><span class="c3 c4">); </span><span class="c3 c7">// ne
                        conect&#259;m la bd test</span><span class="c3 c4"><br> <br>request.onsuccess = (event) =&gt; {
                        <br> &nbsp; &nbsp;</span><span class="c2">const</span><span class="c3 c4">&nbsp;db =
                        event.target.result; &nbsp;</span><span class="c3 c7">// ob&#539;inem bd</span><span
                        class="c3 c4"><br> &nbsp; &nbsp;</span><span class="c3 c7">// cre&#259;m
                        tranzac&#539;ie</span><span class="c3 c4"><br> &nbsp; &nbsp;</span><span
                        class="c2">const</span><span class="c3 c4">&nbsp;transaction = db.transaction([</span><span
                        class="c3 c13">&quot;users&quot;</span><span class="c3 c4">], </span><span
                        class="c3 c13">&quot;readwrite&quot;</span><span class="c3 c4">);<br> &nbsp; &nbsp;</span><span
                        class="c3 c8">console</span><span class="c3 c4">.log(transaction.db.name); &nbsp;
                        &nbsp;</span><span class="c3 c7">// test </span><span class="c3 c4"><br> &nbsp;
                        &nbsp;</span><span class="c3 c8">console</span><span class="c3 c4">.log(transaction.mode);
                        &nbsp; &nbsp;</span><span class="c3 c7">// readwrite</span><span class="c3 c4"><br> &nbsp;
                        &nbsp;</span><span class="c3 c8">console</span><span
                        class="c3 c4">.log(transaction.objectStoreNames); &nbsp;</span><span class="c3 c7">//
                        DOMStringList {0: &quot;users&quot;, length: 1}</span><span class="c3 c4"><br>};</span></p>
            </td>
        </tr>
    </table>
    <p class="c0"><span class="c1"></span></p>
    <p class="c6"><span class="c18 c20 c23">Ob&#539;inerea magazinului.</span></p>
    <p class="c0"><span class="c18 c10 c20"></span></p>
    <p class="c6"><span class="c3">Pentru a efectua opera&#539;iuni propriu-zise cu magazinul &icirc;n cadrul
            tranzac&#539;iei se utilizeaz&#259; diferite metode ale obiectului </span><span
            class="c10">IDBObjectStore</span><span class="c3">, care de fapt reprezint&#259; magazinul. Pentru a
            ob&#539;ine obiectul </span><span class="c10">IDBObjectStore </span><span class="c3">la obiectul
            tranzac&#539;iei </span><span class="c10">IDBTransaction </span><span class="c3">se apeleaz&#259; metoda
        </span><span class="c10">objectStore()</span><span class="c1">:</span></p>
    <p class="c0"><span class="c1"></span></p><a id="t.93dd4643ba61e5e4a6d3da3cac9dd6ed2c507d76"></a><a id="t.6"></a>
    <table class="c17">
        <tr class="c21">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c15"><span class="c2">const</span><span class="c3 c4">&nbsp;userStore =
                        transaction.objectStore(</span><span class="c3 c13">&quot;users&quot;</span><span
                        class="c3 c4">); &nbsp; </span><span class="c3 c7">// ob&#539;inem magazinul users</span></p>
            </td>
        </tr>
    </table>
    <p class="c0"><span class="c1"></span></p>
    <p class="c6"><span class="c3">Trebuie men&#539;ionat c&#259; magazinul trebuie s&#259; fie creat anterior cu
            ajutorul metodei </span><span class="c10">createObjectStore()</span><span class="c1">&nbsp;a obiectului
            IDBDatabase. Crearea unui magazin se poate face la crearea sau modificarea versiunii bazei de date</span>
    </p>
    <p class="c0"><span class="c1"></span></p><a id="t.a68d5403f9dd464841187ac25fa4da9e42f6206f"></a><a id="t.7"></a>
    <table class="c17">
        <tr class="c21">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c15"><span class="c2">const</span><span class="c3 c4">&nbsp;request =
                        indexedDB.open(</span><span class="c3 c13">&quot;test&quot;</span><span class="c3 c4">,
                    </span><span class="c3 c16">5</span><span class="c3 c4">); </span><span class="c3 c7">// ne
                        conect&#259;m la bd test</span><span class="c3 c4"><br><br>request.onupgradeneeded = (event)
                        =&gt; { <br> &nbsp; &nbsp;</span><span class="c2">const</span><span class="c3 c4">&nbsp;db =
                        event.target.result; &nbsp;<br> &nbsp; &nbsp;</span><span class="c2">if</span><span
                        class="c3 c4">&nbsp;(db.objectStoreNames.contains(</span><span
                        class="c3 c13">&quot;users&quot;</span><span class="c3 c4">)) {<br> &nbsp; &nbsp; &nbsp;
                        &nbsp;db.deleteObjectStore(</span><span class="c3 c13">&quot;users&quot;</span><span
                        class="c3 c4">); &nbsp;<br> &nbsp; &nbsp;}<br> &nbsp; &nbsp;</span><span
                        class="c2">const</span><span class="c3 c4">&nbsp;userStore = db.createObjectStore(</span><span
                        class="c3 c13">&quot;users&quot;</span><span class="c3 c4">, { keyPath: </span><span
                        class="c3 c13">&quot;id&quot;</span><span class="c3 c4">, autoIncrement: </span><span
                        class="c2">true</span><span class="c3 c4">&nbsp;});<br> &nbsp; &nbsp;</span><span
                        class="c3 c8">console</span><span class="c3 c4">.log(userStore); <br>};<br><br>request.onsuccess
                        = (event) =&gt; { <br> &nbsp; &nbsp;</span><span class="c2">const</span><span
                        class="c3 c4">&nbsp;db = event.target.result; &nbsp;<br> &nbsp; &nbsp;</span><span
                        class="c2">const</span><span class="c3 c4">&nbsp;transaction = db.transaction([</span><span
                        class="c3 c13">&quot;users&quot;</span><span class="c3 c4">], </span><span
                        class="c3 c13">&quot;readwrite&quot;</span><span class="c3 c4">);<br> &nbsp; &nbsp;</span><span
                        class="c2">const</span><span class="c3 c4">&nbsp;userStore =
                        transaction.objectStore(</span><span class="c3 c13">&quot;users&quot;</span><span
                        class="c3 c4">); &nbsp; <br> &nbsp; &nbsp;</span><span class="c3 c8">console</span><span
                        class="c3 c4">.log(userStore);<br>};</span></p>
            </td>
        </tr>
    </table>
    <p class="c0"><span class="c1"></span></p>
    <p class="c6"><span class="c3">Tipul </span><span class="c10">IDBObjectStore </span><span class="c1">ofer&#259;
            urm&#259;toarea serie de metode pentru opera&#539;ii asupra datelor din magazin:</span></p>
    <p class="c0"><span class="c1"></span></p>
    <ul class="c9 lst-kix_wkqxl4aq8dbg-0 start">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">add</span><span class="c1">- adaug&#259; noi obiecte
                &icirc;n magazin</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_wkqxl4aq8dbg-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">clear</span><span class="c1">- cur&#259;&#539;&#259;
                magazinul &#537;terge toate obiectele</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_wkqxl4aq8dbg-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">count</span><span class="c1">- returneaz&#259; num&#259;rul
                total de obiecte</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_wkqxl4aq8dbg-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">createIndex</span><span class="c1">- creeaz&#259; un nou
                index</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_wkqxl4aq8dbg-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">delete</span><span class="c1">- &#537;terge din magazin
                obiectul cu cheia specificat&#259;</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_wkqxl4aq8dbg-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">deleteIndex</span><span class="c1">- &#537;terge indexul
                specificat</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_wkqxl4aq8dbg-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">get</span><span class="c1">- returneaz&#259; obiectul cu
                cheia specificat&#259;</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_wkqxl4aq8dbg-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">getKey</span><span class="c1">- returneaz&#259; cheia
                obiectului</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_wkqxl4aq8dbg-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">getAll</span><span class="c1">- returneaz&#259; toate
                obiectele din magazin</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_wkqxl4aq8dbg-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">getAllKeys</span><span class="c1">- returneaz&#259; cheile
                obiectelor</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_wkqxl4aq8dbg-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">index</span><span class="c1">- returneaz&#259; indexul
                magazinului</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_wkqxl4aq8dbg-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">openCursor</span><span class="c1">- este folosit pentru a
                itera prin magazinul de obiecte pe baza cheii primare cu ajutorul unui cursor</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_wkqxl4aq8dbg-0">
        <li class="c6 c11 c5 li-bullet-0"><span class="c10">openKeyCursor</span><span class="c1">- returneaz&#259; un
                cursor pentru a itera prin magazinul de obiecte</span></li>
    </ul>
    <p class="c0 c5"><span class="c1"></span></p>
    <ul class="c9 lst-kix_wkqxl4aq8dbg-0">
        <li class="c6 c5 c11 li-bullet-0"><span class="c10">put</span><span class="c1">- actualizeaz&#259; obiectele
                existente &icirc;n magazin</span></li>
    </ul>
    <p class="c0"><span class="c1"></span></p>
    <p class="c0"><span class="c1"></span></p>
</body>

</html>