<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <link rel="stylesheet" type="text/css" href="/lessons/styles.css">
</head>

<body class="c34 doc-content">
    <h1 class="c0 c24"><span class="c33">Obținerea numărului de obiecte. </h1>
    <p class="c0 c10"><span class="c1"></span></p>
    <p class="c0 c24"><span class="c4">Pentru a ob&#539;ine num&#259;rul de date stocate &icirc;n depozitul bazei de
            date &icirc;n IndexDB se aplic&#259; metoda </span><span class="c13">count()</span><span class="c4">&nbsp;a
            interfe&#539;ei </span><span class="c4 c8">IDBObjectStore</span></p>
    <p class="c0 c10"><span class="c4 c8 c26"></span></p><a id="t.63077181cc91b6f2523acd73c4ca22300ae82a59"></a><a
        id="t.0"></a>
    <table class="c6">
        <tr class="c14">
            <td class="c23" colspan="1" rowspan="1">
                <p class="c0"><span class="c4 c5">count()<br>count(query)</span></p>
            </td>
        </tr>
    </table>
    <p class="c0 c10"><span class="c1"></span></p>
    <p class="c0 c24"><span class="c1">Dac&#259; parametrul nu este transmis, metoda returneaz&#259; num&#259;rul total
            de &icirc;nregistr&#259;ri ale depozitului.</span></p>
    <p class="c0 c10"><span class="c1"></span></p>
    <p class="c0 c24"><span class="c4">Aceast&#259; metod&#259; returneaz&#259; un obiect </span><span
            class="c13">IDBRequest</span><span class="c4">. Dac&#259; metoda se execut&#259; cu succes, pentru obiectul
            IDBRequest se genereaz&#259; evenimentul </span><span class="c13">success</span><span class="c4">, iar
            proprietatea sa </span><span class="c13">result </span><span class="c4">con&#539;ine num&#259;rul de obiecte
            ale depozitului. &Icirc;n cazul apari&#539;iei unei erori, la obiectul IDBRequest se declan&#537;eaz&#259;
            evenimentul </span><span class="c13">error</span><span class="c4">, iar proprietatea sa error con&#539;ine
            informa&#539;ii despre eroare. Pentru a gestiona aceste evenimente, se pot folosi, respectiv,
            propriet&#259;&#539;ile </span><span class="c13">onsuccess </span><span class="c4">&#537;i </span><span
            class="c13">onerror</span><span class="c1">.</span></p>
    <p class="c0 c10"><span class="c1"></span></p>
    <p class="c0 c24"><span class="c4">De exemplu, s&#259; ob&#539;inem num&#259;rul total de obiecte din depozitul
        </span><span class="c4 c8">users </span><span class="c1">al bazei de date test:</span></p>
    <p class="c0 c10"><span class="c1"></span></p><a id="t.6a6893d74d37ef39fc47ff675988e3b04e93520c"></a><a
        id="t.1"></a>
    <table class="c6">
        <tr class="c14">
            <td class="c23" colspan="1" rowspan="1">
                <p class="c0"><span class="c2">const</span><span class="c4 c5">&nbsp;request =
                        indexedDB.open(</span><span class="c4 c17">&quot;test&quot;</span><span class="c4 c5">,
                    </span><span class="c4 c15">5</span><span class="c4 c5">) </span><span class="c4 c21">// ne
                        conect&#259;m la baza de date test</span><span class="c4 c5"><br><br></span><span
                        class="c4 c21">// la crearea sau modificarea versiunii bazei de date, cre&#259;m &icirc;n ea un
                        depozit users</span><span class="c4 c5"><br>request.onupgradeneeded = (event) =&gt; { <br>
                        &nbsp; &nbsp;</span><span class="c2">const</span><span class="c4 c5">&nbsp;db =
                        event.target.result &nbsp;</span><span class="c4 c21">// ob&#539;inem baza de date</span><span
                        class="c4 c5"><br> &nbsp; &nbsp;</span><span class="c4 c21">// cheia este proprietatea id
                        &#537;i este autoincrementat&#259;</span><span class="c4 c5"><br> &nbsp;
                        &nbsp;db.createObjectStore(</span><span class="c4 c17">&quot;users&quot;</span><span
                        class="c4 c5">, { keyPath: </span><span class="c4 c17">&quot;id&quot;</span><span
                        class="c4 c5">, autoIncrement: </span><span class="c2">true</span><span
                        class="c4 c5">&nbsp;})<br> &nbsp; &nbsp;</span><span class="c4 c21">// ad&#259;ug&#259;m date
                        ini&#539;iale</span><span class="c4 c5"><br> &nbsp; &nbsp;userStore.add({name: </span><span
                        class="c4 c17">&quot;Tom&quot;</span><span class="c4 c5">, age: </span><span
                        class="c4 c15">39</span><span class="c4 c5">})<br> &nbsp; &nbsp;userStore.add({name:
                    </span><span class="c4 c17">&quot;Bob&quot;</span><span class="c4 c5">, age: </span><span
                        class="c4 c15">43</span><span class="c4 c5">})<br> &nbsp; &nbsp;userStore.add({name:
                    </span><span class="c4 c17">&quot;Sam&quot;</span><span class="c4 c5">, age: </span><span
                        class="c4 c15">28</span><span class="c4 c5">})<br>}<br></span><span class="c4 c21">// la
                        deschiderea bazei de date ob&#539;inem num&#259;rul de obiecte</span><span
                        class="c4 c5"><br>request.onsuccess = (event) =&gt; { <br> &nbsp; &nbsp;</span><span
                        class="c2">const</span><span class="c4 c5">&nbsp;db = event.target.result &nbsp;</span><span
                        class="c4 c21">// ob&#539;inem baza de date</span><span class="c4 c5"><br> &nbsp;
                        &nbsp;</span><span class="c2">const</span><span class="c4 c5">&nbsp;transaction =
                        db.transaction([</span><span class="c4 c17">&quot;users&quot;</span><span class="c4 c5">],
                    </span><span class="c4 c17">&quot;readwrite&quot;</span><span class="c4 c5">) </span><span
                        class="c4 c21">// cre&#259;m o tranzac&#539;ie</span><span class="c4 c5"><br> &nbsp;
                        &nbsp;</span><span class="c2">const</span><span class="c4 c5">&nbsp;userStore =
                        transaction.objectStore(</span><span class="c4 c17">&quot;users&quot;</span><span
                        class="c4 c5">) &nbsp; </span><span class="c4 c21">// ob&#539;inem depozitul users</span><span
                        class="c4 c5"><br><br> &nbsp; &nbsp;</span><span class="c2">const</span><span
                        class="c4 c5">&nbsp;countRequest = userStore.count() </span><span class="c4 c21">// ob&#539;inem
                        num&#259;rul de obiecte din baza de date</span><span class="c4 c5"><br> &nbsp;
                        &nbsp;</span><span class="c4 c21">// la succes, afi&#537;&#259;m num&#259;rul pe
                        consol&#259;</span><span class="c4 c5"><br> &nbsp; &nbsp;countRequest.onsuccess = () =&gt;
                    </span><span class="c4 c27">console</span><span class="c4 c5">.log(</span><span
                        class="c4 c17">&quot;Num&#259;rul de utilizatori&quot;</span><span class="c4 c5">,
                        countRequest.result)<br> &nbsp; &nbsp;countRequest.onerror = () =&gt; &nbsp;</span><span
                        class="c4 c27">console</span><span class="c4 c5">.log(countRequest.error.message)<br>}</span>
                </p>
            </td>
        </tr>
    </table>
    <p class="c0 c10"><span class="c1"></span></p>
    <p class="c0 c24"><span class="c1">&#536;i consola va afi&#537;a:</span></p>
    <p class="c0 c10"><span class="c1"></span></p><a id="t.c160703465fb6e0282ab4128d5c5579032593b3d"></a><a
        id="t.2"></a>
    <table class="c6">
        <tr class="c14">
            <td class="c23" colspan="1" rowspan="1">
                <p class="c0"><span class="c4 c5">Num&#259;rul de utilizatori </span><span class="c4 c15">3</span></p>
            </td>
        </tr>
    </table>
    <p class="c0 c10"><span class="c1"></span></p>
    <p class="c0 c24"><span class="c4">Ca parametru op&#539;ional, query &icirc;n metoda count se transmite valoarea
            cheii sau obiectul </span><span class="c13">IDBKeyRange </span><span class="c1">care stabile&#537;te
            intervalul de chei. Utiliz&acirc;nd parametrul count se poate stabili num&#259;rul maxim de elemente
            &icirc;n selec&#539;ie.</span></p>
    <p class="c0 c10"><span class="c1"></span></p>
    <p class="c0 c24"><span class="c1">Pentru a crea un interval de chei se utilizeaz&#259; urm&#259;toarele metode
            statice ale interfe&#539;ei IDBKeyRange:</span></p>
    <p class="c0 c10"><span class="c1"></span></p>
    <ul class="c7 lst-kix_i557jefp6n0m-0 start">
        <li class="c16 c0 li-bullet-0"><span class="c4 c8">IDBKeyRange.bound()</span><span class="c1">&nbsp;creeaz&#259;
                un interval de chei pentru care sunt stabilite valorile minim&#259; &#537;i maxim&#259;</span></li>
    </ul>
    <p class="c0 c10"><span class="c1"></span></p>
    <ul class="c7 lst-kix_i557jefp6n0m-0">
        <li class="c16 c0 li-bullet-0"><span class="c4 c8">IDBKeyRange.only()</span><span class="c1">&nbsp;creeaz&#259;
                un interval de chei care con&#539;ine doar o singur&#259; valoare</span></li>
    </ul>
    <p class="c0 c10"><span class="c1"></span></p>
    <ul class="c7 lst-kix_i557jefp6n0m-0">
        <li class="c16 c0 li-bullet-0"><span class="c4 c8">IDBKeyRange.lowerBound()</span><span
                class="c1">&nbsp;creeaz&#259; un interval de chei pentru care este stabilit&#259; valoarea
                minim&#259;</span></li>
    </ul>
    <p class="c0 c10"><span class="c1"></span></p>
    <ul class="c7 lst-kix_i557jefp6n0m-0">
        <li class="c0 c16 li-bullet-0"><span class="c4 c8">IDBKeyRange.upperBound()</span><span
                class="c1">&nbsp;creeaz&#259; un interval de chei pentru care este stabilit&#259; valoarea
                maxim&#259;</span></li>
    </ul>
    <p class="c0 c10"><span class="c1"></span></p>
    <p class="c0 c24"><span class="c1">Intervalele de chei create prin aceste metode pot fi descrise &icirc;n
            urm&#259;torul tabel:</span></p>
    <p class="c0 c10"><span class="c1"></span></p>
    <p class="c0 c10"><span class="c1"></span></p>
    <p class="c0 c10"><span class="c1"></span></p><a id="t.0914867a05c7e0082f3bc95b330970a9b26ec6f0"></a><a
        id="t.3"></a>
    <table class="c3">
        <tr class="c32">
            <td class="c30" colspan="1" rowspan="1">
                <p class="c25"><span class="c13">Interval</span></p>
            </td>
            <td class="c20" colspan="1" rowspan="1">
                <p class="c25"><span class="c13">Cod</span></p>
            </td>
        </tr>
        <tr class="c18">
            <td class="c19" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">Valoarea cheii &gt;= x</span></p>
            </td>
            <td class="c11" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">IDBKeyRange.lowerBound(x)</span></p>
            </td>
        </tr>
        <tr class="c28">
            <td class="c19" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">Valoarea cheii &gt; x</span></p>
            </td>
            <td class="c11" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">IDBKeyRange.lowerBound(x, true)</span></p>
            </td>
        </tr>
        <tr class="c31">
            <td class="c19" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">Valoarea cheii &lt;= y</span></p>
            </td>
            <td class="c11" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">IDBKeyRange.upperBound(y)</span></p>
            </td>
        </tr>
        <tr class="c9">
            <td class="c19" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">Valoarea cheii &lt; y</span></p>
            </td>
            <td class="c11" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">IDBKeyRange.upperBound(y, true)</span></p>
            </td>
        </tr>
        <tr class="c12">
            <td class="c19" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">Valoarea cheii &gt;= x &#537;i &lt;= y</span></p>
            </td>
            <td class="c11" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">IDBKeyRange.bound(x, y)</span></p>
            </td>
        </tr>
        <tr class="c12">
            <td class="c19" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">Valoarea cheii &gt; x &lt; y</span></p>
            </td>
            <td class="c11" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">IDBKeyRange.bound(x, y, true, true)</span></p>
            </td>
        </tr>
        <tr class="c12">
            <td class="c19" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">Valoarea cheii &gt; x &#537;i &lt;= y</span></p>
            </td>
            <td class="c11" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">IDBKeyRange.bound(x, y, true, false)</span></p>
            </td>
        </tr>
        <tr class="c12">
            <td class="c19" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">Valoarea cheii &gt;= x &#537;i &lt; y</span></p>
            </td>
            <td class="c11" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">IDBKeyRange.bound(x, y, false, true)</span></p>
            </td>
        </tr>
        <tr class="c12">
            <td class="c22" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">Valoarea cheii = z</span></p>
            </td>
            <td class="c29" colspan="1" rowspan="1">
                <p class="c0"><span class="c1">IDBKeyRange.only(z)</span></p>
            </td>
        </tr>
    </table>
    <p class="c0 c10"><span class="c1"></span></p>
    <p class="c0 c10"><span class="c1"></span></p>
    <p class="c0 c24"><span class="c1">De exemplu, ob&#539;inem toate obiectele ale c&#259;ror valoare a cheii nu este
            mai mare de 2:</span></p>
    <p class="c0 c10"><span class="c1"></span></p><a id="t.846db3b20c1c81518a6014ab9b133d8086f71c0e"></a><a
        id="t.4"></a>
    <table class="c6">
        <tr class="c14">
            <td class="c23" colspan="1" rowspan="1">
                <p class="c0"><span class="c2">const</span><span class="c4 c5">&nbsp;countRequest =
                        userStore.count(IDBKeyRange.upperBound(</span><span class="c4 c15">2</span><span
                        class="c4 c5">));<br>countRequest.onsuccess = () =&gt; </span><span
                        class="c4 c27">console</span><span class="c4 c5">.log(</span><span
                        class="c4 c17">&quot;Num&#259;rul de utilizatori:&quot;</span><span class="c4 c5">,
                        countRequest.result);</span></p>
            </td>
        </tr>
    </table>
    <p class="c0 c10"><span class="c1"></span></p>
    <p class="c0 c10"><span class="c1"></span></p>
    <p class="c0 c10"><span class="c1"></span></p>
</body>

</html>