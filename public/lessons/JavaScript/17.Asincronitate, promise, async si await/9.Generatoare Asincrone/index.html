<html>

<head>
    <meta content="text/html; charset=UTF-8" http-equiv="content-type">
    <link rel="stylesheet" type="text/css" href="/lessons/styles.css">
</head>

<body class="c17 doc-content">
    <h1 class="c8 c18">Generatoare Asincrone. </h1>
    <p class="c1"><span class="c3"></span></p>
    <p class="c8"><span class="c13">Iteratoarele asincrone ne deschid calea c&#259;tre crearea generatoarelor asincrone.
            Generatoarele asincrone ne permit s&#259; folosim operatorul </span><span class="c5">await,</span><span
            class="c3">&nbsp;s&#259; primim &#537;i s&#259; return&#259;m date &icirc;ntr-un mod asincron.</span></p>
    <p class="c1"><span class="c3"></span></p>
    <p class="c8"><span class="c13">Pentru a defini un generator asincron, se pune operatorul </span><span
            class="c5">async </span><span class="c3">&icirc;naintea func&#539;iei generator:</span></p>
    <p class="c1"><span class="c3"></span></p><a id="t.a8ba8b2b0105bd728ca119e5ef2a540545d8421d"></a><a id="t.0"></a>
    <table class="c12">
        <tr class="c15">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c10"><span class="c9">async</span><span class="c0">&nbsp;</span><span
                        class="c9">function</span><span class="c0">* </span><span class="c4">nume_func</span><span
                        class="c0">&#539;</span><span class="c4">ie_generator</span><span class="c0">(){<br> &nbsp;
                        &nbsp; <br> &nbsp; &nbsp;</span><span class="c9">yield</span><span
                        class="c0">&nbsp;valoare_returnat&#259;;<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c1"><span class="c3"></span></p>
    <p class="c8"><span class="c3">S&#259; examin&#259;m cel mai simplu generator:</span></p>
    <p class="c1"><span class="c3"></span></p><a id="t.234b608d4f33711e66935b2e55897268a6661f80"></a><a id="t.1"></a>
    <table class="c12">
        <tr class="c15">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c10"><span class="c9">async</span><span class="c0">&nbsp;</span><span
                        class="c9">function</span><span class="c0">* </span><span
                        class="c4">generatePersonAsync</span><span class="c0">(){<br> &nbsp; &nbsp;</span><span
                        class="c9">yield</span><span class="c0">&nbsp;</span><span
                        class="c11">&quot;Tom&quot;</span><span class="c0">; &nbsp; &nbsp;<br>}</span></p>
            </td>
        </tr>
    </table>
    <p class="c1"><span class="c3"></span></p>
    <p class="c8"><span class="c3">Aici este definit un generator asincron generatePersonAsync, &icirc;n care se
            returneaz&#259; o singur&#259; valoare - &#537;irul &quot;Tom&quot;.</span></p>
    <p class="c1"><span class="c3"></span></p>
    <p class="c8"><span class="c13">Particularitatea generatorului asincron este c&#259; la apelarea metodei
            sale</span><span class="c5">&nbsp;next() </span><span class="c13">se returneaz&#259; un obiect Promise.
            &#536;i obiectul Promise, la r&acirc;ndul s&#259;u, returneaz&#259; un obiect cu dou&#259;
            propriet&#259;&#539;i</span><span class="c2">&nbsp;{ value, done }</span><span class="c13">, unde
        </span><span class="c2">value </span><span class="c13">de&#539;ine valoarea returnat&#259; &#537;i </span><span
            class="c2">done </span><span class="c3">indic&#259; dac&#259; &icirc;n generator mai sunt date
            disponibile.</span></p>
    <p class="c1"><span class="c3"></span></p>
    <p class="c8"><span class="c3">De exemplu, s&#259; lu&#259;m generatorul asincron definit mai sus:</span></p>
    <p class="c1"><span class="c3"></span></p><a id="t.9ed034d0d5bd9db73bc17b93b242fa118d91c05b"></a><a id="t.2"></a>
    <table class="c12">
        <tr class="c15">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c10"><span class="c9">async</span><span class="c0">&nbsp;</span><span
                        class="c9">function</span><span class="c0">* </span><span
                        class="c4">generatePersonAsync</span><span class="c0">(){<br> &nbsp; &nbsp;</span><span
                        class="c9">yield</span><span class="c0">&nbsp;</span><span
                        class="c11">&quot;Tom&quot;</span><span class="c0">; &nbsp; &nbsp;<br>}<br></span><span
                        class="c9">const</span><span class="c0">&nbsp;personGenerator =
                        generatePersonAsync();<br>personGenerator.next(); </span><span class="c6">// Promise</span></p>
            </td>
        </tr>
    </table>
    <p class="c1"><span class="c3"></span></p>
    <p class="c8"><span class="c13">Aici, prin metoda </span><span class="c2">next()</span><span
            class="c13">&nbsp;ob&#539;inem un promise. Apoi, prin metoda </span><span class="c2">then()</span><span
            class="c3">&nbsp;putem ob&#539;ine obiectul din promise:</span></p>
    <p class="c1"><span class="c3"></span></p><a id="t.4e332af4ba0bfbd0fd48b201b56a86cb370dd31f"></a><a id="t.3"></a>
    <table class="c12">
        <tr class="c15">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c10"><span class="c9">const</span><span class="c0">&nbsp;personGenerator =
                        generatePersonAsync();<br>personGenerator.next()<br> &nbsp; &nbsp;.then(data =&gt; </span><span
                        class="c4">console</span><span class="c0">.log(data)); &nbsp; &nbsp;</span><span class="c6">//
                        {value: &quot;Tom&quot;, done: false}</span></p>
            </td>
        </tr>
    </table>
    <p class="c1"><span class="c3"></span></p>
    <p class="c8"><span class="c3">&#536;i la accesarea propriet&#259;&#539;ii value a obiectului ob&#539;inut din
            promise, putem ob&#539;ine datele:</span></p>
    <p class="c1"><span class="c3"></span></p><a id="t.64a57451da99dab1ca495eaad4e1e06117dcf045"></a><a id="t.4"></a>
    <table class="c12">
        <tr class="c15">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c10"><span class="c9">const</span><span class="c0">&nbsp;personGenerator =
                        generatePersonAsync();<br>personGenerator.next()<br> &nbsp; &nbsp;.then(data =&gt; </span><span
                        class="c4">console</span><span class="c0">.log(data.value)); &nbsp;</span><span class="c6">//
                        Tom</span></p>
            </td>
        </tr>
    </table>
    <p class="c1"><span class="c3"></span></p>
    <p class="c8"><span class="c13">Cu ajutorul operatorului </span><span class="c5">await </span><span
            class="c13">putem ob&#539;ine datele din metoda</span><span class="c2">&nbsp;next()</span><span
            class="c3">&nbsp;a generatorului:</span></p>
    <p class="c1"><span class="c3"></span></p><a id="t.87b4cbbcee30ac6bc8a6ee9ff6e79bb9804aaee1"></a><a id="t.5"></a>
    <table class="c12">
        <tr class="c15">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c10"><span class="c9">async</span><span class="c0">&nbsp;</span><span
                        class="c9">function</span><span class="c0">* </span><span
                        class="c4">generatePersonAsync</span><span class="c0">(){<br> &nbsp; &nbsp;</span><span
                        class="c9">yield</span><span class="c0">&nbsp;</span><span
                        class="c11">&quot;Tom&quot;</span><span class="c0">;<br> &nbsp; &nbsp;</span><span
                        class="c9">yield</span><span class="c0">&nbsp;</span><span
                        class="c11">&quot;Sam&quot;</span><span class="c0">;<br> &nbsp; &nbsp;</span><span
                        class="c9">yield</span><span class="c0">&nbsp;</span><span
                        class="c11">&quot;Bob&quot;</span><span class="c0">;<br>}<br></span><span
                        class="c9">async</span><span class="c0">&nbsp;</span><span class="c9">function</span><span
                        class="c0">&nbsp;</span><span class="c4">printPeopleAsync</span><span class="c0">(){<br> &nbsp;
                        &nbsp;</span><span class="c9">const</span><span class="c0">&nbsp;personGenerator =
                        generatePersonAsync();<br> &nbsp; &nbsp;</span><span class="c9">while</span><span
                        class="c0">(!(person = </span><span class="c9">await</span><span
                        class="c0">&nbsp;personGenerator.next()).done){<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span
                        class="c4">console</span><span class="c0">.log(person.value);<br> &nbsp; &nbsp;}<br>}<br>
                        <br>printPeopleAsync();</span></p>
            </td>
        </tr>
    </table>
    <p class="c1"><span class="c3"></span></p>
    <p class="c8"><span class="c3">Output-ul &icirc;n consol&#259;:</span></p>
    <p class="c1"><span class="c3"></span></p><a id="t.a954efb5bfdd31dcd109d44118f252adb191c229"></a><a id="t.6"></a>
    <table class="c12">
        <tr class="c15">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c10"><span class="c0">Tom<br>Sam<br>Bob</span></p>
            </td>
        </tr>
    </table>
    <p class="c1"><span class="c3"></span></p>
    <p class="c8"><span class="c13">Deoarece generatorul asincron reprezint&#259; un iterator asincron, datele
            generatorului pot fi, de asemenea, ob&#539;inute prin ciclul</span><span
            class="c5">&nbsp;for-await-of</span><span class="c3">:</span></p>
    <p class="c1"><span class="c3"></span></p><a id="t.c14493093a77784209f775e23a4945f072aa4af4"></a><a id="t.7"></a>
    <table class="c12">
        <tr class="c15">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c10"><span class="c9">async</span><span class="c0">&nbsp;</span><span
                        class="c9">function</span><span class="c0">* </span><span
                        class="c4">generatePersonAsync</span><span class="c0">(){<br> &nbsp; &nbsp;</span><span
                        class="c9">yield</span><span class="c0">&nbsp;</span><span
                        class="c11">&quot;Tom&quot;</span><span class="c0">;<br> &nbsp; &nbsp;</span><span
                        class="c9">yield</span><span class="c0">&nbsp;</span><span
                        class="c11">&quot;Sam&quot;</span><span class="c0">;<br> &nbsp; &nbsp;</span><span
                        class="c9">yield</span><span class="c0">&nbsp;</span><span
                        class="c11">&quot;Bob&quot;</span><span class="c0">;<br>}<br></span><span
                        class="c9">async</span><span class="c0">&nbsp;</span><span class="c9">function</span><span
                        class="c0">&nbsp;</span><span class="c4">printPeopleAsync</span><span class="c0">(){<br> &nbsp;
                        &nbsp;</span><span class="c9">const</span><span class="c0">&nbsp;personGenerator =
                        generatePersonAsync();<br> &nbsp; &nbsp;</span><span class="c9">for</span><span
                        class="c0">&nbsp;</span><span class="c9">await</span><span class="c0">(person </span><span
                        class="c9">of</span><span class="c0">&nbsp;personGenerator){<br> &nbsp; &nbsp; &nbsp;
                        &nbsp;</span><span class="c4">console</span><span class="c0">.log(person);<br> &nbsp;
                        &nbsp;}<br>}<br> <br>printPeopleAsync();<br></span><span class="c6">// Tom</span><span
                        class="c0"><br></span><span class="c6">// Sam</span><span class="c0"><br></span><span
                        class="c6">// Bob</span></p>
            </td>
        </tr>
    </table>
    <p class="c1"><span class="c3"></span></p>
    <p class="c8"><span class="c7">await &icirc;n generatoarele asincrone.</span></p>
    <p class="c1"><span class="c7"></span></p>
    <p class="c8"><span class="c13">Principalul avantaj al generatoarelor asincrone este c&#259; putem folosi operatorul
        </span><span class="c5">await </span><span class="c3">&icirc;n ele &#537;i, &icirc;n consecin&#539;&#259;, putem
            ob&#539;ine date din surse de date care folosesc API-uri asincrone.</span></p>
    <p class="c1"><span class="c3"></span></p><a id="t.1709a57eadeeddbadc580f2bdcae46587d400175"></a><a id="t.8"></a>
    <table class="c12">
        <tr class="c15">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c10"><span class="c9">async</span><span class="c0">&nbsp;</span><span
                        class="c9">function</span><span class="c0">* </span><span
                        class="c4">generatePersonAsync</span><span class="c0">(people){<br> &nbsp; &nbsp;</span><span
                        class="c9">for</span><span class="c0">(</span><span class="c9">const</span><span
                        class="c0">&nbsp;person </span><span class="c9">of</span><span class="c0">&nbsp;people)<br>
                        &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="c9">yield</span><span
                        class="c0">&nbsp;</span><span class="c9">await</span><span class="c0">&nbsp;</span><span
                        class="c9">new</span><span class="c0">&nbsp;</span><span class="c4">Promise</span><span
                        class="c0">(resolve =&gt; setTimeout(() =&gt; resolve(person), </span><span
                        class="c13 c16">2000</span><span class="c0">));<br>}<br></span><span
                        class="c9">async</span><span class="c0">&nbsp;</span><span class="c9">function</span><span
                        class="c0">&nbsp;</span><span class="c4">printPeopleAsync</span><span class="c0">(people){<br>
                        &nbsp; &nbsp;</span><span class="c9">for</span><span class="c0">&nbsp;</span><span
                        class="c9">await</span><span class="c0">&nbsp;(</span><span class="c9">const</span><span
                        class="c0">&nbsp;item </span><span class="c9">of</span><span
                        class="c0">&nbsp;generatePersonAsync(people)) {<br> &nbsp; &nbsp; &nbsp; &nbsp;</span><span
                        class="c4">console</span><span class="c0">.log(item); <br> &nbsp;
                        &nbsp;}<br>}<br>printPeopleAsync([</span><span class="c11">&quot;Tom&quot;</span><span
                        class="c0">, </span><span class="c11">&quot;Sam&quot;</span><span class="c0">, </span><span
                        class="c11">&quot;Bob&quot;</span><span class="c0">]);</span></p>
            </td>
        </tr>
    </table>
    <p class="c1"><span class="c3"></span></p>
    <p class="c8"><span class="c3">Aici, pentru a imita ob&#539;inerea datelor dintr-o surs&#259; de date
            asincron&#259;, se utilizeaz&#259; un promise care returneaz&#259; unul dintre elementele array-ului care
            este transmis &icirc;n func&#539;ia generatorului dup&#259; 2000 de secunde:</span></p>
    <p class="c1"><span class="c3"></span></p><a id="t.14ec9bb214c78b198c010efe2093dfb0942f7877"></a><a id="t.9"></a>
    <table class="c12">
        <tr class="c15">
            <td class="c14" colspan="1" rowspan="1">
                <p class="c10"><span class="c9">yield</span><span class="c0">&nbsp;</span><span
                        class="c9">await</span><span class="c0">&nbsp;</span><span class="c9">new</span><span
                        class="c0">&nbsp;</span><span class="c4">Promise</span><span class="c0">(resolve =&gt;
                        setTimeout(() =&gt; resolve(person), </span><span class="c13 c16">2000</span><span
                        class="c0">));</span></p>
            </td>
        </tr>
    </table>
    <p class="c1"><span class="c3"></span></p>
    <p class="c1"><span class="c3"></span></p>
</body>

</html>